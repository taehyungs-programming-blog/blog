---
layout: default
title: "(03. IGameFrameworkInitStateInterface)"
parent: "(UE Lyra Review)"
has_children: true
nav_order: 1
---

* [Get Code ğŸŒŸ](https://github.com/Arthur880708/LyraCloneSample)

## GameplayTag ìƒì„± / ì‚¬ìš©

* ìš°ì„  GameplayTagê°€ í•„ìš”í•œ ì´ìœ ëŠ” Componentì˜ ì´ˆê¸°í™” ìˆœì„œë¥¼ ì •í•˜ê¸° ìœ„í•¨ì´ë‹¤.

```cpp
/** forward declaration */
class UGameplayTagsManager;

struct FGameplayTags
{
	static const FGameplayTags& Get() { return GameplayTags; }
	static void InitializeNativeTags();

	void AddTag(FGameplayTag& OutTag, const ANSICHAR* TagName, const ANSICHAR* TagComment);
	void AddAllTags(UGameplayTagsManager& Manager);

	// 4ê°œì˜ íƒœê·¸ë¥¼ ë§Œë“¤ê² ë‹¤.
	FGameplayTag InitState_Spawned;
	FGameplayTag InitState_DataAvailable;
	FGameplayTag InitState_DataInitialized;
	FGameplayTag InitState_GameplayReady;

	// ì´ê±´ Enhanced Input íƒœê·¸
	FGameplayTag InputTag_Move;
	FGameplayTag InputTag_Look_Mouse;

private:
	// static ë³€ìˆ˜ ì´ˆê¸°í™”ëŠ” .cppì— í•´ì£¼ëŠ” ê²ƒì„ ìŠì§€ ë§ê¸°!
	static FGameplayTags GameplayTags;
};
```

```cpp
FGameplayTags FGameplayTags::GameplayTags;

void FGameplayTags::InitializeNativeTags()
{
	UGameplayTagsManager& Manager = UGameplayTagsManager::Get();
	GameplayTags.AddAllTags(Manager);
}

void FGameplayTags::AddTag(FGameplayTag& OutTag, const ANSICHAR* TagName, const ANSICHAR* TagComment)
{
	OutTag = UGameplayTagsManager::Get().AddNativeGameplayTag(FName(TagName), FString(TEXT("(Native) ")) + FString(TagComment));
}

void FGameplayTags::AddAllTags(UGameplayTagsManager& Manager)
{
	AddTag(InitState_Spawned, "InitState.Spawned", "1: Actor/Component has initially spawned and can be extended");
	AddTag(InitState_DataAvailable, "InitState.DataAvailable", "2: All required data has been loaded/replicated and is ready for initialization");
	AddTag(InitState_DataInitialized, "InitState.DataInitialized", "3: The available data has been initialized for this actor/component, but it is not ready for full gameplay");
	AddTag(InitState_GameplayReady, "InitState.GameplayReady", "4: The actor/component is fully ready for active gameplay");

	AddTag(InputTag_Move, "InputTag.Move", "");
	AddTag(InputTag_Look_Mouse, "InputTag.Look.Mouse", "");
}
```

* ì‚¬ìš©ì€ ì´ëŸ°ì‹

```cpp
void UHakPawnExtensionComponent::OnActorInitStateChanged(const FActorInitStateChangedParams& Params)
{
	if (Params.FeatureName != NAME_ActorFeatureName)
	{
		const FHakGameplayTags& InitTags = FHakGameplayTags::Get();
		if (Params.FeatureState == InitTags.InitState_DataAvailable)
		{
			CheckDefaultInitialization();
		}
	}
}
```

---

## GameInstanceì™€ GameplayTag ì ìš©í•´ ì‚¬ìš©í•˜ê¸°

```cpp
UCLASS()
class GAME_API UGameInstance : public UCommonGameInstance
{
	GENERATED_BODY()

	virtual void Init() override;
	virtual void Shutdown() override;
};
```

```cpp
void UGameInstance::Init()
{
	Super::Init();

	UGameFrameworkComponentManager* ComponentManager = GetSubsystem<UGameFrameworkComponentManager>(this);
	if (ensure(ComponentManager))
	{
		const FHakGameplayTags& GameplayTags = FHakGameplayTags::Get();

        // í•µì‹¬ì´ ì´ ì½”ë“œì´ë‹¤.
            // GameplayTagì˜ ìˆœì„œë¥¼ ì§€ì •í• ìˆ˜ ìˆë‹¤.

        // FGameplayTag(Init) -> InitState_Spawned
		ComponentManager->RegisterInitState(GameplayTags.InitState_Spawned, false, FGameplayTag());
        // InitState_Spawned -> InitState_DataAvailable
		ComponentManager->RegisterInitState(GameplayTags.InitState_DataAvailable, false, GameplayTags.InitState_Spawned);
        // InitState_DataAvailable -> InitState_DataInitialized
		ComponentManager->RegisterInitState(GameplayTags.InitState_DataInitialized, false, GameplayTags.InitState_DataAvailable);
        // InitState_DataInitialized -> InitState_GameplayReady
		ComponentManager->RegisterInitState(GameplayTags.InitState_GameplayReady, false, GameplayTags.InitState_DataInitialized);
	}
}

void UGameInstance::Shutdown()
{
	Super::Shutdown();
}
```

* ì´ê±¸ ê¼­ GameInstanceì— ë„£ì–´ì•¼ í•˜ë‚˜?
    * ê³µì‹ë¬¸ì„œì— ì¶”ì²œí•˜ëŠ” ì‚¬í•­ì„.
* ??? ì´ê±¸ ë˜ ì–´ë””ì„œ ì“°ë‚˜?
    * Componentì—ì„œ ì‚¬ìš©í•˜ê²Œ ë˜ëŠ”ë° ì•„ë˜ë¥¼ ì‚´í´ë³´ì

```cpp
// ì•„ë˜ ë‘ í´ë˜ìŠ¤ë¥¼ ë§Œë“¤ì—ˆë‹¤ ê°€ì •í•˜ì.

UCLASS(Blueprintable, Meta = (BlueprintSpawnableComponent))
class GAME_API UHeroComponent : public UPawnComponent, public IGameFrameworkInitStateInterface

// ...

UCLASS()
class GAME_API UPawnExtensionComponent : public UPawnComponent, public IGameFrameworkInitStateInterface
```

* ë‘ Componentëª¨ë‘ Pawnì— ë¶™ê¸°ëŠ” í•˜ì§€ë§Œ, `UPawnExtensionComponent`ê°€ `UHeroComponent`ë¥¼ ê´€ë¦¬í•œë‹¤ê³  ìƒê°í•˜ë©´ëœë‹¤.
    * ì´ë ‡ê²Œ í•¨ìœ¼ë¡œì¨ ìƒì„±ìˆœì„œë¥¼ `UPawnExtensionComponent`ê°€ ê´€ë¦¬í•˜ê³  ê·¸ ê´€ë¦¬ ë°©ë²•ì´ GameplayTagë¥¼ í†µí•´ ì´ë£¨ì–´ì§„ë‹¤.

* ì¢€ ë” ìì„¸í•œê²ƒì€ ë‹¤ìŒì¥ì—ì„œ ì„¤ëª…