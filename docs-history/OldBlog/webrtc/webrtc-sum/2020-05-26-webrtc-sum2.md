---
title: "webrtc : ì •ë¦¬ 2 - í†µí™”ë¥¼ ì›í•˜ëŠ” Aê°€ Signal Serverë¡œ SDP(Session Description Protocol)ì„ ë³´ë‚¸ë‹¤."
permalink: webrtc/sum_2/                # link ì§ì ‘ ì§€ì •
comments: true                  # for disqus Comments
categories:                     # for categories
date: 2020-05-26 00:00:00 -0000
last_modified_at: 2020-05-26 00:00:00 -0000
sidebar:
  title: "webrtc ëª©ì°¨"
  nav: webrtc
tag:
  - webrtc
category:
  - category
excerpt: ""
header:
  teaser: /file/image/webrtc-page-teaser.gif
---

* [Git](https://github.com/8BitsCoding/webrtc-sum2)

```s
$ git clone https://github.com/8BitsCoding/webrtc-sum2
$ npm install
$ node server
```

ëª‡ ë²ˆì„ ì ì—ˆì§€ë§Œ í˜¹ì‹œë‚˜ ì•„ë˜ì™€ ê°™ì€ ì—ëŸ¬ê°€ ë°œìƒí•œë‹¤ë©´??

```
Error: Cannot find module 'express/node_modules/connect'
Require stack:
- C:\git\webrtc\webrtc-basic-arrange\node_modules\express.io\lib\index.coffee
- C:\git\webrtc\webrtc-basic-arrange\node_modules\express.io\switch.js
- C:\git\webrtc\webrtc-basic-arrange\server.js
[90m    at Function.Module._resolveFilename (internal/modules/cjs/loader.js:793:17)[39m
```

ë‹¹í™©í•˜ì§€ ì•Šê³  `node_modules\express`í´ë”ë¡œ ë“¤ì–´ê°€ì„œ

```s
% npm install express
```

`localhost:3000` ì ‘ì†

ì—¬ê¸°ëŠ” í•µì‹¬ì½”ë“œê°€ ë§ì€ë° SDPë¥¼ ìœ„ì£¼ë¡œ ì •ë¦¬í•´ì•¼ í•˜ë‹ˆ ì•„ë˜ë§Œ ë³´ì.

```js
// sdpëŠ” ì•„ë˜ì™€ ê°™ì´ ë³´ë‚¸ë‹¤.
function sendLocalDesc(desc) {
  rtcPeerConn.setLocalDescription(desc, function () {
    io.emit('signal',{"type":"SDP", "message": JSON.stringify({ 'sdp': rtcPeerConn.localDescription }), "room":SIGNAL_ROOM});
  }, logError);
}
```

ê·¸ëŸ¼ ì–´ë””ì„œ `sendLocalDesc`ë¥¼ í˜¸ì¶œí•˜ë‚˜?

```js
// 01. sdp ë©”ì‹œì§€ë¥¼ ë°›ì€ê²½ìš° ìì‹ ì˜ sdpë¥¼ ì „ë‹¬í•´ ì£¼ê¸°ìœ„í•´ ìƒì„±
io.on('signaling_message', function(data) {
  // ...
  if (data.type != "user_here") {
    var message = JSON.parse(data.message);
    if (message.sdp) {
      rtcPeerConn.setRemoteDescription(new RTCSessionDescription(message.sdp), function () {
        // if we received an offer, we need to answer
        if (rtcPeerConn.remoteDescription.type == 'offer') {
          displaySignalMessage("</br></br> createAnswer </br></br>");
          rtcPeerConn.createAnswer(sendLocalDesc, logError);
        }
      }, logError);
    }
```

```js
function startSignaling() {
  displaySignalMessage("starting signaling...");
  
  rtcPeerConn = new webkitRTCPeerConnection(configuration, null);
  dataChannel = rtcPeerConn.createDataChannel('textMessages', dataChannelOptions);
  
  // 02. ì´ˆê¸° í†µì‹  í†µì‹ ì„ ì‹œì‘ì‹œ ìì‹ ì˜ sdpë¥¼ ì „ë‹¬

  rtcPeerConn.onnegotiationneeded = function () {
    displaySignalMessage("</br></br> on negotiationn, Offer </br></br>");
    rtcPeerConn.createOffer(sendLocalDesc, logError);
  }
```