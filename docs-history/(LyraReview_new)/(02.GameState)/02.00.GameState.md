---
layout: default
title: "(02. GameState)"
parent: "(UE Lyra Review)"
has_children: true
nav_order: 1
---

* [Get Code ğŸŒŸ](https://github.com/Arthur880708/LyraCloneSample)

---

## Unreal GameStateì˜ ì´í•´

* ê²Œì„ ì „ì²´ ìƒíƒœ ê´€ë¦¬:
    * ëª¨ë“  í”Œë ˆì´ì–´ê°€ ê³µìœ í•˜ëŠ” ê²Œì„ ë°ì´í„° ê´€ë¦¬
    * ì˜ˆ: ê²½ê¸° ì‹œê°„, ì ìˆ˜, ê²Œì„ ë‹¨ê³„(í˜ì´ì¦ˆ) ë“±
* ë„¤íŠ¸ì›Œí¬ ë™ê¸°í™”:
    * ì„œë²„ì™€ ëª¨ë“  í´ë¼ì´ì–¸íŠ¸ ê°„ì— ìë™ìœ¼ë¡œ ìƒíƒœ ë™ê¸°í™”
    * ëª¨ë“  í”Œë ˆì´ì–´ê°€ ë™ì¼í•œ ê²Œì„ ìƒíƒœë¥¼ ë³´ë„ë¡ ë³´ì¥
* GameModeì™€ì˜ ì°¨ì´ì :
    * GameMode: ì„œë²„ì—ë§Œ ì¡´ì¬, ê²Œì„ ê·œì¹™ ê´€ë¦¬
    * GameState: ì„œë²„ì™€ í´ë¼ì´ì–¸íŠ¸ ëª¨ë‘ì— ì¡´ì¬, ê²Œì„ ìƒíƒœ ë°ì´í„° ê´€ë¦¬
* íŠ¹ì§•:
    * ë ˆí”Œë¦¬ì¼€ì´ì…˜(ë³µì œ) ì§€ì›
    * ëª¨ë“  í”Œë ˆì´ì–´ê°€ ì ‘ê·¼ ê°€ëŠ¥
    * ê²Œì„ ì„¸ì…˜ ë™ì•ˆ ì§€ì†ë¨
* ì‰½ê²Œ ë§í•´ì„œ, GameStateëŠ” "í˜„ì¬ ê²Œì„ì´ ì–´ë–¤ ìƒíƒœì¸ê°€?"ì— ëŒ€í•œ ì •ë³´ë¥¼ ëª¨ë“  í”Œë ˆì´ì–´ê°€ ê³µìœ í•  ìˆ˜ ìˆë„ë¡ ê´€ë¦¬í•˜ëŠ” í´ë˜ìŠ¤ì…ë‹ˆë‹¤.

```cpp
// Example
UCLASS()
class ASoccerGameState : public AGameStateBase
{
    GENERATED_BODY()
public:
    // íŒ€ ì ìˆ˜
    UPROPERTY(Replicated)
    int32 HomeTeamScore;
    
    UPROPERTY(Replicated)
    int32 AwayTeamScore;
    
    // ê²½ê¸° ì‹œê°„
    UPROPERTY(Replicated)
    float MatchTime;
    
    // í˜„ì¬ í•˜í”„
    UPROPERTY(Replicated)
    int32 CurrentHalf;
    
    // ë¶€ìƒ ì‹œê°„
    UPROPERTY(Replicated)
    float InjuryTime;
    
    // ì ìœ ìœ¨
    UPROPERTY(Replicated)
    float HomeTeamPossession;
};
```

```cpp
UCLASS()
class AMyGameState : public AGameStateBase
{
    GENERATED_BODY()
public:
    AMyGameState();
    
    // 1. UPROPERTYì— Replicated ì§€ì •
    UPROPERTY(Replicated)
    int32 Score;
    
    // 2. ReplicatedUsingì„ ì‚¬ìš©í•˜ë©´ ê°’ì´ ë³€ê²½ë  ë•Œ í•¨ìˆ˜ í˜¸ì¶œ
    UPROPERTY(ReplicatedUsing = OnRep_GamePhase)
    EGamePhase CurrentPhase;
    
    UFUNCTION()
    void OnRep_GamePhase();  // í´ë¼ì´ì–¸íŠ¸ì—ì„œë§Œ í˜¸ì¶œë¨
    
    // 3. ë ˆí”Œë¦¬ì¼€ì´ì…˜ ê·œì¹™ ì„¤ì •ì„ ìœ„í•œ í•„ìˆ˜ í•¨ìˆ˜
    virtual void GetLifetimeReplicatedProps(TArray<FLifetimeProperty>& OutLifetimeProps) const override;
};

// cpp íŒŒì¼
AMyGameState::AMyGameState()
{
    // ë°˜ë“œì‹œ trueë¡œ ì„¤ì •í•´ì•¼ ë ˆí”Œë¦¬ì¼€ì´ì…˜ì´ ë™ì‘
    bReplicates = true;
}

void AMyGameState::GetLifetimeReplicatedProps(TArray<FLifetimeProperty>& OutLifetimeProps) const
{
    Super::GetLifetimeReplicatedProps(OutLifetimeProps);
    
    // ë ˆí”Œë¦¬ì¼€ì´ì…˜ ê·œì¹™ ë“±ë¡
    DOREPLIFETIME(AMyGameState, Score);
    DOREPLIFETIME(AMyGameState, CurrentPhase);
    
    // ì¡°ê±´ë¶€ ë ˆí”Œë¦¬ì¼€ì´ì…˜ë„ ê°€ëŠ¥
    DOREPLIFETIME_CONDITION(AMyGameState, SomeValue, COND_OwnerOnly);
}

// RepNotify í•¨ìˆ˜ êµ¬í˜„
void AMyGameState::OnRep_GamePhase()
{
    // CurrentPhaseê°€ ë³€ê²½ë˜ì—ˆì„ ë•Œ í´ë¼ì´ì–¸íŠ¸ì—ì„œ ì‹¤í–‰í•  ì½”ë“œ
    // ì˜ˆ: UI ì—…ë°ì´íŠ¸, ì´í™íŠ¸ ì¬ìƒ ë“±
    UpdateGamePhaseUI();
}
```

---

## GameMode Vs GameState

```
GameMode:
- ì„œë²„ì—ë§Œ ì¡´ì¬
- í´ë¼ì´ì–¸íŠ¸ëŠ” ì ‘ê·¼ ë¶ˆê°€
- ë ˆí”Œë¦¬ì¼€ì´ì…˜(ë³µì œ) ì•ˆ ë¨

GameState:
- ì„œë²„ì™€ ëª¨ë“  í´ë¼ì´ì–¸íŠ¸ì— ì¡´ì¬
- ëª¨ë“  í´ë¼ì´ì–¸íŠ¸ê°€ ì ‘ê·¼ ê°€ëŠ¥
- ìë™ìœ¼ë¡œ ë ˆí”Œë¦¬ì¼€ì´ì…˜(ë³µì œ) ë¨
```

* ìš”ì•½í•˜ë©´:
    * GameMode: "ê²Œì„ì„ ì–´ë–»ê²Œ ì§„í–‰í•  ê²ƒì¸ê°€?"
    * GameState: "ê²Œì„ì´ í˜„ì¬ ì–´ë–¤ ìƒíƒœì¸ê°€?"
* ì´ëŸ¬í•œ ë¶„ë¦¬ëŠ” ë„¤íŠ¸ì›Œí¬ ê²Œì„ì—ì„œ ë§¤ìš° ì¤‘ìš”í•©ë‹ˆë‹¤. í´ë¼ì´ì–¸íŠ¸ë“¤ì€ ê²Œì„ ê·œì¹™(GameMode)ì— ì§ì ‘ ì ‘ê·¼í•  í•„ìš”ëŠ” ì—†ì§€ë§Œ, í˜„ì¬ ê²Œì„ ìƒíƒœ(GameState)ëŠ” ë°˜ë“œì‹œ ì•Œì•„ì•¼ í•˜ê¸° ë•Œë¬¸ì…ë‹ˆë‹¤.

---

## ë‚˜ëŠ” ì–´ë–»ê²Œ ì¼ë‚˜?

```cpp
UCLASS()
class MyGAME_API AMyGameState : public AGameStateBase
{
	GENERATED_BODY()
public:
	AMyGameState();

public:
    // ìŒ? ë­”ê°€ Componentê°€ ìˆëŠ”ë°?
        // ì´ê±´ ë‹¤ìŒì¥ì—ì„œ ì„¤ëª…
	UPROPERTY()
	TObjectPtr<UMyExperienceManagerComponent> ExperienceManagerComponent;
};

```