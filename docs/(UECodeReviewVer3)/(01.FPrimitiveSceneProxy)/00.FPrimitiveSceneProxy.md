---
layout: default
title: "(01. FPrimitiveSceneProxy)"
parent: "(UnrealEngine Code-Review Ver.3 ğŸ³)"
has_children: true
nav_order: 1
---

<p align="center">
  <img src="https://taehyungs-programming-blog.github.io/blog/assets/images/unreal_review_ver3/basic/1_1.png"/>
</p>

```cpp
// StaticMeshComponentì˜ SceneProxy ìƒì„± ì˜ˆì‹œ
class FStaticMeshSceneProxy : public FPrimitiveSceneProxy 
{
public:
    FStaticMeshSceneProxy(UStaticMeshComponent* Component)
        : FPrimitiveSceneProxy(Component)
    {
        // ë Œë”ë§ì— í•„ìš”í•œ ë°ì´í„°ë§Œ ìºì‹œ
        bCastShadow = Component->CastShadow;
        MaterialRelevance = Component->GetMaterialRelevance();
        
        // ë©”ì‹œ ë°ì´í„° ì„¤ì •
        if (Component->GetStaticMesh()->RenderData)
        {
            // LOD ë¦¬ì†ŒìŠ¤ ì„¤ì •
            LODResources = &Component->GetStaticMesh()->RenderData->LODResources[0];
            
            // ë²„í…ìŠ¤ íŒ©í† ë¦¬ ì„¤ì • 
            VertexFactory = &LODResources->VertexFactory;
            
            // ë¨¸í‹°ë¦¬ì–¼ ì„¤ì •
            MaterialInterface = Component->GetMaterial(0);
        }
    }

    virtual SIZE_T GetTypeHash() const override
    {
        static size_t UniquePointer;
        return reinterpret_cast<size_t>(&UniquePointer);
    }

    virtual void GetDynamicMeshElements(
        const TArray<const FSceneView*>& Views,
        const FSceneViewFamily& ViewFamily,
        uint32 VisibilityMap,
        FMeshElementCollector& Collector) const override
    {
        // ë©”ì‹œ ì—˜ë¦¬ë¨¼íŠ¸ ìƒì„±
        FMeshBatch& Mesh = Collector.AllocateMesh();
        
        // ë©”ì‹œ ë°ì´í„° ì„¤ì •
        Mesh.VertexFactory = VertexFactory;
        Mesh.MaterialRenderProxy = MaterialInterface->GetRenderProxy();
        
        // ì¸ë±ìŠ¤ ë²„í¼ ì„¤ì •
        Mesh.Elements[0].IndexBuffer = &LODResources->IndexBuffer;
        Mesh.Elements[0].NumPrimitives = LODResources->GetNumTriangles();
        
        // ì½œë ‰í„°ì— ì¶”ê°€
        Collector.AddMesh(ViewIndex, Mesh);
    }

private:
    const FStaticMeshLODResources* LODResources;
    const FVertexFactory* VertexFactory;
    UMaterialInterface* MaterialInterface;
    FMaterialRelevance MaterialRelevance;
};
```

* ì£¼ìš” íŠ¹ì§•:
    * ê²Œì„ ìŠ¤ë ˆë“œì˜ Component ë°ì´í„°ë¥¼ ë Œë” ìŠ¤ë ˆë“œë¡œ ì•ˆì „í•˜ê²Œ ì „ë‹¬
    * ë Œë”ë§ì— í•„ìš”í•œ ìµœì†Œí•œì˜ ë°ì´í„°ë§Œ ë³´ê´€
    * GetTypeHash()ë¥¼ í†µí•´ í”„ë¡ì‹œ íƒ€ì…ë³„ ì •ë ¬ ì§€ì›
    * SetTransform()ì„ í†µí•´ íŠ¸ëœìŠ¤í¼ ì—…ë°ì´íŠ¸
    * GetDynamicMeshElements()ë¥¼ í†µí•´ ì‹¤ì œ ë Œë”ë§ ë°ì´í„° ì œê³µ



