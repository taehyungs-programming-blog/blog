---
layout: default
title: "FScene"
parent: "(01. SceneRender)"
grand_parent: "(UE Code-Review ğŸ³)"
nav_order: 1
---

## Table of contents
{: .no_toc .text-delta }

1. TOC
{:toc}

---

## FScene

* FSceneì€ ë Œë”ë§ ëª¨ë“ˆì—ì„œ ì‚¬ìš©ë˜ëŠ” ë Œë”ë§ ì„¸ê³„(Render World)ë¥¼ ë‚˜íƒ€ë‚´ëŠ” í´ë˜ìŠ¤
* ì£¼ìš” íŠ¹ì§•
    * UWorldì˜ ë Œë”ë§ ë²„ì „
    * í”„ë¦¬ë·° ì—ë””í„°ì—ì„œë„ UWorld ì—†ì´ ìƒì„± ê°€ëŠ¥
    * ë·°ë‚˜ í”„ë ˆì„ê³¼ ë…ë¦½ì ì¸ ë Œë”ëŸ¬ ìƒíƒœ ì €ì¥
    * í”„ë¦¬ë¯¸í‹°ë¸Œì™€ ë¼ì´íŠ¸ì˜ ì¶”ê°€/ì œê±°ê°€ ì£¼ìš” ì‘ì—…

<p align="center">
  <img src="https://taehyungs-programming-blog.github.io/blog/assets/images/unreal_review_ver3/basic/01.05_01.png"/>
</p>

### SOA(Structure of Arrays) êµ¬ì¡°

```cpp
// í”„ë¦¬ë¯¸í‹°ë¸Œ ê´€ë ¨ ë°ì´í„°ë¥¼ SOAë¡œ ê´€ë¦¬
class FScene {
    TArray<FPrimitiveSceneInfo*> Primitives;         // ì”¬ì˜ í”„ë¦¬ë¯¸í‹°ë¸Œ ì •ë³´
    TScenePrimitiveArray<FMatrix> PrimitiveTransforms; // ë³€í™˜ í–‰ë ¬
    TArray<FPrimitiveSceneProxy*> PrimitiveSceneProxies; // í”„ë¡ì‹œ ê°ì²´
    TScenePrimitiveArray<FPrimitiveBounds> PrimitiveBounds; // ê²½ê³„ ì •ë³´
};
```

### íƒ€ì…ë³„ ì •ë ¬ ê´€ë¦¬

```cpp
// í”„ë¦¬ë¯¸í‹°ë¸Œ íƒ€ì…ë³„ë¡œ ì •ë ¬ëœ ìƒíƒœë¥¼ ìœ ì§€í•˜ê¸° ìœ„í•œ í…Œì´ë¸”
struct FTypeOffsetTableEntry {
    SIZE_T PrimitiveSceneProxyType;  // í”„ë¡ì‹œ íƒ€ì…
    uint32 Offset;                   // ë‹¤ìŒ íƒ€ì…ì˜ ì‹œì‘ ì˜¤í”„ì…‹
};
```

---

## ì–´ë–»ê²Œ ì‚¬ìš©ë ê¹Œ?

```cpp
class FRendererModule : public IRendererModule {
    TMap<UWorld*, FScene*> WorldScenes;  // ì›”ë“œë³„ Scene ê´€ë¦¬
    
    FScene* CreateScene(UWorld* World, bool bInRequiresHitProxies) {
        FScene* NewScene = new FScene(World, bInRequiresHitProxies);
        WorldScenes.Add(World, NewScene);
        return NewScene;
    }
};
```

```cpp
class UWorld {
private:
    FScene* Scene;  // ì›”ë“œì˜ ë Œë”ë§ Scene

public:
    void InitializeNewWorld() {
        // ë Œë”ëŸ¬ ëª¨ë“ˆì„ í†µí•´ Scene ìƒì„±
        Scene = GRendererModule->CreateScene(this, true);
    }
};
```

```cpp
class FDeferredShadingRenderer {
    FScene* Scene;

    void Render(FRHICommandListImmediate& RHICmdList) {
        // Sceneì˜ í”„ë¦¬ë¯¸í‹°ë¸Œë“¤ì„ ì´ìš©í•´ ë Œë”ë§ ìˆ˜í–‰
        Scene->UpdateAllPrimitiveSceneInfos();
        RenderBasePass(RHICmdList);
        // ... ë‹¤ë¥¸ ë Œë”ë§ íŒ¨ìŠ¤ë“¤
    }
};
```

<p align="center">
  <img src="https://taehyungs-programming-blog.github.io/blog/assets/images/unreal_review_ver3/basic/01.05_02.png"/>
</p>