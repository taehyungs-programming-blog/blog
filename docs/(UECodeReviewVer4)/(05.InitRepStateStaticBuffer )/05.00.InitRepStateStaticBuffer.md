---
layout: default
title: "(05. InitRepStateStaticBuffer 대하여)"
parent: "(UE Code-Review 🤖)"
has_children: true
nav_order: 1
permalink: docs/review/ue/ver4/05/InitRepStateStaticBuffer
---

## InitRepStateStaticBuffer란?

* `FRepLayout::InitRepStateStaticBuffer`는 언리얼 엔진의 네트워크 복제 시스템에서 사용되는 함수로, 복제할 객체의 현재 상태를 저장하는 그림자 버퍼(Shadow Buffer)를 초기화하는 역할을 합니다.

```cpp
void InitRepStateStaticBuffer(FRepStateStaticBuffer& ShadowData, const FConstRepObjectDataBuffer Source) const
```

* 이 함수는 다음 세 단계로 진행됩니다:
    * 버퍼 할당: `ShadowData.Buffer.SetNumZeroed(ShadowDataBufferSize);`
        * 그림자 버퍼에 필요한 메모리 공간을 할당하고 0으로 초기화합니다.
    * 속성 구조 생성: `ConstructProperties(ShadowData);`
        * 원본 객체와 동일한 속성 구조를 그림자 버퍼에 생성합니다.
        * 이 단계에서는 값은 복사하지 않고, 단지 속성들의 인스턴스를 생성만 합니다.
    * 값 복사: `CopyProperties(ShadowData, Source);`
        * 원본 객체의 속성 값들을 그림자 버퍼에 복사합니다.

---

## 동작 설명

```
// Source (원본 객체):
┌─┬─┬───┬─┬─┬─┬─┬─┬─┬─┬─┬─┬─┬─┬─┬─┬─┬─┬─┬─┬─┐
│1│1│...│0│0│0│1│1│0│1│0│1│1│0│1│1│0│1│0│1│1│
└─┴─┴───┴─┴─┴─┴─┴─┴─┴─┴─┴─┴─┴─┴─┴─┴─┴─┴─┴─┴─┘
┌───────────────────────────────────────────┐
│      Default__LyraPlayerController        │
└───────────────────────────────────────────┘
```

```
// ShadowData (초기 상태):
┌─┬─┬───┬─┬─┬─┬─┬─┬─┬─┬─┬─┬─┬─┬─┬─┬─┬─┬─┬─┬─┐
│0│0│...│0│0│0│0│0│0│0│0│0│0│0│0│0│0│0│0│0│0│
└─┴─┴───┴─┴─┴─┴─┴─┴─┴─┴─┴─┴─┴─┴─┴─┴─┴─┴─┴─┴─┘
┌───────────────────────────────────────────┐
│                 Empty                     │
└───────────────────────────────────────────┘
```

```
// ConstructProperties 실행 후:
    // 속성의 인스턴스가 생성되지만 값은 아직 복사되지 않은 상태:
┌─┬─┬───┬─┬─┬─┬─┬─┬─┬─┬─┬─┬─┬─┬─┬─┬─┬─┬─┬─┬─┐
│0│0│...│0│0│0│0│0│0│0│0│0│0│0│0│0│0│0│0│0│0│
└─┴─┴───┴─┴─┴─┴─┴─┴─┴─┴─┴─┴─┴─┴─┴─┴─┴─┴─┴─┴─┘
┌───────────┬───────────┬───┬───────────┬───┐
│ Property0'│ Property1'│...│ PropertyN'│...│
└───────────┴───────────┴───┴───────────┴───┘
```

```
// CopyProperties 실행 후:
    // 원본 객체의 모든 속성 값이 그림자 버퍼로 복사된 상태:
// ShadowData (값 복사 후):
┌─┬─┬───┬─┬─┬─┬─┬─┬─┬─┬─┬─┬─┬─┬─┬─┬─┬─┬─┬─┬─┐
│1│1│...│0│0│0│1│1│0│1│0│1│1│0│1│1│0│1│0│1│1│
└─┴─┴───┴─┴─┴─┴─┴─┴─┴─┴─┴─┴─┴─┴─┴─┴─┴─┴─┴─┴─┘
┌───────────┬───────────┬───┬───────────┬───┐
│ Property0'│ Property1'│...│ PropertyN'│...│
└───────────┴───────────┴───┴───────────┴───┘
```

---

## 이런게 왜 필요할까?

* 변경 감지: 그림자 버퍼는 객체의 원래 상태를 저장해두어, 나중에 객체의 현재 상태와 비교할 수 있게 합니다. 이를 통해 어떤 속성이 변경되었는지 정확히 파악할 수 있습니다.
네트워크 효율성: 변경된 속성만 네트워크로 전송함으로써 대역폭을 절약합니다.
* 동기화: 클라이언트와 서버 간의 객체 상태를 효율적으로 동기화하는 데 사용됩니다.
