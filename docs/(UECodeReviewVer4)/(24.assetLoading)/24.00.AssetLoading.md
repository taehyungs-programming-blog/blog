---
layout: default
title: "(24. Asset Loading)"
parent: "(UE Code-Review 🤖)"
has_children: true
nav_order: 3
permalink: docs/review/ue/ver4/24/Asset_Loading
---

## 시작

```cpp
auto& SM = UAssetManager::GetStreamableManager();
auto Handle = SM.RequestAsyncLoad(
    FSoftObjectPath(TEXT("/Game/Props/SM_Chair.SM_Chair")),
    FStreamableDelegate::CreateUObject(this,&ThisClass::OnReady));

```

* 오잉? `RequestAsyncLoad` 내부에선 뭘 할까?

```
UAssetManager::GetStreamableManager().RequestAsyncLoad(SoftPath, Delegate)
 └─ FStreamableManager::RequestAsyncLoad_Internal(...)
     └─ (SoftObjectPath → PackagePath 분해)
         └─ LoadPackageAsync(PackagePath, ...)
```

* 조금 더 상세히...

* 순차적으로 보자면
    * LoadPackageAsync("/Game/Props/SM_Chair") 호출
    * ALT2(Async Loading Thread 2) 가 호출
    * `FAsyncLoadingThread2::QueueAsyncPackage(Desc)` 를 통해 FAsyncPackage2(이 패키지의 “작업 객체”)를 만들고, ALT2의 작업 큐에 올림

* 좀 더 가시적으로 설명

```
[게임 스레드]
RequestAsyncLoad(SoftPath)
  └─ LoadPackageAsync(PackagePath)
      └─ FAsyncLoadingThread2::QueueAsyncPackage(Desc)
           └─ New FAsyncPackage2(Desc)  // 작업 객체 생성
           └─ ALT2 작업 큐에 push

[ALT2 스레드 루프]   // 스케줄러
while (Pkg = PopByPriority())
{
    switch (Pkg->State)
    {
        case CreateImports:  Pkg->DoCreateImports();  break;
        case CreateExports:  Pkg->DoCreateExports();  break;
        case Serialize:      Pkg->DoSerializeExports(); break;
        case PostLoad:       Pkg->DoPostLoad();       break;
        case Ready:          Complete(Pkg);           break;
    }
    // 각 단계에서 IO가 필요하면 FIoDispatcher로 비동기 읽기 걸고, 콜백되면 다시 진행
}

[IO/작업 스레드]
FIoDispatcher::Read(.ucas 범위)
  └─ (압축해제/복사) 완료 콜백 → ALT2에 “이제 다음 단계 가능” 알림

[게임 스레드]
(완료 시점)
FStreamableHandle::Complete → 네 콜백(OnReady) 호출
```

## 패키지 메타 해석: FPackageStore + IoDispatcher

* ALT2가 패키지 작업을 집어들면 먼저 “메타(요약/색인)” 를 파악

```
FAsyncPackage2::Start()
 └─ FAsyncPackage2::BeginIoRequest_Mappings()         // 어떤 청크를 읽어야 하는지
     └─ FPackageStore::GetPackageStoreEntry(Package)  // Import/Export 인덱스/정보
         └─ FIoDispatcher::Read(Requests)             // .utoc/.ucas 에서 비동기 읽기

```

* FPackageStoreEntry 가 “이 패키지에 어떤 Export(오브젝트)와 Import(다른 패키지 참조)가 있는지”를 빠르게 제공
* FIoDispatcher 는 .utoc(목차)와 .ucas(데이터)로부터 필요한 바이트 범위를 읽음
* 읽기 완료/디컴프는 IO/작업 스레드에서 처리되고, ALT2는 콜백으로 상태를 진행

