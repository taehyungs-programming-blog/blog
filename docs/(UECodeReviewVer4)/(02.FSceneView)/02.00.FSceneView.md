---
layout: default
title: "(02. Sceneì€ ì–´ë–»ê²Œ ê·¸ë ¤ì§ˆê¹Œ?)"
parent: "(UE Code-Review ğŸ¤–)"
has_children: true
nav_order: 1
permalink: docs/review/ue/ver4/02/FSceneView
---

## ëŒ€ëµì  Render íë¦„ë¦„

<p align="center">
  <img src="https://taehyungs-programming-blog.github.io/blog/assets/images/unreal_review_ver4/02.00_01.png"/>
</p>

---

## Q) ì™œ í™”ë©´ì„ Playerë¥¼ í†µí•´ ì ‘ê·¼í• ê¹Œ?

* í™”ë©´ ì •ë³´(FSceneViewState)ë¥¼ LocalPlayerê°€ ê°–ëŠ” ì´ìœ ?
* Unrealì€ ê¸°ë³¸ì ìœ¼ë¡œ í”Œë ˆì´ì–´ ì¤‘ì‹¬ ì„¤ê³„:
    * ì–¸ë¦¬ì–¼ ì—”ì§„ì€ í”Œë ˆì´ì–´ ì¤‘ì‹¬ìœ¼ë¡œ ì„¤ê³„ìˆë‹¤
    * ê° í”Œë ˆì´ì–´ëŠ” ìì‹ ë§Œì˜ ì‹œì (view)ì„ ê°€ì§€ë©°(ì‹œì‘ì´ FPSì´ê¸°ì—ì—), ì´ëŠ” ê²Œì„ ì„¸ê³„ë¥¼ ë°”ë¼ë³´ëŠ” ì°½(window)ì´ë‹¤.
* ì§€ì†ì„± ë³´ì¥:
    * FSceneViewëŠ” ë§¤ í”„ë ˆì„ë§ˆë‹¤ ìƒì„±ë˜ê³  ì†Œë©¸ë˜ì§€ë§Œ, ì¼ë¶€ ì •ë³´ëŠ” í”„ë ˆì„ ê°„ì— ìœ ì§€ë˜ì–´ì•¼ í•œë‹¤ë‹¤
        * ì˜ˆ: ëª¨ì…˜ ë¸”ëŸ¬, ì‹œê°„ì  ì•ˆí‹°ì•¨ë¦¬ì–´ì‹±(TAA), í¬ìŠ¤íŠ¸ í”„ë¡œì„¸ì‹± íš¨ê³¼ ë“±ì€ ì´ì „ í”„ë ˆì„ì˜ ì •ë³´ê°€ í•„ìš”
* í”Œë ˆì´ì–´ë³„ ì„¤ì •:
    * ê° í”Œë ˆì´ì–´ëŠ” ìì‹ ë§Œì˜ ê³ ìœ í•œ ì‹œê°ì  ì„¤ì •ì„ ê°€ì§ˆ ìˆ˜ ìˆë‹¤.
    * ë¶„í•  í™”ë©´ ë©€í‹°í”Œë ˆì´ì–´ì—ì„œ ê° í”Œë ˆì´ì–´ëŠ” ì„œë¡œ ë‹¤ë¥¸ ì‹œì ê³¼ ì„¤ì •ì„ ê°€ì§„ë‹¤.

---

## ê¸°ë³¸ ì„¤ê³„ UML

<p align="center">
  <img src="https://taehyungs-programming-blog.github.io/blog/assets/images/unreal_review_ver4/02.00_02.png"/>
</p>

## ëŒ€ëµì  ì˜ˆì‹œì½”ë“œ

```cpp
// ì˜ˆì‹œ: ê²Œì„ ì—”ì§„ì—ì„œ SceneView ìƒì„± ë° ê´€ë¦¬ ë°©ë²•

// LocalPlayer í´ë˜ìŠ¤ (ê°„ëµí™”)
class ULocalPlayer
{
public:
    // ì§€ì†ì ì¸ ViewStateë¥¼ ì €ì¥í•˜ëŠ” ë°°ì—´
    TArray<FSceneViewStateReference> ViewStates;
    
    // PlayerController ì°¸ì¡°
    APlayerController* PlayerController;
    
    // ViewState ê°€ì ¸ì˜¤ê¸° ë˜ëŠ” ìƒì„±
    FSceneViewStateInterface* GetOrCreateViewState(int32 ViewIndex)
    {
        // í•„ìš”í•œ ê²½ìš° ViewStates ë°°ì—´ í™•ì¥
        if (ViewIndex >= ViewStates.Num())
        {
            ViewStates.AddDefaulted(ViewIndex - ViewStates.Num() + 1);
        }
        
        // ViewStateê°€ ì—†ìœ¼ë©´ ìƒˆë¡œ ìƒì„±
        if (!ViewStates[ViewIndex].IsValid())
        {
            ViewStates[ViewIndex] = FSceneViewStateInterface::CreateNew();
        }
        
        return ViewStates[ViewIndex].GetReference();
    }
};

// PlayerController í´ë˜ìŠ¤ (ê°„ëµí™”)
class APlayerController
{
public:
    // ì¹´ë©”ë¼ ë§¤ë‹ˆì € ì°¸ì¡°
    APlayerCameraManager* PlayerCameraManager;
    
    // LocalPlayer ì°¸ì¡°
    ULocalPlayer* Player;
};

// PlayerCameraManager í´ë˜ìŠ¤ (ê°„ëµí™”)
class APlayerCameraManager
{
public:
    // í˜„ì¬ ë³´ê³  ìˆëŠ” ëŒ€ìƒ
    FTViewTarget ViewTarget;
    
    // ì¹´ë©”ë¼ ìºì‹œ
    FCameraCacheEntry CameraCachePrivate;
    
    // SceneView ìƒì„±
    FSceneView* CreateSceneView(FSceneViewFamily* ViewFamily)
    {
        // SceneView ì´ˆê¸°í™” ì˜µì…˜ ì„¤ì •
        FSceneViewInitOptions ViewInitOptions;
        ViewInitOptions.ViewFamily = ViewFamily;
        ViewInitOptions.ViewActor = ViewTarget.Target;
        ViewInitOptions.ViewLocation = CameraCachePrivate.POV.Location;
        ViewInitOptions.ViewRotation = CameraCachePrivate.POV.Rotation;
        ViewInitOptions.FOV = CameraCachePrivate.POV.FOV;
        
        // LocalPlayerì—ì„œ ViewState ê°€ì ¸ì˜¤ê¸°
        APlayerController* PC = Cast<APlayerController>(GetOwner());
        if (PC && PC->Player)
        {
            ViewInitOptions.SceneViewStateInterface = PC->Player->GetOrCreateViewState(0);
        }
        
        // SceneView ìƒì„± ë° ë°˜í™˜
        return new FSceneView(ViewInitOptions);
    }
};

// ë Œë”ë§ ì‹œìŠ¤í…œì—ì„œ SceneView ì‚¬ìš© ì˜ˆì‹œ
void FRenderer::Render(UWorld* World)
{
    // SceneViewFamily ì»¨í…ìŠ¤íŠ¸ ìƒì„±
    FSceneViewFamilyContext ViewFamily(/* íŒŒë¼ë¯¸í„° */);
    
    // ê° í”Œë ˆì´ì–´ì— ëŒ€í•´ SceneView ìƒì„±
    for (FLocalPlayerIterator It(GEngine, World); It; ++It)
    {
        ULocalPlayer* LocalPlayer = *It;
        APlayerController* PlayerController = LocalPlayer->PlayerController;
        
        if (PlayerController && PlayerController->PlayerCameraManager)
        {
            // PlayerCameraManagerë¥¼ í†µí•´ SceneView ìƒì„±
            FSceneView* View = PlayerController->PlayerCameraManager->CreateSceneView(&ViewFamily);
            
            // ViewFamilyì— SceneView ì¶”ê°€
            ViewFamily.Views.Add(View);
        }
    }
    
    // ë Œë”ë§ ìˆ˜í–‰
    GetRendererModule().BeginRenderingViewFamily(/* íŒŒë¼ë¯¸í„° */);
    
    // ë Œë”ë§ ì™„ë£Œ í›„ SceneView ì •ë¦¬
    // (SceneViewëŠ” ë§¤ í”„ë ˆì„ ìƒì„±/ì†Œë©¸ë˜ì§€ë§Œ SceneViewStateëŠ” LocalPlayerì— ìœ ì§€ë¨)
    for (int32 ViewIndex = 0; ViewIndex < ViewFamily.Views.Num(); ViewIndex++)
    {
        delete ViewFamily.Views[ViewIndex];
    }
    ViewFamily.Views.Empty();
}
```

---

## Q) Playerì—ì„œ ì§ì ‘ CameraManagerë¥¼ ì†Œìœ í•˜ì§€ ì•ŠëŠ”ì´ìœ ?

<p align="center">
  <img src="https://taehyungs-programming-blog.github.io/blog/assets/images/unreal_review_ver4/02.00_03.png"/>
</p>

* ê´€ì‹¬ì‚¬ ë¶„ë¦¬(Separation of Concerns):
    * LocalPlayer: í”Œë ˆì´ì–´ì˜ ì¡´ì¬ì™€ ì§€ì†ì„±ì„ ê´€ë¦¬
    * PlayerController: ê²Œì„ ë¡œì§ê³¼ ì…ë ¥ ì²˜ë¦¬ë¥¼ ë‹´ë‹¹
    * PlayerCameraManager: ì¹´ë©”ë¼ ê´€ë ¨ ê¸°ëŠ¥ë§Œ ì „ë¬¸ì ìœ¼ë¡œ ì²˜ë¦¬
* ìœ ì—°í•œ ì œì–´ íë¦„:
    * PlayerControllerëŠ” ê²Œì„ ë¡œì§ì— ë”°ë¼ ì¹´ë©”ë¼ ë™ì‘ì„ ì œì–´í•  ìˆ˜ ìˆìŒ
    * ì˜ˆ: í”Œë ˆì´ì–´ê°€ ì°¨ëŸ‰ì— íƒ‘ìŠ¹í•˜ë©´ ì¹´ë©”ë¼ ë™ì‘ì´ ë³€ê²½ë˜ì–´ì•¼ í•¨
    * `PlayerController`ì—ì„œ Possess/UnPossessë¥¼ ë‹´ë‹¹í•˜ê¸°ì— ì¹´ë©”ë¼ë¥¼ ê´€ë¦¬í•˜ëŠ”ê²ƒë„ ì´ê²Œ ë§ìŒ.

* ê²Œì„í”Œë ˆì´ ê´€ì ì˜ ì´ìœ 
* ê²Œì„í”Œë ˆì´ ë¶„ë¦¬:
    * PlayerControllerëŠ” ê²Œì„í”Œë ˆì´ ë¡œì§ì„ ë‹´ë‹¹
    * ì¹´ë©”ë¼ ì œì–´ëŠ” ê²Œì„í”Œë ˆì´ì˜ ì¼ë¶€ì´ë¯€ë¡œ PlayerControllerì˜ ì±…ì„ ì˜ì—­
* Possession ë©”ì»¤ë‹ˆì¦˜:
    * PlayerControllerëŠ” ë‹¤ì–‘í•œ Pawnì„ ì°¨ë¡€ë¡œ ì†Œìœ (possess)í•  ìˆ˜ ìˆìŒ
    * ê° Pawnì— ë”°ë¼ ì¹´ë©”ë¼ ë™ì‘ì´ ë‹¬ë¼ì§ˆ ìˆ˜ ìˆìœ¼ë¯€ë¡œ, PlayerControllerê°€ CameraManagerë¥¼ ê´€ë¦¬í•˜ëŠ” ê²ƒì´ ë…¼ë¦¬ì 
* ë„¤íŠ¸ì›Œí¬ ê²Œì„ ì§€ì›:
    * ë©€í‹°í”Œë ˆì´ì–´ ê²Œì„ì—ì„œ PlayerControllerëŠ” ë„¤íŠ¸ì›Œí¬ ë³µì œ(replication)ì˜ ì£¼ì²´
CameraManagerë¥¼ PlayerControllerì˜ í•˜ìœ„ ê°ì²´ë¡œ ë‘ë©´ ë„¤íŠ¸ì›Œí¬ ë™ê¸°í™”ê°€ ìš©ì´í•¨
ê¸°ìˆ ì  ì´ìœ 
* ìƒëª…ì£¼ê¸° ê´€ë¦¬:
    * PlayerControllerëŠ” ê²Œì„í”Œë ˆì´ ì¤‘ ì§€ì†ë˜ì§€ë§Œ ë³€ê²½ë  ìˆ˜ ìˆìŒ
    * LocalPlayerëŠ” ê²Œì„ ì„¸ì…˜ ì „ì²´ì— ê±¸ì³ ì§€ì†ë¨
    * CameraManagerëŠ” PlayerControllerì™€ ìƒëª…ì£¼ê¸°ë¥¼ ê³µìœ í•˜ëŠ” ê²ƒì´ ì í•©í•¨
* ìƒíƒœ ì „í™˜ ê´€ë¦¬:
    * ê²Œì„ ëª¨ë“œ ë³€ê²½, ë ˆë²¨ ì „í™˜ ë“±ì—ì„œ PlayerControllerê°€ ë³€ê²½ë  ìˆ˜ ìˆìŒ
    * ì´ë•Œ CameraManagerë„ í•¨ê»˜ ë³€ê²½ë˜ì–´ì•¼ í•˜ë¯€ë¡œ PlayerControllerì— ì—°ê²°í•˜ëŠ” ê²ƒì´ ìì—°ìŠ¤ëŸ¬ì›€
* ë””ë²„ê¹… ë° ì—ë””í„° í†µí•©:
    * ì–¸ë¦¬ì–¼ ì—ë””í„°ì—ì„œ PlayerControllerëŠ” ì§ì ‘ ì¡°ì‘ ê°€ëŠ¥í•œ ì•¡í„°
    * CameraManagerë¥¼ PlayerControllerì˜ ì»´í¬ë„ŒíŠ¸ë¡œ ê´€ë¦¬í•˜ë©´ ì—ë””í„°ì—ì„œ ì‰½ê²Œ ì ‘ê·¼ ê°€ëŠ¥