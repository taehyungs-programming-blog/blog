---
layout: default
title: "(08. í”Œë ˆì´ì–´ê°€ ë¬´ê¸°ë¥¼ íšë“í•˜ëŠ” ì‹œë‚˜ë¦¬ì˜¤ ì‹œë®¬ë ˆì´ì…˜)"
parent: "(UE Code-Review ğŸ¤–)"
has_children: true
nav_order: 1
permalink: docs/review/ue/ver4/08/UpdateUnmappedObject
---

## í”Œë ˆì´ì–´ê°€ ë¬´ê¸°ë¥¼ íšë“í•˜ëŠ” ìƒí™©ì„ ê°€ì •í•´ ë³´ì

* ì„œë²„ì—ì„œ í”Œë ˆì´ì–´(A)ê°€ ë¬´ê¸°(W)ë¥¼ íšë“
* ì„œë²„ëŠ” í”Œë ˆì´ì–´ì˜ Weapon ì†ì„±ì„ ë¬´ê¸° ê°ì²´(W)ë¡œ ì„¤ì •
* ì„œë²„ëŠ” ì´ ë³€ê²½ì‚¬í•­ì„ í´ë¼ì´ì–¸íŠ¸ì— ë³µì œí•˜ë©´ì„œ ë¬´ê¸°ì˜ FNetworkGUID(ì˜ˆ: GUID_W)ë¥¼ ì „ì†¡
* í´ë¼ì´ì–¸íŠ¸ëŠ” GUID_Wë¥¼ ë°›ì§€ë§Œ, ì•„ì§ ë¬´ê¸° ê°ì²´ê°€ ìƒì„±ë˜ì§€ ì•ŠìŒ
* í´ë¼ì´ì–¸íŠ¸ëŠ” GUID_Wë¥¼ ImportedNetGuidsì— ì¶”ê°€í•˜ê³ , ê´€ë ¨ ë³µì œê¸°ë¥¼ UnmappedReplicatorsì— ë“±ë¡
* ë‚˜ì¤‘ì— ì„œë²„ê°€ ë¬´ê¸° ê°ì²´ ìì²´ë¥¼ ë³µì œí•˜ì—¬ í´ë¼ì´ì–¸íŠ¸ì—ì„œ ìƒì„±ë¨
* UpdateUnmappedObjectsê°€ í˜¸ì¶œë˜ì–´ GUID_Wì™€ ìƒˆë¡œ ìƒì„±ëœ ë¬´ê¸° ê°ì²´ë¥¼ ë§¤í•‘
* FObjectReplicator::UpdateUnmappedObjectsê°€ ì‹¤í–‰ë˜ì–´ í”Œë ˆì´ì–´ì˜ Weapon ì†ì„±ì„ ì‹¤ì œ ê°ì²´ë¡œ ì—…ë°ì´íŠ¸
* í•„ìš”í•œ ê²½ìš° OnRep_Weapon ê°™ì€ RepNotify í•¨ìˆ˜ í˜¸ì¶œ

### ì„œë²„ì—ì„œ í”Œë ˆì´ì–´(A)ê°€ ë¬´ê¸°(W)ë¥¼ íšë“
### ì„œë²„ëŠ” í”Œë ˆì´ì–´ì˜ Weapon ì†ì„±ì„ ë¬´ê¸° ê°ì²´(W)ë¡œ ì„¤ì •
### ì„œë²„ëŠ” ì´ ë³€ê²½ì‚¬í•­ì„ í´ë¼ì´ì–¸íŠ¸ì— ë³µì œí•˜ë©´ì„œ ë¬´ê¸°ì˜ FNetworkGUID(ì˜ˆ: GUID_W)ë¥¼ ì „ì†¡

```cpp
// ì„œë²„ ì¸¡ ì½”ë“œ (ë‹¨ìˆœí™”ë¨)
// Serializeí•˜ì—¬ ë³´ë‚´ì¤Œ.
void UPackageMap::SerializeObject(FArchive& Ar, UObject*& Object)
{
    // ê°ì²´ë¥¼ GUIDë¡œ ë³€í™˜í•´ ì „ì†¡
    FNetworkGUID NetGUID = GuidCache->GetOrAssignNetGUID(Object);
    Ar << NetGUID;
}
```

### í´ë¼ì´ì–¸íŠ¸ëŠ” GUID_Wë¥¼ ë°›ì§€ë§Œ, ì•„ì§ ë¬´ê¸° ê°ì²´ê°€ ìƒì„±ë˜ì§€ ì•ŠìŒ
### í´ë¼ì´ì–¸íŠ¸ëŠ” GUID_Wë¥¼ ImportedNetGuidsì— ì¶”ê°€í•˜ê³ , ê´€ë ¨ ë³µì œê¸°ë¥¼ UnmappedReplicatorsì— ë“±ë¡

```cpp
// í´ë¼ì´ì–¸íŠ¸ ì¸¡ ì½”ë“œ (ë‹¨ìˆœí™”ë¨)
void UPackageMap::SerializeObject(FArchive& Ar, UObject*& Object)
{
    FNetworkGUID NetGUID;
    Ar << NetGUID;
    
    // GUIDì— í•´ë‹¹í•˜ëŠ” ê°ì²´ ì°¾ê¸° ì‹œë„
    Object = GuidCache->GetObjectFromNetGUID(NetGUID, true);
    
    if (Object == nullptr)
    {
        // ê°ì²´ë¥¼ ì°¾ì§€ ëª»í•¨, ImportedNetGuidsì— ì¶”ê°€
        GuidCache->ImportedNetGuids.Add(NetGUID);
    }
}
```

### ë‚˜ì¤‘ì— ì„œë²„ê°€ ë¬´ê¸° ê°ì²´ ìì²´ë¥¼ ë³µì œí•˜ì—¬ í´ë¼ì´ì–¸íŠ¸ì—ì„œ ìƒì„±ë¨

```cpp
void UActorChannel::ProcessBunch(FInBunch& Bunch)
{
    // ë²ˆì¹˜ ì²˜ë¦¬ ì¤‘ ê°ì²´ ì°¸ì¡°ë¥¼ ë°œê²¬
    if (RepLayout->ReadPropertyHeader(Bunch, ...) && RepLayout->ReadProperties(...))
    {
        // ì†ì„± ì¤‘ ë§¤í•‘ë˜ì§€ ì•Šì€ ê°ì²´ê°€ ìˆìœ¼ë©´
        if (ObjectReplicator->HasUnmappedObjects())
        {
            // UnmappedReplicatorsì— ì¶”ê°€
            Connection->Driver->UnmappedReplicators.Add(ObjectReplicator);
        }
    }
}
```

### UpdateUnmappedObjectsê°€ í˜¸ì¶œë˜ì–´ GUID_Wì™€ ìƒˆë¡œ ìƒì„±ëœ ë¬´ê¸° ê°ì²´ë¥¼ ë§¤í•‘
### FObjectReplicator::UpdateUnmappedObjectsê°€ ì‹¤í–‰ë˜ì–´ í”Œë ˆì´ì–´ì˜ Weapon ì†ì„±ì„ ì‹¤ì œ ê°ì²´ë¡œ ì—…ë°ì´íŠ¸

```cpp
// ì˜ˆ: ì•¡í„° ìŠ¤í° ì‹œ
AActor* SpawnedActor = World->SpawnActor(...);

// ìŠ¤í°ëœ ì•¡í„°ì— ëŒ€í•œ GUID ìƒì„± ë° ë§¤í•‘
FNetworkGUID NetGUID = GuidCache->AssignNewNetGUID_Server(SpawnedActor);
```

```cpp
void UNetDriver::UpdateUnmappedObjects()
{
    // ImportedNetGuids ëª©ë¡ ìˆœíšŒ
    for (FNetworkGUID NetworkGuid : ImportedNetGuids)
    {
        // ì´ì œ ê°ì²´ê°€ ì¡´ì¬í•˜ëŠ”ì§€ í™•ì¸
        UObject* Object = GuidCache->GetObjectFromNetGUID(NetworkGuid, false);
        
        if (Object != nullptr)
        {
            // ë§¤í•‘ ì„±ê³µ! NewlyMappedGuidsì— ì¶”ê°€
            NewlyMappedGuids.Add(NetworkGuid);
        }
    }
    
    // ìƒˆë¡œ ë§¤í•‘ëœ GUIDì— ëŒ€í•œ ë³µì œê¸° ì—…ë°ì´íŠ¸
    for (FNetworkGUID NetGuid : NewlyMappedGuids)
    {
        // ì´ GUIDë¥¼ ì‚¬ìš©í•˜ëŠ” ëª¨ë“  ë³µì œê¸° ì°¾ê¸°
        TSet<FObjectReplicator*>* Replicators = GuidToReplicatorMap.Find(NetGuid);
        if (Replicators)
        {
            // ê° ë³µì œê¸°ì˜ UnmappedObjects ì—…ë°ì´íŠ¸
            for (FObjectReplicator* Replicator : *Replicators)
            {
                bool bHasMoreUnmapped = false;
                Replicator->UpdateUnmappedObjects(bHasMoreUnmapped);
                
                // ëª¨ë“  ê°ì²´ê°€ ë§¤í•‘ë˜ì—ˆìœ¼ë©´ ëª©ë¡ì—ì„œ ì œê±°
                if (!bHasMoreUnmapped)
                {
                    UnmappedReplicators.Remove(Replicator);
                }
            }
        }
    }
}
```