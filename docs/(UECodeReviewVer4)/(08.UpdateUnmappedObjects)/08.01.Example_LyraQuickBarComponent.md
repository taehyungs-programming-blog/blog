---
layout: default
title: "08.01. ì˜ˆì‹œ. LyraQuickBarComponent"
parent: "(08. í”Œë ˆì´ì–´ê°€ ë¬´ê¸°ë¥¼ íšë“í•˜ëŠ” ì‹œë‚˜ë¦¬ì˜¤ ì‹œë®¬ë ˆì´ì…˜)"
grand_parent: "(UE Code-Review ğŸ¤–)"
nav_order: 1
---

## Table of contents
{: .no_toc .text-delta }

1. TOC
{:toc}

---

## LyraQuickBarComponentë€

* Lyra ìƒ˜í”Œ ê²Œì„ì—ì„œ LyraQuickBarComponentëŠ” í”Œë ˆì´ì–´ê°€ ê°€ì§„ ì•„ì´í…œ ìŠ¬ë¡¯ì„ ê´€ë¦¬í•˜ëŠ” ì»´í¬ë„ŒíŠ¸

```
ë‹¤ìŒ ì†ì„±ë“¤ì„ ë„¤íŠ¸ì›Œí¬ë¡œ ë³µì œ

bReplicates: ì»´í¬ë„ŒíŠ¸ ìì²´ê°€ ë³µì œë˜ëŠ”ì§€ ì—¬ë¶€
bIsActive: í€µë°”ê°€ í™œì„±í™” ìƒíƒœì¸ì§€ ì—¬ë¶€
Slots: ì•„ì´í…œ ìŠ¬ë¡¯ ë°°ì—´ (ì—¬ê¸°ì„œ ì¤‘ìš”)
ActiveSlotIndex: í˜„ì¬ ì„ íƒëœ ìŠ¬ë¡¯ ì¸ë±ìŠ¤
```

### ì„œë²„ì—ì„œ ì•„ì´í…œ íšë“ ìƒí™©

```cpp
// ì„œë²„ ì½”ë“œ (ê°„ì†Œí™”ë¨)
ALyraPlayerController* PC = GetPlayerController();
ULyraQuickBarComponent* QuickBar = PC->GetQuickBarComponent();

// ë¬´ê¸° ì•„ì´í…œë“¤ ìƒì„±
ULyraInventoryItemDefinition* Weapon1 = CreateWeapon("Pistol");
ULyraInventoryItemDefinition* Weapon2 = CreateWeapon("Rifle");
ULyraInventoryItemDefinition* Weapon3 = CreateWeapon("Shotgun");

// í€µë°” ìŠ¬ë¡¯ì— í• ë‹¹
QuickBar->Slots[0] = Weapon1;
QuickBar->Slots[1] = Weapon2;
QuickBar->Slots[2] = Weapon3;

// í™œì„± ìŠ¬ë¡¯ ì„¤ì •
QuickBar->ActiveSlotIndex = 0;
```

### ë³µì œ ê³¼ì • ì‹œì‘

* ì´ì œ ì„œë²„ëŠ” ì´ ì •ë³´ë¥¼ í´ë¼ì´ì–¸íŠ¸ì— ì „ì†¡
* `URepLayout::SendProperties`ê°€ í˜¸ì¶œë˜ì–´ LyraQuickBarComponentì˜ ë³€ê²½ëœ ì†ì„±ë“¤ì„ ì§ë ¬í™”
* Slots ë°°ì—´ì„ ì§ë ¬í™”í•  ë•Œ ê° ë¬´ê¸° ê°ì²´ëŠ” FNetworkGUIDë¡œ ë³€í™˜

```
Slots[0] = GUID_Weapon1 (ì˜ˆ: 12345)
Slots[1] = GUID_Weapon2 (ì˜ˆ: 12346)
Slots[2] = GUID_Weapon3 (ì˜ˆ: 12347)
```

### í´ë¼ì´ì–¸íŠ¸ ìˆ˜ì‹  ê³¼ì •

* í´ë¼ì´ì–¸íŠ¸ì—ì„œëŠ” ë‹¤ìŒ ê³¼ì •ì´ ì¼ì–´ë‚©ë‹ˆë‹¤:
* `UActorChannel::ProcessBunch`ê°€ ë³µì œ ë°ì´í„°ë¥¼ ë°›ìŒ
* RepLayout->ReceivePropertiesê°€ í˜¸ì¶œë˜ì–´ ì†ì„±ì„ ì—­ì§ë ¬í™”
* Slots ë°°ì—´ì„ ì²˜ë¦¬í•  ë•Œ PrepReceiveArray()ê°€ í˜¸ì¶œë¨
* ë°°ì—´ í¬ê¸°(3)ë¥¼ í™•ì¸í•˜ê³  ë©”ëª¨ë¦¬ í• ë‹¹

```cpp
// í´ë¼ì´ì–¸íŠ¸ ì½”ë“œ (ê°„ì†Œí™”ë¨)
// ê° ë¬´ê¸° GUIDë¥¼ ì—­ì§ë ¬í™”
FNetworkGUID WeaponGUID;
Ar << WeaponGUID;  // ì˜ˆ: 12345 (GUID_Weapon1)

// GUIDë¡œë¶€í„° ê°ì²´ ì°¾ê¸° ì‹œë„
UObject* WeaponObject = GuidCache->GetObjectFromNetGUID(WeaponGUID);

if (WeaponObject == nullptr)
{
    // ë¬´ê¸° ê°ì²´ê°€ ì•„ì§ ì¡´ì¬í•˜ì§€ ì•ŠìŒ
    // ì´ GUIDë¥¼ ImportedNetGuidsì— ì¶”ê°€
    GuidCache->ImportedNetGuids.Add(WeaponGUID);
    
    // ê°ì²´ ì°¸ì¡°ëŠ” ì•„ì§ NULLë¡œ ì„¤ì •
    QuickBar->Slots[0] = nullptr;
    
    // ì´ ì»´í¬ë„ŒíŠ¸ì˜ ë³µì œê¸°ë¥¼ UnmappedReplicatorsì— ì¶”ê°€
    Connection->Driver->UnmappedReplicators.Add(ObjectReplicator);
}
else
{
    // ê°ì²´ê°€ ì´ë¯¸ ì¡´ì¬í•˜ë©´ ì°¸ì¡° ì„¤ì •
    QuickBar->Slots[0] = WeaponObject;
}
```

### ê°ì²´ ìƒì„± ë° ë§¤í•‘

* ë‚˜ì¤‘ì— ì„œë²„ê°€ ë¬´ê¸° ê°ì²´ ìì²´ë¥¼ í´ë¼ì´ì–¸íŠ¸ì— ë³µì œ

```cpp
// í´ë¼ì´ì–¸íŠ¸ì—ì„œ ë¬´ê¸° ê°ì²´ ìƒì„± (ì„œë²„ë¡œë¶€í„° ë°›ì€ ë°ì´í„°ì— ì˜í•´)
ULyraInventoryItemDefinition* Weapon1 = CreateObject<ULyraInventoryItemDefinition>();

// ë‚´ë¶€ì ìœ¼ë¡œ GuidCacheì—ì„œ ë°œìƒí•˜ëŠ” ë§¤í•‘
GuidCache->RegisterNetGUID_Client(GUID_Weapon1, Weapon1);
```

### UpdateUnmappedObjects ì‹¤í–‰

```cpp
void UNetDriver::UpdateUnmappedObjects()
{
    // ImportedNetGuids ê²€ìƒ‰
    for (FNetworkGUID NetGUID : ImportedNetGuids)
    {
        // GUID_Weapon1ì´ ì´ì œ ë§¤í•‘ë˜ì—ˆëŠ”ì§€ í™•ì¸
        if (GuidCache->GetObjectFromNetGUID(NetGUID) != nullptr)
        {
            // ë§¤í•‘ë¨! NewlyMappedGuidsì— ì¶”ê°€
            NewlyMappedGuids.Add(NetGUID);
        }
    }
    
    // LyraQuickBarComponentì˜ ë³µì œê¸° ì—…ë°ì´íŠ¸
    for (FNetworkGUID NetGUID : NewlyMappedGuids)
    {
        TSet<FObjectReplicator*>* Replicators = GuidToReplicatorMap.Find(NetGUID);
        if (Replicators)
        {
            for (FObjectReplicator* Replicator : *Replicators)
            {
                bool bHasMoreUnmapped = false;
                Replicator->UpdateUnmappedObjects(bHasMoreUnmapped);
                
                if (!bHasMoreUnmapped)
                {
                    UnmappedReplicators.Remove(Replicator);
                }
            }
        }
    }
}
```

### FObjectReplicator ì—…ë°ì´íŠ¸

```cpp
void FObjectReplicator::UpdateUnmappedObjects(bool& bOutHasMoreUnmapped)
{
    bOutHasMoreUnmapped = false;
    
    // Slots ë°°ì—´ ì†ì„± ì •ë³´ í™•ì¸
    for (FRepState::FPropertyInfo& PropInfo : RepState->Properties)
    {
        // Slots[0]ì— í•´ë‹¹í•˜ëŠ” ì†ì„± ì°¾ê¸°
        if (PropInfo.Property->GetFName() == "Slots" && PropInfo.ArrayIndex == 0 && PropInfo.bUnmapped)
        {
            // GUID_Weapon1ë¡œë¶€í„° ë¬´ê¸° ê°ì²´ ì°¾ê¸°
            UObject* WeaponObj = Connection->Driver->GuidCache->GetObjectFromNetGUID(PropInfo.NetworkGUID);
            
            if (WeaponObj)
            {
                // ë¬´ê¸° ì°¸ì¡° ì—…ë°ì´íŠ¸
                ULyraQuickBarComponent* QuickBar = Cast<ULyraQuickBarComponent>(GetObject());
                QuickBar->Slots[0] = WeaponObj;
                
                // RepNotify í˜¸ì¶œ (ìˆë‹¤ë©´)
                if (QuickBar->IsNetPropertyDirty(PROP_SLOTS))
                {
                    QuickBar->OnRep_Slots();
                }
                
                // ë§¤í•‘ ì™„ë£Œ
                PropInfo.bUnmapped = false;
            }
            else
            {
                // ì•„ì§ ë§¤í•‘ë˜ì§€ ì•ŠìŒ
                bOutHasMoreUnmapped = true;
            }
        }
    }
}
```