---
layout: default
title: "(06. FDormantReplicatorHolder ëŒ€í•˜ì—¬)"
parent: "(UE Code-Review ğŸ¤–)"
has_children: true
nav_order: 1
permalink: docs/review/ue/ver4/05/FDormantReplicatorHolder
---

## FDormantReplicatorHolderë€?

* FDormantReplicatorHolderëŠ” ì–¸ë¦¬ì–¼ ì—”ì§„ì˜ ë„¤íŠ¸ì›Œí‚¹ ì‹œìŠ¤í…œì—ì„œ ì¤‘ìš”í•œ ì—­í• ì„ í•˜ëŠ” êµ¬ì¡°ì²´

### ì£¼ìš”ê¸°ëŠ¥

* ë„ë¨¼íŠ¸(Dormant) ì•¡í„° ê´€ë¦¬:
    * ë„¤íŠ¸ì›Œí¬ ìµœì í™”ë¥¼ ìœ„í•´ ì¼ì‹œì ìœ¼ë¡œ ë¹„í™œì„±í™”ëœ(dormant) ì•¡í„°ì™€ ê·¸ ì»´í¬ë„ŒíŠ¸ë“¤ì˜ ë¦¬í”Œë¦¬ì¼€ì´í„°ë¥¼ ì €ì¥
    * ì•¡í„°ê°€ ë‹¤ì‹œ í™œì„±í™”ë  ë•Œ ë¦¬í”Œë¦¬ì¼€ì´ì…˜ ìƒíƒœë¥¼ ë¹ ë¥´ê²Œ ë³µì›
* ë°ì´í„° êµ¬ì¡°:
    * ActorReplicatorSet: ì•¡í„°ë³„ë¡œ ë¦¬í”Œë¦¬ì¼€ì´í„°ë¥¼ ê·¸ë£¹í™”í•˜ëŠ” TSet ì»¬ë ‰ì…˜
    * ê° ì•¡í„°ë§ˆë‹¤ FActorDormantReplicators ì¸ìŠ¤í„´ìŠ¤ê°€ ìˆìœ¼ë©°, ì´ëŠ” ì•¡í„° ìì‹ ê³¼ ê·¸ í•˜ìœ„ ì»´í¬ë„ŒíŠ¸ë“¤ì˜ ëª¨ë“  ë¦¬í”Œë¦¬ì¼€ì´í„°ë¥¼ í¬í•¨
* ì£¼ìš” ê¸°ëŠ¥:
    * FindAndRemoveReplicator: íŠ¹ì • ì•¡í„°ì™€ ê°ì²´ì˜ ë¦¬í”Œë¦¬ì¼€ì´í„°ë¥¼ ì°¾ì•„ ë°˜í™˜í•˜ê³  ì»¬ë ‰ì…˜ì—ì„œ ì œê±°
    * CreateAndStoreReplicator: ìƒˆ ë¦¬í”Œë¦¬ì¼€ì´í„°ë¥¼ ìƒì„±í•˜ê³  ì €ì¥
* ê³„ì¸µì  êµ¬ì¡°:
    * ì•¡í„° ì¤‘ì‹¬ì˜ ê³„ì¸µ êµ¬ì¡°ë¥¼ ìœ ì§€í•©ë‹ˆë‹¤.
    * ê° ì•¡í„°ëŠ” ìì‹ ì˜ ë¦¬í”Œë¦¬ì¼€ì´í„°ì™€ ëª¨ë“  í•˜ìœ„ ê°ì²´ë“¤ì˜ ë¦¬í”Œë¦¬ì¼€ì´í„°ë¥¼ ì†Œìœ í•©ë‹ˆë‹¤.
* ë„¤íŠ¸ì›Œí¬ ìµœì í™”:
    * ì•¡í„°ê°€ ë„ë¨¼íŠ¸ ìƒíƒœì¼ ë•Œë„ ë¦¬í”Œë¦¬ì¼€ì´ì…˜ ìƒíƒœë¥¼ ìœ ì§€í•¨ìœ¼ë¡œì¨, ì•¡í„°ê°€ ë‹¤ì‹œ í™œì„±í™”ë  ë•Œ ì™„ì „íˆ ìƒˆë¡œìš´ ë¦¬í”Œë¦¬ì¼€ì´ì…˜ì„ ì‹œì‘í•˜ëŠ” ëŒ€ì‹  ì´ì „ ìƒíƒœë¥¼ ë³µì›

---

## Example

ëŒ€ê·œëª¨ ì˜¤í”ˆ ì›”ë“œ ê²Œì„ì—ì„œ:
í”Œë ˆì´ì–´ëŠ” í° ë„ì‹œë¥¼ íƒí—˜ ì¤‘
ë„ì‹œì—ëŠ” ìˆ˜ë°± ê°œì˜ NPC, ì°¨ëŸ‰, ìƒí˜¸ì‘ìš© ê°€ëŠ¥í•œ ë¬¼ì²´ê°€ ì¡´ì¬
ì„œë²„ëŠ” ëª¨ë“  í´ë¼ì´ì–¸íŠ¸ì—ê²Œ ì´ ê°ì²´ë“¤ì„ ë¦¬í”Œë¦¬ì¼€ì´íŠ¸í•´ì•¼ í•¨

```cpp
// ëª¨ë“  ì•¡í„°ë¥¼ í•­ìƒ ë¦¬í”Œë¦¬ì¼€ì´íŠ¸ - ë§¤ìš° ë¹„íš¨ìœ¨ì 
for (AActor* Actor : AllActors)
{
    if (IsRelevantToConnection(Actor, Connection))
    {
        ReplicateActor(Actor, Connection);
    }
}
```

```cpp
// ì•¡í„°ê°€ ë„ë¨¼íŠ¸ ìƒíƒœê°€ ë  ë•Œ:
void UNetConnection::MakeActorDormant(AActor* Actor)
{
    // 1. ì•¡í„° ì±„ë„ ì°¾ê¸°
    UActorChannel* Channel = FindActorChannelRef(Actor);
    
    // 2. ì•¡í„°ì™€ ì»´í¬ë„ŒíŠ¸ì˜ ë¦¬í”Œë¦¬ì¼€ì´í„° ì €ì¥
    for (UObjectReplicator* Replicator : Channel->ReplicationMap)
    {
        UObject* ReplicatedObject = Replicator->GetObject();
        
        // 3. FDormantReplicatorHolderì— ë¦¬í”Œë¦¬ì¼€ì´í„° ì €ì¥
        bool bOverwroteExisting = false;
        DormantReplicatorHolder.CreateAndStoreReplicator(
            Actor,                   // ì†Œìœ  ì•¡í„°
            ReplicatedObject,        // ë¦¬í”Œë¦¬ì¼€ì´íŠ¸ë˜ëŠ” ê°ì²´ (ì•¡í„° ë˜ëŠ” ì»´í¬ë„ŒíŠ¸)
            bOverwroteExisting
        );
    }
    
    // 4. ì•¡í„° ì±„ë„ ë‹«ê¸° (ë¦¬í”Œë¦¬ì¼€ì´ì…˜ ì¤‘ì§€)
    Channel->Close();
}
```

```cpp
// ì•¡í„°ê°€ ë‹¤ì‹œ í™œì„±í™”ë  ë•Œ:
void UNetConnection::WakeupDormantActor(AActor* Actor)
{
    // 1. ìƒˆ ì•¡í„° ì±„ë„ ìƒì„±
    UActorChannel* Channel = CreateChannel(CHTYPE_Actor);
    
    // 2. ì•¡í„°ì˜ ë¦¬í”Œë¦¬ì¼€ì´í„° ë³µì›
    TSharedPtr<FObjectReplicator> ActorReplicator = 
        DormantReplicatorHolder.FindAndRemoveReplicator(Actor, Actor);
    
    if (ActorReplicator.IsValid())
    {
        // 3. ì±„ë„ì— ë¦¬í”Œë¦¬ì¼€ì´í„° ì„¤ì •
        Channel->SetReplicationObject(ActorReplicator);
        
        // 4. ì•¡í„°ì˜ ëª¨ë“  ì»´í¬ë„ŒíŠ¸ ì²˜ë¦¬
        TArray<UActorComponent*> Components;
        Actor->GetComponents(Components);
        
        for (UActorComponent* Component : Components)
        {
            if (Component->GetIsReplicated())
            {
                // 5. ì»´í¬ë„ŒíŠ¸ ë¦¬í”Œë¦¬ì¼€ì´í„° ë³µì›
                TSharedPtr<FObjectReplicator> ComponentReplicator = 
                    DormantReplicatorHolder.FindAndRemoveReplicator(Actor, Component);
                
                if (ComponentReplicator.IsValid())
                {
                    Channel->ReplicationMap.Add(Component, ComponentReplicator);
                }
            }
        }
    }
}
```