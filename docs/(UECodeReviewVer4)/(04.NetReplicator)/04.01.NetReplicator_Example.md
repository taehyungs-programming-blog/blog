---
layout: default
title: "04.01. Network ë³µì œ ì‹œìŠ¤í…œ ì˜ˆì‹œ"
parent: "(04. Network ë³µì œ ì‹œìŠ¤í…œ êµ¬ì¡°ì¡° ì„¤ëª…ëª…)"
grand_parent: "(UE Code-Review ğŸ¤–)"
nav_order: 1
---

## Table of contents
{: .no_toc .text-delta }

1. TOC
{:toc}

---

## ê¸°ë³¸ ì´ë¡ 

* ë„¤íŠ¸ì›Œí¬ ë³µì œ ì‘ë™ ê³¼ì • ì„¤ëª…
    * ìºë¦­í„° ìƒì„± ì‹œ `bReplicates = true`ë¡œ ì„¤ì •í•˜ì—¬ ë³µì œë¥¼ í™œì„±í™”
    * `GetLifetimeReplicatedProps` í•¨ìˆ˜ì—ì„œ ë³µì œí•  ì†ì„±ì„ ë“±ë¡
    * ì„œë²„ì—ì„œ ê°’ì´ ë³€ê²½ë˜ë©´ Engineì˜ FRepLayout ì‹œìŠ¤í…œì´ ìë™ìœ¼ë¡œ í´ë¼ì´ì–¸íŠ¸ì— ë³µì œ -> ì´ê±´ ì˜ˆì‹œì½”ë“œì—ëŠ” ì—†ìŠµë‹ˆë‹¤.
    * í´ë¼ì´ì–¸íŠ¸ëŠ” ë³µì œëœ ê°’ì„ ë°›ì•„ ìƒíƒœë¥¼ ì—…ë°ì´íŠ¸
    * ReplicatedUsing ì†ì„±ì´ ìˆëŠ” ë³€ìˆ˜ëŠ” ê°’ì´ ë³µì œëœ í›„ ì§€ì •ëœ í•¨ìˆ˜(ì˜ˆ: OnRep_IsRunning)ê°€ í´ë¼ì´ì–¸íŠ¸ì—ì„œ í˜¸ì¶œë©ë‹ˆë‹¤.
* ì´ ì½”ë“œëŠ” AMyCharacterì˜ Health, bIsRunning, bIsCrouching, ê·¸ë¦¬ê³  EquippedWeapon êµ¬ì¡°ì²´ë¥¼ ë„¤íŠ¸ì›Œí¬ë¥¼ í†µí•´ ë³µì œí•˜ë©°, í´ë¼ì´ì–¸íŠ¸ì—ì„œ ì„œë²„ë¡œì˜ ëª…ë ¹ì€ Server RPCë¥¼ í†µí•´ ì²˜ë¦¬í•©ë‹ˆë‹¤.

---

## AMyCharacter êµ¬í˜„

```cpp
// MyCharacter.h
UCLASS()
class GAME_API AMyCharacter : public ACharacter
{
    GENERATED_BODY()
    
public:
    AMyCharacter();
    
    // ë³µì œë  ì†ì„±ë“¤
    UPROPERTY(Replicated)
    float Health;
    
    UPROPERTY(ReplicatedUsing=OnRep_IsRunning)
    bool bIsRunning;
    
    UPROPERTY(Replicated)
    bool bIsCrouching;
    
    UPROPERTY(Replicated)
    FWeaponInfo EquippedWeapon;
    
    // ë³µì œ í›„ í´ë¼ì´ì–¸íŠ¸ì—ì„œ í˜¸ì¶œë  í•¨ìˆ˜
    UFUNCTION()
    void OnRep_IsRunning();
    
    // ì„œë²„ì—ì„œ ì‹¤í–‰ë  í•¨ìˆ˜ë“¤
    UFUNCTION(Server, Reliable)
    void ServerStartRunning();
    
    UFUNCTION(Server, Reliable)
    void ServerStopRunning();
    
    UFUNCTION(Server, Reliable)
    void ServerToggleCrouch();
    
    UFUNCTION(Server, Reliable, WithValidation)
    void ServerSetHealth(float NewHealth);
    
    // ë³µì œ ì†ì„± ë“±ë¡ í•¨ìˆ˜
    virtual void GetLifetimeReplicatedProps(TArray<FLifetimeProperty>& OutLifetimeProps) const override;
};

// ë¬´ê¸° ì •ë³´ë¥¼ ë‹´ëŠ” êµ¬ì¡°ì²´
USTRUCT()
struct FWeaponInfo
{
    GENERATED_BODY()
    
    UPROPERTY()
    FString WeaponName;
    
    UPROPERTY()
    int32 Ammo;
    
    UPROPERTY()
    float Damage;
    
    UPROPERTY()
    bool bIsAutomatic;
    
    FWeaponInfo()
    {
        WeaponName = TEXT("ê¸°ë³¸ ë¬´ê¸°");
        Ammo = 30;
        Damage = 10.0f;
        bIsAutomatic = false;
    }
};
```

```cpp
// MyCharacter.cpp
#include "MyCharacter.h"
#include "Net/UnrealNetwork.h"
#include "GameFramework/CharacterMovementComponent.h"

AMyCharacter::AMyCharacter()
{
    // ë³µì œ í™œì„±í™”
    bReplicates = true;
    
    // ì›€ì§ì„ ë³µì œ ì„¤ì •
    GetCharacterMovement()->SetIsReplicated(true);
    
    // ì´ˆê¸°ê°’ ì„¤ì •
    Health = 100.0f;
    bIsRunning = false;
    bIsCrouching = false;
}

void AMyCharacter::GetLifetimeReplicatedProps(TArray<FLifetimeProperty>& OutLifetimeProps) const
{
    Super::GetLifetimeReplicatedProps(OutLifetimeProps);
    
    // ë³µì œ ì†ì„± ë“±ë¡
    DOREPLIFETIME(AMyCharacter, Health);
    DOREPLIFETIME(AMyCharacter, bIsRunning);
    DOREPLIFETIME(AMyCharacter, bIsCrouching);
    DOREPLIFETIME(AMyCharacter, EquippedWeapon);
}

void AMyCharacter::OnRep_IsRunning()
{
    // í´ë¼ì´ì–¸íŠ¸ì—ì„œ ì‹¤í–‰ë  ì½”ë“œ
    if (bIsRunning)
    {
        // ë‹¬ë¦¬ê¸° ì• ë‹ˆë©”ì´ì…˜ ì¬ìƒ
        GetCharacterMovement()->MaxWalkSpeed = 600.0f;
    }
    else
    {
        // ê±·ê¸° ì• ë‹ˆë©”ì´ì…˜ ì¬ìƒ
        GetCharacterMovement()->MaxWalkSpeed = 300.0f;
    }
}

void AMyCharacter::ServerStartRunning_Implementation()
{
    // ì„œë²„ì—ì„œ ì‹¤í–‰ë  ì½”ë“œ
    bIsRunning = true;
    
    // ì„œë²„ì—ì„œë„ ë™ì¼í•œ ë¡œì§ ì ìš©
    OnRep_IsRunning();
    
    // ë³µì œëŠ” ìë™ìœ¼ë¡œ ì²˜ë¦¬ë¨
}

void AMyCharacter::ServerStopRunning_Implementation()
{
    // ì„œë²„ì—ì„œ ì‹¤í–‰ë  ì½”ë“œ
    bIsRunning = false;
    
    // ì„œë²„ì—ì„œë„ ë™ì¼í•œ ë¡œì§ ì ìš©
    OnRep_IsRunning();
    
    // ë³µì œëŠ” ìë™ìœ¼ë¡œ ì²˜ë¦¬ë¨
}

void AMyCharacter::ServerToggleCrouch_Implementation()
{
    // ì„œë²„ì—ì„œ ì‹¤í–‰ë  ì½”ë“œ
    bIsCrouching = !bIsCrouching;
    
    // ì•‰ê¸°/ì„œê¸° ìƒíƒœ ë³€ê²½
    if (bIsCrouching)
    {
        Crouch();
    }
    else
    {
        UnCrouch();
    }
    
    // ë³µì œëŠ” ìë™ìœ¼ë¡œ ì²˜ë¦¬ë¨
}

bool AMyCharacter::ServerSetHealth_Validate(float NewHealth)
{
    // ìœ íš¨ì„± ê²€ì‚¬ - ìŒìˆ˜ëŠ” í—ˆìš©í•˜ì§€ ì•ŠìŒ
    return NewHealth >= 0.0f;
}

void AMyCharacter::ServerSetHealth_Implementation(float NewHealth)
{
    // ìœ íš¨í•œ ê°’ë§Œ ì ìš©
    Health = NewHealth;
    
    // ì²´ë ¥ì´ 0 ì´í•˜ì¸ì§€ í™•ì¸
    if (Health <= 0.0f)
    {
        // ì‚¬ë§ ì²˜ë¦¬ ë¡œì§
    }
}
```