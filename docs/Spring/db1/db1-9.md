---
layout: default
title: "09. Exception í™œìš©"
parent: "(DB1)"
grand_parent: "Spring ğŸ"
nav_order: 1
---

## Table of contents
{: .no_toc .text-delta }

1. TOC
{:toc}

---

* ê¸°ë³¸ì ìœ¼ë¡œ ì–¸ì²´í¬(ëŸ°íƒ€ì„) ì˜ˆì™¸ë¥¼ ì‚¬ìš©í•˜ì. 
* ì²´í¬ ì˜ˆì™¸ëŠ” ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ìƒ ì˜ë„ì ìœ¼ë¡œ ë˜ì§€ëŠ” ì˜ˆì™¸ì—ë§Œ ì‚¬ìš©í•˜ì. 
* ì´ ê²½ìš° í•´ë‹¹ ì˜ˆì™¸ë¥¼ ì¡ì•„ì„œ ë°˜ë“œì‹œ ì²˜ë¦¬í•´ì•¼ í•˜ëŠ” ë¬¸ì œì¼ ë•Œë§Œ ì²´í¬ ì˜ˆì™¸ë¥¼ ì‚¬ìš©í•´ì•¼ í•œë‹¤. 

---

* ì™œ ì–¸ì²´í¬ë¥¼ ì¨ì•¼í• ê¹Œ?

## ì²´í¬ ì˜ˆì™¸ì˜ ë¬¸ì œì  

* ì²´í¬ ì˜ˆì™¸ëŠ” ì»´íŒŒì¼ëŸ¬ê°€ ì˜ˆì™¸ ëˆ„ë½ì„ ì²´í¬í•´ì£¼ê¸° ë•Œë¬¸ì— ê°œë°œìê°€ ì‹¤ìˆ˜ë¡œ ì˜ˆì™¸ë¥¼ ë†“ì¹˜ëŠ” ê²ƒì„ ë§‰ì•„ì¤€ë‹¤. 
* ê·¸ë˜ì„œ í•­ìƒ ëª…ì‹œì ìœ¼ë¡œ ì˜ˆì™¸ë¥¼ ì¡ì•„ì„œ ì²˜ë¦¬í•˜ê±°ë‚˜, ì²˜ë¦¬í•  ìˆ˜ ì—†ì„ ë•ŒëŠ” ì˜ˆì™¸ë¥¼ ë˜ì§€ë„ë¡ method() throws ì˜ˆì™¸ ë¡œ ì„ ì–¸í•´ì•¼ í•œë‹¤. 
* ì§€ê¸ˆê¹Œì§€ ì´ì•¼ê¸°ë¥¼ ë“¤ì–´ë³´ë©´ ì²´í¬ ì˜ˆì™¸ê°€ ëŸ°íƒ€ì„ ì˜ˆì™¸ë³´ë‹¤ ë” ì•ˆì „í•˜ê³  ì¢‹ì•„ë³´ì´ëŠ”ë°, 
ì™œ ì²´í¬ ì˜ˆì™¸ë¥¼ ê¸°ë³¸ìœ¼ë¡œ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ ë¬¸ì œê°€ ë ê¹Œ?

<p align="center">
  <img src="https://taehyungs-programming-blog.github.io/blog/assets/images/spring/db1/db1-9-1.png"/>
</p>

* Repositoryë‚˜ NetworkClientì—ì„œ ë°œìƒí•œ ë¬¸ì œë¥¼ Application(Service)ë‹¨ì—ì„œ ì–´ë–»ê²Œ ì²˜ë¦¬ë¥¼ í•  ìˆ˜ ìˆì„ê¹Œ?
* ì²˜ë¦¬ë¥¼ í• ìˆ˜ ì—†ê¸°ì— ì™¸ë¶€ë¡œ ë˜ì§„ë‹¤
* method() throws SQLException, ConnectException <-- ì´ëŸ°ì½”ë“œ í•„ìš”í•˜ê²Œë¨
* ì´ëŸ°ì‹ìœ¼ë¡œ ê¼¬ë¦¬ì— ê¼¬ë¦¬ë¥¼ ë¬¼ê³ ê°€ë‹¤ë³´ë©´ ëª¨ë“  ì½”ë“œì— method() throws SQLException, ConnectException ê°€ ë¶™ê²Œëœë‹¤. ì´ê²Œ ì˜³ì€ê¸¸ì¸ê°€?

---

```java
public class CheckedAppTest {

    @Test
    void checked() {
        Controller controller = new Controller();
        assertThatThrownBy(() -> controller.request())
                .isInstanceOf(Exception.class);
    }

    static class Controller {
        Service service = new Service();

        public void request() throws SQLException, ConnectException {
            service.logic();
        }
    }

    static class Service {
        Repository repository = new Repository();
        NetworkClient networkClient = new NetworkClient();

        public void logic() throws SQLException, ConnectException {
            repository.call();
            networkClient.call();
        }

    }

    static class NetworkClient {
        public void call() throws ConnectException {
            throw new ConnectException("ì—°ê²° ì‹¤íŒ¨");
        }
    }
    static class Repository {
        public void call() throws SQLException {
            throw new SQLException("ex");
        }
    }
}
```

## 2ê°€ì§€ ë¬¸ì œ 

* ì§€ê¸ˆê¹Œì§€ ì„¤ëª…í•œ ì˜ˆì‹œì™€ ì½”ë“œë¥¼ ë³´ë©´ í¬ê²Œ 2ê°€ì§€ ë¬¸ì œë¥¼ ì•Œ ìˆ˜ ìˆë‹¤. 

* ë³µêµ¬ ë¶ˆê°€ëŠ¥í•œ ì˜ˆì™¸ 
* ì˜ì¡´ ê´€ê³„ì— ëŒ€í•œ ë¬¸ì œ

* ë³µêµ¬ ë¶ˆê°€ëŠ¥í•œ ì˜ˆì™¸ 
    * ëŒ€ë¶€ë¶„ì˜ ì˜ˆì™¸ëŠ” ë³µêµ¬ê°€ ë¶ˆê°€ëŠ¥í•˜ë‹¤. ì¼ë¶€ ë³µêµ¬ê°€ ê°€ëŠ¥í•œ ì˜ˆì™¸ë„ ìˆì§€ë§Œ ì•„ì£¼ ì ë‹¤. SQLException ì„ ì˜ˆë¥¼ ë“¤ë©´ ë°ì´í„°ë² ì´ìŠ¤ì— ë¬´ì–¸ê°€ ë¬¸ì œê°€ ìˆì–´ì„œ ë°œìƒí•˜ëŠ” ì˜ˆì™¸ì´ë‹¤. SQL ë¬¸ë²•ì— ë¬¸ì œê°€ ìˆì„ ìˆ˜ë„ ìˆê³ , ë°ì´í„°ë² ì´ìŠ¤ ìì²´ì— ë­”ê°€ ë¬¸ì œê°€ ë°œìƒí–ˆì„ ìˆ˜ë„ ìˆë‹¤. ë°ì´í„°ë² ì´ìŠ¤ ì„œë²„ê°€ ì¤‘ê°„ì— ë‹¤ìš´ ë˜ì—ˆì„ ìˆ˜ë„ ìˆë‹¤. ì´ëŸ° ë¬¸ì œë“¤ì€ ëŒ€ë¶€ë¶„ ë³µêµ¬ê°€ ë¶ˆê°€ëŠ¥í•˜ë‹¤. íŠ¹íˆë‚˜ ëŒ€ë¶€ë¶„ì˜ ì„œë¹„ìŠ¤ë‚˜ ì»¨íŠ¸ë¡¤ëŸ¬ëŠ” ì´ëŸ° ë¬¸ì œë¥¼ í•´ê²°í•  ìˆ˜ëŠ” ì—†ë‹¤. ë”°ë¼ì„œ ì´ëŸ° ë¬¸ì œë“¤ì€ ì¼ê´€ì„± ìˆê²Œ ê³µí†µìœ¼ë¡œ ì²˜ë¦¬í•´ì•¼ í•œë‹¤. ì˜¤ë¥˜ ë¡œê·¸ë¥¼ ë‚¨ê¸°ê³  ê°œë°œìê°€ í•´ë‹¹ ì˜¤ë¥˜ë¥¼ ë¹ ë¥´ê²Œ ì¸ì§€í•˜ëŠ” ê²ƒì´ í•„ìš”í•˜ë‹¤. ì„œë¸”ë¦¿ í•„í„°, ìŠ¤í”„ë§ ì¸í„°ì…‰í„°, ìŠ¤í”„ë§ì˜ ControllerAdvice ë¥¼ ì‚¬ìš©í•˜ë©´ ì´ëŸ° ë¶€ë¶„ì„ ê¹”ë”í•˜ê²Œ ê³µí†µìœ¼ë¡œ í•´ê²°í•  ìˆ˜ ìˆë‹¤. 
* ì˜ì¡´ ê´€ê³„ì— ëŒ€í•œ ë¬¸ì œ 
    * ì²´í¬ ì˜ˆì™¸ì˜ ë˜ ë‹¤ë¥¸ ì‹¬ê°í•œ ë¬¸ì œëŠ” ì˜ˆì™¸ì— ëŒ€í•œ ì˜ì¡´ ê´€ê³„ ë¬¸ì œì´ë‹¤. ì•ì„œ ëŒ€ë¶€ë¶„ì˜ ì˜ˆì™¸ëŠ” ë³µêµ¬ ë¶ˆê°€ëŠ¥í•œ ì˜ˆì™¸ë¼ê³  í–ˆë‹¤. ê·¸ëŸ°ë° ì²´í¬ ì˜ˆì™¸ì´ê¸° ë•Œë¬¸ì— ì»¨íŠ¸ë¡¤ëŸ¬ë‚˜ ì„œë¹„ìŠ¤ ì…ì¥ì—ì„œëŠ” ë³¸ì¸ì´ ì²˜ë¦¬í•  ìˆ˜ ì—†ì–´ë„ ì–´ì©” ìˆ˜ ì—†ì´ throws ë¥¼ í†µí•´ ë˜ì§€ëŠ” ì˜ˆì™¸ë¥¼ ì„ ì–¸í•´ì•¼ í•œë‹¤.
* ë‹¨ìˆœíˆ method() throws SQLException, ConnectExceptionì½”ë“œì¶”ê°€ê°€ ë¬¸ì œê°€ ì•„ë‹ˆë¼ SQLException(JDBC)ì— ì˜ì¡´ë˜ëŠ”ê²Œ ë¬¸ì œì´ë‹¤.

---

## ì–¸ì²´í¬ ì˜ˆì™¸ í™œìš©

```java
@Slf4j
public class UnCheckedAppTest {

    @Test
    void unchecked() {
        Controller controller = new Controller();
        assertThatThrownBy(() -> controller.request())
                .isInstanceOf(Exception.class);
    }

    @Test
    void printEx() {
        Controller controller = new Controller();
        try {
            controller.request();
        } catch (Exception e) {
//            e.printStackTrace();
            log.info("ex", e);
        }

    }

    static class Controller {
        Service service = new Service();

        public void request() {
            service.logic();
        }
    }

    static class Service {
        Repository repository = new Repository();
        NetworkClient networkClient = new NetworkClient();

        public void logic() {
            repository.call();
            networkClient.call();
        }

    }

    static class NetworkClient {
        public void call() {
            throw new RuntimeConnectException("ì—°ê²° ì‹¤íŒ¨");
        }
    }

    static class Repository {
        public void call() {
            try {
                runSQL();
            } catch (SQLException e) {
                throw new RuntimeSQLException(e);
            }
        }

        public void runSQL () throws SQLException {
            throw new SQLException("ex");
        }
    }

    static class RuntimeConnectException extends RuntimeException {
        public RuntimeConnectException(String message) {
            super(message);
        }
    }

    static class RuntimeSQLException extends RuntimeException {
        public RuntimeSQLException() {
        }

        public RuntimeSQLException(Throwable cause) {
            super(cause);
        }
    }


}
```