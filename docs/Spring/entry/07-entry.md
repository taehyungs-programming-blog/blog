---
layout: default
title: "07. DBì ‘ê·¼"
parent: "(ì…ë¬¸)"
grand_parent: "Spring ğŸ"
nav_order: 1
---

## Table of contents
{: .no_toc .text-delta }

1. TOC
{:toc}

---

* **ì¬ì •ë¦¬ í•„ìš”.**


## í™˜ê²½ì„¸íŒ… (H2 DB)

* [Clone Code ğŸŒ](https://github.com/EasyCoding-7/spring-entry/tree/7-1)

ğŸš— [H2 ë‹¤ìš´](https://www.h2database.com/html/main.html)

<p align="center">
  <img src="https://taehyungs-programming-blog.github.io/blog/assets/images/spring/entry/entry-7-1.png"/>
</p>

ğŸš— ì„¤ì¹˜ê²½ë¡œì—ì„œ `h2.bat` ì‹¤í–‰

<p align="center">
  <img src="https://taehyungs-programming-blog.github.io/blog/assets/images/spring/entry/entry-7-2.png"/>
</p>

ğŸš— **ì—°ê²°**ì„ ëˆ„ë¥´ë©´ í™”ë©´ì´ ë°”ë€Œê³  `C:\User\{ì‚¬ìš©ì}`ì— `test.mv.db`íŒŒì¼ì´ ìƒì„±ë¨ì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.

<p align="center">
  <img src="https://taehyungs-programming-blog.github.io/blog/assets/images/spring/entry/entry-7-3.png"/>
</p>

<p align="center">
  <img src="https://taehyungs-programming-blog.github.io/blog/assets/images/spring/entry/entry-7-4.png"/>
</p>

ğŸš— ì´í›„ì— ì ‘ì†ì€ ë‹¤ì¤‘ì ‘ì†ì„ ìœ„í•˜ì—¬ socketì„ ì—´ì–´ ì ‘ì†í•˜ë„ë¡ í•˜ì. : `jdbc:h2:tcp://localhost/~/test`

<p align="center">
  <img src="https://taehyungs-programming-blog.github.io/blog/assets/images/spring/entry/entry-7-5.png"/>
</p>

ğŸš— ê°„ë‹¨í•œ í…Œì´ë¸” ìƒì„± sqlëª…ë ¹ì–´ëŠ” ì•„ë˜ì™€ ê°™ì´ ë„£ëŠ”ë‹¤

```sql
drop table if exists member CASCADE;
create table member
(
    id bigint generated by default as identity,
    name varchar(255),
    primary key (id)
);
```

<p align="center">
  <img src="https://taehyungs-programming-blog.github.io/blog/assets/images/spring/entry/entry-7-6.png"/>
</p>

---

## ìˆœìˆ˜ JDBCë¥¼ í†µí•œ ì ‘ê·¼

* [Clone Code ğŸŒ](https://github.com/EasyCoding-7/spring-entry/tree/7-2)

ğŸš• ì‚¬ì‹¤ ì´ì œ ì´ ë°©ì‹ì€ ê±°ì˜ ì‚¬ìš©ë˜ì§€ ì•ŠëŠ”ë‹¤.<br>
ğŸš• ì˜ˆì „ì— ì´ë ‡ê²Œ í˜ë“¤ê²Œ DBê´€ë¦¬ë¥¼ í–ˆë‹¤ëŠ” ê²ƒì„ ì´í•´í•˜ëŠ” ì°¨ì›ì—ì„œ ì•Œì•„ë‘ì.

ğŸš• `build.gradle`ì•„ë˜ì™€ ê°™ì´ ìˆ˜ì •

```gradle
dependencies {
	implementation 'org.springframework.boot:spring-boot-starter-thymeleaf'
	implementation 'org.springframework.boot:spring-boot-starter-web'
	implementation 'org.springframework.boot:spring-boot-starter-jdbc'
	runtimeOnly 'com.h2database:h2'
	testImplementation 'org.springframework.boot:spring-boot-starter-test'
}
```

ğŸš• `src/main/resources/application.properties`ì•„ë˜ ì¶”ê°€

```
spring.datasource.url=jdbc:h2:tcp://localhost/~/test
spring.datasource.driver-class-name=org.h2.Driver
```

ğŸš• `src/main/java/repository/JdbcMemverRepository.java`ìƒì„±(ì½”ë“œê°€ ê¸¸ê¸°ì— Cloneí•´ì„œ ë³¼ ê²ƒ)

ğŸš• í•˜ë‚˜ë§Œ ì˜ˆë¡œë³´ì

```java
@Override
public Member save(Member member) {
    // sqlì„ ì´ë ‡ê²Œ ì“¸ ê²ƒì´ë‹¤.
    String sql = "insert into member(name) values(?)";

    Connection conn = null;
    PreparedStatement pstmt = null;
    ResultSet rs = null;

    try {
        // connectionì„ ê°€ì ¸ì˜¤ê³ 
        conn = getConnection();
        // idë¥¼ í•˜ë‚˜ì”© ì¦ê°€í•˜ë©° ë„£ëŠ”ë‹¤
        pstmt = conn.prepareStatement(sql,
                Statement.RETURN_GENERATED_KEYS);
        // ë„£ì„ ì´ë¦„ì„ ë„£ê³ 
        pstmt.setString(1, member.getName());
        // execute!
        pstmt.executeUpdate();

        rs = pstmt.getGeneratedKeys();
        if (rs.next()) {
            member.setId(rs.getLong(1));
        } else {
            throw new SQLException("id ì¡°íšŒ ì‹¤íŒ¨");
        }
        return member;
    } catch (Exception e) {
        throw new IllegalStateException(e);
    } finally {
        close(conn, pstmt, rs);
    }
}
```

ğŸš• ì´ì œ JdbcMemberRepositoryë¥¼ ì“´ë‹¤ê³  ì•Œë¦°ë‹¤.

```java
package hello.hellospring;

import hello.hellospring.repository.JdbcMemberRepository;
import hello.hellospring.repository.MemberRepository;
import hello.hellospring.service.MemberService;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;

import javax.sql.DataSource;

@Configuration
public class SpringConfig {

    private DataSource dataSource;

    @Autowired
    public SpringConfig(DataSource dataSource){
        this.dataSource = dataSource;
    }

    @Bean
    public MemberService memberService() {
        return new MemberService(memberRepository());
    }

    @Bean
    public MemberRepository memberRepository() {
        // return new MemoryMemberRepository();
        return new JdbcMemberRepository(dataSource);
    }
}
```

ğŸš• **í•˜ê³ ì‹¶ì€ ë§** - Springì„ í†µí•´ì„œ ì˜¤ì§ ConfigíŒŒì¼ë§Œ ìˆ˜ì •í•´ Classë¥¼ êµí™˜í•  ìˆ˜ ìˆì—ˆë‹¤.

---

