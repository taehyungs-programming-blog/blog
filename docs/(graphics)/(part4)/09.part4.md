---
layout: default
title: "09. Bitonic Sort"
parent: "(Computer Animation)"
grand_parent: "(Graphics ğŸ˜)"
nav_order: 1
---

## Table of contents
{: .no_toc .text-delta }

1. TOC
{:toc}

---

* [Get Code ğŸŒ](https://github.com/Arthur880708/Graphics_Part4/blob/main/Examples/Ex1408_BitonicSort.h)

* ì •ë ¬ì„ GPUë¥¼ ì‚¬ìš©í•´ í•´ë³´ì
* Bitonic Sortë¥¼ ì´ìš©í•  ì˜ˆì •ì¸ë° [Github ğŸŒ](https://github.com/Microsoft/DirectX-Graphics-Samples/blob/master/MiniEngine/Core/BitonicSort.h)ì— DirectX12ë¥¼ ì´ìš©í•´ êµ¬í˜„í•œ ì…ˆí”Œì´ìˆìŒ(ìµœì í™”ê°€ ë˜ì–´ ë³´ê¸°ëŠ” ì‰½ì§€ ì•ŠìŒ)
* ëŒ€ëµ êµ¬í˜„ë°©ë²•ì€ ì•„ë˜ì˜ ê·¸ë¦¼ì„ ì´í•´í•˜ë©´ ì‰½ë‹¤

<p align="center">
  <img src="https://taehyungs-programming-blog.github.io/blog/assets/images/graphics/part4/p4-9-1.png"/>
</p>

* ê°€ë¡œì¤„ì´ ì…ë ¥ì´ë¼ ê°€ì •í•˜ì
* í™”ì‚´í‘œ ë°©í–¥ìœ¼ë¡œ í° ìˆ«ìë¥¼ ì´ë™ì‹œí‚¨ë‹¤
* ì €ë ‡ê²Œ ëê¹Œì§€ ì§„í–‰ì‹œí‚¤ë©´ Sortê°€ ì™„ë£Œëœë‹¤.
* ë ìš©ìš©??? 

<p align="center">
  <img src="https://taehyungs-programming-blog.github.io/blog/assets/images/graphics/part4/p4-9-2.png"/>
</p>

* ì¦ëª…ì€ ... ìƒëµí•œë‹¤ ...

```cpp
// CPUêµ¬í˜„ì„ ë¨¼ì €í•´ë³´ì

void SortCPU(vector<Element> &arr) {

    const size_t numElements = arr.size();

    for (uint32_t k = 2; k <= numElements; k *= 2)
        for (uint32_t j = k / 2; j > 0; j /= 2) {

#pragma omp parallel for

            for (int32_t i = 0; i < int32_t(numElements); i++) {
                int32_t l = i ^ j;
                if (l > i) {
                    if (((i & k) == 0) && (arr[i].key > arr[l].key) ||
                        ((i & k) != 0) && (arr[i].key < arr[l].key))
                        std::swap(arr[i], arr[l]);
                }
            }

            // cout << j << endl;
            // PrintArray(arr);
        }
}
```

```cpp
// CSë¡œ êµ¬í˜„

struct Element
{
    uint key;
    uint value;
};

cbuffer MyBuffer : register(b0)
{
    uint k;
    uint j;
}

RWStructuredBuffer<Element> arr : register(u0);

[numthreads(1024, 1, 1)]
void main(int3 gID : SV_GroupID, int3 gtID : SV_GroupThreadID,
          uint3 dtID : SV_DispatchThreadID)
{
    uint i = dtID.x;
    
    uint l = i ^ j;
    if (l > i)
    {
        Element iEle = arr[i];
        Element lEle = arr[l];
        
        if(((i & k) == 0) && (iEle.key > lEle.key) ||
            ((i & k) != 0) && (iEle.key < lEle.key))
        {
            arr[i] = lEle;
            arr[l] = iEle;
        }
    }
}
```