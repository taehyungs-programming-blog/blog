---
layout: default
title: "12. Smoothed Particle Hydrodynamics(SPH)"
parent: "(Computer Animation)"
grand_parent: "(Graphics ğŸ˜)"
nav_order: 2
---

## Table of contents
{: .no_toc .text-delta }

1. TOC
{:toc}

---

* [Get Code ğŸŒ](https://github.com/Arthur880708/Graphics_Part4/blob/main/Examples/Ex1503_SphWater.h)


* ì›ë¦¬ëŠ” ê°„ë‹¨í•˜ë‹¤. ì£¼ë³€ì˜ ì…ì(Particle)ë¥¼ ë¶„ì„í›„ ê°€ê¹Œì´ ìˆë‹¤ë©´ ì„œë¡œë¥¼ ë°€ì–´ë‚´ê²Œ ë§Œë“¤ì.
    * ì¶”ê°€ì ìœ¼ë¡œ ê±°ê¸°ë‹¤ ì ì„±ì„ ë” í•¨.
    * ì ì„±ì´ë¼ í•¨ì€ ... ì…ìê°„ì˜ ì†ë„ê°€ ë‹¤ë¥¼ë•Œ ë¹ ë¥¸ì†ë„ëŠ” ì†ë„ë¥¼ ëŠ¦ì¶”ê³  ëŠë¦°ì†ë„ëŠ” ì†ë„ë¥¼ ë”í•˜ë©´ ì ì„±ì´ êµ¬í˜„ëœë‹¤.
* ì½”ë“œë¡œ ë³´ìë©´ ...

```cpp
class SphSimulation {
  public:
    struct Particle {
        Vector3 position = Vector3(0.0f);
        Vector3 velocity = Vector3(0.0f);
        Vector3 force = Vector3(0.0f);
        // ì…ìì— densityì™€ pressureê°€ ìˆë‹¤ëŠ”ê²ƒì— ì£¼ëª©í•˜ì
        float density = 0.0f;
        float pressure = 0.0f;

        Vector3 color = Vector3(1.0f);
        float life = 0.0f;
        float size = 1.0f;
    };

    void Update(float dt);
    void UpdateDensity();
    void UpdateForces();

    vector<Particle> m_particlesCpu;
    float m_radius = 1.0f / 16.0f;
    float m_mass = 1.0f;

    // ì…ìê°„ ì–¼ë§ˆë‚˜ ë°€ì–´ë‚´ëŠ”ì§€ë¥¼ ì˜ë¯¸
    float m_pressureCoeff = 1.0f;
    float m_density0 = 1.0f;
    float m_viscosity = 0.1f;


    // ...
```

```cpp
void SphSimulation::UpdateDensity() {

#pragma omp parallel for
    for (int i = 0; i < m_particlesCpu.size(); i++) {

        // particleì˜ lifeê°€ 0ì´ë¼ë©´ continue
        if (m_particlesCpu[i].life < 0.0f)
            continue;

        // ë°€ë„ë¥¼ êµ¬í•´ë³¸ë‹¤
        m_particlesCpu[i].density = 0.0f;

        for (size_t j = 0; j < m_particlesCpu.size(); j++) {

            if (m_particlesCpu[j].life < 0.0f)
                continue;

            const float dist =
                (m_particlesCpu[i].position - m_particlesCpu[j].position)
                    .Length();

            // ë„ˆë¬´ ë¨¼ particleì€ ë¬´ì‹œ
            if (dist >= m_radius)
                continue;

            m_particlesCpu[i].density +=
                m_mass * SphKernels::CubicSpline(dist * 2.0f / m_radius);
        }

        // densityë¡œ ë¶€í„° ì••ë ¥êµ¬í•˜ê¸°
        m_particlesCpu[i].pressure =
            m_pressureCoeff *
            (pow(m_particlesCpu[i].density / m_density0, 7.0f) - 1.0f);
    }
}
```
