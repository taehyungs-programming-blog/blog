---
layout: default
title: "19-01. .hlsli ìˆ˜ì • + Packing Rules"
parent: "(DirectX12 Tutorial)"
grand_parent: "(Graphics ğŸ˜)"
nav_order: 2
---

## Table of contents
{: .no_toc .text-delta }

1. TOC
{:toc}

---

## .hlsli íŒŒì¼ì˜ ìˆ˜ì • í•„ìš”

* ë§¤ë²ˆ `default.hlsli`ì— ë°ì´í„°ë¥¼ ë‹¤ ë„£ì—ˆëŠ”ë° ê·¸ëŸ¬ë‹¤ ë³´ë©´ `default.hlsli`ì˜ ì½”ë“œì–‘ì´ ë„ˆë¬´ì»¤ì§€ê²Œ ëœë‹¤. -> ì½”ë“œë¥¼ ê° íŒŒì¼ë¡œ ë‚˜ëˆ„ëŠ” ê³¼ì •ì´ í•„ìš”í•˜ë‹¤
* ê·¸ë¦¬ê³  í˜„ì¬ëŠ” GPU ë ˆì§€ìŠ¤í„°ì— ë°ì´í„°ë¥¼ ë³´ë‚¼ë•Œ Descriptor Tableë§Œì„ í†µí•´ì„œ ë³´ë‚´ëŠ”ë°
ê·¸ëŸ¬ë‹¤ ë³´ë‹ˆ ê°±ì‹ ë˜ì§€ ì•Šì•„ë„ ë˜ëŠ” ë°ì´í„° ë§ˆì € Descriptor Tableì•ˆì— ë”¸ë ¤ë“¤ì–´ê°€ë©° ë§¤ë²ˆ ê°±ì‹ í•´ì•¼í•˜ëŠ” ë¶ˆí¸í•œ ìƒí™©ì´ ë°œìƒí•œë‹¤.
* ê°±ì‹ ì´ í•„ìš”ì—†ëŠ” ë¶€ë¶„ì€ Constant Bufferì— ë„£ê³  ê°±ì‹ ì´ ì§€ì†ì ìœ¼ë¡œ ì¼ì–´ë‚˜ëŠ” ë¶€ë¶„ë§Œ Descriptor Tableë¡œ ë³´ë‚´ê²Œ í•˜ê² ë‹¤.
* í—·ê°ˆë¦´ê¹Œë´ ë‹¤ì‹œ ì„¤ëª…í•˜ë©´ Constant BufferëŠ” í•˜ë‚˜ì”© ì—…ë°ì´íŠ¸ê°€ ê°€ëŠ¥í•˜ê³ 
Descriptor Tableì€ Tableë‹¨ìœ„ë¡œ ì—…ë°ì´íŠ¸ê°€ ê°€ëŠ¥í•œë°, ëª¨ë“  ë°ì´í„°ë¥¼ Descriptor Tableì— ê´€ë¦¬ì‹œ êµ³ì´ ì—…ë°ì´íŠ¸ í•˜ì§€ ì•Šì•„ë„ ë  ë°ì´í„°ê¹Œì§€ ëª¨ë‘ ì—…ë°ì´íŠ¸ í•´ì•¼í•˜ëŠ” ìƒí™©ì´ ë°œìƒí•œë‹¤.

```cpp
// *** Example ***

// ê¸°ì¡´ ObjectëŠ” Materialì´ë‚˜ TextureëŠ” Objectë³„ë¡œ PushDataí•´ì¤˜ì•¼ í•˜ì§€ë§Œ
// Lighting ê°™ì€ê²½ìš°ëŠ” ëª¨ë“  Objectì— ë™ì¼í•˜ê²Œ ë“¤ì–´ê°€ê²Œ ëœë‹¤.
void Material::PushData()
{
	// CBV ì—…ë¡œë“œ
	CONST_BUFFER(CONSTANT_BUFFER_TYPE::MATERIAL)->PushData(&_params, sizeof(_params));

	// SRV ì—…ë¡œë“œ
	for (size_t i = 0; i < _textures.size(); i++)
	{
		if (_textures[i] == nullptr)
			continue;

		SRV_REGISTER reg = SRV_REGISTER(static_cast<int8>(SRV_REGISTER::t0) + i);
		GEngine->GetTableDescHeap()->SetSRV(_textures[i]->GetCpuHandle(), reg);
	}

	// íŒŒì´í”„ë¼ì¸ ì„¸íŒ…
	_shader->Update();
}
```

---

## Packing Rules

* HLSLì—ì„œëŠ” 16Bytes ë°”ìš´ë”ë¦¬ë¡œ ì •ë ¬ì´ ëœë‹¤.
* ì´ê²Œ ì¤‘ìš”í•œê²Œ C++ì—ì„œ ë³´ë‚´ì£¼ëŠ” ë°ì´í„° í¬ë§·ê³¼ HLSLì—ì„œ ì²˜ë¦¬í•˜ëŠ” ë°ì´í„° í¬ë§·ì´ ë‹¤ë¥¼ ê²½ìš° ì¶œë ¥ì˜ ê²°ê³¼ê°€ ì•„ì— ë‹¬ë¼ì§ˆ ìˆ˜ ìˆë‹¤.
* ë¬´ìŠ¨ë§ì¼ê¹Œ?

```
cbuffer IE
{
    float4 Val1;
    float2 Val2;
    float2 Val3;
};

// IEëŠ” 2 * 16 bytesë¥¼ ì‚¬ìš©í•˜ê²Œ ëœë‹¤.
// ì´ê±´ ë‹¹ì—°
/*
[ Val1(16bytes)               ]
[ Val2(8bytes) + Val3(8bytes) ]
*/
```

```
cbuffer IE2
{
    float2 Val1; // + padding
    float4 Val2;
    float2 Val3; // + padding
};

// IEëŠ” 3 * 16 bytesë¥¼ ì‚¬ìš©í•˜ê²Œ ëœë‹¤.
/*
[ Val1(8bytes)  ]
[ Val2(16bytes) ]
[ Val3(8bytes)  ]
*/
```

* ê·¸ëŸ°ë° ì´ë ‡ê²Œë¼ë„ ì“°ë©´ ì™œ ì•ˆë ê¹Œ?
    * paddingì„ ë§¤ë²ˆ ê³ ë ¤ì„œí•´ì„œ ì„œë¡œ ì‚¬ìš©í•´ì•¼í•¨.
    * ê·¸ë ‡ì§€ ì•Šì€ê²½ìš° ì´ìƒí•œ ë°ì´í„°ë¥¼ ì½ì„ ìˆ˜ ìˆë‹¤.(c++, hlslëª¨ë‘)