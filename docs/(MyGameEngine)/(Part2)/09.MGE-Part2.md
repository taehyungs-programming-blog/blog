---
layout: default
title: "9. ê³µí†µ í—¤ë” ìƒì„±"
parent: "(Part.2 - ì—”ì§„ êµ¬ì¡° ì¡ê¸°)"
grand_parent: "(ë‚˜ì˜ ê²Œì„ì—”ì§„ ğŸ²)"
nav_order: 1
---

## Table of contents
{: .no_toc .text-delta }

1. TOC
{:toc}

---

* [Get Code ğŸŒ](https://github.com/Arthur880708/ArthurDX12GameEngine/commit/947cf274047b1f61c46e78ba9fa4f2ffc64c8dfd)

---

## ê³µí†µ í—¤ë” ê¸°ëŠ¥ 1 - index, generation

```cpp
using id_type = u32;    // unsigned int32

// generationê³¼ indexë¥¼ ê°™ì´ ì“¸ ì˜ˆì •
    // maskë¡œ êµ¬ë¶„í•  ê²ƒ
constexpr u32 generation_bits{ 8 }; // generationì—ëŠ” 8 bitë¥¼ ì“¸ ê²ƒì´ë‹¤.
constexpr u32 index_bits{ sizeof(id_type) * 8 - generation_bits }; 
// 32 - 8 = 24 bitë¥¼ indexì— ì“°ê² ë‹¤

constexpr id_type index_mask{ (id_type{1} << index_bits) - 1 };
/*
1ì„ 24ë²ˆ ì™¼ìª½ìœ¼ë¡œ ì‹œí”„íŠ¸í•˜ë©´ 
0b1_0000_0000_0000_0000_0000_0000 (ì´ì§„ìˆ˜ë¡œ 16,777,216)ì´ ë©ë‹ˆë‹¤.
ì—¬ê¸°ì„œ 1ì„ ë¹¼ë©´ 
0b0_1111_1111_1111_1111_1111_1111ì´ ë©ë‹ˆë‹¤. 
ì´ê²ƒì´ index_maskì…ë‹ˆë‹¤.
*/
constexpr id_type generation_mask{ (id_type{1} << generation_bits) - 1 };
/*
1ì„ 8ë²ˆ ì™¼ìª½ìœ¼ë¡œ ì‹œí”„íŠ¸(<<)í•˜ë©´ 
0b1_0000_0000 (ì´ì§„ìˆ˜ë¡œ 256)ì´ ë©ë‹ˆë‹¤.
ì—¬ê¸°ì„œ 1ì„ ë¹¼ë©´ 0b0_1111_1111ì´ ë©ë‹ˆë‹¤. 
ì´ê²ƒì´ generation_maskì…ë‹ˆë‹¤.
*/
constexpr id_type id_mask{ id_type{-1} };

using generation_type = std::conditional_t<generation_bits <= 16, std::conditional_t<generation_bits <= 8, u8, u16>, u32>;
static_assert(sizeof(generation_type) * 8 >= generation_bits);
static_assert((sizeof(id_type) - sizeof(generation_type)) > 0);

inline bool
is_valid(id_type id)
{
    return id != id_mask;
}

// maskë¡œ indexì™€ generationì„ êµ¬í•œë‹¤
inline id_type
index(id_type id)
{
    return id & index_mask;
}

inline id_type
generation(id_type id)
{
    return (id >> index_bits) & generation_mask;
}

// ìƒˆë¡œìš´ generation êµ¬í•˜
inline id_type
new_generation(id_type id)
{
    const id_type generation{ id::generation(id) + 1 };
    assert(generation < 255);
    return index(id) | (generation << index_bits);
}
```

---

## ê³µí†µ í—¤ë” ê¸°ëŠ¥ 2 - idë¥¼ í¬í•¨í•œ ê¸°ë³¸ ìƒì„±ì

```cpp
#if _DEBUG
namespace internal {
struct id_base
{
    constexpr explicit id_base(id_type id) : _id{ id } {}
    constexpr operator id_type() const { return _id; }
private:
    id_type _id;
};
}

#define DEFINE_TYPED_ID(name)                                   \
        struct name final : id::internal::id_base               \
        {                                                       \
            constexpr explicit name(id::id_type id)             \
                : id_base{ id } {}                              \
            constexpr name() : id_base{ id::id_mask } {}        \
        };
#else
#define DEFINE_TYPED_ID(name) using name = id::id_type;
#endif
```

* ì‹¤ì‚¬ìš©

```cpp
namespace primal::transform {

DEFINE_TYPED_ID(transform_id);

struct init_info
{
    f32 positon[3]{};
    f32 rotation[4]{};
    f32 scale[3]{1.f, 1.f, 1.f};
};

// transformì„ ìƒì„± í›„ idë¥¼ ë¦¬í„´
transform_id create_transform(const init_info& info, game_entity::entity_id entity_id);

// idë¥¼ ë„£ì„ê²½ìš° transformì„ ì œ
void remove_transform(transform_id id);
}
```