---
layout: default
title: "03-04. FBitWriter"
parent: "([Network] 03. ClientConnect)"
grand_parent: "(UE SourceCode ë¶„ì„ ğŸ¤–)"
nav_order: 1
---

## Table of contents
{: .no_toc .text-delta }

1. TOC
{:toc}

---

```cpp
/** optimized arbitrary bit range memory copy routine */
void appBitsCpy(uint8* Dest, int32 DestBit, uint8* Src, int32 SrcBit, int32 BitCount)
{
    // for calculation efficiency, it has several special case handing (for quicker calculation)
    if (BitCount == 0) return;

    // special case - always at least one bit to copy, a maximum of 2 bytes to read, 2 to write - only touch bytes that are actually used
    // 1. BitCount <= 8, handling bits[0,7] 
    // - BitCount <= 8 implies that it touches 1-byte memory twice to read and twice to write:
    //
    //   - when we copy bits from SRC two bits index[7] and index[8] to DEST                    
    //                                                                                          
    //     - NOTE that the below figures are based on little-endian (x86)                       
    //                                                                                          
    //       INDEX:   7   6   5   4   3   2   1   0     15  14  13  12  11  10  9   8           
    //              â”Œâ”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â” â”Œâ”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”         
    //        DEST: â”‚ 0 â”‚ 1 â”‚ 1 â”‚ 1 â”‚ 1 â”‚ 1 â”‚ 1 â”‚ 1 â”‚ â”‚ 0 â”‚ 0 â”‚ 0 â”‚ 0 â”‚ 0 â”‚ 0 â”‚ 0 â”‚ 0 â”‚         
    //              â””â”€â–²â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”˜ â””â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â–²â”€â”˜         
    //                â”‚                                                             â”‚           
    //                â”‚                                                             â”‚           
    //                â”‚                                                             â”‚           
    //              â”Œâ”€â”´â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â” â”Œâ”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”´â”€â”         
    //         SRC: â”‚ 1 â”‚ 0 â”‚ 0 â”‚ 0 â”‚ 0 â”‚ 0 â”‚ 0 â”‚ 0 â”‚ â”‚ 0 â”‚ 0 â”‚ 0 â”‚ 0 â”‚ 0 â”‚ 0 â”‚ 0 â”‚ 1 â”‚         
    //              â””â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”˜ â””â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”˜         
    //                                                                                          
    //     *** in this case, we touch 2-bytes from SRC to read and 2-bytes from DEST to write   
    //                                â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€     â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                                                        
    if (BitCount <= 8)
    {
        // in this if-statement, (LastSrc - SrcIndex) and (LastDest - DestIndex) cannot exceed more than '1', cuz we are dealing with BitCount <= 8
        uint32 DestIndex    = DestBit / 8;
        uint32 SrcIndex     = SrcBit / 8;
        uint32 LastDest     = (DestBit + BitCount - 1) / 8;
        uint32 LastSrc      = (SrcBit + BitCount - 1) / 8;

        // maximum bit range[0, 7] can be inserted in same 1-byte
        // - this is because (SrcBit,DestBit) & 7!
        uint32 ShiftSrc     = SrcBit & 7;
        uint32 ShiftDest    = DestBit & 7;

        // on BitCount <= 8, we can access maximum 2-byte memory:
        // - 0xFF is 255 and 0xFE is 254
        //   - 0xFF is 11111111(2)
        //   - 0xFE is 11111110(2) : 0xFE is pre-shifted left by 1: 11111111(2) << 1 = 11111110(2)
        // - why do we pre-shifted? we'll understand the reason in soon!
        uint32 FirstMask    = 0xFF << ShiftDest;
        uint32 LastMask     = 0xFE << ((DestBit + BitCount - 1) & 7); // pre-shifted left by 1

        // Accu is accumlater of intermediate calculation results
        // - when SrcIndex and LastSrc is same, all bits are converged into 1-byte
        uint32 Accu;
        if (SrcIndex == LastSrc)
            Accu = (Src[SrcIndex] >> ShiftSrc);
        else
            // how two bytes(uint8) are combined into single int-value(uint32) [feat. little-endian]
            //
            // - how two bytes (with little-endian) are combined into one integer (4 bytes)?       
            //                                                                                     
            //       â”Œâ”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”     â”Œâ”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”       
            //   [0]:â”‚ 1 â”‚ 1 â”‚ 1 â”‚ 1 â”‚ 1 â”‚ 1 â”‚ 1 â”‚ 1 â”‚ [1]:â”‚ 0 â”‚ 0 â”‚ 0 â”‚ 0 â”‚ 0 â”‚ 0 â”‚ 0 â”‚ 1 â”‚       
            //       â””â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”˜     â””â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”˜       
            //       â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€     â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€       
            //                    â”‚                                      â”‚                         
            //                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                         
            //                                        â”‚                                            
            //                                        â”‚ How to order them to make complete value?  
            //                                        â”‚   - we expect 255([0]) + 256[1]            
            //                                        â”‚                                            
            //                                        â–¼                                            
            //           â”Œâ”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”         
            //           â”‚ 0 â”‚ 0 â”‚ 0 â”‚ 0 â”‚ 0 â”‚ 0 â”‚ 0 â”‚ 1 â”‚ 1 â”‚ 1 â”‚ 1 â”‚ 1 â”‚ 1 â”‚ 1 â”‚ 1 â”‚ 1 â”‚         
            //           â””â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”˜         
            //                                                                                     
            Accu = ((Src[SrcIndex] >> ShiftSrc) | (Src[LastSrc] << (8 - ShiftSrc)));
        
        if (DestIndex == LastDest)
        {
            // focus on how MultiMask(for uint32) is constructed
            // - "~LastMask" apply inverse-operator!
            //   - now we can understand why we try to pre-shifted on LastMask:
            //     - what the statement, "uint32 LastMask = 0xFE << ((DestBit + Count - 1) & 7)" means?
            //       - let's suppose (DestBit + Count - 1) & 7 as '1, 2, 3':
            //                                                                                                              
            //                                                     left-shift 1 (<< 1)    â”Œâ”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â” 
            //                                                   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º â”‚ 1 â”‚ 1 â”‚ 1 â”‚ 1 â”‚ 1 â”‚ 1 â”‚ 0 â”‚ 0 â”‚ 
            //              â”Œâ”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”                             â””â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”˜ 
            //         0xFE:â”‚ 1 â”‚ 1 â”‚ 1 â”‚ 1 â”‚ 1 â”‚ 1 â”‚ 1 â”‚ 0 â”‚                                                               
            //              â””â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”˜      left-shift 2 (<< 2)    â”Œâ”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â” 
            //                                                   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º â”‚ 1 â”‚ 1 â”‚ 1 â”‚ 1 â”‚ 1 â”‚ 0 â”‚ 0 â”‚ 0 â”‚ 
            //                                                                            â””â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”˜ 
            //
            //       - with ~operator, try to understand masking functionality:
            //       
            //              â”Œâ”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”        DATA & MASK          â”Œâ”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”                  
            //         DATA:â”‚ 1 â”‚ 1 â”‚ 1 â”‚ 1 â”‚ 1 â”‚ 1 â”‚ 1 â”‚ 0 â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º â”‚ 1 â”‚ 1 â”‚ 1 â”‚ 1 â”‚ 1 â”‚ 0 â”‚ 0 â”‚ 0 â”‚ : CLEARING***    
            //              â””â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”˜             â”‚               â””â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”˜                  
            //              â”Œâ”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”             â”‚               â”Œâ”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”                  
            //         MASK:â”‚ 1 â”‚ 1 â”‚ 1 â”‚ 1 â”‚ 1 â”‚ 0 â”‚ 0 â”‚ 0 â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º â”‚ 0 â”‚ 0 â”‚ 0 â”‚ 0 â”‚ 0 â”‚ 1 â”‚ 1 â”‚ 0 â”‚ : MASKING***     
            //              â””â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”˜        DATA & (~MASK)       â””â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”˜                  
            //                                                                                                                               
            //
            // - what is expected value for "FirstMask & ~LastMask" when "(DestBit + Count - 1) & 7" is 0?
            //   - unified mask of 2-bytes:
            //           
            //                â”Œâ”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”                                                                                                      
            //      FirstMask:â”‚ 1 â”‚ 1 â”‚ 1 â”‚ 1 â”‚ 1 â”‚ 1 â”‚ 1 â”‚ 1 â”œâ”€â”€â”€â”€â”€â”€â”€â” FirstMask & (~LastMask)    â”Œâ”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â” 
            //                â””â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”˜       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º â”‚ 0 â”‚ 0 â”‚ 0 â”‚ 0 â”‚ 0 â”‚ 0 â”‚ 0 â”‚ 1 â”‚ 1 â”‚ 1 â”‚ 1 â”‚ 1 â”‚ 1 â”‚ 1 â”‚ 1 â”‚ 1 â”‚ 
            //                â”Œâ”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”       â”‚                            â””â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”˜ 
            //       LastMask:â”‚ 1 â”‚ 1 â”‚ 1 â”‚ 1 â”‚ 1 â”‚ 1 â”‚ 1 â”‚ 0 â”œâ”€â”€â”€â”€â”€â”€â”€â”˜                                                                                              
            //                â””â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”˜                                                                                                      
            //                                                                                                                                                                                                                                                                                                                                                                        
            uint32 MultiMask = FirstMask & ~LastMask;

            // based on what we covered, it is easy to understand:
            // - Dest[DestIndex] & ~MultiMask --> clearing the value
            // - (Accu << ShiftDest) & MultiMask --> masking the value
            // - (Dest[DestIndex] & ~MultiMask) | ((Accu << ShiftDest) & MultiMask) --> applying(copying) 'Accu' value to destination
            //
            // - lastly, what does it mean force-casting by "(uint8)"?:
            //                                                                                                                                           
            //                               (uint8) â”‚ (uint8)                                                                                           
            //    (dropped)                          â”‚                            (retained)                                                             
            //        â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º                                                                    
            //       â”Œâ”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¼â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”     force-casting by uint8    â”Œâ”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”   
            //       â”‚ 0 â”‚ 0 â”‚ 0 â”‚ 0 â”‚ 0 â”‚ 0 â”‚ 0 â”‚ 1 â”‚ 1 â”‚ 1 â”‚ 1 â”‚ 1 â”‚ 1 â”‚ 1 â”‚ 1 â”‚ 1 â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º  â”‚ 1 â”‚ 1 â”‚ 1 â”‚ 1 â”‚ 1 â”‚ 1 â”‚ 1 â”‚ 1 â”‚   
            //       â””â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”¼â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”˜                               â””â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”˜   
            //                                       â”‚                                                                                                   
            //                                       â”‚                                                                                                   
            //                                       â”‚                                                                                                   
            //                                                                                                                                           
            Dest[DestIndex] = (uint8)((Dest[DestIndex] & ~MultiMask) | ((Accu << ShiftDest) & MultiMask));
        }
        else
        {
            Dest[DestIndex] = (uint8)((Dest[DestIndex] & ~FirstMask) | ((Accu << ShiftDest) & FirstMask));

            // (8 - ShiftDest) means dropping the bits applied for DestIndex
            Dest[LastDest] = (uint8)((Dest[LastDest] & LastMask) | ((Accu >> (8 - ShiftDest)) & ~LastMask));
        }

        return;
    }

    // main copier, use byte sized shifting; minimum size is 9 bits, so at least 2 reads and 2 writes
    // note that LastDest and LastSrc are not subtrack '1'
    uint32 DestIndex    = DestBit / 8;
    uint32 LastDest     = (DestBit + BitCount) / 8;
    uint32 SrcIndex     = SrcBit / 8;
    uint32 LastSrc      = (SrcBit + BitCount) / 8;

    uint32 FirstSrcMask = 0xFF << (DestBit & 7);
    uint32 LastSrcMask  = 0xFF << ((DestBit + BitCount) & 7);
    
    // what 'ShiftCount' means?
    // - DestBit: 7, SrcBit: 1 -> ShiftCount = 6
    // - DestBit: 1, SrcBit: 7 -> ShiftCount = -6
    // - what does it means when ShiftCoutn < 0? let's try to understand the below code
    int32 ShiftCount    = (DestBit & 7) - (SrcBit & 7);

    // note subtracking '1', we can calculate DestLoop/SrcLoop correctly
    int32 DestLoop      = LastDest - DestIndex;
    int32 SrcLoop       = LastSrc - SrcIndex;
    uint32 FullLoop;
    uint32 BitAccu;

    // lead-in needs to read 1 or 2 source bytes depending on alignment
    // 1. LEAD-IN
    // 
    // - When ShiftCount >= 0:                                                                                                                                   
    //                          arrow direction is 5,6,7 increasing order! (NOT OPPOSITE)                                                                        
    //                             â”‚                                                                                                                             
    //                             â”‚                                                                                                                             
    //                             â”‚                                                                                                                             
    //                             â”‚ (DestBit & 7)==5                                                                                                            
    //                           â—„â”€â–¼â”€â”€â”€â”€â”€â”€ â”‚                                                                                                                     
    //                           â”Œâ”€â”€â”€â”¬â”€â”€â”€â”¬â”€â–¼â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”                                                                                               
    //                      DEST:â”‚ 1 â”‚ 1 â”‚ 1 â”‚ 1 â”‚ 1 â”‚ 1 â”‚ 1 â”‚ 1 â”‚                                                                                               
    //                           â””â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”˜                                                                                               
    //                           â”Œâ”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”                                                                                               
    //                       SRC:â”‚ 1 â”‚ 1 â”‚ 1 â”‚ 1 â”‚ 1 â”‚ 1 â”‚ 0 â”‚ 0 â”‚                                                                                               
    //                        â”‚  â””â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â–²â”€â”´â”€â”€â”€â”´â”€â”€â”€â”˜                                                                                               
    //                        â”‚  â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚                                                                                                         
    //    - ShiftCount == 3   â”‚                  (SrcBit & 7)==2 â”‚                                                                                               
    //    - SRC << ShiftCount â”‚                                  â”‚                                                                                               
    //                        â”‚                      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”(BitAccu & FirstSrcMask)                                                           
    //                        â–¼  â”Œâ”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¼â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¼â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¼â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”                                                               
    //                   BitAccu:â”‚ 0 â”‚ 0 â”‚ 0 â”‚ 0 â”‚ 0 â”‚ 1 â”‚ 1 â”‚ 1 â”‚ 1 â”‚ 1 â”‚ 1 â”‚ 0 â”‚ 0 â”‚ 0 â”‚ 0 â”‚ 0 â”‚                                                               
    //                           â””â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”¼â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”¼â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”¼â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”˜                                                               
    //                           â”Œâ”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¼â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¼â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¼â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”                                                               
    //              FirstSrcMask:â”‚ 0 â”‚ 0 â”‚ 0 â”‚ 1 â”‚ 1 â”‚ 1 â”‚ 1 â”‚ 1 â”‚ 1 â”‚ 1 â”‚ 1 â”‚ 0 â”‚ 0 â”‚ 0 â”‚ 0 â”‚ 0 â”‚                                                               
    //      0xFF << (DestBit & 7)â””â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”¼â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”¼â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”¼â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”˜                                                               
    //                                               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                                                   
    //                                                           â”‚           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                               
    //                           â”Œâ”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¼â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¼â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¤                                                               
    //             ~FirstSrcMask:â”‚ 1 â”‚ 1 â”‚ 1 â”‚ 0 â”‚ 0 â”‚ 0 â”‚ 0 â”‚ 0 â”‚ 0 â”‚ 0 â”‚ 0 â”‚ 1 â”‚ 1 â”‚ 1 â”‚ 1 â”‚ 1 â”‚                                                               
    //                           â””â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”¼â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”¼â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”¤                 â”€                                             
    //                                                           â”œâ”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¼â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¤                                                               
    //                                                      DEST:â”‚ 1 â”‚ 1 â”‚ 1 â”‚ 1 â”‚ 1 â”‚ 1 â”‚ 1 â”‚ 1 â”‚                                                               
    //                                                           â”œâ”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”¼â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”¤                                                               
    //                                                           â”‚           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ DEST & (~FirstSrcMask)                                        
    //                                                           â”‚                                                                                               
    //                                                           â”‚                                                                                               
    //                                                           â”‚                                                                                               
    //                                                           â”‚                                                                                               
    //                                                 â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º                                                                                     
    //                2. restof BitAccum is appied in FAST-LOOP  â”‚  1,LEAD-IN:                                                                                   
    //                                                           â”‚     Dest[DestIndex] = (uint8)((BitAccu & FirstSrcMask) | (Dest[DestIndex] & ~FirstSrcMask));  
    //                                                                                   â”€â”€â”€â”€â”€â”€â”€                                                                 
    //                                                                                    *** masking out!                                                       
    //                                                                                                                                                           
    // - When ShiftCount < 0:                                                                                                                                                                                                                                                                                                                                                                                                            
    //                                                                                                                                                                                                                            
    //                                           (DestBit & 7)==2                                                                                                                                                                 
    //                                                   â”‚                                                                                                                                                                        
    //                             â”Œâ”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â–¼â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”                                                                                                                                                              
    //                        DEST:â”‚ 1 â”‚ 1 â”‚ 1 â”‚ 1 â”‚ 1 â”‚ 1 â”‚ 1 â”‚ 1 â”‚                                                                                                                                                              
    //                             â””â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”˜                                                                                                                                                              
    //                             â”Œâ”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”                                                                                                                                                              
    //                      SRC[0]:â”‚ 1 â”‚ 1 â”‚ 1 â”‚ 0 â”‚ 0 â”‚ 0 â”‚ 0 â”‚ 0 â”‚                                                                                                                                                              
    //                          â”‚  â””â”€â”€â”€â”´â”€â”€â”€â”´â”€â–²â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”˜             *** == BitAccu1                                                                                                                                  
    //                          â”‚            â”‚                                 â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                                                                               
    //   - ShiftCount == -3+8=5 â”‚    (SrcBit & 7)==5                           ((uint32)Src[SrcIndex] << ShiftCount) + (BitAccu)                                                                                                  
    //   - SRC[0] << ShiftCount â”‚                                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                                                                      
    //                          â”‚                                              â”‚                                           â”‚                                                                                                      
    //                          â–¼  â”Œâ”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¼â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¼â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”                                                              
    //                     BitAccu:â”‚ 0 â”‚ 0 â”‚ 0 â”‚ 0 â”‚ 0 â”‚ 0 â”‚ 0 â”‚ 0 â”‚ 0 â”‚ 0 â”‚ 0 â”‚ 0 â”‚ 0 â”‚ 0 â”‚ 0 â”‚ 0 â”‚ 0 â”‚ 0 â”‚ 0 â”‚ 1 â”‚ 1 â”‚ 1 â”‚ 0 â”‚ 0 â”‚ 0 â”‚ 0 â”‚ 0 â”‚ 0 â”‚ 0 â”‚ 0 â”‚ 0 â”‚ 0 â”‚                                                              
    //                             â””â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”¼â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”¼â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”˜                                                              
    //                                                                         â”‚                                           â”‚                                                                                                      
    //                             â”Œâ”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬ â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”           â”‚                                           â”‚                                                                                                      
    //                      SRC[1]:â”‚ 1 â”‚ 1 â”‚ 1 â”‚ 1 â”‚ 1 â”‚ 1 â”‚ 1 â”‚ 1 â”‚           â”‚                                           â”‚                                                                                                      
    //                          â”‚  â””â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”˜           â”‚                                           â”‚                                                                                                      
    //  - ShiftCount == 5+8=13  â”‚                                              â”‚                                           â”‚                                                                                                      
    //  - SRC[1] << ShiftCount  â”‚                                  â”‚           â”‚                   â”‚                       â”‚       â”‚                                                                                              
    //                          â–¼  â”Œâ”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¼â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¼â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¼â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¼â”€â”€â”€â”¬â”€â”€â”€â”¼â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”                                                              
    //                    BitAccu1:â”‚ 0 â”‚ 0 â”‚ 0 â”‚ 0 â”‚ 0 â”‚ 0 â”‚ 0 â”‚ 0 â”‚ 0 â”‚ 0 â”‚ 0 â”‚ 1 â”‚ 1 â”‚ 1 â”‚ 1 â”‚ 1 â”‚ 1 â”‚ 1 â”‚ 1 â”‚ 0 â”‚ 0 â”‚ 0 â”‚ 0 â”‚ 0 â”‚ 0 â”‚ 0 â”‚ 0 â”‚ 0 â”‚ 0 â”‚ 0 â”‚ 0 â”‚ 0 â”‚                                                              
    //                          â”‚  â””â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”¼â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”¼â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”¼â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”¼â”€â”€â”€â”´â”€â”€â”€â”¼â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”˜                                                              
    //                          â”‚                                  â”‚           â”‚                   â”‚                       â”‚       â”‚                                                                                              
    //                          â”‚                                              â”‚                                           â”‚                                                                                                      
    //       BitAccu + BitAccu1 â”‚                                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                                                                      
    //                          â”‚                                                                                                                                                                                                 
    //                          â”‚                                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                                                                      
    //                          â–¼  â”Œâ”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¼â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¼â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”                                                              
    //                     BitAccu:â”‚ 0 â”‚ 0 â”‚ 0 â”‚ 0 â”‚ 0 â”‚ 0 â”‚ 0 â”‚ 0 â”‚ 0 â”‚ 0 â”‚ 0 â”‚ 1 â”‚ 1 â”‚ 1 â”‚ 1 â”‚ 1 â”‚ 1 â”‚ 1 â”‚ 1 â”‚ 1 â”‚ 1 â”‚ 1 â”‚ 0 â”‚ 0 â”‚ 0 â”‚ 0 â”‚ 0 â”‚ 0 â”‚ 0 â”‚ 0 â”‚ 0 â”‚ 0 â”‚                                                              
    //                          â”‚  â””â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”¼â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”¼â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”˜                                                              
    //                          â”‚                                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                                                                      
    //                          â”‚                                                                                                                                                                                                 
    //             BitAccu >> 8 â”‚                                                          right-shfit 8       â”‚           â”‚       â”‚                                                                                              
    //                          â”‚                                                â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚           â”œâ”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                                      
    //                          â–¼  â”Œâ”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¼â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¼â”€â”€â”€â”¬â”€â”€â”€â”¼â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¼â”€â”€â”€â”¬â”€â”€â”€â”                                                              
    //                     BitAccu:â”‚ 0 â”‚ 0 â”‚ 0 â”‚ 0 â”‚ 0 â”‚ 0 â”‚ 0 â”‚ 0 â”‚ 0 â”‚ 0 â”‚ 0 â”‚ 0 â”‚ 0 â”‚ 0 â”‚ 0 â”‚ 0 â”‚ 0 â”‚ 0 â”‚ 0 â”‚ 1 â”‚ 1 â”‚ 1 â”‚ 1 â”‚ 1 â”‚ 1 â”‚ 1 â”‚ 1 â”‚ 1 â”‚ 1 â”‚ 1 â”‚ 0 â”‚ 0 â”‚                                                              
    //                             â””â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”¼â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”¼â”€â”€â”€â”´â”€â”€â”€â”¼â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”¼â”€â”€â”€â”´â”€â”€â”€â”˜                                                              
    //                                                                                                         â”‚           â”‚       â”‚                       â”‚                                                                      
    //                                                                                                         â”‚           â”‚       â”‚                       â”‚                                                                      
    //                                                                                                         â”‚           â”‚       â”‚                       â”‚                                                                      
    //                                                                                             â”Œâ”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¼â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¼â”€â”€â”€â”¬â”€â”€â”€â”¼â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¼â”€â”€â”€â”¬â”€â”€â”€â”                                                              
    //                                                                                FirstSrcMask:â”‚ 0 â”‚ 0 â”‚ 0 â”‚ 0 â”‚ 0 â”‚ 0 â”‚ 1 â”‚ 1 â”‚ 1 â”‚ 1 â”‚ 1 â”‚ 1 â”‚ 1 â”‚ 1 â”‚ 0 â”‚ 0 â”‚                                                              
    //                                                                        0xFF << (DestBit & 7)â””â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”¼â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”¼â”€â”€â”€â”´â”€â”€â”€â”¼â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”¼â”€â”€â”€â”´â”€â”€â”€â”˜                                                              
    //                                                                                                         â”‚           â”œâ”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                                      
    //                                                                                                         â”‚           â”‚       â”‚                       â”Œâ”€â”€â”€â”€â”€â”€â”€â”                                                              
    //                                                                                             â”Œâ”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¼â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¼â”€â”€â”€â”¬â”€â”€â”€â”¼â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¼â”€â”€â”€â”¬â”€â”€â”€â”¤                                                              
    //                                                                               ~FirstSrcMask:â”‚ 1 â”‚ 1 â”‚ 1 â”‚ 1 â”‚ 1 â”‚ 1 â”‚ 0 â”‚ 0 â”‚ 0 â”‚ 0 â”‚ 0 â”‚ 0 â”‚ 0 â”‚ 0 â”‚ 1 â”‚ 1 â”‚                                                              
    //                                                                                             â””â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”¼â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”¼â”€â”€â”€â”´â”€â”€â”€â”¼â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”¼â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”¼â”€â”€â”€â”´â”€â”€â”€â”¤                 â”€                                            
    //                                                                                                         â”‚           â”‚       â”œâ”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¼â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¼â”€â”€â”€â”¬â”€â”€â”€â”¤                                                              
    //                                                                                                         â”‚           â”‚  DEST:â”‚ 1 â”‚ 1 â”‚ 1 â”‚ 1 â”‚ 1 â”‚ 1 â”‚ 1 â”‚ 1 â”‚                                                              
    //                                                                                                         â”‚           â”‚       â”œâ”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”¼â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”¼â”€â”€â”€â”´â”€â”€â”€â”¤                                                              
    //                                                                                                         â”‚           â”‚       â”‚                       â””â”€â”€â”€â”€â”€â”€â”€â”˜                                                              
    //                                                                                                         â”‚           â”‚       â”‚                                                                                              
    //                                                                                                         â”‚           â”‚       â”‚                                                                                              
    //                                                                                                         â—„â”€â”€â”€â”€â–²â”€â”€â”€â”€â”€â”€â–º       â”‚                                                                                              
    //                                                                                                         â”‚    â”‚      â”‚       â”‚                                                                                              
    //                                                                                                              â”‚    â—„â”€â”´â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º                                                                                    
    //                                                                                  2. restof BitAccum is appiedâ”‚in FAST-LOOP  â”‚  1,LEAD-IN:                                                                                  
    //                                                                                             â–²                â”‚              â”‚     Dest[DestIndex] = (uint8)((BitAccu & FirstSrcMask) | (Dest[DestIndex] & ~FirstSrcMask)); 
    //                                                                                             â”‚                â”‚                                      â”€â”€â”€â”€â”€â”€â”€                                                                
    //                                                                                             â”‚                â”‚                                       *** masking out!                                                      
    //                                                                                             â”‚                â””â”€â”€â”€â”€â”€â”€â”€â”€â”                                                                                                    
    //                                                                                             â”‚                         â”‚                                                                                                    
    //                                                                                             â”‚                         â”‚(***)                                                                                               
    //                                                                                             â”‚                         â”‚                                                                                                    
    //                                                                                             â”‚                    â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                                            
    //                                                                                        when we loop first index, we need to copy remaining bits                                                                            
    //                                                                                                                                                                                                                            
    //                                                                                                         â”‚                                                                                                                  
    //                                                                                                         â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[right-shfitâ”€13]â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                               
    //                                                                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼                                                                                                                  
    //                             â”Œâ”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¼â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¼â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¼â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”                                                              
    //                             â”‚ 0 â”‚ 0 â”‚ 0 â”‚ 0 â”‚ 0 â”‚ 0 â”‚ 0 â”‚ 0 â”‚ 0 â”‚ 0 â”‚ 0 â”‚ 1 â”‚ 1 â”‚ 1 â”‚ 1 â”‚ 1 â”‚ 1 â”‚ 1 â”‚ 1 â”‚ 1 â”‚ 1 â”‚ 1 â”‚ 1 â”‚ 1 â”‚ 1 â”‚ 1 â”‚ 1 â”‚ 1 â”‚ 1 â”‚ 1 â”‚ 0 â”‚ 0 â”‚                                                              
    //                             â””â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”¼â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”¼â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”¼â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”˜                                                              
    //                                                                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                                                                                  
    //                                                                          every single byte is shifted by 'ShiftCount(13)'                                                                                                  
    //                                                                                                                                                                                                                            
    if (ShiftCount >= 0)
    {
        FullLoop    = FMath::Max(DestLoop, SrcLoop);
        BitAccu     = Src[SrcIndex] << ShiftCount;
        ShiftCount  += 8; // prepare for the inner loop
    }
    else
    {
        ShiftCount += 8; // turn shift -7..-1 into +1..+7
        FullLoop    = FMath::Max(DestLoop, SrcLoop - 1);
        BitAccu     = Src[SrcIndex] << ShiftCount;
        SrcIndex++;
        ShiftCount += 8; // prepare for inner loop
        BitAccu = (((uint32)Src[SrcIndex] << ShiftCount) + (BitAccu)) >> 8;
    }

    // lead-in - first copy
    Dest[DestIndex] = (uint8)((BitAccu & FirstSrcMask) | (Dest[DestIndex] & ~FirstSrcMask));
    SrcIndex++;
    DestIndex++;

    // fast inner loop
    for (; FullLoop > 1; FullLoop--)
    {
        // shift-count ranges from 8 to 15 - all reads are relevant
        // note that BitAccu is shifted by 8 every loop count
        BitAccu = (((uint32)Src[SrcIndex] << ShiftCount) + (BitAccu)) >> 8; // copy in the new, discard the old
        SrcIndex++;
        Dest[DestIndex] = (uint8)BitAccu; // copy low 8 bits
        DestIndex++;
    }

    // lead out 
    // LEAD-OUT is for your homework~ :)
    if (LastSrcMask != 0xFF)
    {
        if ((uint32)(SrcBit + BitCount - 1) / 8 == SrcIndex) // last legal byte?
        {
            BitAccu = (((uint32)Src[SrcIndex] << ShiftCount) + (BitAccu)) >> 8;
        }
        else
        {
            BitAccu = BitAccu >> 8;
        }
        Dest[DestIndex] = (uint8)((Dest[DestIndex] & LastSrcMask) | (BitAccu & ~LastSrcMask));
    }
}
```