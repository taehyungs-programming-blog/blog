---
layout: default
title: "(09. Possess)"
parent: "(UE SourceCode ë¶„ì„ ğŸ¤–)"
has_children: true
nav_order: 2
---

```cpp
// we can describes the Possess() as the diagram:
//                                                                                                           
//                         ***Possess NewPawn0                                                               
//   PlayerController â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º NewPawn0                                 
//    â”‚                                                               â”‚                                      
//    â”œâ”€â”€RootComponent  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º   â””â”€â”€RootComponent                       
//    â”‚                   1.AttachToPawn():                               â”‚                                  
//    â”‚                     follow the relative transform to Pawn         â”œâ”€â”€PlayerController::RootComponent 
//    â”‚                     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚                                  
//    â”œâ”€â”€PlayerCameraManagerâ”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º    â”‚  â”œâ”€â”€CameraActor::CameraComponent    
//    â”‚                     â”‚  2.Update ViewTarget:                    â”‚  â”‚                                  
//    â”‚                     â”‚     it can be NewPawn0                   â”‚  â”‚                                  
//    â”‚                     â”‚      or CameraActor to NewPawn           â”‚  â”‚                                  
//    â””â”€â”€PlayerInput        â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€     â”‚  â””â”€â”€InputComponent                  
//                          â”‚  3.Register NewPawn0 to PlayerController:â”‚                                     
//                          â”‚     to get input events from LocalPlayer â”‚                                     
//                          â””â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                     
//                            â”‚                                                                              
//                            â”‚                                                                              
//                            â””â”€â”€â–º***APawn::Restart()                                                        
// 
// - from the diagram, we can understand Restart() as updating connections between non-world(PC) and world(Pawn) 
//   1. NewPawn0 can get input events by pushing its InputComponent to PlayerController (non-world â”€â”€â–º world)
//   2. PlayerController can update camera data(CameraActor or CameraComponent) from the Pawn (world â”€â”€â–º non-world)          
// - PlayerController is the bridge between non-world and world:
//                                                                 
//             the bridge between non-world and world              
//             â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              
//             â”‚             AController            â”‚              
//    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”´â”€â”€â”€â”€â”         
//    â”‚ Non-World â”‚                              â”‚ World â”‚         
//    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                              â””â”€â”€â”€â”€â”€â”€â”€â”˜           
//                                                                               
```

* ì„ -ì •ë¦¬í•˜ìë©´ `Restart` ë¼ëŠ” í•¨ìˆ˜ëŠ” ë‹¨ìˆœíˆ ì¬ì‹œì‘ í•˜ëŠ” ê²ƒì´ ì•„ë‹ˆë¼ ë‹¤ìŒê³¼ ê°™ì€ ìˆœì„œë¡œ ì‘ë™í•©ë‹ˆë‹¤.

1. PlayerControllerì— DefaultPawnì´ ì¡´ì¬í•˜ëŠ”ì§€ í™•ì¸
2. ì›”ë“œì— ìˆëŠ” PlayerStartë¡œ Pawnì´ ìƒì„± í•  ìœ„ì¹˜ ì„¤ì •
3. DefaultPawnì„ 2ë²ˆì—ì„œ ì„¤ì •í•œ ì¢Œí‘œë¡œ ì†Œí™˜
4. Controllerì— SetPawn ì§„í–‰
5. Controllerì™€ Pawn Possess ì§„í–‰
6. RestartClient ë™ì‘

* ëª¨ë‘ ì¤‘ìš”í•˜ì§€ë§Œ íŠ¹íˆ Posessí•˜ëŠ” ê³¼ì •ì„ ê·¸ë¦¼ì„ í†µí•´ í™•ì¸í•´ë³´ë©´ PlayerControllerë¥¼ Pawnì— Attachë¥¼ ì§„í–‰ í›„ RestartClient í•¨ìˆ˜ë¥¼ í†µí•´ PlayerCameraManagerì˜ ViewTarget ì„¤ì • ë§ˆì§€ë§‰ìœ¼
ë¡œ PlayerInput ì„¤ì •ì„ ì§„í–‰í•©ë‹ˆë‹¤.
* Pawnì€ Non Worldì¸ PlayerControllerì˜ ì…ë ¥ ì´ë²¤íŠ¸ë¥¼ InputComponentë¥¼ í†µí•´ ë°›ì„ ìˆ˜ ìˆê³  PlayerControllerëŠ” Worldì¸ Pawnì˜ CameraComponentë¥¼ í†µí•´ ë°ì´í„°ë¥¼ ì—…ë°ì´íŠ¸ í•  ìˆ˜ ìˆìŠµë‹ˆ
ë‹¤. 
* ì¦‰ PlayerControllerëŠ” Non-Worldì™€ Worldì˜ ì¤‘ê°„ ë‹¤ë¦¬ ì—­í• ì„ì„ ì•Œ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

---

* Spawn ë¶€í„° í•˜ë‚˜í•˜ë‚˜ ì‚´í´ë³´ì.

```cpp
/** spawns a PlayerController and binds it to the passed in Player with the specified RemoteRole and options */
APlayerController* SpawnPlayActor(class UPlayer* Player, ENetRole RemoteRole, const FURL& InURL, const FUniqueNetIdRepl& UniqueId, FString& Error, uint8 InNetPlayerIndex = 0)
{
    Error = TEXT("");

    FString Options;
    for (int32 i = 0; i < InURL.Op.Num(); ++i)
    {
        Options += TEXT("?");
        Options += InURL.Op[i];
    }

    if (AGameModeBase* const GameMode = GetAuthGameMode())
    {
        // give the GameMode a chance to accept the login
        APlayerController* const NewPlayerController = GameMode->Login(NewPlayer, RemoteRole, *InURL.Portal, Options, UniqueId, Error);
        if (NewPlayerController == NULL)
        {
            UE_LOG(LogSpawn, Warning, TEXT("Login failed: %s"), *Error);
            return NULL;
        }
        
        // possess the newly-spawned player
        NewPlayerController->NetPlayerIndex = InNetPlayerIndex;
        NewPlayerController->SetRole(ROLE_Authority);
        NewPlayerController->SetReplicate(RemoteRole != ROLE_None);
        if (RemoteRole == ROLE_AutonomousProxy)
        {
            // we skip this function (networking)
            NewPlayerController->SetAutonomousProxy(true);
        }

        NewPlayerController->SetPlayer(NewPlayer);

        GameMode->PostLogin(NewPlayerController);
        
        return NewPlayerController;
    }

    return nullptr;
}
```