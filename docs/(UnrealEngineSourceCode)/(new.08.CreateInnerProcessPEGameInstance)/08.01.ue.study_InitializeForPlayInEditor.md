---
layout: default
title: "08-01. InitializeForPlayInEditor"
parent: "(08. CreateInnerProcessPIEGameInstance)"
grand_parent: "(UE SourceCode ë¶„ì„ ğŸ¤–)"
nav_order: 1
---

## Table of contents
{: .no_toc .text-delta }

1. TOC
{:toc}

---

```cpp
/** called to initialize the game instance for PIE instances of the game */
virtual FGameInstancePIEResult InitializeForPlayInEditor(int32 PIEInstanceIndex, const FGameInstancePIEParameters& Params)
{
    FWorldDelegates::OnPIEStarted.Broadcast(this);

    // GameInstanceë¥¼ ìƒì„±í•˜ëŠ” ì£¼ì²´ê°€ GameEngine ì…ë‹ˆë‹¤. GetEngineì€ GetOuterë¥¼ GameEngineìœ¼ë¡œ ë³€í™˜ í›„ ë°˜í™˜í•©ë‹ˆë‹¤
    UEditorEngine* const EditorEngine = CastChecked<UEditorEngine>(GetEngine());

    // look for an existing pie world context, may have been created before
    // as I said, PIEInstanceIndex is noramlly zero(0)
/*
ì´ë¯¸ Worldê°€ ìƒì„±ë˜ì—ˆì„ ìˆ˜ë„ ìˆê¸° ë•Œë¬¸ì— PIEInstanceIndexë¥¼ í†µí•´ì„œ ì´ë¯¸ ì¡´ì¬í•˜ëŠ”ì§€ë¥¼
ì²´í¬í•©ë‹ˆë‹¤. ì¼ë°˜ì ìœ¼ë¡œ PIEëª¨ë“œê°€ ì•„ë‹ˆë¼ë©´ PIEInstanceIndex ê°’ì€ 0 ì…ë‹ˆë‹¤. Worldë¥¼ ìˆœíšŒí–ˆì„
ë•Œ ì¡´ì¬í•˜ì§€ ì•Šìœ¼ë©´ WorldContextë¥¼ PIEëª¨ë“œë¡œ ìƒì„±í•©ë‹ˆë‹¤
*/
    WorldContext = EditorEngine->GetWorldContextFromPIEInstance(PIEInstanceIndex);
    if (!WorldContext)
    {
        WorldContext = &EditorEngine->CreateNewWorldContext(EWorldType::PIE);
        WorldContext->PIEInstance = PIEInstanceIndex;
    }

    // mark our GameInstance to WorldContext
    // - WorldContext is cached in UGameInstance also
    WorldContext->OwningGameInstance = this;

    // we always need to create a new PIE world unless we're using the editor world for SIE
    UWorld* NewWorld = nullptr;
    bool bNeedsGarbageCollection = false;
    
    // standard PIE path: just duplicate the EditorWorld
    // note that we duplicate the world for PIE world context (does NOT reuse)
    NewWorld = EditorEngine->CreatePIEWorldByDuplication(*WorldContext, EditorEngine->EditorWorld, PIEMapName);

    // duplication can result in unreferenced objects, so indicate that we should do a GC pass after initializing the world context
    // as we saw, in CreatePIEWorldByDuplication, we call StaticDuplicateObjectEx
    // - StaticDuplicateObjectEx causes unused objects to be GC'ed
    bNeedsGarbageCollection = true;

    WorldContext->SetCurrentWorld(NewWorld);

    // if NewWorld is immutable to be GC'ed, GameInstance can be also immutable to be GC'ed
    // - I didn't look into the detail how GC works on these objects, which will be tossing to you~ :)
    NewWorld->SetGameInstance(this);

    // note that how to call GC in unreal engine
    // - this is why we call AddToRoot() for UGameInstance
    if(bNeedsGarbageCollection)
    {
        /*
        PIEë¥¼ ìƒì„±í•˜ë©´ì„œ ì´ì œëŠ” í•„ìš”ì—†ëŠ” Objectê°€ ë§ì´ ìƒê²¼ê¸° ë•Œë¬¸ì— GCë¥¼ ì§„í–‰í•©ë‹ˆë‹¤.
        GameInsatnceì˜ AddtoRoot() í•¨ìˆ˜ë¥¼ í˜¸ì¶œ í–ˆë˜ ì´ìœ ì…ë‹ˆë‹¤.
        */
        CollectGarbage(GARBAGE_COLLECTION_KEEPFLAGS);
    }

    // this creates the game instance subsystems
    Init();

    // initialize the world after setting world context and initializing the game instance to be consistent with normal loads
    // this creates the world subsystems and prepares to begin play

    // need to init newly created UWorld
    EditorEngine->PostCreatePIEWorld(NewWorld);

    return FGameInstancePIEResult::Success();
}
```