---
layout: default
title: "02. CreatePIEWorldByDuplication"
parent: "(07_00.PIEGameInstanceë§Œë“¤ê¸°)"
grand_parent: "(UE SourceCode ë¶„ì„ ðŸ¤–)"
nav_order: 1
---

## Table of contents
{: .no_toc .text-delta }

1. TOC
{:toc}

---

* Duplication? ë­˜ ë³µì‚¬í•˜ë‚˜?
* ë§žìŒ! ì™œëƒ? ê²°êµ­ PIEê°€ Editorì˜ Worldë¥¼ ë³µì‚¬í•´ì„œ ë§Œë“¤ê¸° ë•Œë¬¸ìž„.

```cpp
virtual UWorld* CreatePIEWorldByDuplication(
    FWorldContext& WorldContext, 
    UWorld* InWorld, 
    FString& PlayWorldMapName) override
{
    UPackage* InPackage = InWorld->GetOutermost();
    const FString WorldPackageName = InPackage->GetName();

    // ì´ë¦„ì„ Uniqueí•˜ê²Œ ë§Œë“¤ì–´ì¤€ë‹¤ ìƒê°í•˜ìž
    PlayWorldMapName = UWorld::ConvertToPIEPackageName(WorldPackageName, WorldContext, PIEInstance);

    UPackage* PlayWorldPackage = CreatePackage(*PlayWorldMapName);
    PlayWorldPackage->SetPIEInstanceID(WorldContext.PIEInstance);
    PlayWorldPackage->SetLoadedPath(InPackage->GetLoadedPath());
    PlayWorldPackage->SetGuid(InPackage->GetGuid());
    PlayWorldPackage->MarkAsFullyLoaded();

    PlayWorldPackage->SetPackageFlags(PKG_PlayInEditor | PKG_NewlyCreated);


    UWorld* NewPIEWorld = NULL;
    {
        // NULL GWorld before various PostLoad functions are called, this makes it easier to debug invalid GWorld accesses
        GWorld = NULL;

        // GetDuplicatedWorldForPIEëŠ” ì•„ëž˜ ì°¸ì¡°
        NewPIEWorld = UWorld::GetDuplicatedWorldForPIE(InWorld, PlayWorldPackage, WorldContext.PIEInstance);
    }

    NewPIEWorld->SetFeatureLevel(InLevel->GetFeatureLevel());

    NewPIEWorld->WorldType = EWorldType::PIE;

    //                                                                              
    //                                    *** 1. Create PIEWorld's package object   
    //                                            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             
    //       EditorWorld's Package                â”‚ PIE World Package â”‚             
    //           â–²                                â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             
    //           â”‚                                         â”‚                        
    //        OuterMost()                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                        
    //           â”‚                           â”‚                                      
    //     â”Œâ”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”                   â–¼                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      
    //     â”‚ EditorWorld â”‚    â”€â”€â”€â”€StaticDuplicateObject()â”€â”€â”€â”€â–º â”‚ NEW PIEWorldâ”‚      
    //     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      
    //                        *** 2. Duplicate Editor World                         
    //                                with PIE World Package                        
    //

    return NewPIEWorld;
}
```

```cpp
static UWorld* GetDuplicatedWorldForPIE(UWorld* InWorld, UPackage* InPIEPackage, int32 PIEInstanceID)
{
    FObjectDuplicationParameters Parameters(InWorld, InPIEPackage);
    Parameters.DestName = InWorld->GetFName();
    Parameters.DestClass = InWorld->GetClass();

    Parameters.DuplicateMode = EDuplicateMode::PIE;
    Parameters.PortFlags = PPF_DuplicateForPIE;

    UWorld* DuplicatedWorld = CastChecked<UWorld>(StaticDuplicateObjectEx(Parameters));
    return DuplicatedWorld;
}
```