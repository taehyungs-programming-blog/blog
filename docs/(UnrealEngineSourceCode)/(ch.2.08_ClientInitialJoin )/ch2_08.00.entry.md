---
layout: default
title: "([Network] 08. ClientInitialJoin)"
parent: "(UE SourceCode ë¶„ì„ ğŸ¤–)"
has_children: true
nav_order: 3
---

```cpp
class HandlerComponent
{   
    friend class PacketHandler;
public:
    HandlerComponent(FName InName)
        : Name(InName)
    {}

    /** should be called when the handler is fully initilized on both remote and local */
    /** í•¸ë“¤ëŸ¬ê°€ ì›ê²©ê³¼ ë¡œì»¬ ì–‘ìª½ì—ì„œ ì™„ì „íˆ ì´ˆê¸°í™”ë˜ì—ˆì„ ë•Œ í˜¸ì¶œë˜ì–´ì•¼ í•¨ */
    
    // [ClientInitialJoin]
    // this is called by 'StatelessConnectHandlerComponent'
    // StatelessConnectHandlerComponentì— ì˜í•´ í˜¸ì¶œë¨

    void Initialized()
    {
        bInitialized = true;

        
        // [ClientInitialJoin]
        // it is called from the client-side (IpConnection::PacketHandler::StatelessHandlerComponent)

        // í´ë¼ì´ì–¸íŠ¸ ì¸¡ì—ì„œ í˜¸ì¶œë¨ (IpConnection::PacketHandler::StatelessHandlerComponent)
        Handler->HandlerComponentInitialized(this);
    }
```

```cpp
/** triggered when a child HandlerComponent has been initialized */

// ìì‹ HandlerComponentê°€ ì´ˆê¸°í™”ë˜ì—ˆì„ ë•Œ í˜¸ì¶œë¨
void HandlerComponentInitialized(HandlerComponent* InComponent)
{
    // check if all handlers are initialized

    // ëª¨ë“  í•¸ë“¤ëŸ¬ê°€ ì´ˆê¸°í™”ë˜ì—ˆëŠ”ì§€ í™•ì¸
    if (State != UE::Handler::State::Initialized)
    {
        bool bAllInitialized = true;
        bool bEncounteredComponent = false;
        for (int32 i = HandlerComponents.Num() - 1; i >= 0; --i)
        {
            // note that we already marked as StatelessConnectHandlerComponent's bInitialized as 'true'
            // StatelessConnectHandlerComponentì˜ bInitializedê°€ ì´ë¯¸ 'true'ë¡œ í‘œì‹œë˜ì–´ ìˆìŒì„ ì£¼ì˜
            HandlerComponent& CurComponent = *HandlerComponents[i];
            if (!CurComponent.IsInitialized())
            {
                bAllInitialized = false;
            }
            if (bEncounteredComponent)
            {
                //...
            }
            else
            {
                bEncounteredComponent = &CurComponent == InComponent;
            }
        }

        // [ClientInitialJoin]
        // the client also calls 'HandlerInitialized()'

        // [ClientInitialJoin]
        // í´ë¼ì´ì–¸íŠ¸ë„ 'HandlerInitialized()'ë¥¼ í˜¸ì¶œí•¨
        if (bAllInitialized)
        {
            HandlerInitialized();
        } 
    }
}
```

```cpp
/** called when handler is finished initialzing */
/** í•¸ë“¤ëŸ¬ì˜ ì´ˆê¸°í™”ê°€ ì™„ë£Œë˜ì—ˆì„ ë•Œ í˜¸ì¶œë¨ */
void HandlerInitialized()
{
    // if any buffered packets, add to queue

    // ë²„í¼ë§ëœ íŒ¨í‚·ì´ ìˆë‹¤ë©´ íì— ì¶”ê°€
    for (int32 i = 0; i < BufferedPackets.Num(); ++i)
    {
        QueuedPackets.Enqueue(BufferedPackets[i]);
        BufferedPackets[i] = nullptr;
    }
    BufferedPackets.Reset();

    for (int32 i = 0; i < BufferedConnectionlessPackets.Num(); ++i)
    {
        QueuedConnectionlessPackets.Enqueue(BufferedConnectionlessPackets[i]);
        BufferedConnectionlessPackets[i] = nullptr;
    }
    BufferedConnectionlessPackets.Empty();

    // now, we are finally in the state 'Initialized' for PacketHandler
    // ì´ì œ ë§ˆì¹¨ë‚´ PacketHandlerê°€ 'Initialized' ìƒíƒœê°€ ë¨
    SetState(UE::Handler::State::Initialized);

    // [ClientInitialJoin]
    // do you remember that we bound 'HandshakeCompleteDel' to UPendingNetGame::SendInitialJoin 

    // [í´ë¼ì´ì–¸íŠ¸ ì´ˆê¸° ì ‘ì†]
    // 'HandshakeCompleteDel'ì„ UPendingNetGame::SendInitialJoinì— ë°”ì¸ë”©í–ˆë˜ ê²ƒì„ ê¸°ì–µí•˜ì‹œë‚˜ìš”
    if (bBeganHandshaking)
    {
        HandshakeCompleteDel.ExecuteIfBound();
    }
}
```