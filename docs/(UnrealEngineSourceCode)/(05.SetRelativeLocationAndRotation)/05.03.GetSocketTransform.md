---
layout: default
title: "03. GetSocketTransform"
parent: "(05.SetRelativeLocationAndRotation ë¶„ì„)"
grand_parent: "(UE SourceCode ë¶„ì„ ðŸ¤–)"
nav_order: 1
---

## Table of contents
{: .no_toc .text-delta }

1. TOC
{:toc}

---

## USceneComponent::GetSocketTransform

* ë“¤ì–´ê°€ê¸° ì „ `ERelativeTransformSpace`ì˜ ì´í•´ê°€ í•„ìš”í•˜ë‹¤

```cpp
enum ERelativeTransformSpace : int8
{
    /** World space transform */
    RTS_World,      // World
    /** Actor space transform. */
    RTS_Actor,      //
    /** Component space transform. */
    RTS_Component,  // Actor ë‚´ì˜ Component
    /** Parent bone space transform */
    RTS_ParentBoneSpace,    // íŠ¹ì • Boneì— ì†Œì¼“ì´ë¼ ìƒê°í•˜ìž.

    // ë¡œì»¬ìŠ¤íŽ˜ì´ìŠ¤ì—ëŠ” ë„¤ ê°œì˜ transformì´ ì¡´ìž¬í•œë‹¤ ìƒê°í•˜ìž.
};
```

```cpp
virtual FTransform GetSocketTransform
(
    FName InSocketName, 
    ERelativeTransformSpace TransformSpace=RTS_World    // ë””í´íŠ¸ëŠ” Worldì´ë‹¤.
) const
{
    switch (TransformSpace)
    {
        case RTS_Actor:
        {
            /*
            const FTransform& GetTransform() const
            {
                return ActorToWorld();
            }
            */
            return GetComponentTransform().GetRelativeTransform(GetOwner()->GetTransform());
        }
        case RTS_Component:
        case RTS_ParentBoneSpace:
        {
            return FTransform::Identity;
        }
        default:
        {
            // ê·¸ëƒ¥ FTransform ComponentToWorld ì»´í¬ë„ŒíŠ¸ì˜ ë¦¬í„´ì´ë‹¤.
            return GetComponentTransform();
        }
    }
}
```

---

## USKinnedMeshComponent::GetSocketTransform

```cpp
virtual FTransform GetSocketTransform(FName InSocketName, ERelativeTransformSpace TransformSpace = RTS_World) const override
{
    FTransform OutSocketTransform = GetComponentTransform();
    // haker: how to understand what the socket is?
    //                                                                                                                         
    //      [Visual Look]                                                [Conceptual Structure]                                
    //                                                                                                                         
    //                  Head                                                           Root                                    
    //                    â”‚                                                             â–²                                      
    //                    â–¼           R_Arm_Socket[R_Arm,Offset]                        â”‚                                      
    //             â”Œâ”€â”€â”€â–ºSpineâ—„â”€â”€â”€â”€â”  â”Œâ”€â”                                               Pelvis                                  
    //             â”‚      â”‚       â”‚  â””â”€â”˜                                                â–²                                      
    //          L_Arm     â”‚      R_Arm  R_Hand_Socket[R_Hand,Offset]                    â”‚                                      
    //           â”‚        â”‚       â–²    â”Œâ”€â”                                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                            
    //           â–¼        â–¼       â”‚    â””â”€â”˜                                    â”‚         â”‚         â”‚                            
    //       L_Hand  â”Œâ”€â–ºPelvisâ—„â”  R_Hand                                     L_Leg     Spine     R_Leg                         
    //               â”‚    â”‚    â”‚                                              â–²          â–²        â–²                            
    //               â”‚    â”‚    â”‚                                              â”‚          â”‚        â”‚                            
    //             L_Leg  â”‚  R_Leg                                          L_Foot       â”‚       R_Root                        
    //              â–²     â”‚     â–²                                                   â”Œâ”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”                              
    //              â”‚     â–¼     â”‚                                                   â”‚    â”‚      â”‚                              
    //          L_Foot   Root   R_Foot                                              â”‚    â”‚      â”‚                              
    //                                                                            L_Arm  Head  R_Arm                           
    //                                                                              â–²            â–² â”‚                           
    //                                                                              â”‚            â”‚ â””â”€â”€â”€â”€â”€R_Arm_Socket          
    //                                                                           L_Hand        R_Hand                          
    //                                                                                           â”‚                             
    //                                                                                           â””â”€â”€â”€â”€â”€R_Hand_Socket           

    if (InSocketName != NAME_None)
    {
        int32 SocketBoneIndex;
        FTransform SocketLocalTransform;
        // Socketì˜ ì´ë¦„ì„ í†µí•´ USkeletalMeshSocketì„ ê°€ì ¸ì˜¨ë‹¤
        USkeletalMeshSocket const* const Socket = GetSocketInfoByName(InSocketName, SocketLocalTransform, SocketBoneIndex);
        
        if (Socket)
        {
            if (TransformSpace == RTS_ParentBoneSpace)
            {
                return SocketLocalTransform;
            }

            if (SocketBoneIndex != INDEX_NONE)
            {
                FTransform BoneTransform = GetBoneTransform(SocketBoneIndex);
                OutSocketTransform = SocketLocalTransform * BoneTransform;
            }
        }
        else
        {
            // ëª» ê°€ì ¸ì˜¨ ì¼€ì´ìŠ¤
            int32 BoneIndex = GetBoneIndex(InSocketName);
            if (BoneIndex != INDEX_NONE)
            {
                OutSocketTransform = GetBoneTransform(BoneIndex);

                if (TransformSpace == RTS_ParentBoneSpace)
                {
                    FName ParentBone = GetParentBone(InSocketName);
                    int32 ParentIndex = GetBoneIndex(ParentBone);
                    if (ParentIndex != INDEX_NONE)
                    {
                        return OutSocketTransform.GetRelativeTransform(GetBoneTransform(ParentIndex));
                    }
                    return OutSocketTransform.GetRelativeTransform(GetComponentTransform());
                }
            }
        }
    }


    switch (TransformSpace)
    {
        case RTS_Actor:
        {
            if (AActor* Actor = GetOwner())
            {
                return OutSocketTransform.GetRelativeTransform(Actor->GetTransform());
            }
            break;
        }
        case RTS_Component:
        {
            return OutSocketTransform.GetRelativeTransform(GetComponentTransform());
        }
    }

    return OutSocketTransform;
}
```