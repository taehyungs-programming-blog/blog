---
layout: default
title: "01. ConditionalUpdateComponentToWorld"
parent: "(05.SetRelativeLocationAndRotation ë¶„ì„)"
grand_parent: "(UE SourceCode ë¶„ì„ ğŸ¤–)"
nav_order: 1
---

## Table of contents
{: .no_toc .text-delta }

1. TOC
{:toc}

---

```cpp
void SetRelativeLocationAndRotation(FVector NewLocation, const FQuat& NewRotation, bSweep=false, FHitResult* OutSweepHitResult=nullptr, ETeleportType Teleport=ETeleportType::None)
{
    // ConditionalUpdateComponentToWorld - ë¶€ëª¨ë¡œ ë¶€í„° íŒŒìƒëœ Locationì„ Worldì¢Œí‘œë¡œ ë³€í™˜
    ConditionalUpdateComponentToWorld();
    // ...
```

---

## EUpdateTransformFlags, ETeleportType

* ë“¤ì–´ê°€ê¸° ì „ `EUpdateTransformFlags`, `ETeleportType`ì— ëŒ€í•œ ì´í•´ê°€ í•„ìš”

```cpp
enum class EUpdateTransformFlags : int32
{
	/** Default options */
	None = 0x0,
	/** Don't update the underlying physics */
    // PhysicsUdpateëŠ” ë§‰ì•„ë¼
	SkipPhysicsUpdate = 0x1,		
	/** The update is coming as a result of the parent updating (i.e. not called directly) */
    // ë¶€ëª¨ë¡œ ë¶€í„° ì—…ë°ì´íŠ¸ë˜ì–´ ë„˜ì–´ì˜¨ ì• ì…ë‹ˆë‹¤. (ì´ë²ˆê°•ì€ ì—¬ê¸°ë§Œ ì•Œì•„ë„ ë¨.)
	PropagateFromParent = 0x2,		
	/** Only update child transform if attached to parent via a socket */
    
	OnlyUpdateIfUsingSocket = 0x4	
};
```

```cpp
enum class ETeleportType : uint8
{
    /** do not teleport physics body: this means velocity will reflect the movement between initial and final position, and collisions along the way will occur */
    None,
    /** teleport physics body so that velocity remains the same and no collision occurs */
    // Teleportë¥¼ ì‚¬ìš©í•´ Physicsë¥¼ ì—…ë°ì´íŠ¸ (ê·¸ëƒ¥ ê·¸ ìœ„ì¹˜ì— ë„£ì–´ë‹¬ë¼.)
    TeleportPhysics,
    /** teleport physics body and reset physics state completely */
    // ì˜ ì‚¬ìš© ì•ˆ ë¨.
    ResetPhysics,
}
```

---

## ë‹¤ì‹œ UpdateComponentToWorldWithParent

```cpp
void UpdateComponentToWorldWithParent
    (
        USceneComponent* Parent, 
        FName SocketName, EUpdateTransformFlags UpdateTransformFlags, 
        const FQuat& RelativeRotationQuat, 
        ETeleportType Teleport = ETeleportType::None        // ì¼ë°˜ì ìœ¼ë¡œ None
    )
{
// ë§Œì•½ Component5ë¥¼ UpdateComponentToWorldWithParentí•˜ë ¤í•œë‹¤ ê°€ì •í•˜ì
// Component5ì˜ Parentê°€ Updateê°€ ì•ˆëœê²½ìš°. -> Parent->bComponentToWorldUpdated ì¸ê²½ìš°
// ì¬ê·€ì  Parentì˜ UpdateComponentToWorldWithParentí˜¸ì¶œì´ í•„ìš”í•´ì§„ë‹¤.
//                                                  â”Œâ”€â”€â”€Component4                                                    
//                                                  â”‚                                                                 
//                                 â”Œâ”€â”€Component2â—„â”€â”€â”€â”¤                                                                 
//                                 â”‚                â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                   
//                                 â”‚                â””â”€â”€â”¤Component5â”‚â—„â”€â”€â”€â”€â”€Component6                                   
// Component0â—„â”€â”€â”€â”€â”€â”€â”€Component1â—„â”€â”€â”€â”¤                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                   
//                                 â”‚                       â–²                                                          
//                                 â”‚                       â”‚                                                          
//                                 â””â”€â”€Component3           â”‚                                                          

    if (Parent && !Parent->bComponentToWorldUpdated)
    {
        // Parentì˜ UpdateComponentToWorld í˜¸ì¶œ
        Parent->UpdateComponentToWorld();

//                                                                                                                         
//                                                      â”Œâ”€â”€â”€Component4                                                     
//                                                      â”‚                                                                  
//                                     â”Œâ”€â”€Component2â—„â”€â”€â”€â”¤                                                                  
//                                     â”‚                â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                    
//                                     â”‚                â””â”€â”€â”¤Component5â”‚â—„â”€â”€â”€â”€â”€Component6                                    
//     Component0â—„â”€â”€â”€â”€â”€â”€â”€Component1â—„â”€â”€â”€â”¤                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                    
//                                     â”‚                                                                                   
//                                     â”‚                                                                                   
//                                     â””â”€â”€Component3                                                                       
//                                                                                                                         
// CASE 1)                                                                                                                 
//     Component0's bComponentToWorldUpdated : False                                                                       
//     Component1's bComponentToWorldUpdated : False                                                                       
//     Component2's bComponentToWorldUpdated : False                                                                       
// ë¶€ëª¨ê°€ ëª¨ë‘ Falseì´ ê²½ìš° ê·¸ëƒ¥ë‹¤ í˜¸ì¶œëœë‹¤ ë³´ë©´ ë¨.
//     [Component0, Component1, Component2, Component3, Component4, Component5, Component6]                                
//                                                                                                                         
// CASE 2)                                                                                                                 
//     Component0's bComponentToWorldUpdated : True                                                                        
//     Component1's bComponentToWorldUpdated : True                                                                        
//     Component2's bComponentToWorldUpdated : False                                                                       
// ì´ ì¼€ì´ìŠ¤ë„ ì‰½ë‹¤
//     [Component2, Component4, Component5, Component6]                                                                    
//                                                                                                                         
// CASE 3)                                                                                                                 
//     Component0's bComponentToWorldUpdated : False                                                                       
//     Component1's bComponentToWorldUpdated : True                                                                        
//     Component2's bComponentToWorldUpdated : False                                                                       
// ì´ ê²½ìš°ëŠ” ì‚¬ì‹¤ìƒ ìˆì„ìˆ˜ ì—†ìŒ.
        
        // ìˆì„ ìˆ˜ ì—†ëŠ” ì¼€ì´ìŠ¤ëŠ” ì–¼ë¦¬ë¦¬í„´.
        if (bComponentToWorldUpdated)
        {
            return;
        }
    }

    // ì—¬ê¸°ê¹Œì§€ í•˜ë©´ ë¶€ëª¨ Componentê°€ ëª¨ë‘ Worldì¢Œí‘œê³„ë¡œ ì—…ë°ì´íŠ¸ ë˜ì—ˆë‹¤!
    bComponentToWorldUpdated = true;

    // ì ì—¬ê¸°ê¹Œì§€ ë˜ë©´ëª¨ë‘ Worldì¢Œí‘œ ê³„ë¡œ ì—…ë°ì´íŠ¸ ë¨!
    FTransform NewTransform(NoInit);
    {
        const FTransform RelativeTransform(RelativeRotationQuat, GetRelativeLocation(), GetRelativeScale3D());

        // ì´ì œ ë‚´ ì¢Œí‘œê³„ë¥¼ ê³„ì‚°í•˜ì -> ë‹¤ìŒê°• ì°¸ì¡°
        NewTransform = CalcNewComponentToWorld(
            RelativeTransform,  // ìœ„ì¹˜ ì •ë³´
            Parent,             // Parent ì •ë³´
            SocketName          // ì–´ëŠì†Œì¼“ì— ë¶™ì—ˆë‚˜
            );
    }

    bool bHasChanged;
    {
        bHasChanged = !GetComponentTransform().Equals(NewTransform, UE_SMALL_NUMBER);
    }

    // ë³€í™”ê°€ ìˆëŠ”ê²½ìš° PropagateTransformUpdate(true) 
    // ì—†ëŠ”ê²½ìš° PropagateTransformUpdate(false) 
        // ë­” ì°¨ì¼ê¹Œ? ì•„ë˜ë¥¼ ë³´ì
    if (bHasChanged || 
        Teleport != ETeleportType::None)
    {
        ComponentToWorld = NewTransform;

        PropagateTransformUpdate(true, UpdateTransformFlags, Teleport);
    }
    else
    {
        PropagateTransformUpdate(false);
    }
}
```

---

## PropagateTransformUpdate

```cpp
void PropagateTransformUpdate
(
    bool bTransformChanged, 
    EUpdateTransformFlags UpdateTransformFlags = EUpdateTransformFlags::None, 
    ETeleportType Teleport = ETeleportType::None        // ë³´í†µì€ Noneì´ê¸°ì— ì‹ ê²½ X
)
{
    // ì—¬ê¸°ëŠ” Moveí˜¸ì¶œë¡œ ì¤‘ë³µí˜¸ì¶œ ë  ê²½ìš° ëŒ€ë¹„í•´ ë§Œë“  í•¨ìˆ˜ì¸ë°
    // í¬ê²Œ ë¡œì§ê³¼ ìƒê´€ì—†ê¸°ì— ìƒëµ.
    if (IsDeferringMovementUpdates())
    {
        //...
        return;
    }

    const TArray<USceneComponent*>& AttachedChildren = GetAttachChildren();
    // AttachChildrenë¥¼ ì‚¬ìš©í•  ê²ƒì´ê¸°ì— ë¯¸ë¦¬ ìºì‹±
        // ë¯¸ë¦¬ ë©”ëª¨ë¦¬ ê³µê°„ì— ìºì‹±í•´ë‘ëŠ”ê²Œ ì¢‹ê¸°ë„ í•˜ì§€ë§Œ..
        // ë‹¨ì ì´ë¼ë©´ ì´ë¯¸ ì˜¬ë¼ê°„ ìºì‹œë„ ë‚´ë ¤ê°ˆ ìˆ˜ ìˆë‹¤ëŠ” ê²ƒ (ì¡°ì‹¬í•´ì„œ í˜¹ì€ ì“°ì§€ë§ì)
    FPlatformMisc::Prefetch(AttachChildren.GetData());

    if (bTransformChanged)
    {
        // (Tips) Bound - íŠ¹ì • ì˜¤ë¸Œì íŠ¸ì˜ ë¬¼ë¦¬ì ì¸ ê²½ê³„ë¥¼ ë‚˜íƒ€ë‚´ëŠ” ìš©ì–´ì…ë‹ˆë‹¤.
        UpdateBounds();

        if (bRegistered)
        {
            // bTransformChanged True/Falseì— ë”°ë¼ ë‹¤ë¥¸ ì ì€ ì—¬ê¸° ë¿ì´ë‹¤.
            if (bWantsOnUpdateTransform)
            {
                OnUpdateTransform(UpdateTransformFlags, Teleport);
            }
            TransformUpdated.Broadcast(this, UpdateTransformFlags, Teleport);

            // Rendering Worldì— ì•Œë ¤ì¤€ë‹¤.
            MarkRenderTransformDirty();
        }

        if (AttachedChildren.Num() > 0)
        {
            EUpdateTransformFlags ChildrenFlagNoPhysics = ~EUpdateTransformFlags::SkipPhysicsUpdate & UpdateTransformFlags;
            UpdateChildTransforms(ChildrenFlagNoPhysics, Teleport);
        }
    }
    else
    {
        UpdateBounds();

        if (AttachedChildren.Num() > 0)
        {
            UpdateChildTransforms();
        }

        if (bRegistered)
        {
            MarkRenderTransformDirty();
        }
    }
}
```