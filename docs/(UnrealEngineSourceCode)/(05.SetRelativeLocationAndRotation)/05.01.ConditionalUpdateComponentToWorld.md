---
layout: default
title: "01. ConditionalUpdateComponentToWorld"
parent: "(05.SetRelativeLocationAndRotation ë¶„ì„)"
grand_parent: "(UE SourceCode ë¶„ì„ ğŸ¤–)"
nav_order: 1
---

## Table of contents
{: .no_toc .text-delta }

1. TOC
{:toc}

---

```cpp
void SetRelativeLocationAndRotation(FVector NewLocation, const FQuat& NewRotation, bSweep=false, FHitResult* OutSweepHitResult=nullptr, ETeleportType Teleport=ETeleportType::None)
{
    // ConditionalUpdateComponentToWorld - ë¶€ëª¨ë¡œ ë¶€í„° íŒŒìƒëœ Locationì„ Worldì¢Œí‘œë¡œ ë³€í™˜
    ConditionalUpdateComponentToWorld();
    // ...
```

---

## EUpdateTransformFlags, ETeleportType

* ë“¤ì–´ê°€ê¸° ì „ `EUpdateTransformFlags`, `ETeleportType`ì— ëŒ€í•œ ì´í•´ê°€ í•„ìš”

```cpp
enum class EUpdateTransformFlags : int32
{
	/** Default options */
	None = 0x0,
	/** Don't update the underlying physics */
    // PhysicsUdpateëŠ” ë§‰ì•„ë¼
	SkipPhysicsUpdate = 0x1,		
	/** The update is coming as a result of the parent updating (i.e. not called directly) */
    // ë¶€ëª¨ë¡œ ë¶€í„° ì—…ë°ì´íŠ¸ë˜ì–´ ë„˜ì–´ì˜¨ ì• ì…ë‹ˆë‹¤. (ì´ë²ˆê°•ì€ ì—¬ê¸°ë§Œ ì•Œì•„ë„ ë¨.)
	PropagateFromParent = 0x2,		
	/** Only update child transform if attached to parent via a socket */
    
	OnlyUpdateIfUsingSocket = 0x4	
};
```

```cpp
enum class ETeleportType : uint8
{
    /** do not teleport physics body: this means velocity will reflect the movement between initial and final position, and collisions along the way will occur */
    None,
    /** teleport physics body so that velocity remains the same and no collision occurs */
    // Teleportë¥¼ ì‚¬ìš©í•´ Physicsë¥¼ ì—…ë°ì´íŠ¸ (ê·¸ëƒ¥ ê·¸ ìœ„ì¹˜ì— ë„£ì–´ë‹¬ë¼.)
    TeleportPhysics,
    /** teleport physics body and reset physics state completely */
    // ì˜ ì‚¬ìš© ì•ˆ ë¨.
    ResetPhysics,
}
```

---

## ë‹¤ì‹œ UpdateComponentToWorldWithParent

```cpp
void UpdateComponentToWorldWithParent
    (
        USceneComponent* Parent, 
        FName SocketName, EUpdateTransformFlags UpdateTransformFlags, 
        const FQuat& RelativeRotationQuat, 
        ETeleportType Teleport = ETeleportType::None        // ì¼ë°˜ì ìœ¼ë¡œ None
    )
{
// ë§Œì•½ Component5ë¥¼ UpdateComponentToWorldWithParentí•˜ë ¤í•œë‹¤ ê°€ì •í•˜ì
// Component5ì˜ Parentê°€ Updateê°€ ì•ˆëœê²½ìš°. -> Parent->bComponentToWorldUpdated ì¸ê²½ìš°
// ì¬ê·€ì  Parentì˜ UpdateComponentToWorldWithParentí˜¸ì¶œì´ í•„ìš”í•´ì§„ë‹¤.
//                                                  â”Œâ”€â”€â”€Component4                                                    
//                                                  â”‚                                                                 
//                                 â”Œâ”€â”€Component2â—„â”€â”€â”€â”¤                                                                 
//                                 â”‚                â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                   
//                                 â”‚                â””â”€â”€â”¤Component5â”‚â—„â”€â”€â”€â”€â”€Component6                                   
// Component0â—„â”€â”€â”€â”€â”€â”€â”€Component1â—„â”€â”€â”€â”¤                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                   
//                                 â”‚                       â–²                                                          
//                                 â”‚                       â”‚                                                          
//                                 â””â”€â”€Component3           â”‚                                                          

    if (Parent && !Parent->bComponentToWorldUpdated)
    {
        // Parentì˜ UpdateComponentToWorld í˜¸ì¶œ
        Parent->UpdateComponentToWorld();

//                                                                                                                         
//                                                      â”Œâ”€â”€â”€Component4                                                     
//                                                      â”‚                                                                  
//                                     â”Œâ”€â”€Component2â—„â”€â”€â”€â”¤                                                                  
//                                     â”‚                â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                    
//                                     â”‚                â””â”€â”€â”¤Component5â”‚â—„â”€â”€â”€â”€â”€Component6                                    
//     Component0â—„â”€â”€â”€â”€â”€â”€â”€Component1â—„â”€â”€â”€â”¤                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                    
//                                     â”‚                                                                                   
//                                     â”‚                                                                                   
//                                     â””â”€â”€Component3                                                                       
//                                                                                                                         
// CASE 1)                                                                                                                 
//     Component0's bComponentToWorldUpdated : False                                                                       
//     Component1's bComponentToWorldUpdated : False                                                                       
//     Component2's bComponentToWorldUpdated : False                                                                       
// ë¶€ëª¨ê°€ ëª¨ë‘ Falseì´ ê²½ìš° ê·¸ëƒ¥ë‹¤ í˜¸ì¶œëœë‹¤ ë³´ë©´ ë¨.
//     [Component0, Component1, Component2, Component3, Component4, Component5, Component6]                                
//                                                                                                                         
// CASE 2)                                                                                                                 
//     Component0's bComponentToWorldUpdated : True                                                                        
//     Component1's bComponentToWorldUpdated : True                                                                        
//     Component2's bComponentToWorldUpdated : False                                                                       
// ì´ ì¼€ì´ìŠ¤ë„ ì‰½ë‹¤
//     [Component2, Component4, Component5, Component6]                                                                    
//                                                                                                                         
// CASE 3)                                                                                                                 
//     Component0's bComponentToWorldUpdated : False                                                                       
//     Component1's bComponentToWorldUpdated : True                                                                        
//     Component2's bComponentToWorldUpdated : False                                                                       
// ì´ ê²½ìš°ëŠ” ì‚¬ì‹¤ìƒ ìˆì„ìˆ˜ ì—†ìŒ.
        
        // ìˆì„ ìˆ˜ ì—†ëŠ” ì¼€ì´ìŠ¤ëŠ” ì–¼ë¦¬ë¦¬í„´.
        if (bComponentToWorldUpdated)
        {
            return;
        }
    }

    // ì—¬ê¸°ê¹Œì§€ í•˜ë©´ ë¶€ëª¨ Componentê°€ ëª¨ë‘ Worldì¢Œí‘œê³„ë¡œ ì—…ë°ì´íŠ¸ ë˜ì—ˆë‹¤!
    bComponentToWorldUpdated = true;

    // ì ì—¬ê¸°ê¹Œì§€ ë˜ë©´ëª¨ë‘ Worldì¢Œí‘œ ê³„ë¡œ ì—…ë°ì´íŠ¸ ë¨!
    FTransform NewTransform(NoInit);
    {
        const FTransform RelativeTransform(RelativeRotationQuat, GetRelativeLocation(), GetRelativeScale3D());

        // ì´ì œ ë‚´ ì¢Œí‘œê³„ë¥¼ ê³„ì‚°í•˜ì -> ë‹¤ìŒê°• ì°¸ì¡°
        NewTransform = CalcNewComponentToWorld(
            RelativeTransform,  // ìœ„ì¹˜ ì •ë³´
            Parent,             // Parent ì •ë³´
            SocketName          // ì–´ëŠì†Œì¼“ì— ë¶™ì—ˆë‚˜
            );
    }

    bool bHasChanged;
    {
        bHasChanged = !GetComponentTransform().Equals(NewTransform, UE_SMALL_NUMBER);
    }

    if (bHasChanged || 
        Teleport != ETeleportType::None)
    {
        ComponentToWorld = NewTransform;

        PropagateTransformUpdate(true, UpdateTransformFlags, Teleport);
    }
    else
    {
        PropagateTransformUpdate(false);
    }
}
```