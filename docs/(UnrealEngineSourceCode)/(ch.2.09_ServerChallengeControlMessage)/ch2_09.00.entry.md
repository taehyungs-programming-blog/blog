---
layout: default
title: "([Network] 09. ServerChallengeControlMessage)"
parent: "(UE SourceCode 분석 🤖)"
has_children: true
nav_order: 3
---

```cpp
/** allows the connection to process the raw data that was received */
/** 연결이 수신한 원시 데이터를 처리할 수 있도록 함 */

// the server received any packet from the client
// in our case, we are going to dispatch NMT_Hello from ControlChannel
// 서버가 클라이언트로부터 패킷을 수신함
// 우리의 경우, ControlChannel로부터 NMT_Hello를 디스패치할 것임

virtual void ReceivedRawPacket(void* Data, int32 Count)
{
    uint8* Data = (uint8*)InData;

    if (Handler.IsValid())
    {
        FReceivedPacketView PacketView;
        PacketView.DataView = {Data, Count, ECountUnits::Bytes};
        // [ServerChallengeControlMessage]
        // do you remember that we serialize additional data by calling PacketHandler::Outgoing(StatelessConnectHandlerComponent::Outgoing)?
        // we need to consume these data bits to read the packet properly afterward:
        // PacketHandler::Outgoing(StatelessConnectHandlerComponent::Outgoing)을 호출하여 추가 데이터를 직렬화했던 것을 기억하시나요?
        // 이후에 패킷을 올바르게 읽기 위해 이러한 데이터 비트들을 소비해야 합니다:
        //
        //          NewPacket                                     PacketHandler's data                                                                        
        //           │                                              │                                                                                         
        //           ├─MagicHeader(0)                               │            send-buffer data                                                             
        //           │                                              │               │                                                                         
        //           ├─SessionClientId(2)                      ┌────┼────┬──────────┼─────────────────┐                                                       
        //           │                                 ──────► │    ▼    │          ▼                 │                                                       
        //           ├─ClientID(3)                             └─────────┴────────────────────────────┘                                                       
        //           │                                         ▲   ▲     ▲                                                                                    
        //           ├─bHandshakePacket(1): false              │   │     │                                                                                    
        //           │                                        (1) (2)   (...)                                                                                 
        //           └─send-buffer data                                                                                                                       
        //             ────────────────                        ──────────►                                                                                    
        //              ***                                      *** before reading bunch data, we need to move cursor properly by serializing bits(reading)! 
        //                                                                                                                                                                                                                                                                                                      
        // see PacketHandler::Incoming(goto 003: ServerChallengeControlMessage)
        EIncomingResult IncomingResult = Handler->Incoming(PacketView);

        // [ServerChallengeControlMessage]
        // the packet's data is still left to read(serialize)
        // Count > 0!
        // 패킷의 데이터를 아직 읽어야(직렬화) 합니다
        // Count > 0!
        if (IncomingResult == EIncomingResult::Success)
        {
            Count = PacketView.DataView.NumBytes();
            if (Count > 0)
            {
                Data = PacketView.DataView.GetMutableData();
            }
            else
            {
                // this packet has been consumed
                // 이 패킷은 이미 소비되었습니다
                return;
            }
        }
    }
}
```