---
layout: default
title: "05-01. "
parent: "(05. Update World)"
grand_parent: "(UE SourceCode ë¶„ì„ ðŸ¤–)"
nav_order: 1
---

## Table of contents
{: .no_toc .text-delta }

1. TOC
{:toc}

---

```cpp
/** set the location and rotation of the component relative to its parent */
void SetRelativeLocationAndRotation(FVector NewLocation, const FQuat& NewRotation, bSweep=false, FHitResult* OutSweepHitResult=nullptr, ETeleportType Teleport=ETeleportType::None)
{
    ConditionalUpdateComponentToWorld();

    const FTransform DesiredRelTransform(NewRotation, NewLocation);
    // see USceneComponent::CalcNewComponentToWorld briefly
    // - DesiredDelta is the delta of translation between DesiredTransform and ComponentToWorld
    const FTransform DesiredWorldTransform = CalcNewComponentToWorld(DesriedRelTransform);
    const FVector DesiredDelta = FTransform::SubtractTranslation(DesiredWorldTransform, GetComponentTransform());
    
    MoveComponent(DesiredDelta, DesiredWorldTransform.GetRotation(), bSweep, OutSweepHitResult, MOVECOMP_NoFlags, Teleport);
}
```

```cpp
/** call UpdateComponentToWorld if bComponentToWorldUpdated is false */
void ConditionalUpdateComponentToWorld()
{
    // bComponentToWorldUpdated can be known later in UpdateComponentToWorld()
    // - preventing infinite-looping from recursive call while updating children's ComponentToWorld
    // see bComponentToWorldUpdated bit flag member variable breifly
    // UpdateComponentToWorldì—ì„œ ìžì„¸ížˆ ë‹¤ë£° ë³€ìˆ˜ì´ì§€ë§Œ í•´ë‹¹ ë³€ìˆ˜ë¥¼ í†µí•´ ìž¬ê·€ í˜¸ì¶œë¡œ ì¸í•œ ë¬´í•œ ë£¨í”„ë¥¼ ë°©ì§€í•©ë‹ˆë‹¤.
    if (!bComponentToWorldUpdated)
    {
        UpdateComponentToWorld();
    }
}
```

```cpp
void UpdateComponentToWorldWithParent(USceneComponent* Parent, FName SocketName, EUpdateTransformFlags UpdateTransformFlags, const FQuat& RelativeRotationQuat, ETeleportType Teleport = ETeleportType::None)
```

* ë“¤ì–´ê°€ê¸° ì „ ë³€ìˆ˜ ì •ë¦¬

```cpp
/** Information about how to update transform when something is moved */
enum class EUpdateTransformFlags : int32
{
	/** Default options */
	None = 0x0,
	/** Don't update the underlying physics */
    // as the word implies, it is related to SkipPhysicsUpdate, for now, we'll not covered today with this flag
    // PysicsUpdateë¥¼ Skipì„ ì„¤ì •í•˜ê¸° ìœ„í•œ í”Œëž˜ê·¸ ìž…ë‹ˆë‹¤.
	SkipPhysicsUpdate = 0x1,		
	/** The update is coming as a result of the parent updating (i.e. not called directly) */
    // when we propagate UpdateComponentToWorld from parent to AttachChildren
    // ë¶€ëª¨ì˜ ì—…ë°ì´íŠ¸ ê²°ê³¼ë¥¼ ìžì‹ì—ê²Œë„ ì „íŒŒí•˜ê¸° ìœ„í•œ í”Œëž˜ê·¸ ìž…ë‹ˆë‹¤
	PropagateFromParent = 0x2,		
	/** Only update child transform if attached to parent via a socket */
    // it is special purpose flag type, but for now, we don't need to care so much
    // ì†Œì¼“ì„ í†µí•´ ë¶€ëª¨ì—ê²Œ ì—°ê²°ëœ ê²½ìš°ì—ë§Œ ìžì‹ì„ ì—…ë°ì´íŠ¸ í•˜ëŠ” íŠ¹ìˆ˜ í”Œëž˜ê·¸ ìž…ë‹ˆë‹¤.
	OnlyUpdateIfUsingSocket = 0x4	
};
```

```cpp
/** whether to teleport physics body or not */
enum class ETeleportType : uint8
{
    /** do not teleport physics body: this means velocity will reflect the movement between initial and final position, and collisions along the way will occur */
    // apply collision and reflect result of collision to velocity
    // ì½œë¦¬ì „ì˜ ì¶©ëŒ , ì†ë ¥ì„ ë°˜ì˜í•˜ëŠ” ì¼ë°˜ì ìœ¼ë¡œ ì›€ì§ì¼ ë•Œ ì‚¬ìš©í•˜ëŠ” í”Œëž˜ê·¸ ìž…ë‹ˆë‹¤.
    None,
    /** teleport physics body so that velocity remains the same and no collision occurs */
    // do NOT consider velocity, just teleport remaining velocity
    // - useful initially spawning object or initial placement of object
    // ì†ë ¥ì„ ê³ ë ¤í•˜ì§€ ì•Šê³  í•´ë‹¹ ìœ„ì¹˜ì— ë°”ë¡œ ìˆœê°„ì´ë™ í•˜ëŠ” í”Œëž˜ê·¸ ìž…ë‹ˆë‹¤.
    TeleportPhysics,
    /** teleport physics body and reset physics state completely */
    // rarely used... cuz, recreating physics state is too expensive
    // Physcisë¥¼ í…”ë ˆí¬íŠ¸í•˜ê³  ìž¬ì„¤ì •í•˜ëŠ” í”Œëž˜ê·¸ë¡œ ë§Žì€ ë¹„ìš©ì„ ìš”êµ¬í•˜ê¸° ë•Œë¬¸ì— ìž˜ ì‚¬ìš©í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
    ResetPhysics,
}
```

* ë‹¤ì‹œ `UpdateComponentToWorldWithParent`ë¡œ ëŒì•„ê°€ìž

```cpp
void UpdateComponentToWorldWithParent(USceneComponent* Parent, FName SocketName, EUpdateTransformFlags UpdateTransformFlags, const FQuat& RelativeRotationQuat, ETeleportType Teleport = ETeleportType::None)
{
    // if our parent hasn't been updated before, we'll need walk up our parent attach hierarchy
    // there is no guarantee that developer calls UpdateComponentToWorldWithParent on root of scene graph(SceneComponent):
    // - so make sure successive parent's ComponentToWorld is up-to-date wherever you call UpdateComponentToWorld()
    //                                                  â”Œâ”€â”€â”€Component4                                                    
    //                                                  â”‚                                                                 
    //                                 â”Œâ”€â”€Component2â—„â”€â”€â”€â”¤                                                                 
    //                                 â”‚                â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                   
    //                                 â”‚                â””â”€â”€â”¤Component5â”‚â—„â”€â”€â”€â”€â”€Component6                                   
    // Component0â—„â”€â”€â”€â”€â”€â”€â”€Component1â—„â”€â”€â”€â”¤                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                   
    //                                 â”‚                       â–²                                                          
    //                                 â”‚                       â”‚                                                          
    //                                 â””â”€â”€Component3           â”‚                                                          
    //                                                         â”‚                                                          
    //                                                         â”‚                                                          
    //                                                         â”‚                                                          
    //                                                   When Component5's UpdateComponentToWorldWithParent is called     
    //                                                    - Recursively make sure Parent's UpdateComponentToWorld is up-to-date

/*
ë¶€ëª¨ì˜ WorldUpdateê°€ ì§„í–‰ë˜ì§€ ì•Šì•˜ë‹¤ë©´ updateComponentToWorldë¥¼ ìž¬ê·€ì ìœ¼ë¡œ í˜¸ì¶œì„
í†µí•´ ëª¨ë“  ë¶€ëª¨ì˜ Updateê°€ ì™„ë£Œë˜ì—ˆë‹¤ë©´ ìžì‹ ì˜ bComponentToWorldUpdated í”Œëž˜ê·¸ë¥¼ Trueë¡œ
ë³€ê²½í•˜ê³  ìžì‹ ì˜ Updateë¥¼ ì§„í–‰í•©ë‹ˆë‹¤.
*/
    if (Parent && !Parent->bComponentToWorldUpdated)
    {
        // also NOTE that before calling Parent->UpdateComponentToWorld, we check whether bComponentToWorldUpdate is 'true' or not:
        // - prevent dup calls on UpdateComponentToWorld()
        Parent->UpdateComponentToWorld();
```

