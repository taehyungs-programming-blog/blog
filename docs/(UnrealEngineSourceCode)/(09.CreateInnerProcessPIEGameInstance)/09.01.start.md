---
layout: default
title: "(09.CreateInnerProcessPIEGameInstance)"
parent: "(UE SourceCode ë¶„ì„ ğŸ¤–)"
has_children: true
nav_order: 1
---

* ë³µìŠµì˜ ì‹œê°„
* ì‹œì‘ì€ ì—¬ê¸° ë¶€í„°ì´ë‹¤.

```cpp
/** create an GameInstance with the given settings. a window is created if this isn't server */
    UGameInstance* CreateInnerProcessPIEGameInstance(FRequestPlaySessionParams& InParams, const FGameInstancePIEParameters& InPIEParameters, int32 InPIEInstanceIndex)
    {
        FSoftClassPath GameInstanceClassName = GetDefault<UGameMapsSettings>()->GameInstanceClass;

        UClass* GameInstanceClass = GameInstanceClassName.TryLoadClass<UGameInstance>();
        if (!GameInstanceClass)
        {
            GameInstanceClass = UGameInstance::StaticClass();
        }

        UGameInstance* GameInstance = NewObject<UGameInstance>(this, GameInstanceClass);

        // GCì— ê±¸ë ¤ ì‚­ì œë˜ëŠ”ê²ƒì„ ë°©ì§€
        GameInstance->AddToRoot();

        // ì´ˆê¸°í™” ì‹œë„ëŠ” ì—¬ê¸°ì„œ ì§„í–‰ëœë‹¤. -> 02 ì°¸ì¡°.
        const FGameInstancePIEResult InitializeResult = GameInstance->InitializeForPlayInEditor(InPIEInstanceIndex, InPIEParameters);
        if (!InitializeResult.IsSuccess())
        {
            GameInstance->RemoveFromRoot();
            return nullptr;
        }

        FWorldContext* const PieWorldContext = GameInstance->GetWorldContext();
        PlayWorld = PieWorldContext->World();

        UGameViewportClient* ViewportClient = nullptr;
        ULocalPlayer* NewLocalPlayer = nullptr;
        {
            ViewportClient = NewObject<UGameViewportClient>(this, GameViewportClientClass);

            ViewportClient->Init(*PreWorldContext, GameInstance);

            GameViewport = ViewportClient;
            GameViewport->bIsPlayInEditorViewport = true;

            PieWorldContext->GameViewport = ViewportClient;

            ViewportClient->OnGameViewportInputKey().BindUObject(this, &UEditorEngine::ProcessDebuggerCommands);

            FString Error;
            NewLocalPlayer = ViewportClient->SetupInitialLocalPlayer(Error);

            UGameViewportClient::OnViewportCreated().Broadcast();
        }

        // ë‹¤ì‹œ GCì— ê±¸ë¦¬ê²Œ Rootë¥¼ í’€ì–´ì¤€ë‹¤.
        GameInstance->RemoveFromRoot();

        FGameInstancePIEResult StartResult = FGameInstancePIEResult::Success();
        {
            StartResult = GameInstance->StartPlayInEditorGameInstance(NewLocalPlayer, InPIEParameters);
        }


        return GameInstance;
    }
```
