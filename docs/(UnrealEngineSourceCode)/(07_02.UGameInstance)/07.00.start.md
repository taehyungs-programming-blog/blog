---
layout: default
title: "(07_02.UGameInstance)"
parent: "(UE SourceCode ë¶„ì„ ğŸ¤–)"
has_children: true
nav_order: 1
---

## ì‹œì‘

* GameInstanceë€ ë­˜ê¹Œ?
    * UE Engineì„ í•˜ë‚˜ì˜ OSë¼ ìƒê°í•˜ê³  ê·¸ OSìœ„ì˜ Processë¥¼ GameInstanceë¼ ìƒê°í•˜ì

```cpp

/**
 * GameInstance: high-level manager object for an instance of the running game
 * - spawned at game creation and not destroyed until game instance is shut down
 * - running as a standalone game, there will be one of these
 * - running in PIE (play-in-editor) will generate one of these per PIE instance
 */
UCLASS(config=Game, transient, BlueprintType, Blueprintable, MinimalAPI)
class UGameInstance : public UObject, public FExec
{

    // ...

    // ì—¬ê¸°ì„œ ë¶€í„° ë³´ì
    FString PIEMapName;

    //                                                                                
    // UEngine             In Frame0, GameInstance is dependent                       
    //  â”‚                   on WorldContext0                      â”Œâ”€Frame0â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” 
    //  â”œâ”€â”€â”€WorldContext0â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   GameInstance  â”‚ 
    //  â”‚                                                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ 
    //  â”œâ”€â”€â”€WorldContext1                                                             
    //  â”‚                                                         â”Œâ”€Frame1â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” 
    //  â””â”€â”€â”€WorldContext2â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   GameInstance  â”‚ 
    //                     In Frame1, GameInstance is dependent   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ 
    //                      on WorldContext1                                          
    //                                                                                
    // - Actually, GameInstance has "indirect" relation to world by introducing WorldContext
    FWorldContext* WorldContext;

    /** list of locally participating players in this game instance */
    TArray<TObjectPtr<ULocalPlayer>> LocalPlayers;

    FObjectSubsystemCollection<UGameInstanceSubsystem> SubsystemCollection;
};
```

---

## ULocalPlayer

```cpp
/**
 * each player that is active on the current client/listen server has a LocalPlayer
 * it stays active across maps, and there may be several spawned in the case of splitscreen/coop
 * there will be 0 spawned on dedicated servers
 */

// - LocalPlayer is created in client(or listen server) but dedicated server doesn't spawn LocalPlayer!
// - LocalPlayer's lifetime is 'independent' from World's lifetime:
//   - try to understand the relationship between LocalPlayer and World:
//
//         EditorEngine                                                                                                             
//          â”‚                                                                                                                       
//          â””â”€â”€WorldContexts: TArray<FWorldContext>                                                                                 
//                                                                                                                                  
//                â–²                                                                                                                 
//                â”‚                                                                                                                 
//     [OuterPrivate as 'Engine']                                                                                                   
//                â”‚               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º GameInstance:                                                               
//          â”Œâ”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”         â”‚                      â”‚                                                                          
//          â”‚LocalPlayerâ”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                      â””â”€â”€LocalPlayers: TArray<ULocalPlayer>                                      
//          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ managed by GameInstance           â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                      
//                                                                  â”‚                                                               
//                                                                  â”‚                                                               
//                                                            ***independent from World                                             
//                                                                -GameInstance can change its dependent WorldContext any time      
//                                                                -LocalPlayer is also independent from WorldContext                
//                                                                                                                                  

class ULocalPlayer : public UPlayer
{
    /** create an actor for this player */
    virtual bool SpawnPlayActor(const FString& URL, FString& OutError, UWorld* InWorld)
    {
        {
            FURL PlayerURL(NULL, *URL, TRAVEL_Absolute);

            PlayerController = InWorld->SpawnPlayActor(this, ROLE_SimulatedProxy, PlayerURL, UniqueId, OutError, GEngine->GetGamePlayers(InWorld).Find(this));
        }
        return PlayerController != NULL;
    }
};
```