---
layout: default
title: "03-01. AddAndInitializeSubsystem"
parent: "(03. CreateWorld::Initialize)"
grand_parent: "(UE SourceCode ë¶„ì„ ğŸ¤–)"
nav_order: 1
---

## Table of contents
{: .no_toc .text-delta }

1. TOC
{:toc}

---

## Worldì™€ Subsystem

* Unreal Engineì—ì„œ **UWorld**ëŠ” ê²Œì„ ì„¸ê³„ë¥¼ ë‚˜íƒ€ëƒ…ë‹ˆë‹¤. ì´ëŠ” ë ˆë²¨, ì•¡í„°, ì»´í¬ë„ŒíŠ¸, ë„¤ë¹„ê²Œì´ì…˜ ë°ì´í„° ë“±ì„ í¬í•¨í•˜ì—¬ ê²Œì„ í™˜ê²½ì˜ ëª¨ë“  ìš”ì†Œë¥¼ ìº¡ìŠí™”í•©ë‹ˆë‹¤. ê¸°ë³¸ì ìœ¼ë¡œ, í”Œë ˆì´ ê°€ëŠ¥í•œ ë ˆë²¨ì´ë‚˜ í™˜ê²½ì„ ì •ì˜í•˜ëŠ” ëª¨ë“  ê²Œì„ í”Œë ˆì´ ìš”ì†Œì˜ ì»¨í…Œì´ë„ˆì…ë‹ˆë‹¤.

* **ì„œë¸Œì‹œìŠ¤í…œ(Subsystem)**ì€ ì—”ì§„ì˜ í•µì‹¬ í´ë˜ìŠ¤ë¥¼ ìˆ˜ì •í•˜ê±°ë‚˜ ì‹±ê¸€í†¤ì— í¬ê²Œ ì˜ì¡´í•˜ì§€ ì•Šê³ ë„ ì—”ì§„ì˜ ê¸°ëŠ¥ì„ í™•ì¥í•˜ëŠ” ëª¨ë“ˆì‹ ë°©ë²•ì…ë‹ˆë‹¤. ì´ëŠ” ì „ì—­ ë˜ëŠ” ì›”ë“œë³„ ì‹œìŠ¤í…œì„ ê²Œì„ ì½”ë“œ ì „ë°˜ì—ì„œ ì•¡ì„¸ìŠ¤í•  ìˆ˜ ìˆë„ë¡ ê¹¨ë—í•˜ê³  ì¡°ì§ì ì¸ ë°©ì‹ì„ ì œê³µí•©ë‹ˆë‹¤. Unreal Engineì€ ì—¬ëŸ¬ ìœ í˜•ì˜ ì„œë¸Œì‹œìŠ¤í…œì„ ì œê³µí•©ë‹ˆë‹¤:

* ì—°ê´€ì„±: ê° UWorld ì¸ìŠ¤í„´ìŠ¤ëŠ” ìì²´ì ì¸ UWorldSubsystem ì„¸íŠ¸ë¥¼ ê´€ë¦¬í•©ë‹ˆë‹¤. ì´ëŠ” ë¡œë“œëœ ê° ì›”ë“œ(ë ˆë²¨ ë˜ëŠ” í™˜ê²½)ì— ëŒ€í•´ í•´ë‹¹ ì›”ë“œ ë‚´ì—ì„œë§Œ ì‘ë™í•˜ëŠ” ì„œë¸Œì‹œìŠ¤í…œ ì„¸íŠ¸ê°€ ìˆë‹¤ëŠ” ê²ƒì„ ì˜ë¯¸í•©ë‹ˆë‹¤.
* ìˆ˜ëª… ê´€ë¦¬: UWorldëŠ” ì„œë¸Œì‹œìŠ¤í…œì˜ ìƒì„±, ì´ˆê¸°í™”, í‹±(tick), íŒŒê´´ë¥¼ ì±…ì„ì§‘ë‹ˆë‹¤. ì›”ë“œê°€ ë¡œë“œë˜ë©´ í•´ë‹¹ ì„œë¸Œì‹œìŠ¤í…œì´ ìë™ìœ¼ë¡œ ì¸ìŠ¤í„´ìŠ¤í™”ë˜ê³  ì´ˆê¸°í™”ë©ë‹ˆë‹¤. ë°˜ëŒ€ë¡œ ì›”ë“œê°€ ì–¸ë¡œë“œë˜ë©´ í•´ë‹¹ ì„œë¸Œì‹œìŠ¤í…œì´ ì ì ˆí•˜ê²Œ ì •ë¦¬ë©ë‹ˆë‹¤.
* ì•¡ì„¸ìŠ¤: UWorldì— ëŒ€í•œ ì°¸ì¡°ê°€ ìˆëŠ” ê³³ì—ì„œëŠ” ì–´ë””ì„œë“  UWorldSubsystemì— ì•¡ì„¸ìŠ¤í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ë¥¼ í†µí•´ ì›”ë“œë³„ ê¸°ëŠ¥ì„ ì„œë¸Œì‹œìŠ¤í…œ ë‚´ì— ê¹”ë”í•˜ê²Œ ìº¡ìŠí™”í•˜ì—¬ ì½”ë“œì˜ ì¡°ì§í™”ì™€ ì¬ì‚¬ìš©ì„±ì„ ë†’ì¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.


* ì˜ˆì‹œ:
    * `UWeatherSubsystem`: ì›”ë“œ ë‚´ì˜ ë‚ ì”¨ì™€ í™˜ê²½ íš¨ê³¼ë¥¼ ê´€ë¦¬í•©ë‹ˆë‹¤.
    * `UAIPathfindingSubsystem`: AIì˜ ê²½ë¡œ ì°¾ê¸°ì™€ ë„¤ë¹„ê²Œì´ì…˜ì„ ì²˜ë¦¬í•©ë‹ˆë‹¤.
    * `UEnvironmentalSoundSubsystem`: ì›”ë“œì˜ í™˜ê²½ ì‚¬ìš´ë“œë¥¼ ê´€ë¦¬í•©ë‹ˆë‹¤.

---

```cpp
USubsystem* AddAndInitializeSubsystem(UClass* SubsystemClass)
{
    // note that it only allow ONE instance per class type
    // í´ë˜ìŠ¤ íƒ€ì…ë‹¹ í•˜ë‚˜ì˜ ì¸ìŠ¤í„´ìŠ¤ë§Œ í—ˆìš©í•œë‹¤ëŠ” ì ì— ì£¼ëª©í•˜ì„¸ìš”
    if (!SubsystemMap.Contains(SubsystemClass))
    {
        // only add instances for non abstract Subsystems
        // ì¶”ìƒ í´ë˜ìŠ¤ê°€ ì•„ë‹Œ ì„œë¸Œì‹œìŠ¤í…œì— ëŒ€í•´ì„œë§Œ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ì¶”ê°€í•©ë‹ˆë‹¤
        // 
        // - UClass::ClassFlags has class information
        // - UClass::ClassFlagsì—ëŠ” í´ë˜ìŠ¤ ì •ë³´ê°€ ìˆìŠµë‹ˆë‹¤
        if (SubsystemClass && !SubsystemClass->HasAllClassFlags(CLASS_Abstract))
        {
            // subsystem class should be derived from base type
            // ì„œë¸Œì‹œìŠ¤í…œ í´ë˜ìŠ¤ëŠ” ê¸°ë³¸ íƒ€ì…ì—ì„œ íŒŒìƒë˜ì–´ì•¼ í•©ë‹ˆë‹¤
            check(SubsystemClass->IsChildOf(BaseType));

            // 
            // - ShouldCreateSubsystem() determines whether we create subsystem or not
            //    - override this method to control the flow of subsystem creation
            // - CDO is sufficient to call ShouldCreateSubsystem()
            // 
            // - ShouldCreateSubsystem()ëŠ” ì„œë¸Œì‹œìŠ¤í…œì„ ìƒì„±í• ì§€ ì—¬ë¶€ë¥¼ ê²°ì •í•©ë‹ˆë‹¤
            //    - ì„œë¸Œì‹œìŠ¤í…œ ìƒì„± íë¦„ì„ ì œì–´í•˜ë ¤ë©´ ì´ ë©”ì„œë“œë¥¼ ì˜¤ë²„ë¼ì´ë“œí•˜ì„¸ìš”
            // - ShouldCreateSubsystem()ë¥¼ í˜¸ì¶œí•˜ê¸° ìœ„í•´ì„œëŠ” CDOë¡œ ì¶©ë¶„í•©ë‹ˆë‹¤
            const USubsystem* CDO = SubsystemClass->GetDefaultObject<USubsystem>();
            // see USubsystem::ShouldCreateSubsystem (goto 32)
            // USubsystem::ShouldCreateSubsystem ì°¸ì¡° (32ë¡œ ì´ë™)
            if (CDO->ShouldCreateSubsystem(Outer))
            {
                // create new USubsystem by SubsystemClass (in our case, the class is UWorldSubsystem)
                // SubsystemClassë¡œ ìƒˆë¡œìš´ USubsystemì„ ìƒì„±í•©ë‹ˆë‹¤ (ìš°ë¦¬ì˜ ê²½ìš°, ì´ í´ë˜ìŠ¤ëŠ” UWorldSubsystemì…ë‹ˆë‹¤)
                USubsystem* Subsystem = NewObject<USubsystem>(Outer, SubsystemClass);
                SubsystemMap.Add(SubsystemClass, Subsystem);
                Subsystem->InternalOwningSubsystem = this;
                Subsystem->Initialize(*this);
                return Subsystem;
            }
        }
        return nullptr;
    }
    // if we already have SubsystemClass, find an existing instance from SubsystemMap
    // ì´ë¯¸ SubsystemClassê°€ ìˆë‹¤ë©´, SubsystemMapì—ì„œ ê¸°ì¡´ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ì°¾ìŠµë‹ˆë‹¤
    return SubsystemMap.FindRef(SubsystemClass);
}
```