---
layout: default
title: "[System Design] ë¶„ì‚° ì±„íŒ… ì‹œìŠ¤í…œ"
parent: "24ë…„ Coding Test ğŸ¦–"
grand_parent: "Etc ğŸ› "
nav_order: 2
---

## Table of contents
{: .no_toc .text-delta }

1. TOC
{:toc}

---

## Q

* Slackê³¼ ê°™ì€ ì‹¤ì‹œê°„ ë¶„ì‚° ì±„íŒ… ì‹œìŠ¤í…œì„ ì„¤ê³„í•˜ì„¸ìš”.
* ë‹¤ìŒ ê¸°ëŠ¥ë“¤ì´ í•„ìš”í•©ë‹ˆë‹¤:
    * 1:1 ì±„íŒ… ë° ê·¸ë£¹ ì±„íŒ… ì§€ì›
    * ë©”ì‹œì§€ ì „ì†¡/ìˆ˜ì‹  (í…ìŠ¤íŠ¸, ì´ë¯¸ì§€, íŒŒì¼)
    * ì½ìŒ í™•ì¸ ê¸°ëŠ¥
    * ì˜¨ë¼ì¸/ì˜¤í”„ë¼ì¸ ìƒíƒœ í‘œì‹œ
    * ë©”ì‹œì§€ ê²€ìƒ‰ ê¸°ëŠ¥
    * ì±„íŒ…ë°© ì°¸ì—¬ì ê´€ë¦¬
    * ì•Œë¦¼ ê¸°ëŠ¥

---

## A

* ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜:
    * ì›¹ì†Œì¼“ ì„œë²„: ì‹¤ì‹œê°„ ë©”ì‹œì§€ ì „ì†¡
    * ë©”ì‹œì§€ í: ë©”ì‹œì§€ ì²˜ë¦¬ ë° ì „ë‹¬ ë³´ì¥
    * ìºì‹œ ì„œë²„: ìµœê·¼ ë©”ì‹œì§€ ë° ì‚¬ìš©ì ìƒíƒœ ì €ì¥
    * ê²€ìƒ‰ ì—”ì§„: ë©”ì‹œì§€ ê²€ìƒ‰ ê¸°ëŠ¥ ì œê³µ
* ë°ì´í„° ëª¨ë¸:
    * ì‚¬ìš©ì ì •ë³´
    * ì±„íŒ…ë°© ì •ë³´
    * ë©”ì‹œì§€ ë°ì´í„°
    * ì½ìŒ ìƒíƒœ
* í™•ì¥ì„± ê³ ë ¤ì‚¬í•­:
    * ìˆ˜í‰ì  í™•ì¥ì´ ê°€ëŠ¥í•œ ì„¤ê³„
    * ì§€ì—­ë³„ ì„œë²„ ë¶„ì‚°
    * ë©”ì‹œì§€ ì „ë‹¬ ë³´ì¥
* ì„±ëŠ¥ ìµœì í™”:
    * ë©”ì‹œì§€ ìºì‹±
    * íš¨ìœ¨ì ì¸ ì—°ê²° ê´€ë¦¬
    * ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸ ìµœì í™”

```cpp
// ë©”ì‹œì§€ ì •ì˜
class Message {
public:
    string id;
    string senderId;
    string chatRoomId;
    string content;
    MessageType type;  // TEXT, IMAGE, FILE
    time_t timestamp;
    map<string, bool> readStatus;  // userId -> read status
};

// ì±„íŒ…ë°© ê´€ë¦¬
class ChatRoom {
public:
    string id;
    vector<string> participants;
    ChatType type;  // INDIVIDUAL, GROUP
    time_t createdAt;
    
    void addParticipant(string userId) {
        participants.push_back(userId);
        notifyParticipantChange(userId, true);
    }
    
    void removeParticipant(string userId) {
        auto it = find(participants.begin(), 
                      participants.end(), 
                      userId);
        if (it != participants.end()) {
            participants.erase(it);
            notifyParticipantChange(userId, false);
        }
    }
};

// ì›¹ì†Œì¼“ ì—°ê²° ê´€ë¦¬
class WebSocketConnection {
public:
    void handleMessage(const Message& msg) {
        // ë©”ì‹œì§€ ìœ íš¨ì„± ê²€ì‚¬
        if (!validateMessage(msg)) {
            return;
        }
        
        // ë©”ì‹œì§€ íì— ì „ì†¡
        messageQueue.publish(msg);
        
        // ì˜¨ë¼ì¸ ì‚¬ìš©ìì—ê²Œ ì¦‰ì‹œ ì „ì†¡
        for (auto& userId : msg.chatRoom->participants) {
            if (isUserOnline(userId)) {
                sendToUser(userId, msg);
            }
        }
    }
    
    void handleUserStatus(string userId, bool online) {
        userStatusCache.set(userId, online);
        notifyUserStatus(userId, online);
    }
};

// ë©”ì‹œì§€ í ì²˜ë¦¬
class MessageQueue {
public:
    void publish(const Message& msg) {
        // ë©”ì‹œì§€ ì˜ì†í™”
        messageStore.save(msg);
        
        // ì½ì§€ ì•Šì€ ì‚¬ìš©ìë“¤ì—ê²Œ ì•Œë¦¼ ì „ì†¡
        for (auto& userId : msg.chatRoom->participants) {
            if (userId != msg.senderId) {
                notificationService.sendNotification(userId, msg);
            }
        }
    }
};

// ê²€ìƒ‰ ê¸°ëŠ¥
class SearchEngine {
public:
    vector<Message> searchMessages(string query, 
                                 string userId,
                                 SearchOptions options) {
        vector<Message> results;
        
        // ì‚¬ìš©ìì˜ ì±„íŒ…ë°©ì—ì„œ ê²€ìƒ‰
        auto chatRooms = getUserChatRooms(userId);
        for (auto& room : chatRooms) {
            auto messages = searchInRoom(room, query, options);
            results.insert(results.end(), 
                         messages.begin(), 
                         messages.end());
        }
        
        return results;
    }
};

// ì±„íŒ… ì„œë¹„ìŠ¤ ë©”ì¸ í´ë˜ìŠ¤
class ChatService {
public:
    ChatRoom* createChatRoom(vector<string> participants, 
                           ChatType type) {
        auto room = new ChatRoom();
        room->id = generateUniqueId();
        room->participants = participants;
        room->type = type;
        room->createdAt = getCurrentTime();
        
        chatRoomStore.save(room);
        return room;
    }
    
    void sendMessage(string userId, 
                    string roomId, 
                    string content,
                    MessageType type) {
        auto msg = new Message();
        msg->id = generateUniqueId();
        msg->senderId = userId;
        msg->chatRoomId = roomId;
        msg->content = content;
        msg->type = type;
        msg->timestamp = getCurrentTime();
        
        wsConnection.handleMessage(*msg);
    }
    
    vector<Message> getMessages(string roomId, 
                              int limit, 
                              time_t before) {
        return messageStore.getMessages(roomId, limit, before);
    }
    
    void markAsRead(string userId, string messageId) {
        auto msg = messageStore.getMessage(messageId);
        msg->readStatus[userId] = true;
        messageStore.update(msg);
        
        // ì½ìŒ ìƒíƒœ ë³€ê²½ ì•Œë¦¼
        notifyReadStatus(msg);
    }
    
private:
    WebSocketConnection wsConnection;
    MessageQueue messageQueue;
    SearchEngine searchEngine;
    MessageStore messageStore;
    ChatRoomStore chatRoomStore;
    NotificationService notificationService;
};

// ì‚¬ìš© ì˜ˆì œ
int main() {
    ChatService chatService;
    
    // ì±„íŒ…ë°© ìƒì„±
    vector<string> participants = {"user1", "user2"};
    auto room = chatService.createChatRoom(participants, 
                                         ChatType::INDIVIDUAL);
    
    // ë©”ì‹œì§€ ì „ì†¡
    chatService.sendMessage("user1", 
                          room->id, 
                          "ì•ˆë…•í•˜ì„¸ìš”!", 
                          MessageType::TEXT);
    
    // ë©”ì‹œì§€ ì¡°íšŒ
    auto messages = chatService.getMessages(room->id, 50, 
                                          getCurrentTime());
    
    // ë©”ì‹œì§€ ê²€ìƒ‰
    SearchOptions options;
    options.startDate = getYesterday();
    options.endDate = getCurrentTime();
    
    auto searchResults = 
        chatService.searchEngine.searchMessages("ì•ˆë…•", 
                                              "user1", 
                                              options);
    
    return 0;
}
```

ì´ ì„¤ê³„ëŠ” ë‹¤ìŒê³¼ ê°™ì€ íŠ¹ì§•ì„ ê°€ì§‘ë‹ˆë‹¤:

1. ì‹¤ì‹œê°„ì„±
   * WebSocketì„ í†µí•œ ì‹¤ì‹œê°„ ë©”ì‹œì§€ ì „ì†¡
   * ì‚¬ìš©ì ìƒíƒœ ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸

2. ì‹ ë¢°ì„±
   * ë©”ì‹œì§€ íë¥¼ í†µí•œ ë©”ì‹œì§€ ì „ë‹¬ ë³´ì¥
   * ë©”ì‹œì§€ ì˜ì†í™”

3. í™•ì¥ì„±
   * ë…ë¦½ì ìœ¼ë¡œ í™•ì¥ ê°€ëŠ¥í•œ ì»´í¬ë„ŒíŠ¸
   * ë¶„ì‚° ì•„í‚¤í…ì²˜ ì§€ì›

4. ê¸°ëŠ¥ì„±
   * ë‹¤ì–‘í•œ ë©”ì‹œì§€ íƒ€ì… ì§€ì›
   * ì½ìŒ í™•ì¸
   * ê²€ìƒ‰ ê¸°ëŠ¥
   * ì•Œë¦¼ ì‹œìŠ¤í…œ

ì‹¤ì œ êµ¬í˜„ì‹œì—ëŠ” ë‹¤ìŒ ì‚¬í•­ë“¤ì„ ì¶”ê°€ë¡œ ê³ ë ¤í•´ì•¼ í•©ë‹ˆë‹¤:
* ë³´ì•ˆ (ë©”ì‹œì§€ ì•”í˜¸í™”, ì¸ì¦)
* ì—ëŸ¬ ì²˜ë¦¬
* ë©”ì‹œì§€ ìˆœì„œ ë³´ì¥
* ë„¤íŠ¸ì›Œí¬ ì§€ì—° ë° ì¥ì•  ì²˜ë¦¬
* ëŒ€ê·œëª¨ íŠ¸ë˜í”½ ì²˜ë¦¬

```plantuml
@startuml ChatSystem

enum MessageType {
    TEXT
    IMAGE
    FILE
}

enum ChatType {
    INDIVIDUAL
    GROUP
}

class Message {
    +string id
    +string senderId
    +string chatRoomId
    +string content
    +MessageType type
    +time_t timestamp
    +map<string, bool> readStatus
}

class ChatRoom {
    +string id
    +vector<string> participants
    +ChatType type
    +time_t createdAt
    +addParticipant(string userId)
    +removeParticipant(string userId)
}

class WebSocketConnection {
    +handleMessage(Message msg)
    +handleUserStatus(string userId, bool online)
}

class MessageQueue {
    +publish(Message msg)
}

class SearchEngine {
    +searchMessages(string query, string userId, SearchOptions options)
}

class ChatService {
    -WebSocketConnection wsConnection
    -MessageQueue messageQueue
    -SearchEngine searchEngine
    -MessageStore messageStore
    -ChatRoomStore chatRoomStore
    -NotificationService notificationService
    +createChatRoom(vector<string> participants, ChatType type)
    +sendMessage(string userId, string roomId, string content, MessageType type)
    +getMessages(string roomId, int limit, time_t before)
    +markAsRead(string userId, string messageId)
}

ChatService --> WebSocketConnection
ChatService --> MessageQueue
ChatService --> SearchEngine
ChatService --> MessageStore
ChatService --> ChatRoomStore
ChatService --> NotificationService

Message --> MessageType
ChatRoom --> ChatType
MessageQueue ..> Message
WebSocketConnection ..> Message
SearchEngine ..> Message
ChatService ..> Message
ChatService ..> ChatRoom

@enduml
```