---
layout: default
title: "04-07. [Con.] GameplayAbilitySystem UML로 정리"
parent: "(04. AbilitySystem)"
grand_parent: "(UE Lyra Review)"
nav_order: 1
---

## Table of contents
{: .no_toc .text-delta }

1. TOC
{:toc}

---

<p align="center">
  <img src="https://taehyungs-programming-blog.github.io/blog/assets/images/unreal/lyra_new/04.07_01.png"/>
</p>

<p align="center">
  <img src="https://taehyungs-programming-blog.github.io/blog/assets/images/unreal/lyra_new/04.07_02.png"/>
</p>

---

## 참고) PlantUML

```
@startuml GAS Usage Flow

skinparam sequenceMessageAlign center
skinparam sequence {
    ArrowColor #333
    LifeLineBackgroundColor White
    ParticipantBackgroundColor White
}

participant "AMyCharacter" as Character
participant "UGameplayAbility" as Ability
participant "UAbilitySystemComponent" as ASC
participant "FGameplayEffectSpec" as Spec
participant "UGameplayEffect" as Effect
participant "UGameplayEffectExecutionCalculation" as Execution
participant "UAttributeSet" as AttributeSet

== 1. 기본적인 GameplayEffect 적용 ==
Character -> ASC : ApplyGameplayEffectToSelf(DamageEffect, 1.0, Context)
activate ASC
ASC -> Spec : new FGameplayEffectSpec(DamageEffect, 1.0)
ASC -> ASC : ApplyGameplayEffectSpecToSelf(Spec)
ASC -> Effect : GetGameplayEffectExecutions()
Effect --> ASC : ExecutionCalculations
ASC -> Execution : Execute(ExecutionParams, OutExecutionOutput)
Execution -> AttributeSet : GetAttributeValue()
AttributeSet --> Execution : CurrentValue
Execution --> ASC : ModifiedValue
ASC -> AttributeSet : SetAttributeValue(ModifiedValue)
deactivate ASC

== 2. GameplayAbility를 통한 Effect 적용 ==
Character -> Ability : ActivateAbility()
activate Ability
Ability -> Ability : MakeOutgoingGameplayEffectSpec(EffectClass)
Ability -> Spec : SetSetByCallerMagnitude("Damage", 50.0f)
Ability -> ASC : ApplyGameplayEffectSpecToTarget(Spec, Target)
activate ASC
ASC -> Effect : GetGameplayEffectExecutions()
Effect --> ASC : ExecutionCalculations
ASC -> Execution : Execute(ExecutionParams, OutExecutionOutput)
Execution -> AttributeSet : GetAttributeValue()
AttributeSet --> Execution : CurrentValue
Execution --> ASC : ModifiedValue
ASC -> AttributeSet : SetAttributeValue(ModifiedValue)
deactivate ASC
deactivate Ability

== 3. 지속성 Effect 관리 ==
Character -> ASC : ApplyGameplayEffectToSelf(BuffEffect, 1.0, Context)
activate ASC
ASC -> Spec : new FGameplayEffectSpec(BuffEffect, 1.0)
ASC -> ASC : ApplyGameplayEffectSpecToSelf(Spec)
ASC -> ASC : AddActiveGameplayEffect(Spec)

loop 매 틱마다
    ASC -> ASC : UpdateActiveGameplayEffects()
    ASC -> Effect : GetPeriod()
    alt Period 시간이 되었을 때
        ASC -> Execution : Execute(ExecutionParams, OutExecutionOutput)
        Execution -> AttributeSet : GetAttributeValue()
        AttributeSet --> Execution : CurrentValue
        Execution --> ASC : ModifiedValue
        ASC -> AttributeSet : SetAttributeValue(ModifiedValue)
    end
end

== 4. Effect 제거 ==
Character -> ASC : RemoveActiveGameplayEffect(ActiveHandle)
activate ASC
ASC -> ASC : RemoveActiveGameplayEffect(Handle)
ASC -> AttributeSet : OnGameplayEffectRemoved()
deactivate ASC

@enduml
```

```
@startuml GAS Core Structure

skinparam class {
    BackgroundColor White
    ArrowColor #333
    BorderColor #333
}

class UAbilitySystemComponent {
    + ApplyGameplayEffect()
    + GiveAbility()
    + GetAttributeValue()
    - ActiveGameplayEffects
    - ActivatableAbilities
}

class UGameplayAbility {
    + ActivateAbility()
    + EndAbility()
    + CommitAbility()
    - AbilityTags
    - CancelAbilitiesWithTags
}

class UAttributeSet {
    + Health
    + Mana
    + Attack
    + Defense
    + PreAttributeChange()
    + PostGameplayEffectExecute()
}

class UGameplayEffect {
    + Duration
    + Period
    + StackLimitCount
    - Modifiers
    - ExecutionCalculations
}

class FGameplayEffectSpec {
    + Level
    + Duration
    + Period
    - SourceTags
    - TargetTags
}

class UGameplayEffectExecutionCalculation {
    + Execute_Implementation()
    - RelevantAttributesToCapture
}

class AActor {
}

class ACharacter {
}

AActor <|-- ACharacter
ACharacter *-- UAbilitySystemComponent
UAbilitySystemComponent *-- UAttributeSet
UAbilitySystemComponent o-- UGameplayAbility
UAbilitySystemComponent o-- "many" FGameplayEffectSpec

UGameplayEffect ..> FGameplayEffectSpec : creates
UGameplayEffect *-- "0..n" UGameplayEffectExecutionCalculation

note right of UAbilitySystemComponent
  핵심 컴포넌트로 GAS의 
  모든 기능을 관리
end note

note right of UAttributeSet
  캐릭터의 기본 속성들을
  정의하고 관리
end note

note right of UGameplayEffectExecutionCalculation
  복잡한 효과 계산을
  커스텀하게 처리
end note

@enduml
```