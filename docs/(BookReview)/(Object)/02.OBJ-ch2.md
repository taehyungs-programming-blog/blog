---
layout: default
title: "Ch.2 - ê°ì²´ì§€í–¥ í”„ë¡œê·¸ëž˜ë°"
parent: "(ì˜¤ë¸Œì íŠ¸)"
grand_parent: "ì±…(ê°œë°œë„ì„œ) ë¦¬ë·° ðŸ“š"
nav_order: 1
---

## Table of contents
{: .no_toc .text-delta }

1. TOC
{:toc}

---

* ì˜í™”ë¥¼ ì˜ˆë§¤ì‹œ í• ì¸ì •ì±…ê³¼ í• ì¸ì¡°ê±´ì„ ì„¸íŒ…í•˜ë ¤í•œë‹¤

```cpp
class Screening
{
public:
    Screening(Movie* _movie, int _sequence, LocalDateTime _whenScreened) : 
        movie(_movie), sequence(_sequence), whenScreened(_whenScreened) {}

    LocalDateTime getStartTime() { return whenScreened; }
    bool isSequence(int _sequence) { return sequence == _sequence; }
    Money getMoiveFee() { return movie->getFee(); }

private:
    Movie* movie;
    int sequence;
    LocalDateTime whenScreened;
};
```

* ì˜í™”ì— ì˜ˆë§¤ê¸°ëŠ¥ì„ ì¶”ê°€í•œë‹¤ê³  ìƒê°í•´ ë³´ìž

```cpp
class Screening
{
public:
    Reservation* reserve(Customer customer, int audienceCount) 
    {
        return new Reservation(customer, this, calculateFee(audienceCount), audienceCount);
    }

    Money calculateFee(int audienceCount)
    {
        return movie->calculateMovieFee(this).times(audienceCount);
            // (ì°¸ê³ ) timesëŠ” Moneyì˜ ê³±ì…ˆí•¨ìˆ˜ì´ë‹¤.
    }
```

```cpp
class Movie
{
public:
    // ...

    Money calculateMovieFee(Screening* _screening)
    {
        return fee.minus(discountPolicy->calculateDiscountAmount(_screening));
    }

private:
    string title;
    Duration runningTime;
    Money fee;
    DiscountPolicy* discountPolicy;
};
```

```cpp
class DiscountPolicy
{
public:
    // ...
    Money calculateDiscountAmount(Screening* _screening)
    {
        for (auto condition : conditions)
        {
            if (condition.isSatisfiedBy(_screening))
            {
                return getDiscountAmount(_screening);
            }
        }
    }

protected:
    abstract Money getDiscountAmount(Screening* _screening);

private:
    vector<DiscountCondition> conditions;
};
```

* ì¨‹ë“  êµ¬ì¡°ëŠ” ì´ëŸ¬í•˜ë‹¤

```
Movie ---> DiscountPolicy ---> DiscountCondition

* DiscountPolicy 
    * Amount DiscountPolicy
    * Percent DiscountPolicy
* DiscountCondition
    * Sequence Condition
    * Period Condition
```

* ìƒì„±ì„ ë³´ë©´ ...

```cpp
Movie* avatar = 
    new Movie(
        "ì•„ë°”íƒ€",
        Duration->ofMinutes(120),
        Money->wons(1000),
        // ì´ëŸ°ì‹ìœ¼ë¡œ ì™¸ë¶€ì—ì„œ ì˜ì¡´ì„±ì„ ì£¼
        new AmountDiscountPolicy(Money->wons(800)))
```