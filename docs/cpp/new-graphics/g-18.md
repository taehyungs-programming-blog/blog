---
layout: default
title: "18. Lighting - 이론"
parent: "(Graphics🌠)"
grand_parent: C++
nav_order: 2
---

## Table of contents
{: .no_toc .text-delta }

1. TOC
{:toc}

---

🙀 사실상... 그냥 아래와 같은게 있다고 알고 있고... 다음강의 코드구현에 집중하자

## 3D Game의 조명(Light)의 종류

😺 사실 빛에는 무한에 가까운 종류가 있다. 하지만 모든 빛을 다 구현할 수 없고 최대한 현실과 유사하면서 최소한의 연산을 사용하게 구현해야하는데... 아래 세 가지 정도를 구현하면 현실과 유사하게 3D환경에서 빛을 구현할 수 있다.

* **diffuse(난반사)** : 빛이 들어온 각도에 따른 난반사광
* **ambient(환경광)** : 주변 환경에 의한 빛 반사
* **specular(정반사)** : 들어온 빛의 각도와 동일한 각의 반사

<p align="center">
  <img src="https://taehyungs-programming-blog.github.io/blog/assets/images/cpp/directx/directx-17-1.png"/>
</p>

😺 위 그림이 이해가 잘되게 설명해 주는데 Ambient(환경광), Diffuse(들어오는 빛의 영향), Specular(정반사 되는 빛의 영향) 👉 요 정도만 이해해도 충분...

😺 이론은 대충이해가 되고 수식으로 표현해 보자면 ...

* 대략적으로 빛을 어떻게 구현할까?
    * 가령 RGB(1, 0, 0)이라는 빛을 반사하는 물체(픽셀)이 있다면
    * RGB(1, 0, 0) * diffuse * ambient * specular = 실제 카메라(우리의 눈)에 보이는 색상 이 된다.(Pixel Shader에서 한다)
    * 따라서 우리가 알아야 할 것은 `diffuse * ambient * specular`을 어떻게 수식으로 표현할 것인가 이다.

## Normal Vector

😺 물체에 수직으로 반사되는 빛(벡터)을 의미한다.

```
 (빛)(L)
 \
  \       (Normal Vector)(N)
   \             |
    \            |
     \           |
      \     (a)  |
                 |
--------------------------------------
            (   물체   )
```

## Diffuse

* 들어온 빛(L)의 각도(a)에 따라 Diffuse(난반사광)은 어떻게 반영될까?
* `cos(a)`로 반영되고(Normal Vector(N)으로 들어오면 cos(a) == 1이 됨 들어온 빛을 그대로 받는다는 말.)
* 그럼 물체의 색상 `RGB * cos(a)`하면 Diffuse의 영향을 받은 색상을 출력가능하다
* `cos(a)`만 구하면 되겠군?
    * `cos(a)`를 구하려면 `a`를 알아야하는데 어떻게 구할까?
    * `-L*N = 1*1*cos(a)` L과 N이 단위 벡터이기에 -L과 N을 내적하면 `cos(a)`를 구할수 있다. (그냥 받아들이는게 맘편할수 있음.)

---

## Ambient

* 빛을 직접받는 부분이 아니더라도 간접적으로 빛을 받을 수 있다.
    * (가령 책상위에 등불이 있고 책상아래 물체가 있다면 빛을 직접적으로 못 받더라도 책상아래 물체는 보이게 된다.)
* 이런 ambient는 연산의 마지막에 특정값을 더해주는 형태로 구현하게 된다.

---

## Specular

```
 (빛)(L)
 \              (정반사)(R)
  \      (N)      /
   \      |      /
    \     |     /
     \    |    /
      \(a)|   /
       \  |  /
--------------------------------------
     (   물체   )
```

* Diffuse가 있는데 Specular를 굳이 구하는 이유? Specular가 가장 강한 반사광이기에 좀 더 현실적인 빛 반사를 보여줄 수 있음.
* 정반사 벡터는 딱 정반사(들어온 각과 동일한 a각으로 반사되는) 되는 벡터의 세기가 가장 세고
* a각으로 정반사 되는 벡터의 `+` or `-` 되는 벡터는 그 만큼 세기가 작아질 것이다.
* 우선 a각으로 정반사 되는 벡터 R을 먼저 구해보자.

```
          (N)
   \-------|
    \      |
     \     |
 (-L) \    | cos(a)
       \(a)|
        \  |
         \ |
```

* `-L`과 `N`은 단위 벡터이고 내적시에 `cos(a)`을 구할수 있었고
    * (더 쉽게는 `-L`이 단위 벡터라 크기가 1이고 밑변이 `cos(a)`가 된다고 생각)
* 우리가 `L`을 알기에 `L`에 `cos(a)` 벡터만 2번 더하면 `R`을 쉽게 구한다.
* 여기까지하면 L + cos(a) + cos(a) = R을 알수 있고
* 이제 R을 토대로 원점 -> Camera까지 빛이 어떻게 들어가는지 봐야한다.

```
(빛)(L)                (카메라)(C)
 \         (정반사)(R)   /
  \      (N)      /    /
   \      |      /    /
    \     |     /    /
     \    |    /    /
      \(a)|   /    /
       \  |  / (b)/
--------------------------------------
     (   물체   )
```

* diffuse구할때 `L` 내적 `N`이 `cos(a)`를 알았듯
* `R` 내적 `C`가 `cos(b)`임을 알수 있다.

* 아직은 이해가 잘 안되지만 코드로 보면 오히려 쉽다

---

## 특정 point에서 들어오는 빛의 계산

* 지금까지 위에서 설명한 값들은 태양 빛 어럼 전역에서 오는 빛을 의미했고
* 특정 POINT(가령 횟불)에서 오는 빛의 값은 빛이오는 위치, 거리 등이 필요하다

```
           /
          /
         /    (물체)
        /
   (광원)
        \
         \
          \
           \
            \
```

* 광원과 물체를 잇는 벡터 A를 정의하고
* 광원에서 수직으로 나가는 단위벡터 L을 A와 내적시 A*L*cos(a)가 되며
* 그 내적 값은 광원과 물체의 x축 거리가 된다
* x축 거리가 멀어지면 빛을 처리할지 말지를 결정해서 빛을 계산하면 된다.
* 광원에서 지원하는 각은 구하기 쉽기에 생략(대략 A와 L의 내적후 나온 cos의 acos하면 각도가 나오고 그 각도가 빛을 지원하는 각인지만 확인하면 됨.)