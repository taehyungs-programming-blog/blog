---
layout: default
title: "26. (C++17) std::variant"
parent: "(C++) ë¬¸ë²•"
grand_parent: (C++)
nav_order: 3
---

## Table of contents
{: .no_toc .text-delta }

1. TOC
{:toc}

---

{% raw %}

* [ì°¸ê³ ì‚¬ì´íŠ¸ ğŸŒ](https://modoocode.com/309)

---

* **ê²°ë¡ ** : ë³€ìˆ˜ì˜ íƒ€ì…ì„ One-ofë¡œ ì§€ì •í•  ìˆ˜ ìˆë‹¤.

```cpp
// v ëŠ” ì´ì œ int
std::variant<int, std::string, double> v = 1;

// v ëŠ” ì´ì œ std::string
v = "abc";

// vëŠ” ì´ì œ double
v = 3.14;
```

* ë„ˆë¬´ ì¢‹ì€ë°?? ğŸ¥ ì´ˆë³´ì ì…ì¥ì—ì„  ì™œ ì¢‹ì€ì§€ ì´í•´ê°€ ì˜ ë˜ì§€ ì•Šì„í…ë° ì•„ë˜ë¥¼ ë³´ì.

```cpp
class Data {};
class A : public Data {};
class B : public Data {};

std::unique_ptr<Data> GetDataFromDB(bool is_a) {
    // íŠ¹ì • ì¡°ê±´ì„ ë§Œì¡±ì‹œ A í˜¹ì€ B í´ë˜ìŠ¤ë¥¼ ë¦¬í„´í•˜ëŠ” í•¨ìˆ˜ê°€ ìˆë‹¤ ê°€ì •í•˜ì
    // ê¸°ì¡´ì—ëŠ” ì´ëŸ° í•¨ìˆ˜ë¥¼ ë§Œë“œë ¤ë¨¼ A, Bì˜ ë¶€ëª¨ë¡œ Dataë¥¼ ë‘ê³  Dataí˜•ìœ¼ë¡œ ë¦¬í„´í–ˆì–´ì•¼ í•œë‹¤.
  if (is_a) {
    return std::make_unique<A>();
  }
  return std::make_unique<B>();
}
```

```cpp
#include <iostream>
#include <memory>
#include <variant>

class A {
 public:
  void a() { std::cout << "I am A" << std::endl; }
};

class B {
 public:
  void b() { std::cout << "I am B" << std::endl; }
};

std::variant<A, B> GetDataFromDB(bool is_a) {
  if (is_a) {
    return A();
  }
  return B();
}

int main() {
  auto v = GetDataFromDB(true);

  std::cout << v.index() << std::endl;
  std::get<A>(v).a();  // í˜¹ì€ std::get<0>(v).a()
}
```

---

## Example

```cpp
#include <variant>
#include <string>
#include <iostream>

int main() {
    std::variant<int, double, std::string> v;
    
    // ê°’ í• ë‹¹
    v = 42;                    // int ì €ì¥
    v = 3.14;                  // double ì €ì¥  
    v = std::string("ì•ˆë…•");    // string ì €ì¥
    
    // std::getìœ¼ë¡œ ê°’ ì ‘ê·¼ (íƒ€ì…ì„ ì •í™•íˆ ì•Œ ë•Œ)
    try {
        int i = std::get<int>(v);           // ì˜ˆì™¸ ë°œìƒ (í˜„ì¬ stringì´ ì €ì¥ë¨)
    } catch (const std::bad_variant_access& e) {
        std::cout << "ì˜ëª»ëœ íƒ€ì… ì ‘ê·¼" << std::endl;
    }
    
    std::string s = std::get<std::string>(v);  // ì„±ê³µ
    std::cout << s << std::endl;
    
    return 0;
}
```

```cpp
#include <variant>
#include <string>
#include <iostream>

int main() {
    std::variant<int, double, std::string> v = 42;
    
    // std::get_ifë¡œ ì•ˆì „í•œ ì ‘ê·¼ (í¬ì¸í„° ë°˜í™˜)
    if (auto* ptr = std::get_if<int>(&v)) {
        std::cout << "ì •ìˆ˜ê°’: " << *ptr << std::endl;
    }
    
    if (auto* ptr = std::get_if<std::string>(&v)) {
        std::cout << "ë¬¸ìì—´ê°’: " << *ptr << std::endl;
    } else {
        std::cout << "ë¬¸ìì—´ì´ ì•„ë‹™ë‹ˆë‹¤" << std::endl;
    }
    
    return 0;
}
```

---

## ì–´ë–»ê²Œ ì´ê²Œ ê°€ëŠ¥í• ê¹Œ?

```cpp
#include <variant>
#include <string>
#include <iostream>

int main() {
    std::variant<char, int, double, std::string> v;
    
    std::cout << "char í¬ê¸°: " << sizeof(char) << std::endl;        // 1
    std::cout << "int í¬ê¸°: " << sizeof(int) << std::endl;          // 4  
    std::cout << "double í¬ê¸°: " << sizeof(double) << std::endl;    // 8
    std::cout << "string í¬ê¸°: " << sizeof(std::string) << std::endl; // ë³´í†µ 24-32
    
    std::cout << "variant í¬ê¸°: " << sizeof(v) << std::endl;        // string í¬ê¸° + ì¶”ê°€ ì •ë³´
    
    return 0;
}
```

* ë‚´ë¶€ êµ¬í˜„ì€ ì´ëŸ¬í•˜ë‹¤

```cpp
// ë‹¨ìˆœí™”ëœ variant êµ¬í˜„ ì˜ˆì‹œ
template<typename... Types>
class simplified_variant {
private:
    // ëª¨ë“  íƒ€ì… ì¤‘ ê°€ì¥ í° í¬ê¸°ë§Œí¼ì˜ ì €ì¥ê³µê°„
    alignas(Types...) char storage[std::max({sizeof(Types)...})];
    
    // í˜„ì¬ ì–´ë–¤ íƒ€ì…ì´ ì €ì¥ë˜ì–´ ìˆëŠ”ì§€ ì¶”ì 
    std::size_t type_index;
    
public:
    template<typename T>
    void assign(T&& value) {
        // ê¸°ì¡´ ê°ì²´ ì†Œë©¸
        destroy_current();
        
        // ìƒˆë¡œìš´ ê°ì²´ë¥¼ placement newë¡œ ìƒì„±
        new (storage) T(std::forward<T>(value));
        
        // íƒ€ì… ì¸ë±ìŠ¤ ì—…ë°ì´íŠ¸
        type_index = get_type_index<T>();
    }
    
private:
    void destroy_current() {
        // í˜„ì¬ ì €ì¥ëœ ê°ì²´ì˜ ì†Œë©¸ì í˜¸ì¶œ
        visit_current([](auto& obj) { obj.~decltype(obj)(); });
    }
};
```

```cpp
#include <variant>
#include <string>
#include <iostream>

int main() {
    std::variant<int, std::string> v;
    
    // 1. ì´ˆê¸° ìƒíƒœ: ì²« ë²ˆì§¸ íƒ€ì…(int)ìœ¼ë¡œ ê¸°ë³¸ ì´ˆê¸°í™”
    std::cout << "ì´ˆê¸° ì¸ë±ìŠ¤: " << v.index() << std::endl;  // 0
    std::cout << "ì´ˆê¸° ê°’: " << std::get<int>(v) << std::endl;  // 0
    
    // 2. string í• ë‹¹
    v = std::string("ì•ˆë…•í•˜ì„¸ìš”");
    std::cout << "string í• ë‹¹ í›„ ì¸ë±ìŠ¤: " << v.index() << std::endl;  // 1
    
    // ë‚´ë¶€ì ìœ¼ë¡œ ì¼ì–´ë‚˜ëŠ” ì¼:
    // - ê¸°ì¡´ int ê°’ ì†Œë©¸ (trivialí•˜ë¯€ë¡œ ì‹¤ì œë¡œëŠ” ì•„ë¬´ê²ƒë„ ì•ˆí•¨)
    // - storage ì˜ì—­ì— placement newë¡œ string ê°ì²´ ìƒì„±
    // - type_indexë¥¼ 1ë¡œ ë³€ê²½
    
    // 3. ë‹¤ì‹œ int í• ë‹¹
    v = 42;
    std::cout << "int í• ë‹¹ í›„ ì¸ë±ìŠ¤: " << v.index() << std::endl;  // 0
    
    // ë‚´ë¶€ì ìœ¼ë¡œ ì¼ì–´ë‚˜ëŠ” ì¼:
    // - ê¸°ì¡´ string ê°ì²´ì˜ ì†Œë©¸ì í˜¸ì¶œ
    // - storage ì˜ì—­ì— int ê°’ ì €ì¥
    // - type_indexë¥¼ 0ìœ¼ë¡œ ë³€ê²½
    
    return 0;
}
```

* ëª¨ë“  íƒ€ì…ì´ **ì„ ì–¸**ë˜ëŠ” ê²ƒì´ ì•„ë‹ˆë¼, ëª¨ë“  íƒ€ì…ì„ ì €ì¥í•  ìˆ˜ ìˆëŠ” ê³µê°„ì´ í• ë‹¹
* ì‹¤ì œ ê°ì²´ëŠ” í•˜ë‚˜ë§Œ ì¡´ì¬í•˜ë©°, íƒ€ì…ì´ ë°”ë€” ë•Œë§ˆë‹¤ **ê¸°ì¡´ ê°ì²´ëŠ” ì†Œë©¸ë˜ê³  ìƒˆ ê°ì²´ê°€ ìƒì„±**
* íƒ€ì… ì •ë³´ëŠ” ëŸ°íƒ€ì„ì— ì¶”ì ë˜ì§€ë§Œ, ê° íƒ€ì…ì— ëŒ€í•œ ì—°ì‚°ë“¤(ìƒì„±ì, ì†Œë©¸ì, ë³µì‚¬ ë“±)ì€ ì»´íŒŒì¼ íƒ€ì„ì— ê²°ì •
* ë©”ëª¨ë¦¬ ì˜¤ë²„í—¤ë“œëŠ” ê°€ì¥ **í° íƒ€ì…ì˜ í¬ê¸° + íƒ€ì… ì¸ë±ìŠ¤ ì €ì¥ ê³µê°„** ì •ë„
* ì´ëŸ° ë°©ì‹ìœ¼ë¡œ std::variantëŠ” íƒ€ì… ì•ˆì „ì„±ì„ ë³´ì¥í•˜ë©´ì„œë„ íš¨ìœ¨ì ì¸ ë©”ëª¨ë¦¬ ì‚¬ìš©

{% endraw %}