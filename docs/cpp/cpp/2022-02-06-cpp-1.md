---
layout: default
title: "1. std::unique_ptr"
parent: "(C++) ë¬¸ë²•"
grand_parent: (C++)
nav_order: 1
---

## Table of contents
{: .no_toc .text-delta }

1. TOC
{:toc}

---

##  Unique_ptrì´ë€?

* ë©”ëª¨ë¦¬ì£¼ì†Œì˜ ì°¸ì¡°ë¥¼ ë…ì í•  ìˆ˜ ìˆëŠ” í¬ì¸í„°
* ì™œì“°ë‚˜? êµ³ì´ ì†Œë©¸ìë¥¼ í˜¸ì¶œí•˜ì§€ ì•Šì•„ë„ ë˜ëŠ” ì¥ì ì´ ìˆë‹¤! (**ë©”ëª¨ë¦¬ë¦­ ì•ˆì •ì„± ë³´ì¥!**)

```cpp
// Example

struct point {
    int x;
    int y;
};

int main() {
    auto p{ make_unique<point>( point{3, 6} ) };
    // í˜¹ì€
    // unique_ptr<point> p{ new point{3, 6} };
    cout << p->x << ", " << p->y << endl;
}
```

```cpp
// Example2 - ë­ ì´ëŸ°ì‹ìœ¼ë¡œë„ ì“°ì¸ë‹¤ê³  ë°›ì•„ë“¤ì´ì.

struct point {
    int x;
    int y;
};

unique_ptr<point> create_ptr() { 
    point p{0};
    p.x = 3; p.y = 6;   
    unique_ptr<point> ptr = make_unique<point>(p);
    return ptr;
}

int main() {
    unique_ptr<point> upp { create_ptr() };
    cout << upp->x << ", " << upp->y << endl;
}
```

---

## unique_ptrì„ ì“°ë‹¤ê°€ shared_ptrë¡œ ì˜®ê²¨ì•¼ í•˜ëŠ” ì¼€ì´ìŠ¤ëŠ”?

```cpp
class Car
{
    int color;
    int speed;
public:
    ~Car() { cout << "~Car()" << endl; }
    void Go() { cout << "Car go" << endl; }
};

int main()
{
    shared_ptr<Car> sp1(new Car);
    shared_ptr<Car> sp2 = sp1;      // ì°¸ì¡° ê³„ìˆ˜ 2
    unique_ptr<Car> up1(new Car);   // ìì› ë…ì 
    unique_ptr<Car> up2 = up1;      // error
}
```

```cpp
unique_ptr<int> up1(new int);
unique_ptr<int> up2 = move(up1);        // ok.
shared_ptr<int> sp2 = move(up2);        // ok.
```

ğŸˆ ë‹¨, `shared_ptr` -> `unique_ptr`ì€ ì•ˆë¨

```cpp
shared_ptr<int> sp(new int);
unique_ptr<int> up(new int);

shared_ptr<int> sp1 = up;       // error
shared_ptr<int> sp2 = move(up); // ok

unique_ptr<int> up1 = sp;       // error
unique_ptr<int> up2 = move(sp); // error
```

---

## ë³„ë„ì˜ ì‚­ì œì ì„ ì–¸?

```cpp
#include <iostream>
#include <memory>
using namespace std;

struct Deleter
{
    void operator()(int* p) const
    {
        delete p;
    }
}

int main()
{
    unique_ptr<int> up1(new int);
    // ì‚­ì œìëŠ” ì´ë ‡ê²Œ ì„ ì–¸
    unique_ptr<int, Deleter> up(new int);
    // ì´ëŸ° ì‚­ì œìë„ ê°€ëŠ¥ - 1
    unique_ptr<int, void(*)(int*)> up(new int, foo);
    // ì´ëŸ° ì‚­ì œìë„ ê°€ëŠ¥ - 2
    auto f = [](int*p){delete p;}
    unique_ptr<int, decltype(f)> up(new int, f);
}
```

---

## ë°°ì—´ë¡œ ì„ ì–¸, ì‚­ì œ

```cpp
unique_ptr<uint8_t[]> mp_array;
// ì„ ì–¸
mp_array = std::make_unique<uint8_t[]>(48000 * 8);
// uint8_t* ì˜ í˜¸ì¶œì´ í•„ìš”í•  ê²½ìš°
&mp_array[0];
```

```cpp
// (C++11)
unique_ptr<int[]> up(new int[10]);
```

---

## newì™€ make_unique ì°¨ì´?

* [ì°¸ê³  ì‚¬ì´íŠ¸ ğŸŒ](https://11reviewer.tistory.com/54)

```cpp
std::shared_ptr<Widget> spw(new Widget);
```

* **new í• ë‹¹** - ë©”ëª¨ë¦¬ë¥¼ ë‘ ë²ˆ í• ë‹¹í•˜ê²Œ ëœë‹¤. 1ë²ˆ(ë°ì´í„°ë¥¼ ë‹´ëŠ” ë©”ëª¨ë¦¬ ë¸”ëŸ­), 2ë²ˆ(ì œì–´ë¥¼ ë‹´ë‹¹í•˜ëŠ” ë¸”ëŸ­) -> ë©”ëª¨ë¦¬ë¥¼ íš¨ìœ¨ì ìœ¼ë¡œ ì“´ë‹¤ê³  ë³´ê¸° í˜ë“¤ë‹¤.
* **make_unique í• ë‹¹** - ë©”ëª¨ë¦¬ë¥¼ í•œ ë²ˆì— í• ë‹¹í•œë‹¤. ë°ì´í„°ì™€ ì œì–´ë¸”ë¡ì„ í•œ ë²ˆì— í• ë‹¹í•¨.
