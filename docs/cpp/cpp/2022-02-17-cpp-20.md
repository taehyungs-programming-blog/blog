---
layout: default
title: "20. function object"
parent: "(C++) ë¬¸ë²•"
grand_parent: (C++)
nav_order: 3
---

## Table of contents
{: .no_toc .text-delta }

1. TOC
{:toc}

---

## function object ë§Œë“¤ê¸° ê¸°ì´ˆ

* **function object, functor(í•¨ìˆ˜ ê°ì²´)**
    * `()`ë¥¼ ì‚¬ìš©í•˜ì—¬ ë§ˆì¹˜ í•¨ìˆ˜ì²˜ëŸ¼ ì‚¬ìš©ë˜ëŠ” ê°ì²´

```cpp
// function objectë¥¼ ëŒ€ëµ ì´ë ‡ê²Œ ì‚¬ìš©í•œë‹¤ê³  ì•Œê³ ìˆë‹¤.

#include <iostream>
#include <functional>

template<class T>
struct plus
{
    // (C++17) [[nodiscard]] ë¦¬í„´ê°’ì´ ë¬´ì‹œë˜ë©´ warningì„ ë„ì›Œë‹¬ë¼
	[[nodiscard]] constexpr /* (C++11) ì»´íŒŒì¼íƒ€ì„ì— ê²°ê³¼ ë„ì¶œí•´ë‹¬ë¼ */
	T operator()(const T& arg1, const T& arg2) const /*constë¥¼ ë¶™ì¸ì´ìœ ëŠ” constê°ì²´(const plus<int> p;)ë¼ë„ ì‚¬ìš©ì´ ê°€ëŠ¥í•˜ê²Œ í•˜ë ¤ê³  ë¶™ì„*/ 
	{
		return arg1 + arg2;
	}
};

int main()
{
//	const plus<int> p;					
	std::plus<int> p;

	p(3, 4);

	int n = p(1, 2);					

	std::cout << n << std::endl;
}
```

* ì •ë¦¬í•˜ìë©´ function objectë¥¼ ë§Œë“¤ë•ŒëŠ”
    * C++17 ì´ìƒì€ `[[nodiscard]]`ì„ ë¶™ì´ëŠ”ê²Œ ì¢‹ë‹¤
    * C++11 ì´ìƒì€ `constexpr`ë¥¼ ë¶™ì´ëŠ”ê²Œ ì¢‹ë‹¤
    * `const`ë¥¼ ë¶™ì—¬ì„œ ìƒìˆ˜ ê°ì²´ í•¨ìˆ˜ë„ ì²˜ë¦¬í•˜ê²Œ í•˜ë©´ ì¢‹ë‹¤

---

## í•¨ìˆ˜ ê°ì²´ì˜ íŠ¹ì§• 1. ìƒíƒœë¥¼ ê°–ëŠ”ë‹¤

```cpp
#include <iostream>

int urand()
{
    // ë§Œì•½ ì¤‘ë³µë˜ì§€ ì•ŠëŠ” ë‚œìˆ˜ë¥¼ ë§Œë“¤ê³ ì í•œë‹¤ë©´?
        // ì§€ë‚œë²ˆì— ë‚˜ì™”ë˜ ë‚œìˆ˜ë¥¼ ì €ì¥í•´ ë‘¬ì•¼ í•œë‹¤.(ìƒíƒœë¥¼ ê°–ì–´ì•¼í•œë‹¤.)
	return rand() % 10;
}

int main()
{
	for ( int i = 0; i < 10; i++)
		std::cout << urand() << ", ";

	std::cout << std::endl;
}
```

```cpp
// ì¼ë‹¨ urand() ìì²´ë¥¼ ê°ì²´ë¡œ ë§Œë“¤ì–´ ë³´ì.

#include <iostream>

class URandom
{
	// member data
public:
	int operator()()
	{
		return rand() % 10;
	}
};

URandom urand;

int main()
{
	for ( int i = 0; i < 10; i++)
		std::cout << urand() << ", ";

	std::cout << std::endl;
}
```

```cpp
// ë‚´ë¶€ ì•Œê³ ë¦¬ì¦˜ì— ì£¼ëª©í•˜ì§€ë§ê³  function objectê°€ ìƒíƒœë¥¼ ê°–ëŠ”ë‹¤ì— ì£¼ëª©í•˜ì

#include <iostream>
#include <bitset>

class URandom
{
	std::bitset<10> bs; // 10ê°œì˜ bitë¥¼ ì¤€ë¹„í•´ì£¼ì„¸ìš”
	bool recycle;

    std::mt19937 randgen{std::random_device{}()};
public:
	URandom(bool recycle = false) : recycle(recycle)
	{
		bs.set();   // ëª¨ë“  ë¹„íŠ¸ë¥¼ 1ë¡œ ì„¸íŒ…
	}

	int operator()()
	{
        if (bs.none())
        {
            if(recycle)
                bs.set();
            else
                return -1;
        }
        int k = -1;
        while(!bs.test(k=dist(randgen)));   // 0 ì¸ì§€ ì²´í¬
        bs.reset(k);    // k ë²ˆì§¸ë¥¼ 0ìœ¼ë¡œ
		
        return k;
	}
};
URandom urand;

int main()
{
	for ( int i = 0; i < 10; i++)
		std::cout << urand() << ", ";

	std::cout << std::endl;
}
```

---

## í•¨ìˆ˜ ê°ì²´ì˜ íŠ¹ì§• 2. ì¸ë¼ì¸ ì¹˜í™˜

* **ì¸ë¼ì¸ í•¨ìˆ˜** : ì»´íŒŒì¼ ì‹œì— í•¨ìˆ˜ í˜¸ì¶œì‹ì„ í•¨ìˆ˜ ê¸°ê³„ì–´ ì½”ë“œë¡œ ì¹˜í™˜

```cpp
int add1(int a, int b)
{
	return a + b;
}

inline int add2(int a, int b)
{
	return a + b;
}

int main()
{
	int ret1 = add1(1, 2); // í˜¸ì¶œ
	int ret2 = add2(1, 2); // ì¹˜í™˜

	int(*f)(int, int) = &add2;


	f(1, 2); // í˜¸ì¶œ - ì»´íŒŒì¼ì‹œê°„ì— fê°€ ë­˜ë¡œ ì§€ì •ë ì§€ ì•Œìˆ˜ê°€ ì—†ìŒ
    //	if ( ì‚¬ìš©ìì…ë ¥ == 1) f = &add1; // ì´ëŸ´ìˆ˜ê°€ ìˆê¸° ë•Œë¬¸ì—
}
```

```cpp
#include <iostream>
#include <algorithm>

// ë¹„êµì •ì±…ì„ ë™ì ìœ¼ë¡œ ë°”ê¿”ë³´ì.
void sort(int* x, int sz, bool(*cmp)(int, int) )
{
	for( int i = 0; i < sz-1; i++)
	{
		for ( int j = i + 1; j < sz; j++)
		{
		    //	if ( x[i] > x[j] )
            // ë‹¨ì ) ë‹¨ìˆœ ë¹„êµì— ë¹„í•´ í•¨ìˆ˜í˜¸ì¶œì€ í™•ì—°í•˜ê²Œ ì†ë„ê°€ ëŠë¦¬ë‹¤.
			if ( cmp(x[i], x[j]) )
				std::swap(x[i], x[j]);
		}
	}
}

// ì—¬ê¸° inlineì„ ë„£ëŠ”ë‹¤ê³  inlineìœ¼ë¡œ ë™ì‘í• ê¹Œ?
    // Nope! í•¨ìˆ˜ í¬ì¸í„°ì— ë„£ëŠ”ë‹¤ë©´ ì¸ë¼ì¸ ì¹˜í™˜ì´ ì•ˆëœë‹¤.
inline bool cmp1(int a, int b) { return a < b;}
inline bool cmp2(int a, int b) { return a > b;}

int main()
{
	int x[10] = {1,3,5,7,9,2,4,6,8,10};

//	sort(x, 10, &cmp1);
	sort(x, 10, &cmp2);

	for( auto e : x)
		std::cout << e << ", ";
}
```

```cpp
#include <iostream>
#include <algorithm>

struct Less    
{ 
	inline bool operator()(int a, int b) const { return a < b; } 
};

struct Greater 
{
	inline bool operator()(int a, int b) const { return a > b; }
};

//void sort(int* x, int sz, bool(*cmp)(int, int) )
//void sort(int* x, int sz, Less cmp )

template<class T> 
void sort(int* x, int sz, T cmp )
{
	for( int i = 0; i < sz-1; i++)
	{
		for ( int j = i + 1; j < sz; j++)
		{
			if ( cmp(x[i], x[j]) )
				std::swap(x[i], x[j]);
		}
	}
}

int main()
{
	int x[10] = {1,3,5,7,9,2,4,6,8,10};
	Less 	f1; f1(1, 2); 
    sort(x, 10, f1); // ok - T = Lessê°€ ëœë‹¤. And inline ì¹˜í™˜ëœë‹¤.

	Greater f2; f2(1, 2); 
    sort(x, 10, f2); // ok - T = Greaterê°€ ëœë‹¤. And inline ì¹˜í™˜ëœë‹¤.
}
```

```cpp
#include <iostream>
#include <algorithm>

inline bool cmp1(int a, int b) { return a < b;}
inline bool cmp2(int a, int b) { return a > b;}
struct Less 	{ inline bool operator()(int a, int b) const { return a < b; }};
struct Greater  { inline bool operator()(int a, int b) const { return a > b; }};

template<class T> 
void sort(int* x, int sz, T cmp )
{
	for( int i = 0; i < sz-1; i++)
	{
		for ( int j = i + 1; j < sz; j++)
		{
			if ( cmp(x[i], x[j]) )
				std::swap(x[i], x[j]);
		}
	}
}
int main()
{
	int x[10] = {1,3,5,7,9,2,4,6,8,10};
	Less 	f1;
	Greater f2;
    
    // ì•„ë˜ì²˜ëŸ¼ ì‚¬ìš©í•˜ë©´ T = bool(*cmp)(int, int)ê°€ ëœë‹¤.
        // í•¨ìˆ˜ í¬ì¸í„°ì´ê¸°ì— inline ë¶ˆê°€
	sort(x, 10, &cmp1);
	sort(x, 10, &cmp2);

    // ì•„ë˜ì²˜ëŸ¼ ì‚¬ìš©í•˜ë©´ T = Less, T = Greater ê°€ ëœë‹¤. inlineê°€ëŠ¥!
	sort(x, 10, f1);
	sort(x, 10, f2);
}
```

* ìœ„ ì½”ë“œë¥¼ [Compile Explorer ğŸŒ](https://godbolt.org/)ì—ì„œ ë³´ì.
    * ë‹¨, ê¸°ë³¸ì ìœ¼ë¡œ inlineì„ ì§€ì›í•˜ì§€ ì•Šê¸°ì— ë‹¤ìŒê³¼ ê°™ì€ ì˜µì…˜ì„ ì¤˜ì•¼í•œë‹¤.
    * msvc(cl) ì»´íŒŒì¼ëŸ¬ + /Ob1
    * `x64 msvc v19.latest`, `/Ob1`
* í™•ì¸í•´ë³¼ ì‚¬í•­
    * sortí•¨ìˆ˜ê°€ ëª‡ê°œ ë§Œë“¤ì–´ ì¡ŒëŠ”ì§€
    * inlineì´ ì œëŒ€ë¡œ (callì´ ì•ˆë¶ˆë¦¬ëŠ”ì§€)