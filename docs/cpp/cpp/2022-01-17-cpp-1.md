---
layout: default
title: "1. unique_ptr"
parent: (C++)
grand_parent: C++
nav_order: 1
---

## Table of contents
{: .no_toc .text-delta }

1. TOC
{:toc}

---

* ì´ë ‡ê²Œë§Œ ê¸°ì–µí•´ë„ 90ì ì€ ë°›ëŠ”ë‹¤
    * í•´ë‹¹ í´ë˜ìŠ¤ì—ì„œ ì‚¬ìš©í•˜ëŠ” í¬ì¸í„° ğŸ‘‰ `unique_ptr`
    * ë‹¤ë¥¸ í´ë˜ìŠ¤ì—ì„œ ì°¸ì¡°í•´ì•¼í•  í¬ì¸í„° ğŸ‘‰ `shared_ptr`

```cpp
// Example
#include <iostream>
#include <memory>
using namespace std;

class cl1
{
public:
    cl1() { cout << "cl1()" << endl; }
    ~cl1() { cout << "~cl1()" << endl; } 
    void printCL1() { cout << "Hello This is CL!" << endl; }
};

class parent1
{
public:
    parent1(int num) { cout << "parent1() : " << num << endl; m_num = num; }
    ~parent1() { cout << "~parent1() : " << m_num  << endl; }
    void SetCL1(shared_ptr<cl1> _cl1) { m_cl1 = _cl1; }
    void PrintCL1() { m_cl1->printCL1(); }
private:
    shared_ptr<cl1> m_cl1;
    int m_num = -1;
};

int main() {
    // your code goes here
    shared_ptr<cl1> m_cl1 = make_shared<cl1>();
    unique_ptr<parent1> m_pr1 = make_unique<parent1>(1);
    parent1* m_pr2 = new parent1(2);
    m_pr1->SetCL1(m_cl1);
    m_pr2->SetCL1(m_cl1);
    m_pr1->PrintCL1();
    m_pr2->PrintCL1();
    return 0;
}
```

```
cl1()
parent1() : 1
parent1() : 2
Hello This is CL!
Hello This is CL!
~parent1() : 1
```

<br>

---

ì´ë ‡ê²Œ ëë‚´ê¸´ ì•„ì‰¬ìš°ë‹ˆ...

##  Unique_ptrì´ë€?

* ë©”ëª¨ë¦¬ì£¼ì†Œì˜ ì°¸ì¡°ë¥¼ ë…ì í•  ìˆ˜ ìˆëŠ” í¬ì¸í„°
* ì™œì“°ë‚˜? êµ³ì´ ì†Œë©¸ìë¥¼ í˜¸ì¶œí•˜ì§€ ì•Šì•„ë„ ë˜ëŠ” ì¥ì ì´ ìˆë‹¤!(ë©”ëª¨ë¦¬ë¦­ ì•ˆì •ì„± ë³´ì¥!)

```cpp
// Example

struct point {
    int x;
    int y;
};

int main() {
    auto p{ make_unique<point>( point{3, 6} ) };
    // í˜¹ì€
    // unique_ptr<point> p{ new point{3, 6} };
    cout << p->x << ", " << p->y << endl;
}
```

```cpp
// Example2 - ë­ ì´ëŸ°ì‹ìœ¼ë¡œë„ ì“°ì¸ë‹¤ê³  ë°›ì•„ë“¤ì´ì.

struct point {
    int x;
    int y;
};

unique_ptr<point> create_ptr() { 
    point p{0};
    p.x = 3; p.y = 6;   
    unique_ptr<point> ptr = make_unique<point>(p);
    return ptr;
}

int main() {
    unique_ptr<point> upp { create_ptr() };
    cout << upp->x << ", " << upp->y << endl;
}
```

---

## unique_ptrì„ ì“°ë‹¤ê°€ shared_ptrë¡œ ì˜®ê²¨ì•¼ í•˜ëŠ” ì¼€ì´ìŠ¤ëŠ”?

```cpp
class Car
{
    int color;
    int speed;
public:
    ~Car() { cout << "~Car()" << endl; }
    void Go() { cout << "Car go" << endl; }
};

int main()
{
    shared_ptr<Car> sp1(new Car);
    shared_ptr<Car> sp2 = sp1;      // ì°¸ì¡° ê³„ìˆ˜ 2
    unique_ptr<Car> up1(new Car);   // ìì› ë…ì 
    unique_ptr<Car> up2 = up1;      // error
}
```

```cpp
unique_ptr<int> up1(new int);
unique_ptr<int> up2 = move(up1);        // ok.
shared_ptr<int> sp2 = move(up2);        // ok.
```

ë‹¨, `shared_ptr` -> `unique_ptr`ì€ ì•ˆë¨

```cpp
shared_ptr<int> sp(new int);
unique_ptr<int> up(new int);

shared_ptr<int> sp1 = up;       // error
shared_ptr<int> sp2 = move(up); // ok

unique_ptr<int> up1 = sp;       // error
unique_ptr<int> up2 = move(sp); // error
```

---

## ë³„ë„ì˜ ì‚­ì œì ì„ ì–¸?

```cpp
#include <iostream>
#include <memory>
using namespace std;

struct Deleter
{
    void operator()(int* p) const
    {
        delete p;
    }
}

int main()
{
    unique_ptr<int> up1(new int);
    // ì‚­ì œìëŠ” ì´ë ‡ê²Œ ì„ ì–¸
    unique_ptr<int, Deleter> up(new int);
    // ì´ëŸ° ì‚­ì œìë„ ê°€ëŠ¥ - 1
    unique_ptr<int, void(*)(int*)> up(new int, foo);
    // ì´ëŸ° ì‚­ì œìë„ ê°€ëŠ¥ - 2
    auto f = [](int*p){delete p;}
    unique_ptr<int, decltype(f)> up(new int, f);
}
```

---

## ë°°ì—´ë¡œ ì„ ì–¸, ì‚­ì œ

```cpp
unique_ptr<uint8_t[]> mp_array;
// ì„ ì–¸
mp_array = std::make_unique<uint8_t[]>(48000 * 8);
// uint8_t* ì˜ í˜¸ì¶œì´ í•„ìš”í•  ê²½ìš°
&mp_array[0];
```

```cpp
// (C++11)
unique_ptr<int[]> up(new int[10]);
```