---
layout: default
title: "16. r-value reference"
parent: (C++)
grand_parent: C++
nav_order: 2
---

## Table of contents
{: .no_toc .text-delta }

1. TOC
{:toc}

---

* **r-value**
    * **ë“±í˜¸(=)ì˜ ì™¼ìª½**ì— ì˜¬ ìˆ˜ ì—†ë‹¤.
    * **ì´ë¦„ì´ ì—†ê³ **, ë‹¨ì¼ ì‹ì—ì„œë§Œ ì‚¬ìš©ëœë‹¤.
    * ì£¼ì†Œì—°ì‚°ìë¡œ **ì£¼ì†Œë¥¼ êµ¬í• ìˆ˜ ì—†ë‹¤.**
    * Ex) ê°’ì„ ë°˜í™˜í•˜ëŠ” í•¨ìˆ˜, ì‹¤ìˆ˜/ì •ìˆ˜ literal, ì„ì‹œê°ì²´

```cpp
#include <iostream>

int x = 10;
int  f1() { return x;} // "10"(ê°’) ì„ ë°˜í™˜
int& f2() { return x;} // xì˜ ë³„ëª…(ì£¼ì†Œ) ë°˜í™˜ 

int main()
{
	int v1 = 0, v2 = 0;

	v1 = 10; // ok     v1 : lvalue - =ì˜ ì™¼ìª½ì— ì˜¬ ìˆ˜ ìˆë‹¤.
//	10 = v1; // error  10 : rvalue - =ì˜ ì™¼ìª½ì— ì˜¬ ìˆ˜ ì—†ë‹¤.
	v2 = v1;

	int* p1 = &v1; // ok
//	int* p2 = &10; // error

//	f1() = 20; // 10 = 20  error
	f2() = 20; // x = 20   ok


	const int c = 10;
    //	c = 20; // error. 
        // immutable  lvalue

//	Point(1,2).set(10,20);

	10 = 20; // error. 10ì€ lvalue ê°€ ì•„ë‹ˆë‹¤.
	"aa"[0] = 'x'; // error. lvalue ë¬¸ì œê°€ ì•„ë‹ˆë¼
				   // const char[3] ì´ë¯€ë¡œ
}
```

```cpp
#include <iostream>

int main()
{
	int n = 3;

	n = 10;			// ok
	n + 2 = 10;		// error
	n + 2 * 3 = 10; // error

	(n = 20) = 10;	// ok 
	++n = 10;		// ok
	n++ = 10;		// error
}
```

```cpp
#include <iostream>
#include <type_traits>

#define value_category(...)													\
			if ( std::is_lvalue_reference_v<decltype((__VA_ARGS__))> )		\
				std::cout << "lvalue" << std::endl;							\
			else if (std::is_rvalue_reference_v<decltype((__VA_ARGS__))>)	\
				std::cout << "rvalue(xvalue)" << std::endl;					\
			else                                                            \
				std::cout << "rvalue(prvalue)" << std::endl;

int main()
{
	int n = 10;

	value_category(n);      // lvalue
	value_category(n+2);    // rvalue(prvalue)
	value_category(++n);    // lvalue
	value_category(n++);    // rvalue(prvalue)
	value_category(10);     // rvalue(prvalue)
	value_category("AA");   // lvalue

}
```

* [Run This Code ğŸŒ](https://www.onlinegdb.com/online_c++_compiler)

---

```cpp
int main()
{
	int n = 3;

	int& r1 = n; // ok
	int& r2 = 3; // error

    // constê°€ ë¶™ì–´ìˆë‹¤ë©´ l, rì´ë“  ë°›ì„ìˆ˜ ìˆìŒ.
        // ë‹¨, ìƒìˆ˜ì„±ì´ ì¶”ê°€ëœë‹¤.
	const int& r3 = n; // ok
	const int& r4 = 3; // ok
	
	// C++11 - &&(r-value reference) - r-valueë¥¼ ìƒìˆ˜ì„± ì—†ì´ ë°›ì„ ìˆ˜ ìˆë‹¤.
	int&& r5 = n; // error
	int&& r6 = 3; // ok
}
```

* reference ê·œì¹™
    * const l-valueëŠ” r, l valueë¥¼ ëª¨ë‘ ë°›ì„ ìˆ˜ ìˆë‹¤.
    * r-value referenceëŠ” r-valueë§Œ ë°›ì„ ìˆ˜ ìˆë‹¤.

```cpp
#include <iostream>

class X{};

void foo(X  x)       { std::cout << "X" << std::endl;}          // 0
void foo(X& x)       { std::cout << "X&" << std::endl;}			// 1
void foo(const X& x) { std::cout << "const X&" << std::endl;}	// 2
void foo(X&& x)      { std::cout << "X&&" << std::endl;}		// 3
void foo(const X&& x){ std::cout << "const X&&" << std::endl;}  // 4 - ì“°ì¼ì¼ì´ ì—†ìŒ.

int main()
{
	X x;
	foo( x ); 	// l-value
                // 1ì´ ìš°ì„ ë¨(1ì´ ì—†ë‹¤ë©´ 2ë¡œ)

	foo( X() );	// r-value
				// 0, 3ë²ˆ ì¤‘ ì–´ë””ë¡œ ê°ˆì§€ ëª°ë¼ Error
                // 0ì´ ì—†ë‹¤ë©´ 3ìœ¼ë¡œ
}
```

```cpp
#include <iostream>

class X{};

void foo(X& x)       { std::cout << "X&" << std::endl;}			// 1
void foo(const X& x) { std::cout << "const X&" << std::endl;}	// 2
void foo(X&& x)      { std::cout << "X&&" << std::endl;}		// 3

int main()
{
	foo( X() ); // 3ë²ˆ

	X&& rx = X();

	foo(rx); // 1 - ??? 3ë²ˆìœ¼ë¡œ ê°ˆì¤„ì•Œì•˜ëŠ”ë°?
             // rxìì²´ëŠ” ì´ë¦„ì´ ìˆê³  ë‹¨ì¼ì‹ì„ ë²—ì–´ë‚˜ê¸°ì— l-valueì´ë‹¤.

	// lvalue => rvalue ìºìŠ¤íŒ…í•˜ë©´ 3ë²ˆ
	foo(static_cast<X&&>(rx)); // 3
}
```

---

```cpp
int main()
{
    int n = 3;
    int&  lr = n;       // lvalue reference
    int&& rr = 3;       // rvalue reference

//    int& & ref2ref = lr; // error
    // & &ì€ ë§ˆì¹˜ ** í¬ì¸í„°ì˜ í¬ì¸í„° ì²˜ëŸ¼ ë ˆí¼ëŸ°ìŠ¤ì˜ ë ˆí¼ëŸ°ìŠ¤ ì„ ì–¸ì´ ëœë‹¤.
    // C++ì€ ë ˆí¼ëŸ°ìŠ¤ì˜ ë ˆí¼ëŸ°ìŠ¤ëŠ” ì§€ì›í•˜ì§€ ì•ŠëŠ”ë‹¤.
        // ë‹¨, int & &ê³¼ ê°™ì€ í‘œê¸°ë¥¼ ì§ì ‘ ì‘ì„±í•˜ë©´ ì—ëŸ¬ë¡œ ì²˜ë¦¬í•˜ë‚˜
        // type deduction ì¤‘ì— ë‚˜íƒ€ë‚˜ë©´ reference collapsing ê·œì¹™ì— ë”°ë¼ ì•„ë˜ì™€ ê°™ì´ ì²˜ë¦¬ëœë‹¤.

    decltype(lr)&  r1 = n; // int&  &   => int&
    decltype(lr)&& r2 = n; // int&  &&  => int&
    decltype(rr)&  r3 = n; // int&&  &  => int&
    decltype(rr)&& r4 = 3; // int&&  && => int&& (2ê°œ + 2ê°œ = 2ê°œ -> ì´ê±°ë§Œ ìƒê°í•˜ë©´ ë¨ ë‚˜ë¨¸ì§„ ë‹¤ 1ê°œ)
}
```

```cpp
// Example

template<typename T> void foo(T&& arg) 
{    
}

int main()
{
    int n = 10;

    typedef int& LREF;
    LREF&& r1 = n; // int& && => int& 

    using RREF = int&&;
    RREF&& r2 = 10; // int&& && => int&&

    decltype(r2)&& r3 = 10; // int&& && => int&& 

    foo<int&>( n ); // foo( int& && arg )
                    // foo( int& arg ) ì˜ í•¨ìˆ˜ ìƒì„±
                    // 
}
```
