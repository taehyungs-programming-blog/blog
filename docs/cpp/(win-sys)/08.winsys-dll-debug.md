---
layout: default
title: "08. Dll Debug"
parent: "(Windows System Programming)"
grand_parent: "(C++)"
nav_order: 1
---

## Table of contents
{: .no_toc .text-delta }

1. TOC
{:toc}

---

* Visual Studio 기준
    * 프로젝트 -> 속성 -> 디버깅 -> 명령(Command)에 .exe위치 지정
* Rider 기준
    * 프로젝트 -> 속성 -> Local Debugger -> Command 등 세팅

---

## 복습) MT MD

* Microsoft Visual C++ 컴파일러에서 /MD와 /MT는 C/C++ 런타임 라이브러리(CRT)를 어떻게 링크할지 결정하는 옵션

| 옵션 | 이름 | 설명 |
|:---|:---|:---|
| /MD | Multi-threaded DLL | 런타임 라이브러리를 동적 링크 (DLL 사용) |
| /MDd | Multi-threaded DLL Debug | 디버그용 동적 링크 |
| /MT | Multi-threaded | 런타임 라이브러리를 정적 링크 (EXE에 포함) |
| /MTd | Multi-threaded Debug | 디버그용 정적 링크 |

### Static Lib CRT 권장 이유 

* CRT Debug 기능 안정성
    * **/MD (Shared DLL)** → CRT Debug 기능이 제대로 작동하지 않을 수 있음
    * **/MT (Static Lib)** → 누수 체크 등 Debug 기능이 안정적으로 작동
* 디버깅 편의성
    * 각 EXE/DLL마다 자료구조와 코드가 분리됨
    * **다른 모듈의 코드 진행에 방해받지 않고 디버깅 가능**
* 배포 간소화
    * /MD → **vcredist 패키지 별도 배포 필요** (이 이슈가 제일 큼)
    * /MT → 단독 실행 파일로 배포 가능

### CRT Debug 사용 가능한 옵션

| 옵션 | CRT Debug 사용 |
|:---|:---|
| /MD | ❌ 불가 |
| /MDd | ✅ 가능 |
| /MT | ❌ 불가 |
| /MTd | ✅ 가능 |

### CRT 링크 방식 비교

| 구분 | Static Lib CRT (/MT) | Shared DLL CRT (/MD) |
|:---|:---|:---|
| 링크 방식 | 각 DLL/EXE에 CRT 코드 포함 | CRT를 별도 DLL로 공유 |
| 파일 크기 | 큼 (각각 CRT 포함) | 작음 |
| 배포 | 단독 배포 가능 | vcredist 패키지 필요 |
| VS 기본값 | ❌ | ✅ (기본 설정) |

### CRT Heap 동작 방식 (버전별 변화)

```
// Visual Studio 2010 이하 (msvcr 10.0 까지)
┌─────────────────────────────────────────────────────┐
│  Static Lib CRT (/MT)                               │
│  ┌──────────┐  ┌──────────┐  ┌──────────┐          │
│  │  EXE     │  │  DLL A   │  │  DLL B   │          │
│  │ ──────── │  │ ──────── │  │ ──────── │          │
│  │  Heap 1  │  │  Heap 2  │  │  Heap 3  │  ← 각각 다른 Heap │
│  └──────────┘  └──────────┘  └──────────┘          │
└─────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────┐
│  Shared DLL CRT (/MD)                               │
│  ┌──────────┐  ┌──────────┐  ┌──────────┐          │
│  │  EXE     │  │  DLL A   │  │  DLL B   │          │
│  └────┬─────┘  └────┬─────┘  └────┬─────┘          │
│       │             │             │                 │
│       └─────────────┼─────────────┘                 │
│                     ▼                               │
│              ┌──────────┐                           │
│              │ 공유 Heap │  ← 하나의 Heap 공유       │
│              └──────────┘                           │
└─────────────────────────────────────────────────────┘
```

```
// Visual Studio 2012 이상 (msvcr 11.0 부터)
┌─────────────────────────────────────────────────────┐
│  Static Lib CRT (/MT) - VS2012+                     │
│  ┌──────────┐  ┌──────────┐  ┌──────────┐          │
│  │  EXE     │  │  DLL A   │  │  DLL B   │          │
│  └────┬─────┘  └────┬─────┘  └────┬─────┘          │
│       │             │             │                 │
│       └─────────────┼─────────────┘                 │
│                     ▼                               │
│           ┌────────────────┐                        │
│           │ Process 기본 Heap │  ← 모두 같은 Heap!   │
│           └────────────────┘                        │
└─────────────────────────────────────────────────────┘
```

