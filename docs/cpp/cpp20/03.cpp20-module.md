---
layout: default
title: 3. Module
parent: (C++20)
grand_parent: (C++)
nav_order: 1
---

## Table of contents
{: .no_toc .text-delta }

1. TOC
{:toc}

---

ğŸ˜¾ C++20ì˜ ìƒˆë¡œìš´ ê¸°ëŠ¥ì¤‘ ê°€ì¥ ì¤‘ìš”í•œ ê¸°ëŠ¥ì¤‘ í•˜ë‚˜ì…ë‹ˆë‹¤. (ì§‘ì¤‘í•˜ì„¸ìš”!)

---

## ê¸°ì¡´ C++ì˜ ë¬¸ì œ

* ê¸°ì¡´ C++ì˜ ê°€ì¥ í° ë¬¸ì œëŠ” ğŸ‘‰ ë¹Œë“œì†ë„... ë¹Œë“œì†ë„ë¥¼ **Module**ì„ í†µí•´ì„œ ê°œì„ í•´ë³´ì
* ë¹Œë“œëŠ” í¬ê²Œ ì„¸ ê°€ì§€ ë‹¨ê³„ë¡œ êµ¬ì„±ëœë‹¤. **ì „ì²˜ë¦¬**, **ì»´íŒŒì¼**, **ë§í¬**

* ì „ì²˜ë¦¬
    - `#include`, `#define`
* ì»´íŒŒì¼
    - ì˜¤ë¸Œì íŠ¸ íŒŒì¼ .obj
* ë§í¬

* ê¸°ì¡´ì— ì‚¬ìš©í•˜ë˜ ë°©ë²•ì˜ ë¬¸ì œì 
    1. ë¹Œë“œ ì†ë„ (ë°˜ë³µëœ **substitution(ì¹˜í™˜)**), ë„ˆë¬´ ë„ˆë¬´ ëŠë¦¬ë‹¤
    2. ë§¤í¬ë¡œ (#define) 
        - ğŸ‘‰ ì†ë„ì˜ ë¬¸ì œëŠ” ì•„ë‹ˆê³  Test1ì—ì„œ ì„ ì–¸í•œ defineê³¼ ë™ì¼í•œ ì´ë¦„ì˜ defineì„ Test2ì—ì„œ ë˜ ì„ ì–¸í•˜ê³  ê·¸ defineì„ mainì—ì„œ ì‚¬ìš©ì‹œ ì—ëŸ¬ë¥¼ ìœ ë°œí•  ìˆ˜ ìˆìŒ.
    3. ì‹¬ë³¼ ì¤‘ë³µ ì •ì˜ 
        - ğŸ‘‰ ê°„ë‹¨í•˜ê²Œ ì„¤ëª…í•˜ë©´ Test1ì— ì„ ì–¸ëœ MyFuncê°€ í—¤ë”ì— í•¨ìˆ˜ê°€ êµ¬í˜„ë˜ì—ˆë‹¤ë©´ Test1ì„ includeí•œ ë‹¤ë¥¸ í—¤ë”ì—ì„œë„ ë™ì¼í•˜ê²Œ í•¨ìˆ˜ì˜ êµ¬í˜„ì´ ë¹Œë“œë˜ê²Œ ëœë‹¤. ë§í‚¹íƒ€ì„ì— ì–´ë–¤ MyFuncë¡œ ë§í¬í•´ì•¼í• ì§€ ëª¨ë¥´ê¸°ì— ë°œìƒí•˜ëŠ” ë¬¸ì œ

---

### substitution

```cpp
// math.h
#ifndef MATH_H
#define MATH_H
#include <iostream>
#include <vector>
#include <string>
#include <algorithm>
// ... ìˆ˜ë°± ì¤„ì˜ ì½”ë“œ
class Calculator { /* ... */ };
#endif
```

```cpp
// file1.cpp
#include "math.h"  // ì „ì²´ í—¤ë” íŒŒì‹±
#include <iostream>
// ...
```

```cpp
// file2.cpp  
#include "math.h"  // ë˜ ë‹¤ì‹œ ì „ì²´ í—¤ë” íŒŒì‹±
#include <vector>
// ...
```

```cpp
// file3.cpp
#include "math.h"  // ë˜ ë‹¤ì‹œ ì „ì²´ í—¤ë” íŒŒì‹±
#include <string>
// ...
```

* ì´ê±¸ moduleì€ ë¯¸ë¦¬ ì»´íŒŒì¼í•˜ëŠ” ë°©í–¥ìœ¼ë¡œ í•´ê²°

```cpp
// math_module.cppm
export module math_utils;
import <iostream>;
import <vector>;
import <string>;

export class Calculator { /* ... */ };
```

```cpp
// file1.cpp
import math_utils;  // ë¯¸ë¦¬ ì»´íŒŒì¼ëœ ëª¨ë“ˆ ë¡œë“œ (ë¹ ë¦„)

// file2.cpp
import math_utils;  // ë™ì¼í•œ ë¯¸ë¦¬ ì»´íŒŒì¼ëœ ëª¨ë“ˆ ì¬ì‚¬ìš©

// file3.cpp
import math_utils;  // íŒŒì‹± ì—†ì´ ì¦‰ì‹œ ë¡œë“œ
```

---

## ì¡°ê¸ˆ ë” ê¸°ì¡´ c++ì˜ ë¬¸ì œë¥¼ ì‚´í´ë³´ì

* ì—¬ê¸¸ ì¶”ê°€í•œ ì´ìœ ëŠ”, c++ë¡œ ì˜ í•˜ê³ ìˆëŠ”ë° ì´ê²Œ í•„ìš”í•œê°€? ì˜ ì˜ë¬¸ì„ í•´ê²°í•˜ê¸° ìœ„í•¨ì´ë‹¤.

### ë§¤í¬ë¡œ ì˜¤ì—¼ ë¬¸ì œ

```cpp
// windows_api.h
#define min(a, b) ((a) < (b) ? (a) : (b))
#define max(a, b) ((a) > (b) ? (a) : (b))

// my_math.h
#include "windows_api.h"
#include <algorithm>

void test() {
    std::vector<int> vec = {1, 2, 3, 4, 5};
    // ì»´íŒŒì¼ ì—ëŸ¬! std::maxê°€ ë§¤í¬ë¡œë¡œ ì¹˜í™˜ë¨
    auto result = std::max_element(vec.begin(), vec.end());
}
```

```cpp
// main.cpp
#include "my_math.h"

class MyClass {
    // ì»´íŒŒì¼ ì—ëŸ¬! minì´ ë§¤í¬ë¡œë¡œ ì¹˜í™˜ë˜ì–´ í•¨ìˆ˜ëª…ìœ¼ë¡œ ì‚¬ìš© ë¶ˆê°€
    int min() { return 0; }
};
```

* ì•„ì£¼ ìµìˆ™í•œ ë¬¸ì œêµ° ... ì–´ë–»ê²Œ í•´ê²°ì„ í• ê¹Œ?

```cpp
// windows_module.cppm
module;
#define min(a, b) ((a) < (b) ? (a) : (b))  // ëª¨ë“ˆ ë‚´ë¶€ì—ì„œë§Œ ìœ íš¨
#define max(a, b) ((a) > (b) ? (a) : (b))

export module windows_utils;

export void some_windows_function() {
    // ë‚´ë¶€ì—ì„œëŠ” ë§¤í¬ë¡œ ì‚¬ìš© ê°€ëŠ¥
    int result = min(10, 20);
}
```

```cpp
// main.cpp
import windows_utils;
import <algorithm>;

class MyClass {
    int min() { return 0; }  // OK! ë§¤í¬ë¡œ ì˜¤ì—¼ ì—†ìŒ
};

void test() {
    std::vector<int> vec = {1, 2, 3, 4, 5};
    // OK! std::max_element ì •ìƒ ì‘ë™
    auto result = std::max_element(vec.begin(), vec.end());
}
```

---

### ìˆœí™˜ ì˜ì¡´ì„± ë¬¸ì œ

```cpp
// player.h
#ifndef PLAYER_H
#define PLAYER_H
#include "game.h"  // ìˆœí™˜ ì°¸ì¡°!

class Player {
    Game* current_game;
public:
    void join_game(Game& game);
};
#endif

// game.h
#ifndef GAME_H
#define GAME_H
#include "player.h"  // ìˆœí™˜ ì°¸ì¡°!

class Game {
    std::vector<Player*> players;
public:
    void add_player(Player& player);
};
#endif
```

```cpp
// game_types.cppm
export module game_types;

export class Player;  // ì „ë°© ì„ ì–¸
export class Game;    // ì „ë°© ì„ ì–¸
```

```cpp
// player.cppm
export module player;
import game_types;

export class Player {
    Game* current_game;
public:
    void join_game(Game& game);
};
```

```cpp
// game.cppm
export module game;
import game_types;
import <vector>;

export class Game {
    std::vector<Player*> players;
public:
    void add_player(Player& player);
};
```

---

### ìº¡ìŠí™” ë¶€ì¡± ë¬¸ì œ

```cpp
// database.h
#include <sqlite3.h>  // ì‚¬ìš©ìê°€ sqlite3ì— ì˜ì¡´í•˜ê²Œ ë¨
#include <string>

// ë‚´ë¶€ í—¬í¼ í•¨ìˆ˜ë“¤ì´ ëª¨ë‘ ë…¸ì¶œë¨
void internal_cleanup();
void internal_validate(const std::string& query);

class Database {
private:
    sqlite3* db;  // ë‚´ë¶€ êµ¬í˜„ ì„¸ë¶€ì‚¬í•­ ë…¸ì¶œ ã… ã… ...
public:
    void execute(const std::string& query);
};
```

```cpp
// user_code.cpp
#include "database.h"

void user_function() {
    // ì‹¤ìˆ˜ë¡œ ë‚´ë¶€ í•¨ìˆ˜ í˜¸ì¶œ ê°€ëŠ¥
    internal_cleanup();  // ì´ê±´ í˜¸ì¶œí•˜ë©´ ì•ˆ ë˜ëŠ”ë°...
    
    Database db;
    db.execute("SELECT * FROM users");
}
```

```cpp
// database.cppm
module;
#include <sqlite3.h>  // ëª¨ë“ˆ ë‚´ë¶€ì—ì„œë§Œ ì‚¬ìš©

export module database;
import <string>;

// ë‚´ë¶€ í•¨ìˆ˜ë“¤ - exportí•˜ì§€ ì•Šì•„ ì™¸ë¶€ì—ì„œ ì ‘ê·¼ ë¶ˆê°€
void internal_cleanup() { /* ... */ }
void internal_validate(const std::string& query) { /* ... */ }

export class Database {
    // ë‚´ë¶€ êµ¬í˜„ ìˆ¨ê¹€
        // ë¬¼ë¡  ì´ëŸ°ì²˜ë¦¬ëŠ” ê¸°ì¡´ c++ì—ì„œë„ ê°€ëŠ¥í•˜ë‹¤.
    struct Impl;
    std::unique_ptr<Impl> pimpl;
    
public:
    Database();
    ~Database();
    void execute(const std::string& query);
};
```

```cpp
// user_code.cpp
import database;

void user_function() {
    // internal_cleanup();  // ì»´íŒŒì¼ ì—ëŸ¬! ì ‘ê·¼ ë¶ˆê°€
    
    Database db;
    db.execute("SELECT * FROM users");  // ê³µê°œ ì¸í„°í˜ì´ìŠ¤ë§Œ ì‚¬ìš© ê°€ëŠ¥
}
```

---

### ë¹Œë“œ ì˜ì¡´ì„± ë¬¸ì œ

```cpp
// config.h
#define VERSION "1.0.0"
#define DEBUG_MODE 1

// utils.h
#include "config.h"
void utility_function();

// main.cpp
#include "utils.h"
// config.hì˜ DEBUG_MODEë§Œ ë°”ë€Œì–´ë„ main.cpp ì¬ì»´íŒŒì¼
```

```cpp
// config_module.cppm
export module config;

export constexpr const char* VERSION = "1.0.0";
export constexpr bool DEBUG_MODE = true;
```

```cpp
// utils_module.cppm
export module utils;
// config ëª¨ë“ˆì„ importí•˜ì§€ë§Œ re-exportí•˜ì§€ ì•ŠìŒ
import config;

export void utility_function() {
    if constexpr (DEBUG_MODE) {
        // ë””ë²„ê·¸ ë¡œì§
    }
}
```

```cpp
// main.cpp
import utils;  // config ë³€ê²½ì´ main.cppì— ì§ì ‘ ì˜í–¥ ì—†ìŒ

int main() {
    utility_function();
    return 0;
}
```

---

### í…œí”Œë¦¿ ì¸ìŠ¤í„´ìŠ¤í™” ë¬¸ì œ

```cpp
// template_utils.h
template<typename T>
class Container {
    // ë³µì¡í•œ í…œí”Œë¦¿ êµ¬í˜„
};

// file1.cpp
#include "template_utils.h"
Container<int> c1;  // Container<int> ì¸ìŠ¤í„´ìŠ¤í™”

// file2.cpp  
#include "template_utils.h"
Container<int> c2;  // Container<int> ë˜ ë‹¤ì‹œ ì¸ìŠ¤í„´ìŠ¤í™”

// file3.cpp
#include "template_utils.h"
Container<int> c3;  // Container<int> ë˜ ë‹¤ì‹œ ì¸ìŠ¤í„´ìŠ¤í™”
```

```cpp
// template_module.cppm
export module template_utils;

export template<typename T>
class Container {
    // í…œí”Œë¦¿ êµ¬í˜„
};

// ëª…ì‹œì  ì¸ìŠ¤í„´ìŠ¤í™”
template class Container<int>;
```

```cpp
// file1.cpp, file2.cpp, file3.cpp
import template_utils;
Container<int> c;  // ë¯¸ë¦¬ ì»´íŒŒì¼ëœ ì¸ìŠ¤í„´ìŠ¤ ì¬ì‚¬ìš©
```

---

### Module

- ëª¨ë“ˆì€ ë”± í•œë²ˆë§Œ import ëœë‹¤
- import ìˆœì„œì— ìƒê´€ ì—†ìŒ
- ì‹¬ë³¼ ì¤‘ë³µ ì •ì˜
- ëª¨ë“ˆì˜ ì´ë¦„ë„ ì§€ì • ê°€ëŠ¥
- ì¸í„°í˜ì´ìŠ¤(.h)/êµ¬í˜„ë¶€(.cpp) ë¶„ë¦¬ ê´€ë¦¬í•  í•„ìš” ì—†ìŒ

* ì–´ë ¤ìš´ë° ì˜ˆì œë¡œ ë³´ìë©´??

```cpp
// math.ixx

// ì™¸ë¶€ì—ì„œ mathë€ ì´ë¦„ìœ¼ë¡œ ë¶ˆë¦¬ê²Œ í•˜ê² ë‹¤
export module math;

export int Add(int a, int b)
{
	return a + b;
}
```

```cpp
// main.cpp

import math;

int main()
{
    // ì´ëŸ°ì‹ì˜ ì‚¬ìš©ì´ ê°€ëŠ¥
    int sum = Add(1 + 2)
}
```

* Wow! ì‰½ê³  ê¸°ì¡´ì˜ ë¹Œë“œ ì†ë„ (ë°˜ë³µëœ **substitution(ì¹˜í™˜)**)ê¹Œì§€ í•´ê²°í•´ ì¤€ë‹¤ë‹ˆ ë„ˆë¬´ ì¢‹ì€ê±¸? ì¡°ê¸ˆ ë” ì‚´í´ë³´ìë©´

```cpp
// math.ixx
export module math;

export
{
	void TestExport1()
	{

	}
}

export namespace math
{
	void TestExport2()
	{

	}
}
```

```cpp
// main.cpp

import math;

int main()
{
    TestExport1();

    // namespaceë‚´ì— ìˆë‹¤ë©´ namespaceê¹Œì§€ ëª…ì‹œí•´ ì¤˜ì•¼í•œë‹¤
    test::TestExport2();
}
```

* ë³´í†µ ì„ ì–¸ì€ ì´ë ‡ê²Œ í•œë‹¤.

```cpp
// example.ixx

module; // global module fragment

// includeí•  ë¶€ë¶„ì´ ìˆë‹¤ë©´ ì—¬ê¸°ì—
#include <vector>

// ì´ moduleì˜ ì´ë¦„ì€?
export module math;

// import module ...

// submodule
// ì‚¬ìš©í•  ë‹¤ë¥¸ moduleì„ ì—¬ê¸°ì„œ import
// í˜¹ì€ export import ì„ ì–¸í•˜ë©´ importí•œ moduleì„ ì´ moduleì„ ì‚¬ìš©í•˜ëŠ” cppì—ì„œ ì‚¬ìš©ê°€ëŠ¥í•˜ê²Œ ë§Œë“¤ì–´ ì¤Œ.
    // ì„¤ëª…ì´ ì´ìƒí•œë° math.timeì„ mathë§Œ importí•´ë„ ì‚¬ìš©ê°€ëŠ¥í•˜ë‹¤ëŠ” ë§.
export import math.time;
```

```cpp
export module math.time;

export void MathTimeFunc()
{

}
```

```cpp
// main.cpp

import math;

int main()
{
    // math.timeì„ importí•˜ì§€ ì•Šì•˜ì§€ë§Œ MathTimeFuncë¥¼ ì‚¬ìš©ê°€ëŠ¥
	MathTimeFunc();
```

* ê³µì‹ì²˜ëŸ¼ ìƒê°í•˜ê³  ë°›ì•„ë“¤ì´ì.

```cpp
// mathpartition.ixx

export module MathPartition;

// Partition
export import :MathPartition_1;
export import :MathPartition_2;
```

```cpp
// mathpartition1.ixx
export module MathPartition:MathPartition_1;

export void MyFunc()
{

}
```

```cpp
// mathpartition2.ixx
export module MathPartition:MathPartition_2;

export void MyFunc2()
{

}
```

```cpp
import MathPartition;

int main()
{
    // ì´ëŸ°ì‹ìœ¼ë¡œë„ ì‚¬ìš©ê°€ëŠ¥
    // submoduleê³¼ ê±°ì˜ ë™ì¼
    
    // ì°¨ì´ì ì€
    // import MathPartition_1   // Error
    // ê°œë³„ë¡œ importê°€ ë¶ˆê°€ëŠ¥í•˜ê²Œ ë§Œë“¤ì–´ ì¤€ë‹¤

	MyFunc();
	MyFunc2();
}
```

> Partitionì´ë“  Submoduleì´ë“  ë­˜ ì“°ë“  ê°œë°œì ì·¨í–¥ì˜ ì˜ì—­ ë‘˜ ë‹¤ ì¢‹ì€ ë°©ì‹ì´ë‹¤.

---

## .ixx? .cppm? í™•ì¥ìëŠ” ë­ê°€ ë§ì„ê¹Œ?

* `.ixx` - msvc
* `.cppm` - gcc, clang

* ë ìš©? ì´ê²Œ ë­ì•¼? ì™œ ì´ë ‡ê²Œ ë§Œë“ ê±°ì§€? -> C++23ì—ì„œ í™•ì¥ì í‘œì¤€í™” ë…¼ì˜ ì¤‘...