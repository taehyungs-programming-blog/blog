---
layout: default
title: "38. CRT (C Runtime) 링킹 방식"
parent: (Windows API)
grand_parent: (C++)
nav_order: 4
---

## Table of contents
{: .no_toc .text-delta }

1. TOC
{:toc}

---

## CRT (C Runtime Library)란?

* C/C++에서 malloc, free, new, delete, printf 같은 기본 함수들은 컴파일러가 제공하는 라이브러리에 들어있다.
* 이걸 CRT (C Runtime Library) 라고 한다.

```cpp
int* p = new int[100];    // CRT의 메모리 할당 함수 호출
delete[] p;               // CRT의 메모리 해제 함수 호출
```

## CRT(C Runtime) 링킹 방식에 따라 달라진다

* /MD - CRT를 DLL로 공유 (exe와 dll이 **같은 힙** 사용)
* /MT - CRT를 정적 링크 (exe와 dll이 **각자 별도 힙**)

```
/MT
┌──────────────────────────────┐
│          Game.exe            │
│                              │
│  ┌────────────────────────┐  │
│  │     당신의 게임 코드     │  │
│  └────────────────────────┘  │
│                              │
│  ┌────────────────────────┐  │
│  │   CRT 코드 복사본       │  │  ← malloc, free, new, delete 등
│  │   (힙 관리자 포함)      │  │  ← 자체 힙 관리!
│  └────────────────────────┘  │
│                              │
└──────────────────────────────┘

┌──────────────────────────────┐
│        Renderer.dll          │
│                              │
│  ┌────────────────────────┐  │
│  │     렌더러 코드         │  │
│  └────────────────────────┘  │
│                              │
│  ┌────────────────────────┐  │
│  │   CRT 코드 복사본       │  │  ← 또 다른 malloc, free...
│  │   (힙 관리자 포함)      │  │  ← 별도 힙 관리!
│  └────────────────────────┘  │
│                              │
└──────────────────────────────┘
```

```
/MD
┌──────────────────────────────┐
│          Game.exe            │
│  ┌────────────────────────┐  │
│  │     당신의 게임 코드     │  │
│  └────────────────────────┘  │
└──────────────┬───────────────┘
               │ 호출
               ▼
┌──────────────────────────────┐
│       vcruntime140.dll       │  ← 공유 CRT DLL
│  ┌────────────────────────┐  │
│  │  malloc, free, new...  │  │
│  │  (공유 힙 관리자)       │  │  ← 하나의 힙!
│  └────────────────────────┘  │
└──────────────────────────────┘
               ▲
               │ 호출
┌──────────────┴───────────────┐
│        Renderer.dll          │
│  ┌────────────────────────┐  │
│  │     렌더러 코드         │  │
│  └────────────────────────┘  │
└──────────────────────────────┘
```

---

## 비교

* /MD 장점	
    * EXE 크기 작음
    * 메모리 절약
    * 보안 패치 자동 적용

* /MT 장점
    * CRT DLL 없이 실행 가능
    * 배포가 단순
    * 의존성 걱정 없음

* 게임 배포할 때 vcruntime140.dll 같이 안 줘도 되니까 /MT 선호하는 경우가 많습니다.