---
layout: default
title: "2. ì–´ì…ˆë¸”ë¦¬ ë§Œë“¤ì–´ë³´ê¸°"
parent: (Windows API)
grand_parent: C++
nav_order: 1
---

## Table of contents
{: .no_toc .text-delta }

1. TOC
{:toc}

---

ğŸ˜º ê°„ë‹¨í•œ ì˜ˆì‹œë¡œ ì•„ë˜ íŒŒì¼ì„ ì–´ì…ˆë¸”ë¦¬ì½”ë“œë¡œ ë³€ê²½í•´ ë³´ì

```cpp
// inline_asm1.c    // ì¸ë¼ì¸ ì–´ì…ˆë¸”ë¦¬ë¥¼ ìœ„í•´ì„œ .cë¡œ íŒŒì¼ì„ ë§Œë“¦ì„ ì£¼ì˜
#include <stdio.h>
int Add(int a, int b)
{
    int c = a + b;
    return c;
}
int main()
{
    int n = 0;
    // ìŠ¤íƒì— ë§¤ê°œë³€ìˆ˜ 1, 2ë¥¼ ë„£ì„ ê²ƒ
    n = Add(1, 2);
    // ë°˜í™˜ ê°’ì€ EAX ë ˆì§€ìŠ¤í„°ì— ë‹´ê²¨ì„œ ëŒì•„ ì˜¬ ê²ƒ
    printf("result : %d\n", n);
    // ì´ê±¸ ê¸°ê³„ì–´ë¡œ ì§ì ‘ í‘œí˜„í•˜ê³  ì‹¶ì€ë°...
}
```

<br>

ğŸ˜º ìš°ì„  VisualStudioì—ì„œ ë§Œë“¤ì–´ì£¼ëŠ” ì–´ì…ˆë¸”ë¦¬ëŠ” : ë””ë²„ê·¸ ğŸ‘‰ ì°½ ğŸ‘‰ ë””ìŠ¤ì–´ì…ˆë¸”ë¦¬ ì—ì„œ í™•ì¸ê°€ëŠ¥

```
    int n = 0;
006B1958  mov         dword ptr [n],0  
    // ì°¸ê³ 1) [n]ì€ nì˜ ì£¼ì†Œê°’ì„ ë¦¬í„´í•´ ë‹¬ë¼ëŠ” ë§.
    // C++ë¡œ ì¹˜ë©´ *nê³¼ ë™ì¼í•œ í‘œí˜„ì´ë‹¤
    // ì°¸ê³ 2) dword(2ë°”ì´íŠ¸) ptr(í¬ì¸í„°)ë¥¼ ì•Œë ¤ì¤€ë‹¤
    n = Add(1, 2);
006B195F  push        2  
006B1961  push        1  
006B1963  call        Add (06B119Ah)  
006B1968  add         esp,8  
006B196B  mov         dword ptr [n],eax  
    printf("result : %d\n", n);
006B196E  mov         eax,dword ptr [n]  
006B1971  push        eax  
006B1972  push        offset string "result : %d\n" (06B7B30h)  
006B1977  call        _printf (06B104Bh)  
006B197C  add         esp,8  
}
```

<br>

ğŸ˜º ëŒ€ëµ ì´ëŸ°ë° ì•„ì§ì€ ì´ê²Œ ë¬´ìŠ¨ ì†Œë¦¬ì¸ì§€... í•˜ëŠ”ê²Œ ì •ìƒì´ë‹¤. ìš°ì„  ìœ„ë¥¼ ì°¸ê³ í•˜ì—¬ ì–´ì…ˆë¸”ë¦¬ì–¸ì–´ë¥¼ ë§Œë“¤ì–´ë³´ì

```cpp
// ì°¸ê³ , ì´ë¡ ) mov
// .c ì½”ë“œì—ì„œ ì¸ë¼ì¸ ì–´ì…ˆë¸”ë¦¬ì–¸ì–´ë¥¼ ì“¸ë•ŒëŠ” __asmì„ ì“°ë©´ëœë‹¤ 
__asm
{
    // eax ë ˆì§€ìŠ¤í„°ì— ìˆëŠ” ê°’ì„ nìœ¼ë¡œ ì˜®ê²¨ì£¼ì„¸ìš”
    mov n, eax
}
```

```cpp
// inline_asm1.c
#include <stdio.h>
int Add(int a, int b)
{
    int c = a + b;
    __asm
    {
        mov eax, c  // return c ê³¼ ë™ì¼í•˜ë‹¤
    }
}
```

<br>

ğŸ˜º ë¦¬í„´í•˜ëŠ”ë²•ì€ ìµí˜”ê³  ë§¤ê°œë³€ìˆ˜ë¥¼ ë„£ëŠ” ë²•ì€

```cpp
int main()
{
    int n = 0;
    //n = Add(1, 2);
    __asm
    {
        push    2
        push    1       // pushë¥¼ ì´ìš©í•´ ìŠ¤íƒì„ í• ë‹¹
        call    Add     // Add í•¨ìˆ˜ í˜¸ì¶œ
        add     esp, 8  // (ì´ ë¶€ë¶„ì´ ì—†ìœ¼ë©´ í”„ë¡œê·¸ë¨ì´ ì£½ìŒ) 
                        // ì—­í• ì€ í• ë‹¹ëœ ìŠ¤íƒì„ ì œê±°í•œë‹¤.(ìŠ¤íƒ í”„ë ˆì„ì˜ ë ì§€ì  ì£¼ì†Œë¥¼ ê°€ë¦¬í‚¨ë‹¤ê³  ë³´ë©´ ëœë‹¤.)
        mov     n, eax  // ê²°ê³¼ë¥¼ nì— ë°›ëŠ”ë‹¤
    }
    
    printf("result : %d\n", n);
}
```

<br>

ğŸ˜º ì–´ì…ˆë¸”ë¦¬íŒŒì¼(`.asm`)ì„ ë§Œë“¤ì–´ ë¹Œë“œí•˜ëŠ” ë°©ë²•?
* ì„¸ ê°€ì§€ ë°©ë²•ì´ ì¡´ì¬í•œë‹¤
    * command line ë¹Œë“œ
    * VisualStudioì—ì„œ `.asm`íŒŒì¼ì— ì‚¬ìš©ì ì§€ì •ë¹Œë“œ ëª…ë ¹ ì¶”ê°€ í›„ ë¹Œë“œ
    * VisualStudioì—ì„œ ë¹Œë“œ ì¢…ì†ì„± ì˜µì…˜ ì¶”ê°€ í›„ ë¹Œë“œ

ğŸ˜º ì˜ˆë¥¼ë“¤ì–´ ì•„ë˜ì™€ ê°™ì€ ì–´ì…ˆë¸”ë¦¬(`.asm`), `.cpp` íŒŒì¼ì´ ìˆë‹¤ê³  ê°€ì •í•´ë³´ì

```
; asm1.asm  ; (ì°¸ê³ ) ì–´ì…ˆë¸”ë¦¬ëŠ” ì„¸ë¯¸ì½œë¡ ì´ ì£¼ì„
.model flat ; ì´ê±´ ì¼ë‹¨ ë°›ì•„ë“¤ì´ê³ 
public _asm_main
.code
_asm_main:                  ; ë©”ì¸ì€ ì—¬ê¸°ì´ë‹¤
    mov     eax, 100        ; return 100ê³¼ ë™ì¼
    ret
end
```

```cpp
// main.cpp
#include <stdio.h>
int asm_main();     // ì–´ì…ˆë¸”ë¦¬ íŒŒì¼ë¡œ ë§Œë“¤ì˜ˆì •
int main()
{
    int n = asm_main();
    printf("result : %d\n", n);
}
```

<br>

* ë°©ë²•1) command line ë¹Œë“œ

```bash
$ cl main.c /c           # main.obj ìƒì„±ë¨
$ ml asm1.asm /c         # asm1.obj ìƒì„±ë¨
$ link main.obj asm1.obj # .objë¥¼ ë§í‚¹
# /c : ë§í¬ì—†ì´ ì»´íŒŒì¼ë§Œ í•´ë‹¬ë¼
```

* ë°©ë²•2) VisualStudioì—ì„œ `.asm`íŒŒì¼ì— ì‚¬ìš©ì ì§€ì •ë¹Œë“œ ëª…ë ¹ ì¶”ê°€ í›„ ë¹Œë“œ

<p align="center">
  <img src="https://taehyungs-programming-blog.github.io/blog/assets/images/cpp/win32api/win32-2-1.png" style="border-radius:5%;border:1px solid #e6e1e8"/>
</p>

<br>

<p align="center">
  <img src="https://taehyungs-programming-blog.github.io/blog/assets/images/cpp/win32api/win32-2-2.png" style="border-radius:5%;border:1px solid #e6e1e8"/>
</p>

<br>

ğŸ˜º í•˜ì§€ë§Œ ì´ ë°©ì‹ì˜ ë‹¨ì ì€ `.asm`íŒŒì¼ì´ ë§ì•„ì§ˆ ê²½ìš° ëŒ€ì‘ì´ ì–´ë µë‹¤

* ë°©ë²•3) VisualStudioì—ì„œ ë¹Œë“œ ì¢…ì†ì„± ì˜µì…˜ ì¶”ê°€ í›„ ë¹Œë“œ

<p align="center">
  <img src="https://taehyungs-programming-blog.github.io/blog/assets/images/cpp/win32api/win32-2-3.png" style="border-radius:5%;border:1px solid #e6e1e8"/>
</p>

<br>

<p align="center">
  <img src="https://taehyungs-programming-blog.github.io/blog/assets/images/cpp/win32api/win32-2-4.png" style="border-radius:5%;border:1px solid #e6e1e8"/>
</p>

<br>

ì°¸ê³ ë¡œ ê¸°ì¡´ì— ìƒì„±ëœ .asmíŒŒì¼ì˜ ê²½ìš° ìš°í´ë¦­ -> ì†ì„±ì„ ë“¤ì–´ê°€ì„œ ì¼ë°˜ -> í•­ëª© í˜•ì‹ì„ Microsoft Macro Assemblerë¡œ ìˆ˜ì •í•´ì¤˜ì•¼í•¨(ë§Œì•½ì— ìœ„ ì„¤ì •í›„ asmíŒŒì¼ì„ ë§Œë“¤ì—ˆë‹¤ë©´ ì•ˆí•´ë„ ë¨)