---
layout: default
title: "3. pinì„ ìž¬í™œìš©í•˜ëŠ” ë°©ë²•"
parent: (DShow)
grand_parent: C++
nav_order: 1
---

## Table of contents
{: .no_toc .text-delta }

1. TOC
{:toc}

---

* [Get This Code ðŸŒŽ](https://github.com/EasyCoding-7/dshow-basic/tree/main/dshow-basic-4)
* [ì°¸ê³  OBS GitHub ðŸŒŽ](https://github.com/obsproject/obs-studio)

ðŸ˜º obsì—ì„œ ë³´ë©´ pinì„ ìž¬í™œìš© í•˜ëŠ” ë¶€ë¶„ì´ ë‚˜ì˜¨ë‹¤.

```cpp
class CapturePin : public IPin, public IMemInputPin {/**/}
class OutputPin : public IPin, public IAMStreamConfig, public IKsPropertySet {/**/}
```

ðŸ˜º ì–´ë–¤ì‹ìœ¼ë¡œ ìž¬í™œìš©í•˜ëŠ”ì§€ ë³´ìž.

ðŸ˜º (ì°¸ê³ ) obsì—ì„œ ì‚¬ìš©ëœ ì´ ìº¡ì³ëŠ” ë¯¸ë””ì–´ ìž¥ë¹„ì˜ ìº¡ì²˜ í›„ ì¸ì½”ë”© ë„êµ¬ë¡œ ì‚¬ìš©ë˜ê¸°ì— ë¯¸ë””ì–´ ìž¥ë¹„ê°€ ì—†ë‹¤ë©´ ìº¡ì²˜ê°€ ë¶ˆê°€ëŠ¥í•˜ë‹¤

```cpp
bool HVideoEncoder::SetupEncoder(IBaseFilter *filter)
{
	// ...

    // ë„¤ ê°œì˜ í•„í„°ê°€ ì‚¬ìš©ë˜ëŠ”ë°

	encoder = filter;
	device = std::move(deviceFilter);
	capture = new CaptureFilter(captureInfo);
	output = new OutputFilter(VideoFormat::YV12, config.cx, config.cy,
				  frameTime);

	graph->AddFilter(output, nullptr);                  // ìš°ë¦¬ê°€ ë§Œë“  output í•„í„°
	graph->AddFilter(device, L"Device Filter");         // ìº¡ì³ í•„í„°
	graph->AddFilter(encoder, L"Encoder Filter");       // ì¸ì½”ë” í•„í„°
	graph->AddFilter(capture, nullptr);                 // ìš°ë¦¬ê°€ ë§Œë“  capture í•„í„°
	return true;
}
```

<br>

ðŸ˜º ì–´ë–»ê²Œ Connectë˜ëŠ”ì§€ ë³´ë©´

```
-------------        -------------         -------------          -------------
|           |        |           |         |           |          |           |
|           |        |           |         |           |          |           |
|  output   |------->|  device   |-------->|  encoder  |--------->|  capture  |
|           |        |           |         |           |          |           |
|           |        |           |         |           |          |           |
-------------        -------------         -------------          -------------
```

```cpp
bool HVideoEncoder::ConnectFilters()
{
	ComPtr<IPin> deviceIn;
	ComPtr<IPin> deviceOut;
	ComPtr<IPin> encoderIn;
	ComPtr<IPin> encoderOut;
	bool success;
	HRESULT hr;

	success = GetPinByName(device, PINDIR_INPUT, L"YUV In", &deviceIn);
	if (!success) {
		Warning(L"Failed to get YUV In pin");
		return false;
	}

	success = GetPinByName(device, PINDIR_OUTPUT, L"Virtual Video Out",
			       &deviceOut);
	if (!success) {
		Warning(L"Failed to get Virtual Video Out pin");
		return false;
	}

	success = GetPinByName(encoder, PINDIR_INPUT, L"Virtual Video In",
			       &encoderIn);
	if (!success) {
		Warning(L"Failed to get encoder input pin");
		return false;
	}

	success = GetPinByName(encoder, PINDIR_OUTPUT, nullptr, &encoderOut);
	if (!success) {
		Warning(L"Failed to get encoder output pin");
		return false;
	}

	hr = graph->ConnectDirect(output->GetPin(), deviceIn, nullptr);
	if (FAILED(hr)) {
		WarningHR(L"Failed to connect output to device", hr);
		return false;
	}

	hr = graph->ConnectDirect(deviceOut, encoderIn, nullptr);
	if (FAILED(hr)) {
		WarningHR(L"Failed to connect device to encoder", hr);
		return false;
	}

	hr = graph->ConnectDirect(encoderOut, capture->GetPin(), nullptr);
	if (FAILED(hr)) {
		WarningHR(L"Failed to connect encoder to capture", hr);
		return false;
	}

	return true;
}
```