---
layout: default
title: "3. Async"
parent: (Concurrency)
grand_parent: (C++)
nav_order: 1
---

## Table of contents
{: .no_toc .text-delta }

1. TOC
{:toc}

---

ğŸ¦„ C++ì—ì„œëŠ” Threadë¥¼ ë§Œë“œëŠ” ì„¸ ê°€ì§€ ë°©ë²•ì´ ì¡´ì¬í•œë‹¤.

1. `std::thread`
2. `std:jthread` (C++20)
3. `std::async` ğŸ‘ˆ ì´ê±¸ ì•Œì•„ë³´ì.

---

```cpp
#include <iostream>
#include <thread>
#include <chrono>
#include <future>
using namespace std::literals;

int add(int a, int b)
{
    std::this_thread::sleep_for(2s);
    return a+b;
}

int main()
{
    // add(10, 20);                                   // ë™ê¸°
    std::future<int> ft = std::async(add, 10, 20);    // ë¹„ë™ê¸°

    int ret = ft.get();
    std::cout << "result : " << ret << std::endl;
}
```

```cpp
#include <iostream>
#include <thread>
#include <chrono>
#include <future>
using namespace std::literals;

int add(int a, int b)
{
    std::cout << "add : " << std::this_thread::get_id() << std::endl;
    std::this_thread::sleep_for(2s);
    return a+b;
}

int main()
{
    // std::launch::async : ë¹„ë™ê¸°ë¡œ ë§Œë“¤ì–´ ì£¼ì„¸ìš”
    std::future<int> ft = std::async(std::launch::async, add, 10, 20);

    // std::launch::deferred : ì§€ì—°ëœ ì‹¤í–‰ìœ¼ë¡œ ë§Œë“¤ì–´ ì£¼ì„¸ìš”(getì—ì„œ ì‹¤í–‰í•´ ì£¼ì„¸ìš”)
    std::future<int> ft = std::async(std::launch::deferred, add, 10, 20);

    // std::launch::async | std::launch::deferred : ë¹„ë™ê¸° ì§€ì—°ëœ ì‹¤í–‰ìœ¼ë¡œ í•´ì£¼ì„¸ìš”
    std::future<int> ft = std::async(std::launch::async | std::launch::deferred, add, 10, 20);

    // í™˜ê²½ì— ë”°ë¼ ë‹¬ë¼ì§„ë‹¤(ëŒ€ë¶€ë¶„ì€ ì§€ì—°ëœ ì‹¤í–‰ì— ë¹„ë™ê¸°)
    std::future<int> ft = std::async(add, 10, 20);

    std::cout << "continue main : " << std::this_thread::get_id() << std::endl;
    std::this_thread::sleep_for(2s);
    int ret = ft.get();
    std::cout << "result : " << ret << std::endl;
}
```

```cpp
#include <iostream>
#include <thread>
#include <chrono>
#include <future>
using namespace std::literals;

int add(int a, int b)
{
    std::cout << "start add" << std::endl;
    std::this_thread::sleep_for(2s);
    std::cout << "finish add" << std::endl;
    return a+b;
}

int main()
{
    std::future<int> ft = std::async(std::launch::async, add, 10, 20);

    std::cout << "continue main" << std::endl;

    // int ret = ft.get();
    // getì„ í˜¸ì¶œì•ˆí•œë‹¤ë©´
    // addëŠ” í˜¸ì¶œì´ ë˜ì§€ ì•Šì„ê¹Œ??
    // Nope! -> futureì˜ ì†Œë©¸ìì—ì„œ getì´ ìë™í˜¸ì¶œë˜ì–´ addê°€ í˜¸ì¶œë˜ê²Œ ëœë‹¤.
}
```