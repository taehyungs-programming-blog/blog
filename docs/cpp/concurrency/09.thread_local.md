---
layout: default
title: "9. thread_local"
parent: (Concurrency)
grand_parent: C++
nav_order: 1
---

## Table of contents
{: .no_toc .text-delta }

1. TOC
{:toc}

---

ğŸ¦„ ì˜ˆì „ì—ëŠ” ì´ë ‡ê²Œ TLSë¥¼ ì‚¬ìš©í–ˆë‹¤.<Br>

* linux(gcc) : _thread static int x
* windows(cl) : __declspec(thread)
* C++í‘œì¤€ì´ ë‚˜ì˜¤ê³  ë¶€í„° : thread_local

```cpp
#include <iostream>
#include <thread>
#include <string_view>

int next3times()
{
    // ì‹±ê¸€ìŠ¤ë ˆë“œì¼ë•ŒëŠ” ì •ìƒì ìœ¼ë¡œ ë™ì‘
    static int n = 0;
    n = n + 3;
    return n;
}

void foo(std::string_view name)
{
    std::cout << name << " : " << next3times() << std::endl;
    std::cout << name << " : " << next3times() << std::endl;
    std::cout << name << " : " << next3times() << std::endl;
}

int main()
{
    foo("A");

    // ë§Œì•½ ë©€í‹°ìŠ¤ë ˆë“œí™˜ê²½ì´ë¼ë©´?
    std::thread t1(foo, "A");
    std::thread t2(foo, "\tB");
    t1.join();
    t2.join();
    // ê²°ê³¼ë¶€í„° ë§í•˜ë©´ 3 6 9 12 15 18 ì´ë‚˜ì˜¤ê²Œëœë‹¤.
    // ë§Œì•½ ìŠ¤ë ˆë“œë³„ë¡œ 3 6 9 ë¥¼ ì¶œë ¥í•˜ê³  ì‹¶ë‹¤ë©´?
    // ê°ê° ìŠ¤ë ˆë“œë³„ë¡œ ë³€ìˆ˜ë¥¼ ê°–ê³ ì‹¶ë‹¤(TLS : Thread Local Storage) : ìŠ¤ë ˆë“œë³„ë¡œ ìŠ¤íƒì„ ë§Œë“¤ì–´ì¤˜
}
```

```cpp
int next3times()
{
    thread_local int n = 0;
    // thread_local static int n = 0;
    // staticì´ ì•”ì‹œì ìœ¼ë¡œ ì„ ì–¸ì´ ë˜ê¸°ì— ìƒëµí•´ë„ ëœë‹¤.
    n = n + 3;
    return n;
}
```