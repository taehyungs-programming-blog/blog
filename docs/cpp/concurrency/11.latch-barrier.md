---
layout: default
title: "11. latch & barrirer"
parent: (Concurrency)
grand_parent: (C++)
nav_order: 2
---

## Table of contents
{: .no_toc .text-delta }

1. TOC
{:toc}

---

## latch

ğŸ¦„ countê¸°ë°˜ì˜ ìŠ¤ë ˆë“œ ë™ê¸°í™” ë„êµ¬

```cpp
#include <iostream>
#include <mutex>
#include <latch>
#include <thread>

void foo(std::string name)
{
    std::cout << "start work : " << name << std::endl;
    std::cout << "finish work : " << name << std::endl;

    // ì„¸ ìŠ¤ë ˆë“œì—ì„œ ì§‘ì—ê°€ëŠ” ë™ì‘ì€ ê°™ì´ í•˜ê³  ì‹¶ë‹¤ë©´?
    std::cout << "go home : " << name << std::endl;
}

int main()
{
    std::jthread t1(foo, "kim"), t2(foo, "lee"), t3(foo, "park");
}
```

```cpp
#include <iostream>
#include <mutex>
#include <latch>
#include <thread>

std::latch complete{3};
std::latch gohome{1};

void foo(std::string name)
{
    std::cout << "start work : " << name << std::endl;
    std::cout << "finish work : " << name << std::endl;
    complete.count_down();
    gohome.wait();
    std::cout << "go home : " << name << std::endl;
}

int main()
{
    std::jthread t1(foo, "kim"), t2(foo, "lee"), t3(foo, "park");

    complete.wait();    // ì¹´ìš´íŠ¸ê°€ 0ì¼ë•Œê¹Œì§€ ëŒ€ê¸°
    gohome.count_down();
}
```

```cpp
#include <iostream>
#include <mutex>
#include <latch>
#include <thread>

std::latch sync_point{3};

void foo(std::string name)
{
    std::cout << "start work : " << name << std::endl;
    std::cout << "finish work : " << name << std::endl;

    sync_point.arrive_and_wait();   // ì¹´ìš´íŠ¸ë¥¼ 1ì¤„ì´ê³ , ì¹´ìš´íŠ¸ê°€ 0ì¼ë•Œê¹Œì§€ ëŒ€ê¸°í•œë‹¤

    std::cout << "go home : " << name << std::endl;

    sync_point.arrive_and_wait();   // Error - latchëŠ” 1íšŒë§Œ ì“¸ ìˆ˜ ìˆë‹¤ ì—¬ëŸ¬ë²ˆ ì“°ë ¤ë©´ barrierë¥¼ ì“°ì
}

int main()
{
    std::jthread t1(foo, "kim"), t2(foo, "lee"), t3(foo, "park");
}
```

---

## barrier

```cpp
#include <iostream>
#include <mutex>
#include <barrier>
#include <thread>

void oncomplete()
{
    std::cout << "oncomplete" << name << std::endl;
}

std::barrier sync_point{3, oncomplete}; // ì½œë°±í•¨ìˆ˜ë„ ì„ ì–¸ê°€ëŠ¥

void foo(std::string name)
{
    std::cout << "start work : " << name << std::endl;
    std::cout << "finish work : " << name << std::endl;

    sync_point.arrive_and_wait();

    std::cout << "go home : " << name << std::endl;

    sync_point.arrive_and_wait();   // 2íšŒ ì¨ë„ ë¬´ë°©
}

int main()
{
    std::jthread t1(foo, "kim"), t2(foo, "lee"), t3(foo, "park");
}
```