---
layout: default
title: "03. dmp file"
parent: "(Windows Debugging)"
grand_parent: "(C++)"
nav_order: 1
---

## Table of contents
{: .no_toc .text-delta }

1. TOC
{:toc}

---

# DMP (Dump File)

## DMP란?

DMP 파일은 프로그램 크래시 시점의 메모리 상태와 실행 정보를 저장하는 파일입니다.

## 저장되는 정보

- **메모리 상태**: 크래시 시점의 메모리 스냅샷
- **레지스터 상태**: CPU 레지스터 값
- **Stack 상태**: 함수 호출 스택 정보
- **Call Stack**: 함수 호출 추적 정보

## 주요 용도

제품 배포 후 사후 디버깅 용도로 사용됩니다.

## DMP 파일 종류

### Mini Dump
- 유저 배포용 클라이언트에서 사용
- Call stack 및 소량의 메모리만 저장
- 파일 크기가 작아 배포에 적합

### Full Memory Dump
- 내부 테스트용 클라이언트에서 사용
- 서버 어플리케이션에서 사용
- 전체 메모리 상태 저장

## 덤프 파일 생성 방법

### 1. Procdump를 이용한 외부 생성

외부 프로세스에서 덤프를 생성할 수 있는 도구입니다.

- 다운로드: https://learn.microsoft.com/ko-kr/sysinternals/downloads/procdump

### 2. 프로그램 내부에서 생성 (Windows)

Windows에서는 SEH(Structured Exception Handling)를 사용하여 덤프 파일을 생성할 수 있습니다.

#### 구현 절차

1. `SetUnhandledExceptionFilter()`로 exception handler 설정
2. Exception handler가 호출되면 `MiniDumpWriteDump()`로 덤프 파일 생성

#### 주의사항

- 크래시 시점에서 CRT가 손상되었을 수 있으므로 `fwrite` 대신 `WriteFile` 사용 권장
- 나중에 파일을 찾기 쉽도록 `.dmp` 파일이 생성될 경로를 명시적으로 지정할 것