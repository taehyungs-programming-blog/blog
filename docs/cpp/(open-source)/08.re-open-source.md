---
layout: default
title: "8. (yalantinglibs) Coroutineì˜ í™œìš©"
parent: "(OpenSource ğŸ‘¨â€ğŸ’»)"
grand_parent: (C++)
nav_order: 1
---

## Table of contents
{: .no_toc .text-delta }

1. TOC
{:toc}

---

* [Link ğŸŒ](https://github.com/alibaba/yalantinglibs)

* C++ Coroutineì„ ì–´ë–»ê²Œ í™œìš©í•  ê²ƒì¸ê°€ì— ëŒ€í•œ ì˜ˆì‹œì´ë‹¤.
    * yalantinglibsì—ì„œ HTTP asyncê°€ ì–´ë–»ê²Œ ë™ì‘í•˜ë‚˜ í™•ì¸ìš©.

```cpp
async_simple::coro::Lazy<void> test_async_client(
    coro_http::coro_http_client &client) {
  std::string uri = "http://www.baidu.com";

  // ì•„ë˜ ì²˜ëŸ¼ co_awaitë¡œ ëŒ€ê¸°í•œë‹¤.
    // ì´ëŸ´ê±°ë©´ ê·¸ëƒ¥ í•¨ìˆ˜í˜¸ì¶œì´ ë‚«ì§€ ì•Šë‚˜?
  auto result = co_await client.connect(uri);
  if (result.net_err) {
    std::cout << result.net_err.message() << "\n";
  }
  
  // ...
```

* ìš°ì„  `client.connect(uri)`ì˜ returnì´ promiseíƒ€ì…ì´ë¼ `co_await`ë¥¼ ìƒëµí•˜ê³  ë¦¬í„´ì„ ë°›ì„ ì‹œ promiseì— ê°’ì´ ë‹´ê²¨ìˆë‹¤ëŠ” ë³´ì¥ì„ ëª»í•œë‹¤.
* ì™œ ì´ë ‡ê²Œ ë§Œë“¤ì—ˆë‚˜?
  * ì–´ë§ˆì–´ë§ˆí•œ ì¥ì ì´ ìˆìŒ

```cpp
int main() {
    coro_http::coro_http_client client{};
    auto a = test_async_client(client);
    auto a1 = test_async_client(client);
    auto a2 = test_async_client(client);

    // ì—¬ê¸°ì„œ ê²°ê³¼ë¥¼ ëŒ€ê¸°í•  ìˆ˜ ìˆë‹¤.
    co_await a;
    co_await a1;
    co_await a2;
    return 0;
}
```

---

* ì! ì´ì œ í•„ìš”ì„±ì€ ëŠê¼ˆìœ¼ë‹ˆ ì–´ë–»ê²Œ ë™ì‘í•˜ëŠ”ì§€ ë³´ì

```cpp
// connectì˜ ë¦¬í„´ìœ¼ë¡œ async_simple::coro::Lazyê°€ ë„˜ì–´ê°„ë‹¤ Lazyê°€ ë­”ì§€ ë´ì•¼í•œë‹¤
async_simple::coro::Lazy<resp_data> connect(std::string uri) {
  resp_data data{};

  // ...
```

```cpp
template <typename T = void>
class [[nodiscard]] Lazy : public detail::LazyBase<T, /*reschedule=*/false> {
  using Base = detail::LazyBase<T, false>;

  // ...
```

```cpp
template <typename T, bool reschedule>
class LazyBase {
 public:
  // ì–˜ê°€ coroutine êµ¬ì¡°ì²´ì„
    // coroutine êµ¬ì¡°ì²´ wrapperë¼ ìƒê°í•˜ë©´ í¸í•˜ë‹¤

  // ...
```