---
layout: default
title: "01. Player movement"
parent: "(Example4 - ì‹¬í”Œ ìŠˆíŒ…)"
grand_parent: "(Unreal C++ ğŸš€)"
nav_order: 1
---

## Table of contents
{: .no_toc .text-delta }

1. TOC
{:toc}

---

* ProjectëŠ” ì•„ë˜ì™€ ê°™ì€ ìˆœì„œë¡œ ì§„í–‰ ì˜ˆì •
    * Player movement
    * Animation
    * Shooting
    * Health / Death
    * Enemy AI
    * Win / Lose Conditions
* ì‹œì‘ì€ **Player movement!**

---

## Pawnê³¼ Characterì°¨ì´?

* ìš°ì„ , Pawnê³¼ Characterëª¨ë‘ ì‚¬ìš©ìê°€ possessí•˜ì—¬ ì»¨íŠ¸ë¡¤ì´ê°€ëŠ¥í•˜ë‹¤.
* ê·¸ëŸ¼ ì°¨ì´ëŠ” ë­˜ê¹Œ?
    * **Pawn** - 
    * **Character** - Pawnì˜ ìì†ì´ë‹¤. ë”°ë¼ì„œ Pawnì— íŠ¹ì • ê¸°ëŠ¥ì„ ì¶”ê°€í•œ ê°œë…ì´ë‹¤. ê·¸ íŠ¹ì • ê°œë…ì´ **Movement**!! 

* C++ë¡œ ë§Œë“  Characterë¥¼ Blueprintë¡œ ìƒì†í•´ ì—´ì–´ë³´ë©´, ì•„ë˜ì™€ ê°™ì´ Animationì´ ì¡´ì¬í•¨ì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.
* ì•„ì§ì€ ë¬´ìŠ¨ ê¸°ëŠ¥ì¸ì§„ ëª¨ë¥´ê² ìœ¼ë‚˜ ìš°ì„  ìˆë‹¤ë§Œ ì•Œê³ ìˆì!

<p align="center">
  <img src="https://taehyungs-programming-blog.github.io/blog/assets/images/unreal/unreal_cpp_4/ucpp4-1-1.png"/>
</p>

---

## ì´ë™ì ìš©

```cpp
UCLASS()
class SIMPLESHOOTER_API AShooterCharacter : public ACharacter
{
	GENERATED_BODY()

    // ...

private:
    // ì›€ì§ì„
	void MoveForward(float AxisValue);
	void MoveRight(float AxisValue);

    // íšŒì „
	void LookUpRate(float AxisValue);
	void LookRightRate(float AxisValue);
};
```

```cpp
void AShooterCharacter::SetupPlayerInputComponent(UInputComponent* PlayerInputComponent)
{
	Super::SetupPlayerInputComponent(PlayerInputComponent);

	PlayerInputComponent->BindAxis(TEXT("MoveForward"), this, &AShooterCharacter::MoveForward);
	PlayerInputComponent->BindAxis(TEXT("LookUp"), this, &APawn::AddControllerPitchInput);
	PlayerInputComponent->BindAxis(TEXT("MoveRight"), this, &AShooterCharacter::MoveRight);
	PlayerInputComponent->BindAxis(TEXT("LookRight"), this, &APawn::AddControllerYawInput);
	PlayerInputComponent->BindAxis(TEXT("LookUpRate"), this, &AShooterCharacter::LookUpRate);
	PlayerInputComponent->BindAxis(TEXT("LookRightRate"), this, &AShooterCharacter::LookRightRate);
	PlayerInputComponent->BindAction(TEXT("Jump"), EInputEvent::IE_Pressed, this, &ACharacter::Jump);
}

void AShooterCharacter::MoveForward(float AxisValue) 
{
	AddMovementInput(GetActorForwardVector() * AxisValue);
}

void AShooterCharacter::MoveRight(float AxisValue) 
{
	AddMovementInput(GetActorRightVector() * AxisValue);
}

void AShooterCharacter::LookUpRate(float AxisValue) 
{
	AddControllerPitchInput(AxisValue * RotationRate * GetWorld()->GetDeltaSeconds());
}

void AShooterCharacter::LookRightRate(float AxisValue) 
{
	AddControllerYawInput(AxisValue * RotationRate * GetWorld()->GetDeltaSeconds());
}
```

* Animationì´ ì ìš©ëœ ìƒíƒœê°€ ì•„ë‹ˆë¼ ê·¸ëƒ¥ ì„œìˆëŠ” ìƒíƒœë¡œ ì´ë™ë§Œ í•œë‹¤

---

## Skeletal Animation ë¶™ì´ê¸°

* ìš°ì„  **Skeletal Animation**ì´ë€ Skeletal Meshì— Animationì„ ë¶™ì´ëŠ”ê±°ë‹¤
* ë­”? Meshì— Skeletal(ë¼ˆ)ë¥¼ í• ë‹¹í•˜ê³  ê±°ê¸°ì— ë§ê²Œ Animationì„ ì ìš©í•´ ì¤€ë‹¤ê³  ìƒê°í•˜ë©´ ëœë‹¤.
* ì˜ˆì‹œë¡œ AnimationíŒŒì¼ì„ í•˜ë‚˜ ì—´ì–´ë³´ì

<p align="center">
  <img src="https://taehyungs-programming-blog.github.io/blog/assets/images/unreal/unreal_cpp_4/ucpp4-1-2.png"/>
</p>

* ì˜¤ë¥¸ìª½ ìœ„ì˜ Skeletalë²„íŠ¼ì„ ëˆ„ë¥´ë©´ Skeletalì´ ì–´ë–»ê²Œ ì ìš©ë˜ì–´ ìˆëŠ”ì§€ ë‚˜ì˜¨ë‹¤

<p align="center">
  <img src="https://taehyungs-programming-blog.github.io/blog/assets/images/unreal/unreal_cpp_4/ucpp4-1-3.png"/>
</p>

* ê·¸ëŸ¼ ì‹œí—˜ì‚¼ì•„ì„œ Blueprintì— ì ìš©í•´ ë³´ì

<p align="center">
  <img src="https://taehyungs-programming-blog.github.io/blog/assets/images/unreal/unreal_cpp_4/ucpp4-1-4.png"/>
</p>

* ì´ì œëŠ” ìƒí™©ì— ë§ê²Œ Animationì„ ë¶™ì´ê¸°ë§Œ í•˜ë©´ëœë‹¤.

---

## (Tips) Collision

* ê°€ë” íŠ¹ì • Objectì—ì„œ ì•„ë˜ ê·¸ë¦¼ê³¼ ê°™ì´ ì›ì¹˜ì•ŠëŠ” Collisionì´ ìƒì„±ë ìˆ˜ ìˆë‹¤
* ê·¸ëƒ¥ í´ë¦­ í›„ ì‚­ì œí•˜ë©´ ë¨.

<p align="center">
  <img src="https://taehyungs-programming-blog.github.io/blog/assets/images/unreal/unreal_cpp_4/ucpp4-1-5.png"/>
</p>

---

## Animation Blueprint

* ìš°ì„  Animation Blueprintë¥¼ í•˜ë‚˜ ìƒì„±í•´ ë³´ì

<p align="center">
  <img src="https://taehyungs-programming-blog.github.io/blog/assets/images/unreal/unreal_cpp_4/ucpp4-1-6.png"/>
</p>

* Skeletonì„ í•˜ë‚˜ ì§€ì •í•´ ì¤˜ì•¼í•œë‹¤

<p align="center">
  <img src="https://taehyungs-programming-blog.github.io/blog/assets/images/unreal/unreal_cpp_4/ucpp4-1-7.png"/>
</p>

* ë‹¤ìŒê³¼ ê°™ì´ AnimGraphë¥¼ êµ¬ì„±í•´ ë³´ì

<p align="center">
  <img src="https://taehyungs-programming-blog.github.io/blog/assets/images/unreal/unreal_cpp_4/ucpp4-1-8.png"/>
</p>

* Alphaê°€ ë‘ Animationì„ Blendí•´ì£¼ê¸°ì— ì ë‹¹íˆ ë³€ê²½í•˜ë©° í…ŒìŠ¤íŠ¸ í•´ë³´ì

---

## Blend Space í™œìš©

<p align="center">
  <img src="https://taehyungs-programming-blog.github.io/blog/assets/images/unreal/unreal_cpp_4/ucpp4-1-9.png"/>
</p>

---

### ì‹¤ì œ Blueprintì— ì ìš©í•˜ê¸°

* ìš°ì„  Blueprintì—ì„œ Animation Blueprintë¥¼ ì§€ì •

<p align="center">
  <img src="https://taehyungs-programming-blog.github.io/blog/assets/images/unreal/unreal_cpp_4/ucpp4-1-10.png"/>
</p>

<p align="center">
  <img src="https://taehyungs-programming-blog.github.io/blog/assets/images/unreal/unreal_cpp_4/ucpp4-1-11.png"/>
</p>

* í˜„ì¬ëŠ” ì†ë„ë§Œ ë°˜ì˜ëœ ìƒíƒœ(Angleì€ ë°˜ì˜ì•ˆë¨)

---

### Angleì„ ë°˜ì˜í•´ ë³´ì

* ì•Œì•„ì•¼ í•  ì ì€ Actorì˜ Transform ì •ë³´ë¥¼ ë°›ì„ìˆ˜ ìˆë‹¤ëŠ”ê²ƒ!

<p align="center">
  <img src="https://taehyungs-programming-blog.github.io/blog/assets/images/unreal/unreal_cpp_4/ucpp4-1-12.png"/>
</p>

* Transformì—ì„œ í•„ìš”í•œ ì •ë³´ëŠ” Rotationì¼ ê²ƒì´ë‹¤.
* êµ¬í•˜ëŠ” ë°©ë²•ì€ ë‹¤ìŒê³¼ ê°™ë‹¤
    * Pawnì˜ Transformì„ ë°›ëŠ”ë‹¤
    * Pawnì˜ Transformì€ Worldì¢Œí‘œê³„ì´ê¸°ì— Inverse Transform Directionì„ ì´ìš©í•´ Localì¢Œí‘œê³„ë¡œ ë°”ê¾¼ë‹¤
    * Xì¶•ë§Œì„ ì´ìš©í•´ Yawê°’ì„ êµ¬í•˜ë©´ Angleì„ êµ¬í• ìˆ˜ ìˆë‹¤

<p align="center">
  <img src="https://taehyungs-programming-blog.github.io/blog/assets/images/unreal/unreal_cpp_4/ucpp4-1-13.png"/>
</p>

---

### ë°œê±¸ìŒê³¼ ì†ë„ ë§ì¶”ê¸°

* í˜„ì¬ ì‹¤í–‰í•´ ë³´ë©´ ë°œê±¸ìŒì€ ë„ˆë¬´ ë¹ ë¥¸ë° ê±·ëŠ”ì†ë„ëŠ” ëŠë ¤ì„œ ë§ˆì¹˜ ì–¼ìŒìœ„ë¥¼ ë‹¬ë¦¬ëŠ”ê²ƒ ê°™ë‹¤

<p align="center">
  <img src="https://taehyungs-programming-blog.github.io/blog/assets/images/unreal/unreal_cpp_4/ucpp4-1-14.png"/>
</p>

* ë°œê±¸ìŒ ì‹œì‘ì´ 0.16ì´ˆ

<p align="center">
  <img src="https://taehyungs-programming-blog.github.io/blog/assets/images/unreal/unreal_cpp_4/ucpp4-1-15.png"/>
</p>

* ì¢…ë£Œê°€ 0.3ì´ˆ, í•œ ê±¸ìŒì— 0.14ì´ˆ ì •ë„ê°€ ê±¸ë¦¬ë©° Yì¶•ìœ¼ë¡œ ì–¼ë§ˆë‚˜ ì›€ì§ì˜€ë‚˜ í™•ì¸í•´ ë³´ë©´

<p align="center">
  <img src="https://taehyungs-programming-blog.github.io/blog/assets/images/unreal/unreal_cpp_4/ucpp4-1-16.png"/>
</p>

* ì‹œì‘ìœ„ì¹˜ 17.088 / ì¢…ë£Œìœ„ì¹˜ -28.42
* ì†ë„ = ê±°ë¦¬/ì‹œê°„ = -45.50/0.14 = -325.07
* ì´ì œ Blend Spaceì— ì ìš©í•˜ì

<p align="center">
  <img src="https://taehyungs-programming-blog.github.io/blog/assets/images/unreal/unreal_cpp_4/ucpp4-1-17.png"/>
</p>

---

## Gun

* Spawn í›„ Actorì— ë¶™ì„

```cpp
UCLASS()
class SIMPLESHOOTER_API AShooterCharacter : public ACharacter
{
	GENERATED_BODY()
    // ...

	UPROPERTY(EditDefaultsOnly)
	TSubclassOf<AGun> GunClass;

	UPROPERTY()
	AGun* Gun;
};
```

```cpp
void AShooterCharacter::BeginPlay()
{
	Super::BeginPlay();

	Gun = GetWorld()->SpawnActor<AGun>(GunClass);
	GetMesh()->HideBoneByName(TEXT("weapon_r"), EPhysBodyOp::PBO_None);
	Gun->AttachToComponent(GetMesh(), FAttachmentTransformRules::KeepRelativeTransform, TEXT("WeaponSocket"));
	Gun->SetOwner(this);
}
```

---

## Gun Shoot AND Particle Effects

```cpp
void AGun::PullTrigger() 
{
	UGameplayStatics::SpawnEmitterAttached(MuzzleFlash, Mesh, TEXT("MuzzleFlashSocket"));
}
```

---

## Player View Point

* ì´ì•Œì˜ í‘œì ì§€ë¥¼ êµ¬í•˜ê¸° ìœ„í•´ì„œ view point debugë¥¼ ì°ì–´ë³´ë ¤í•œë‹¤

```cpp
void AGun::PullTrigger() 
{
    // particle
	UGameplayStatics::SpawnEmitterAttached(MuzzleFlash, Mesh, TEXT("MuzzleFlashSocket"));

    // player view point
	APawn* OwnerPawn = Cast<APawn>(GetOwner());
	if (OwnerPawn == nullptr) return;
	AController* OwnerController = OwnerPawn->GetController();
	if (OwnerController == nullptr) return;

	FVector Location;
	FRotator Rotation;
	OwnerController->GetPlayerViewPoint(Location, Rotation);

	DrawDebugCamera(GetWorld(), Location, Rotation, 90, 2, FColor::Red, true);
}
```

* ì‚¬ê²©ì„ í•˜ë©´ ì•„ë˜ì™€ ê°™ì´ view point debugê°€ ì°íŒë‹¤

<p align="center">
  <img src="https://taehyungs-programming-blog.github.io/blog/assets/images/unreal/unreal_cpp_4/ucpp4-1-18.png"/>
</p>

---

## Line Tracing

* ì•ì—ì„œ êµ¬í•œ View Pointì— ì§ì„ ì„ ê·¸ì–´ DebugPoint ì ì„ ì°ì

```cpp
void AGun::PullTrigger() 
{
	UGameplayStatics::SpawnEmitterAttached(MuzzleFlash, Mesh, TEXT("MuzzleFlashSocket"));

	APawn* OwnerPawn = Cast<APawn>(GetOwner());
	if (OwnerPawn == nullptr) return;
	AController* OwnerController = OwnerPawn->GetController();
	if (OwnerController == nullptr) return;

	FVector Location;
	FRotator Rotation;
	OwnerController->GetPlayerViewPoint(Location, Rotation);

	FVector End = Location + Rotation.Vector() * MaxRange;
	// TODO: LineTrace
	FHitResult Hit;
	bool bSuccess = GetWorld()->LineTraceSingleByChannel(Hit, Location, End, ECollisionChannel::ECC_GameTraceChannel1);
	if (bSuccess)
	{
		DrawDebugPoint(GetWorld(), Hit.Location, 20, FColor::Red, true);
	}
}
```

<p align="center">
  <img src="https://taehyungs-programming-blog.github.io/blog/assets/images/unreal/unreal_cpp_4/ucpp4-1-19.png"/>
</p>

---

## Actorì— ë°ë¯¸ì§€ ì…íˆê¸°

```cpp
void AGun::PullTrigger() 
{
	// ...

	FHitResult Hit;
	bool bSuccess = GetWorld()->LineTraceSingleByChannel(Hit, Location, End, ECollisionChannel::ECC_GameTraceChannel1);
	if (bSuccess)
	{
		FVector ShotDirection = -Rotation.Vector();
		UGameplayStatics::SpawnEmitterAtLocation(GetWorld(), ImpactEffect, Hit.Location, ShotDirection.Rotation());
		
		AActor* HitActor = Hit.GetActor();
		if (HitActor != nullptr)
		{
			FPointDamageEvent DamageEvent(Damage, Hit, ShotDirection, nullptr);
			HitActor->TakeDamage(Damage, DamageEvent, OwnerController, this);
		}
	}

}
```

```cpp
float AShooterCharacter::TakeDamage(float DamageAmount, struct FDamageEvent const &DamageEvent, class AController *EventInstigator, AActor *DamageCauser) 
{
    float DamageToApply = Super::TakeDamage(DamageAmount, DamageEvent, EventInstigator, DamageCauser);
    DamageToApply = FMath::Min(Health, DamageToApply);
    Health -= DamageToApply;
    UE_LOG(LogTemp, Warning, TEXT("Health left %f"), Health);

    return DamageToApply;
}
```

---

## Blend by bool

* boolì„ ì´ìš©í•˜ Blendê°€ ê°€ëŠ¥í•˜ë‹¤

<p align="center">
  <img src="https://taehyungs-programming-blog.github.io/blog/assets/images/unreal/unreal_cpp_4/ucpp4-1-20.png"/>
</p>

---

## Blueprint Pure Nodeë§Œë“¤ê¸°

* ì¼ë‹¨ **Blueprint Pure**ë€ ì‹¤í–‰í•€ì´ ì—†ì´ ë…ë¦½ì ìœ¼ë¡œ ì‹¤í–‰ì´ ê°€ëŠ¥í•œ í•¨ìˆ˜ë¥¼ ì˜ë¯¸í•œë‹¤
* ê°€ë ¹ ì•„ë˜ì˜ CastToShooterCharacterì˜ ê²½ìš° Pureí•˜ì§€ì•Šê³ , IsDeadëŠ” Pureí•˜ë‹¤

<p align="center">
  <img src="https://taehyungs-programming-blog.github.io/blog/assets/images/unreal/unreal_cpp_4/ucpp4-1-21.png"/>
</p>

```cpp
UFUNCTION(BlueprintPure)
bool IsDead() const;
```

