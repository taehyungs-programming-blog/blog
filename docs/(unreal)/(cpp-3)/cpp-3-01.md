---
layout: default
title: "01. ì‹œì‘ ë° Pawnë§Œë“¤ê¸°"
parent: "(Unreal C++ Part3 - 3D Tank)"
grand_parent: "(Unreal ğŸš€)"
nav_order: 1
---

## Table of contents
{: .no_toc .text-delta }

1. TOC
{:toc}

---

## í”„ë¡œì íŠ¸ ì„¸íŒ…

* ê¸°ë³¸ í”„ë¡œì íŠ¸ ì„¸íŒ…ì€ [ì—¬ê¸°]()ì„œ ë‹¤ìš´ë°›ì
    * ê¸°ë³¸ì„¸íŒ…í•˜ëŠ”ë° ë„ˆë¬´ ì˜¤ë˜ê±¸ë¦¼ ã…;;
* Editor ìˆ˜ì •
    * Edit -> Editor Perferences -> General -> Source Code -> Visual Studio Code

---

## BasePawn Class

* [Get Code ğŸŒ]()

```
BasePawn --- Main Tank
          |
          -- Other Tank (enemy)
```

* ì´ëŸ°ì‹ìœ¼ë¡œ ë§Œë“¤ì˜ˆì •! í•´ë³´ì!
* Tools -> New C++ Clases ... -> ??? **(ì—¬ê¸°ì„œ ë­˜ ì„ íƒí•˜ì§€?)**

* ì„¸ ê°€ì§€ ì˜µì…˜ì´ ìˆë‹¤.
* **Actor**
    * ë¬¼ë¦¬ ì ìš©ì´ ê°€ëŠ¥
    * Meshë¥¼ ì‚¬ìš©ê°€ëŠ¥(ëˆˆìœ¼ë¡œ ë³¼ ìˆ˜ ìˆë‹¤)
* **Pawn**
    * Possessedê°€ëŠ¥(ì»¨íŠ¸ë¡¤ëŸ¬ë¥¼ ë¶™ì¼ìˆ˜ ìˆë‹¤)
* **Character**
    * Movementë¥¼ ì ìš©ê°€ëŠ¥(ë‹¬ë¦¬ê¸°, ìˆ˜ì˜, ë‚ ê¸° ë“± ì²˜ë¦¬ê°€ ê°€ëŠ¥)

* í ? ë‚´ê°€ë§Œë“œëŠ”ê±´ Tankë‹ˆ **Pawn**ì •ë„ê°€ ì ë‹¹í•˜ê² êµ°?
* Pawnìœ¼ë¡œ BasePawnì„ í•˜ë‚˜ ìƒì„±í•˜ì

---

### BasePawnë‚´ì— Componentì¶”ê°€

* ìš°ì„  Componentì˜ ìƒì†ê´€ê³„ë¥¼ ì•Œì•„ì•¼ í•œë‹¤

```
USceneComponent --- Handles collision
                 |
                 -- UStaticMeshComponent
```

* **USceneComponent**
    * ìµœ ìƒìœ„ í´ë˜ìŠ¤ë¡œ transform, ë‹¤ë¥¸ componentì˜ attachë¥¼ ë‹´ë‹¹í•œë‹¤
    * ì°¸ê³ ë¡œ Actorì—ì„œ ì‚¬ìš©ë˜ëŠ” RootComponentê°€ USceneComponentì´ë‹¤
* **Handles collision**
    * ì¶©ëŒì„ ë‹´ë‹¹í•œë‹¤
* **UStaticMeshComponent**
    * Meshë¥¼ ë‹´ë‹¹í•œë‹¤ (ë³´ì´ëŠ” ë¶€ë¶„)

* ì´ë¥¼ ë°”íƒ•ìœ¼ë¡œ BasePawnì— Componentë¥¼ ì¶”ê°€í•´ ë³´ì
* BasePawnì—ëŠ” ì•„ë˜ì™€ ê°™ì€ê²Œ ë“¤ì–´ìˆì–´ì•¼ í•œë‹¤.
    * Base Mesh(Tank ëª¸ì²´)
    * Turrent Mesh(Tank ë¨¸ë¦¬)
    * Capsule(ì¶©ëŒì„ ìœ„í•˜ì—¬)
    * Projectile Spawn Point(USceneComponentì •ë„ë©´ ì ë‹¹í• ë“¯!)


```cpp
// header
private:
    // ì „ë°©ì„ ì–¸ì— ìœ ì˜í•˜ì(ë³´í†µ ì „ë°©ì„ ì–¸í•¨.)
    UPROPERTY(VisibleAnywhere, BlueprintReadOnly, Category = "Components", meta = (AllowPrivateAccess = "true"))
	class UCapsuleComponent* CapsuleComp;

    UPROPERTY(VisibleAnywhere, BlueprintReadOnly, Category = "Components", meta = (AllowPrivateAccess = "true"))
	UStaticMeshComponent* BaseMesh;

    UPROPERTY(VisibleAnywhere, BlueprintReadOnly, Category = "Components", meta = (AllowPrivateAccess = "true"))
    UStaticMeshComponent* TurrentMesh;

    UPROPERTY(VisibleAnywhere, BlueprintReadOnly, Category = "Components", meta = (AllowPrivateAccess = "true"))
    USceneComponent* ProjectileSpawnPoint;
```

```cpp
// cpp
#include "Components/CapsuleComponent.h"
#include "Components/StaticMeshComponent.h"

// ...

ABasePawn::ABasePawn()
{
	PrimaryActorTick.bCanEverTick = true;

	CapsuleComp = CreateDefaultSubobject<UCapsuleComponent>(TEXT("Capsule Collider"));

    // Capsuleì„ ê·¸ëƒ¥ Rootë¡œ ë¶™ì´ì,
        // ì–´ì°¨í”¼ í˜„ì¬ëŠ” í•´ì•¼í•  ë™ì‘ì´ ê±°ì˜ ë¹„ìŠ·í•¨.
    RootComponent = CapsuleComp;

    BaseMesh = CreateDefaultSubobject<UStaticMeshComponent>(TEXT("Base Mesh"));
    BaseMesh->SetupAttachment(CapsuleComp);

    TurrentMesh = CreateDefaultSubobject<UStaticMeshComponent>(TEXT("Turrent Mesh"));
    TurrentMesh->SetupAttachment(BaseMesh);

    ProjectileSpawnPoint = CreateDefaultSubobject<USceneComponent>(TEXT("Projectile Spawn Point"));
    ProjectileSpawnPoint->SetupAttachment(TurrentMesh);
}
```

* ì´ê±´ ì°¸ê³ , Blueprint EventGraphì—ì„œ C++ì—ì„œ ìƒì„±í•œ ë³€ìˆ˜ë¥¼ Get, Setí•˜ê³  ì‹¶ë‹¤ë©´?

```cpp
private:
    // BlueprintReadWriteë¥¼ ì„ ì–¸
	UPROPERTY(EditAnywhere, BlueprintReadWrite)
	int32 val;

    // private ë³€ìˆ˜ë¥¼ blueprintì—ì„œ ì ‘ê·¼ì´ ê°€ëŠ¥í•˜ê²Œ í•˜ê³ ì‹¶ë‹¤ë©´?
    UPROPERTY(EditAnywhere, BlueprintReadWrite, meta = (AllowPrivateAccess = "true"))
	int32 val2;

    // Categoryë¥¼ ì§€ì •í•˜ê³  ì‹¶ë‹¤ë©´
    UPROPERTY(EditAnywhere, BlueprintReadWrite, Category = "Hello Category")
	int32 val2;
```

---

### Blueprintë¡œ ìƒì†í•´ ë³´ê¸°

* ì•„ë˜ì™€ ê°™ì´ ìƒì„±í•´ ë³´ë©´

<p align="center">
  <img src="https://taehyungs-programming-blog.github.io/blog/assets/images/unreal/unreal_cpp_3/ucpp3-1-1.png"/>
</p>

* ë‚´ë¶€êµ¬ì¡°ê°€ ìƒê°í–ˆë˜ê²ƒê³¼ ë™ì¼í•˜ê²Œ ìƒì„±ë¨ì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.

<p align="center">
  <img src="https://taehyungs-programming-blog.github.io/blog/assets/images/unreal/unreal_cpp_3/ucpp3-1-2.png"/>
</p>

* ì! ì´ì œ Meshë¥¼ ë„£ì–´ë³´ì.
    * ì£¼ì˜í•  ì ì€ Projectile Spawn Pointë¥¼ Meshì™€ ë„ˆë¬´ ê°€ê¹ê²Œ í•˜ë©´ ì„œë¡œ ì¶©ëŒì´ ì¼ì–´ë‚œë‹¤
    * ì¢€ ë–¨ì–´ì ¸ ìƒì„±í•˜ëŠ” ê²ƒì„ ì¶”ì²œ!

<p align="center">
  <img src="https://taehyungs-programming-blog.github.io/blog/assets/images/unreal/unreal_cpp_3/ucpp3-1-3.png"/>
</p>

---

### C++ë¡œ ìƒì†í•´ ë³´ê¸°

* ì‰?? ì´ê²Œ ì™œ í•„ìš”í•˜ì§€?
* Tankì™€ Turretì˜ ê¸°ëŠ¥ì´ ë‹¤ë¥´ê¸°ì— í•„ìš”í•˜ë‹¤!

<p align="center">
  <img src="https://taehyungs-programming-blog.github.io/blog/assets/images/unreal/unreal_cpp_3/ucpp3-1-4.png"/>
</p>

```cpp
UCLASS()
class TOONTANKS_API ATank : public ABasePawn
{
	GENERATED_BODY()

public:
	ATank();
private:
    // Cameraì™€ Spring Armì„ ë¶™ì¸ë‹¤
	UPROPERTY(VisibleAnywhere, Category = "Components")
	class USpringArmComponent* SpringArm;

	UPROPERTY(VisibleAnywhere, Category = "Components")
	class UCameraComponent* Camera;
};
```

```cpp
ATank::ATank()
{
    SpringArm = CreateDefaultSubobject<USpringArmComponent>(TEXT("Spring Arm"));
    SpringArm->SetupAttachment(RootComponent);

    Camera = CreateDefaultSubobject<UCameraComponent>(TEXT("Camera"));
    Camera->SetupAttachment(SpringArm);
}
```

* ì£¼ì˜í•  ì ì€ Tank Blueprintì—ì„œ Parentë¥¼ ë°”ê¿”ì¤˜ì•¼í•œë‹¤ëŠ” ì !

<p align="center">
  <img src="https://taehyungs-programming-blog.github.io/blog/assets/images/unreal/unreal_cpp_3/ucpp3-1-5.png"/>
</p>

---

### Possessì™€ Inputì²˜ë¦¬

* ìš°ì„  Possessì§€ì •

<p align="center">
  <img src="https://taehyungs-programming-blog.github.io/blog/assets/images/unreal/unreal_cpp_3/ucpp3-1-6.png"/>
</p>

* ì´ì œ ì¸í’‹ì²˜ë¦¬
    * ì°¸ê³ ë¡œ í˜„ì¬ Key Mappingì€ ë‹¤ ëœ ìƒíƒœì´ë‹¤.
    * í˜¹ì‹œ ë³€ê²½ì„ ì›í•˜ëŠ” ê²½ìš° Project Settings -> Engine -> Inputì—ì„œ Action Mappingsìˆ˜ì •
* BasePawnì—ì„œ `SetupPlayerInputComponent`ë¥¼ ì œê±°
    * Turretì—ì„œëŠ” Inputì²˜ë¦¬ê°€ í•„ìš”ì—†ê¸° ë•Œë¬¸ì´ë‹¤.

```cpp
// Tankì— ì•„ë˜ë¥¼ ì¶”ê°€
virtual void SetupPlayerInputComponent(class UInputComponent *PlayerInputComponent) override;
```

```cpp
void ATank::SetupPlayerInputComponent(UInputComponent* PlayerInputComponent)
{
    Super::SetupPlayerInputComponent(PlayerInputComponent);

    PlayerInputComponent->BindAxis(TEXT("MoveForward"), this, &ATank::Move);
}

void ATank::Move(float Value)
{
    UE_LOG(LogTemp, Warning, TEXT("Value: %f"), Value);
}
```

---

## Tankë¥¼ ì›€ì§ì—¬ ë³´ì

* ìš°ì„  í˜„ì¬ Tankì˜ xì¶•(ë¹¨ê°„ìƒ‰)ì´ ì „ì§„ì„ì„ ê¸°ì–µí•˜ì

<p align="center">
  <img src="https://taehyungs-programming-blog.github.io/blog/assets/images/unreal/unreal_cpp_3/ucpp3-1-7.png"/>
</p>

```cpp
void ATank::Move(float Value)
{
    FVector DeltaLocation = FVector::ZeroVector;
    DeltaLocation.X = Value;

    // xì¶•ì— Offsetì„ ì£¼ëŠ” ë°©ì‹ìœ¼ë¡œ ì´ë™ì‹œí‚¨ë‹¤
    AddActorLocalOffset(DeltaLocation);
}
```

* ê·¸ëŸ°ë° ë„ˆë¬´ ëŠë¦°ë°??

```cpp
void ATank::Move(float Value)
{
    FVector DeltaLocation = FVector::ZeroVector;
    DeltaLocation.X = Value;
    // X = Value * DeltaTime * Speed
    DeltaLocation.X = Value * Speed * UGameplayStatics::GetWorldDeltaSeconds(this);
    AddActorLocalOffset(DeltaLocation);
}
```

* ì´ë²ˆì—” íšŒì „ì„ ì ìš©í•´ ë³´ì
* ìš°ì„  Axis Mapping

<p align="center">
  <img src="https://taehyungs-programming-blog.github.io/blog/assets/images/unreal/unreal_cpp_3/ucpp3-1-8.png"/>
</p>

```cpp
void ATank::SetupPlayerInputComponent(UInputComponent* PlayerInputComponent)
{
    Super::SetupPlayerInputComponent(PlayerInputComponent);

    PlayerInputComponent->BindAxis(TEXT("MoveForward"), this, &ATank::Move);

    // Event Bind
    PlayerInputComponent->BindAxis(TEXT("Turn"), this, &ATank::Turn);
}

// ...

void ATank::Turn(float Value)
{
    FRotator DeltaRotation = FRotator::ZeroRotator;
    // Yaw = Value * DeltaTime * TurnRate
    DeltaRotation.Yaw = Value * TurnRate * UGameplayStatics::GetWorldDeltaSeconds(this);
    AddActorLocalRotation(DeltaRotation, true);
}
```

---

## ë§ˆìš°ìŠ¤ë¥¼ ì´ìš©í•˜ì—¬ Tank í—¤ë“œ íšŒì „í•˜ê¸°

* ìš°ì„  ë§ˆìš°ìŠ¤ì˜ ì…ë ¥ì„ ì²˜ë¦¬í•´ì•¼í•œë‹¤

```cpp
UCLASS()
class TOONTANKS_API ATank : public ABasePawn
{
	GENERATED_BODY()

    // ...

    // ìš°ì„  PlayerControllerë¥¼ ì¤€ë¹„í•˜ì
	APlayerController* PlayerControllerRef;
};
```

```cpp
void ATank::BeginPlay()
{
    Super::BeginPlay();

    PlayerControllerRef = Cast<APlayerController>(GetController());
}
```

```cpp
void ATank::Tick(float DeltaTime)
{
    Super::Tick(DeltaTime);

    if (PlayerControllerRef)
    {
        // ëŒ€ëµ ë§ˆìš°ìŠ¤ ì»¤ì„œ ì•„ë˜ Hit Pointì— êµ¬ë¥¼ ê·¸ë¦°ë‹¤
        FHitResult HitResult;
        PlayerControllerRef->GetHitResultUnderCursor(
            ECollisionChannel::ECC_Visibility, 
            false, 
            HitResult);

        DrawDebugSphere(
            GetWorld(),
            HitResult.ImpactPoint,
            25.f,
            12,
            FColor::Red,
            false,
            -1.f);
    }
}
```

<p align="center">
  <img src="https://taehyungs-programming-blog.github.io/blog/assets/images/unreal/unreal_cpp_3/ucpp3-1-9.png"/>
</p>

### ë§ˆìš°ìŠ¤ë¡œ í¬íƒ‘ íšŒì „ì‹œí‚¤ê¸°

```cpp
void ABasePawn::RotateTurret(FVector LookAtTarget)
{
    // í˜„ì¬ Locationì—ì„œ íšŒì „í•˜ê³ ìí•˜ëŠ” ë°©í–¥ìœ¼ë¡œ Vectorë¥¼ ë§Œë“¤ê³ 
    FVector ToTarget = LookAtTarget - TurretMesh->GetComponentLocation();

    // Rotatorë¥¼ êµ¬í•´ íšŒì „ì‹œí‚¨ë‹¤
    FRotator LookAtRotation = FRotator(0.f, ToTarget.Rotation().Yaw, 0.f);
    TurretMesh->SetWorldRotation(LookAtRotation);
}
```

<p align="center">
  <img src="https://taehyungs-programming-blog.github.io/blog/assets/images/unreal/unreal_cpp_3/ucpp3-1-1.svg"/>
</p>
