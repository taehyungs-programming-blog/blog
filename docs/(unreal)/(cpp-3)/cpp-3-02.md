---
layout: default
title: "02. Tower(ì ) ë§Œë“¤ê¸°"
parent: "(Unreal C++ Part3 - 3D Tank)"
grand_parent: "(Unreal ğŸš€)"
nav_order: 1
---

## Table of contents
{: .no_toc .text-delta }

1. TOC
{:toc}

---

* ì ì„ ë§Œë“¤ì–´ ë³´ì.

<p align="center">
  <img src="https://taehyungs-programming-blog.github.io/blog/assets/images/unreal/unreal_cpp_3/ucpp3-2-1.png"/>
</p>

```cpp
UCLASS()
class TOONTANKS_API ATower : public ABasePawn
{
	GENERATED_BODY()

public:

	virtual void Tick(float DeltaTime) override;

protected:
	// Called when the game starts or when spawned
	virtual void BeginPlay() override;

private:

    // Tankë¥¼ ì¤€ë¹„í•œë‹¤
	class ATank* Tank;

	UPROPERTY(EditDefaultsOnly, Category = "Combat")
	float FireRange = 300.f;
};
```

* ìš°ì„  Tankì˜ ìœ„ì¹˜ë¡œ í—¤ë“œë§Œ ëŒë ¤ë³´ì.

```cpp
void ATower::Tick(float DeltaTime)
{
    Super::Tick(DeltaTime);

    // Find the distance to the Tank
    if (Tank)
    {
        float Distance = FVector::Dist(GetActorLocation(), Tank->GetActorLocation());

        if (Distance <= FireRange)
        {
            RotateTurret(Tank->GetActorLocation());
        }
    }
}

void ATower::BeginPlay()
{
    Super::BeginPlay();

    // Tankë¥¼ ì¤€ë¹„í•˜ê³ 
    Tank = Cast<ATank>(UGameplayStatics::GetPlayerPawn(this, 0));
}
```

---

## Fire Timer

* ë¬´í•œìœ¼ë¡œ ì  ìˆ˜ëŠ” ì—†ê¸°ì— Timerë¥¼ ë„£ì

```cpp
void ATower::BeginPlay()
{
    Super::BeginPlay();

    Tank = Cast<ATank>(UGameplayStatics::GetPlayerPawn(this, 0));

    // íƒ€ì´ë¨¸ë¥¼ ê±¸ê³ 
    GetWorldTimerManager().SetTimer(FireRateTimerHandle, this, &ATower::CheckFireCondition, FireRate, true);
}

void ATower::CheckFireCondition()
{
    if (InFireRange())
    {
        Fire();
    }
}

bool ATower::InFireRange()
{
    if (Tank)
    {
        float Distance = FVector::Dist(GetActorLocation(), Tank->GetActorLocation());
        if (Distance <= FireRange)
        {
            return true;
        }
    }

    return false;
}
```