---
layout: default
title: "02. Enemy AI"
parent: "(Unreal C++ Part3 - Simple Shooter)"
grand_parent: "(Unreal ğŸš€)"
nav_order: 1
---

## Table of contents
{: .no_toc .text-delta }

1. TOC
{:toc}

---

## AI Controller ì¤€ë¹„í•˜ê¸°

* C++ `AAIController` ìƒì„±

```cpp
UCLASS()
class SIMPLESHOOTER_API AShooterAIController : public AAIController
{
	GENERATED_BODY()
	
};
```

* BP_ShooterCharacterì— Pawn, AI Controller Classë¥¼ BP_ShooterAIControllerë¡œ ì§€ì •í•œë‹¤

<p align="center">
  <img src="https://taehyungs-programming-blog.github.io/blog/assets/images/unreal/unreal_cpp_4/ucpp4-2-1.png"/>
</p>

---

## AI ì¡°ì¤€

```cpp
void AShooterAIController::BeginPlay() 
{
    Super::BeginPlay();

    // Player ì–»ê³  êµ¬ê²½
    APawn* PlayerPawn = UGameplayStatics::GetPlayerPawn(GetWorld(), 0);

    // ì–˜ë¥¼ ë´ë¼
    SetFocus(PlayerPawn);
}
```

---

## ì¢€ ê¸°ëŠ¥ì„ ì¶”ê°€í•´ ë³´ì

```cpp
void AShooterAIController::Tick(float DeltaSeconds) 
{
    Super::Tick(DeltaSeconds);

    APawn *PlayerPawn = UGameplayStatics::GetPlayerPawn(GetWorld(), 0);

    if (LineOfSightTo(PlayerPawn))
    {
        SetFocus(PlayerPawn);
        MoveToActor(PlayerPawn, AcceptanceRadius);
    }
    else
    {
        ClearFocus(EAIFocusPriority::Gameplay);
        StopMovement();
    }
}
```

---

## BehaviorTree í™œìš©

* BehaviorTreeë¥¼ ì“°ë ¤ë©´ ë‘ ê°€ì§€ë¥¼ ì•Œì•„ì•¼í•œë‹¤
    * **Behavior Tree** - Behavior TreeëŠ” ê³„ì¸µì ìœ¼ë¡œ êµ¬ì„±ëœ ë…¸ë“œì˜ ì§‘í•©ìœ¼ë¡œ, AI ìºë¦­í„°ì˜ í–‰ë™ì„ ì •ì˜í•©ë‹ˆë‹¤. ê° ë…¸ë“œëŠ” íŠ¹ì • í–‰ë™ì´ë‚˜ ì¡°ê±´ì„ ë‚˜íƒ€ë‚´ë©°, íŠ¸ë¦¬ì˜ ë£¨íŠ¸ì—ì„œ ì‹œì‘í•˜ì—¬ í•˜ìœ„ ë…¸ë“œë¡œ ë‚´ë ¤ê°€ë©´ì„œ í‰ê°€ë©ë‹ˆë‹¤. 
    * **Black Board** - BlackboardëŠ” Behavior Treeê°€ ì‹¤í–‰ë˜ëŠ” ë™ì•ˆ AI ìºë¦­í„°ì˜ ìƒíƒœë¥¼ ì¶”ì í•˜ê³  ê´€ë¦¬í•˜ëŠ” ë° ì‚¬ìš©ë˜ëŠ” ë°ì´í„° ì €ì¥ì†Œì…ë‹ˆë‹¤. í‚¤ì™€ ê°’ì˜ ìŒìœ¼ë¡œ êµ¬ì„±ë˜ë©°, ì´ëŸ¬í•œ í‚¤ë¥¼ ì‚¬ìš©í•˜ì—¬ Behavior Tree ë‚´ì—ì„œ ì¡°ê±´ì„ ê²€ì‚¬í•˜ê±°ë‚˜ ì‘ì—…ì„ ìˆ˜í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
    * ì˜ˆë¥¼ ë“¤ì–´, "IsPlayerVisible"ì´ë¼ëŠ” í‚¤ê°€ ìˆê³  ì´ ê°’ì´ ì°¸ì¸ ê²½ìš° ìºë¦­í„°ê°€ í”Œë ˆì´ì–´ë¥¼ ì¶”ì í•˜ëŠ” ì‘ì—…ì„ ìˆ˜í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ì™€ ê°™ì´ Blackboardë¥¼ ì‚¬ìš©í•˜ë©´ ìœ ì—°í•œ í–‰ë™ê³¼ ìƒíƒœ ë³€í™”ë¥¼ êµ¬í˜„í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
* C++ì½”ë“œì—ì„œ BehaviorTreeë¥¼ ì‹¤í–‰í•˜ê²Œ ë§Œë“¤ì–´ ë³´ì.

```cpp
void AShooterAIController::BeginPlay() 
{
    Super::BeginPlay();

    if (AIBehavior != nullptr)
    {
        RunBehaviorTree(AIBehavior);
    }
}
```

---

### C++ì½”ë“œì—ì„œ Blackboard Keyì¶”ê°€

```cpp
void AShooterAIController::BeginPlay() 
{
    Super::BeginPlay();

    if (AIBehavior != nullptr)
    {
        RunBehaviorTree(AIBehavior);

        APawn *PlayerPawn = UGameplayStatics::GetPlayerPawn(GetWorld(), 0);

        GetBlackboardComponent()->SetValueAsVector(TEXT("PlayerLocation"), PlayerPawn->GetActorLocation());
    }
}
```

<p align="center">
  <img src="https://taehyungs-programming-blog.github.io/blog/assets/images/unreal/unreal_cpp_4/ucpp4-2-2.png"/>
</p>

---

### Sequence ì ìš©í•´ ë³´ê¸°

* ë”±íˆ ì–´ë µì§„ ì•Šì•„ ì„¤ëª…ì€ ìƒëµ ...

<p align="center">
  <img src="https://taehyungs-programming-blog.github.io/blog/assets/images/unreal/unreal_cpp_4/ucpp4-2-3.png"/>
</p>

* ë§Œì•½ ì›€ì§ì´ì§€ ì•ŠëŠ”ë‹¤ë©´?
* BP_ShooterAIControllerì˜ AIBehaviorê°€ ì„¤ì •ë˜ì—ˆë‚˜ í™•ì¸í•´ ë³´ì.

<p align="center">
  <img src="https://taehyungs-programming-blog.github.io/blog/assets/images/unreal/unreal_cpp_4/ucpp4-2-4.png"/>
</p>

---

### Decoratorsì™€ Selectors

<p align="center">
  <img src="https://taehyungs-programming-blog.github.io/blog/assets/images/unreal/unreal_cpp_4/ucpp4-2-5.png"/>
</p>

---

### Behavior Tree Task C++ë¡œ ë§Œë“¤ê¸°

```cpp
UCLASS()
class SIMPLESHOOTER_API UBTTask_ClearBlackboardValue : public UBTTask_BlackboardBase
{
	GENERATED_BODY()

public:
	UBTTask_ClearBlackboardValue();
};
```

```cpp
UBTTask_ClearBlackboardValue::UBTTask_ClearBlackboardValue() 
{
    NodeName = "Clear Blackboard Value";
}
```

* ì´ëŸ°ì‹ìœ¼ë¡œ ì‚¬ìš©ê°€ëŠ¥

<p align="center">
  <img src="https://taehyungs-programming-blog.github.io/blog/assets/images/unreal/unreal_cpp_4/ucpp4-2-6.png"/>
</p>

---

### Behavior Tree Task ì¢€ ë” í™œìš©í•´ ë³´ê¸° - 1

```cpp
EBTNodeResult::Type UBTTask_ClearBlackboardValue::ExecuteTask(UBehaviorTreeComponent &OwnerComp, uint8 *NodeMemory) 
{
    Super::ExecuteTask(OwnerComp, NodeMemory);

    OwnerComp.GetBlackboardComponent()->ClearValue(GetSelectedBlackboardKey());

    return EBTNodeResult::Succeeded;
}
```

---

### Behavior Tree Task ì¢€ ë” í™œìš©í•´ ë³´ê¸° - 2 : Pawn

```cpp
EBTNodeResult::Type UBTTask_Shoot::ExecuteTask(UBehaviorTreeComponent &OwnerComp, uint8 *NodeMemory) 
{
    Super::ExecuteTask(OwnerComp, NodeMemory);

    if (OwnerComp.GetAIOwner() == nullptr)
    {
        return EBTNodeResult::Failed;
    }

    AShooterCharacter* Character = Cast<AShooterCharacter>(OwnerComp.GetAIOwner()->GetPawn());
    if (Character == nullptr)
    {
        return EBTNodeResult::Failed;
    }

    Character->Shoot();

    return EBTNodeResult::Succeeded;
}
```
