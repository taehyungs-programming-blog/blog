---
layout: default
title: "01-01. UPrimaryDataAsset"
parent: "(01. UE ê´€ë ¨ ê¸°ë³¸ ì´ë¡ ì •ì˜)"
grand_parent: "(UE Lyra Code Review 2025Ver)"
nav_order: 1
---

## Table of contents
{: .no_toc .text-delta }

1. TOC
{:toc}

---

* ë°ì´í„° ì—ì…‹ ê´€ë¦¬
    * ê²Œì„ì˜ ì •ì  ë°ì´í„°ë¥¼ ê´€ë¦¬í•˜ê¸° ìœ„í•œ ê¸°ë³¸ í´ë˜ìŠ¤ì…ë‹ˆë‹¤
    * ì—ë””í„°ì—ì„œ ìƒì„±í•˜ê³  ìˆ˜ì •í•  ìˆ˜ ìˆëŠ” ë°ì´í„° ì»¨í…Œì´ë„ˆ ì—­í• ì„ í•©ë‹ˆë‹¤
* ì—ì…‹ ë²ˆë“¤ë§
    * ì½˜í…ì¸ ë¥¼ íŒ¨í‚¤ì§•í•˜ê³  ê´€ë¦¬í•˜ëŠ”ë° ì‚¬ìš©ë©ë‹ˆë‹¤
    * ê²Œì„ ëŸ°íƒ€ì„ì— ë™ì ìœ¼ë¡œ ë¡œë“œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤
* ì£¼ìš” ì‚¬ìš© ì‚¬ë¡€
    * ê²Œì„ ì„¤ì • ë°ì´í„°
    * ìºë¦­í„° ë°ì´í„°
    * ê²½í—˜ì¹˜ ì •ì˜ (ê·€í•˜ì˜ HakExperienceDefinition ì˜ˆì‹œì²˜ëŸ¼)
    * ì•„ì´í…œ ì •ë³´
    * ê¸°íƒ€ ì •ì  ê²Œì„ ë°ì´í„°

> ì—­ì‹œ ì´ë ‡ê²Œë§Œ ë³´ë©´ ë¬´ìŠ¨ ë§ì¸ì§€? ğŸ¤ª

---

## ì–˜ì‹œ

### ê¸°ë³¸ ë°ì´í„° ì—ì…‹ ì •ì˜

```cpp
// ê¸°ë³¸ ë°ì´í„° ì—ì…‹ ì •ì˜

USTRUCT(BlueprintType)
struct FCharacterStats
{
    GENERATED_BODY()

    UPROPERTY(EditAnywhere, BlueprintReadOnly)
    float Health = 100.0f;

    UPROPERTY(EditAnywhere, BlueprintReadOnly)
    float MoveSpeed = 600.0f;
};

UCLASS()
class GAME_API UCharacterDataAsset : public UPrimaryDataAsset
{
    GENERATED_BODY()

public:
    // ì—ë””í„°ì—ì„œ ìˆ˜ì • ê°€ëŠ¥í•œ ê¸°ë³¸ ë°ì´í„°
    UPROPERTY(EditDefaultsOnly, BlueprintReadOnly, Category = "Character")
    FCharacterStats BaseStats;

    // ì—ì…‹ ì°¸ì¡° ì˜ˆì‹œ
    UPROPERTY(EditDefaultsOnly, BlueprintReadOnly, Category = "Character")
    TSoftObjectPtr<USkeletalMesh> CharacterMesh;

    // ì—ì…‹ ë²ˆë“¤ë§ì„ ìœ„í•œ í•¨ìˆ˜
    virtual FPrimaryAssetId GetPrimaryAssetId() const override
    {
        return FPrimaryAssetId("Character", GetFName());
    }
};
```

* ì—¬ê¸°ì„œ ì´ëŸ° ì§ˆë¬¸ì„ í•´ì¤˜ì•¼ í•œë‹¤ ã…ã…
    * ì´ê±¸ êµ³ì´ ì™œ `UPrimaryDataAsset`ì—ì„œ ê´€ë¦¬í•˜ë‚˜?
    * `ACharater`ë¼ëŠ” ìºë¦­í„° ì „ìš© í´ë˜ìŠ¤ê°€ ë”°ë¡œ ìˆì§€ ì•Šë‚˜?

```cpp
// 2. DataAssetì„ ì‚¬ìš©í•œ ë°©ì‹
UCLASS()
class UCharacterDataAsset : public UPrimaryDataAsset
{
    GENERATED_BODY()
    
    UPROPERTY(EditDefaultsOnly)
    TSoftObjectPtr<USkeletalMesh> CharacterMesh;
    
    UPROPERTY(EditDefaultsOnly)
    float Health;
    
    UPROPERTY(EditDefaultsOnly)
    float AttackPower;
};

UCLASS()
class AGameCharacter : public ACharacter
{
    GENERATED_BODY()
    
    UPROPERTY(EditDefaultsOnly)
    UCharacterDataAsset* CharacterData;
};
```

* UPrimaryDataAssetì„ ì‚¬ìš©í•˜ëŠ” ì¥ì :
* ë°ì´í„° ì¬ì‚¬ìš©
    * ì—¬ëŸ¬ ìºë¦­í„°ê°€ ê°™ì€ ë°ì´í„°ë¥¼ ê³µìœ í•  ìˆ˜ ìˆìŒ
    * ë°ì´í„° ìˆ˜ì •ì´ í•œ ê³³ì—ì„œ ì´ë£¨ì–´ì§
* ë°ì´í„°ì™€ ë¡œì§ì˜ ë¶„ë¦¬
    * ìºë¦­í„° í´ë˜ìŠ¤ëŠ” ë™ì‘ ë¡œì§ì—ë§Œ ì§‘ì¤‘
    * ë°ì´í„°ëŠ” ë³„ë„ë¡œ ê´€ë¦¬
* ì—ë””í„°ì—ì„œì˜ ê´€ë¦¬ ìš©ì´ì„±
    * ë°ì´í„°ë§Œ ë”°ë¡œ ëª¨ì•„ì„œ ê´€ë¦¬ ê°€ëŠ¥
    * ë””ìì´ë„ˆê°€ í”„ë¡œê·¸ë˜ë¨¸ ì—†ì´ë„ ë°ì´í„° ìˆ˜ì • ê°€ëŠ¥
* ëŸ°íƒ€ì„ ë°ì´í„° êµì²´
    * ê²Œì„ ì¤‘ì— ìºë¦­í„°ì˜ ë°ì´í„°ë¥¼ ì‰½ê²Œ êµì²´ ê°€ëŠ¥

---

### ë°ì´í„° ì—ì…‹ ë¡œë”© ë° ì‚¬ìš©

* ìš”ê±´ ì‚¬ì‹¤ ìœ„ì™€ ê±°ì˜ ê°™ì€ ì´ìœ ê¸°ì— ì„¤ëª…ì€ ìƒëµ.

```cpp
// ë°ì´í„° ì—ì…‹ ë¡œë”© ë° ì‚¬ìš©

class UCharacterDataAsset;

UCLASS()
class GAME_API AGameCharacter : public ACharacter
{
    GENERATED_BODY()

protected:
    UPROPERTY(EditDefaultsOnly, Category = "Data")
    TSoftObjectPtr<UCharacterDataAsset> CharacterData;

    virtual void BeginPlay() override;
    void LoadCharacterData();
};
```

```cpp
void AGameCharacter::BeginPlay()
{
    Super::BeginPlay();
    LoadCharacterData();
}

void AGameCharacter::LoadCharacterData()
{
    // ë¹„ë™ê¸° ë¡œë”© ì˜ˆì‹œ
    if (!CharacterData.IsNull())
    {
        // ìŠ¤íŠ¸ë¦¼ ê°€ëŠ¥í•œ ì—ì…‹ ë¹„ë™ê¸° ë¡œë“œ
        CharacterData.LoadSynchronous();
        if (UCharacterDataAsset* Data = CharacterData.Get())
        {
            // ë°ì´í„° ì ìš©
            MaxHealth = Data->BaseStats.Health;
            GetCharacterMovement()->MaxWalkSpeed = Data->BaseStats.MoveSpeed;

            // ë©”ì‹œ ë¡œë”© ë° ì ìš©
            if (!Data->CharacterMesh.IsNull())
            {
                USkeletalMesh* Mesh = Data->CharacterMesh.LoadSynchronous();
                GetMesh()->SetSkeletalMesh(Mesh);
            }
        }
    }
}
```

---

### ì—ì…‹ ë§¤ë‹ˆì €ë¥¼ í†µí•œ ë°ì´í„° ê´€ë¦¬

```cpp
// ì—ì…‹ ë§¤ë‹ˆì €ë¥¼ í†µí•œ ë°ì´í„° ê´€ë¦¬

UCLASS()
class GAME_API UGameAssetManager : public UAssetManager
{
    GENERATED_BODY()

public:
    static UGameAssetManager& Get();

    // ì—ì…‹ ë¡œë”© í•¨ìˆ˜
    UCharacterDataAsset* LoadCharacterData(const FPrimaryAssetId& AssetId);

protected:
    virtual void StartInitialLoading() override;
};
```

```cpp
UGameAssetManager& UGameAssetManager::Get()
{
    UGameAssetManager* AssetManager = Cast<UGameAssetManager>(GEngine->AssetManager);
    return *AssetManager;
}

void UGameAssetManager::StartInitialLoading()
{
    Super::StartInitialLoading();

    // ê²Œì„ ì‹œì‘ ì‹œ í•„ìš”í•œ ì—ì…‹ë“¤ ë¯¸ë¦¬ ë¡œë”©
    TArray<FPrimaryAssetId> AssetsToLoad;
    GetPrimaryAssetIdList(FPrimaryAssetType("Character"), AssetsToLoad);
    
    // ë¹„ë™ê¸° ë¡œë”© ìš”ì²­
    LoadPrimaryAssets(AssetsToLoad);
}

UCharacterDataAsset* UGameAssetManager::LoadCharacterData(const FPrimaryAssetId& AssetId)
{
    FSoftObjectPath AssetPath = GetPrimaryAssetPath(AssetId);
    return Cast<UCharacterDataAsset>(AssetPath.TryLoad());
}
```

* ì—¬ê¸°ì„œ ë˜ í•´ì¤˜ì•¼ í•  ì§ˆë¬¸?
    * ì§ì ‘ `UPrimaryDataAsset`ì— ì ‘ê·¼í•˜ë©´ ì–´ë–¨ê¹Œ?

```cpp
// ì—ì…‹ ë§¤ë‹ˆì € ì‚¬ìš©
UCLASS()
class UGameAssetManager : public UAssetManager
{
    GENERATED_BODY()
public:
    static UGameAssetManager& Get();
    
    // ìºì‹±ëœ ë°ì´í„° ì œê³µ
    UCharacterDataAsset* GetCharacterData(const FName& ID);
    
private:
    // ìì£¼ ì‚¬ìš©ë˜ëŠ” ë°ì´í„° ìºì‹±
    UPROPERTY()
    TMap<FName, UCharacterDataAsset*> CachedCharacterData;
};

// ì‚¬ìš© ì˜ˆì‹œ
void AGameMode::SpawnCharacter(const FName& CharacterID)
{
    if (auto* Data = UGameAssetManager::Get().GetCharacterData(CharacterID))
    {
        // ìºì‹±ëœ ë°ì´í„° ì‚¬ìš©
    }
}
```

```cpp
// 1. ì§ì ‘ ì ‘ê·¼ ë°©ì‹
void AGameMode::SpawnCharacter(const FName& CharacterID)
{
    // StaticLoadObjectëŠ” ì´ë¯¸ ë¡œë“œëœ ì—ì…‹ì´ë¼ë„ 
    // ë§¤ë²ˆ ìƒˆë¡œìš´ ì°¸ì¡°ë¥¼ ìƒì„±í•˜ê³  ê²€ìƒ‰í•˜ëŠ” ê³¼ì •ì„ ê±°ì¹¨
    UCharacterDataAsset* Data = Cast<UCharacterDataAsset>(
        StaticLoadObject(UCharacterDataAsset::StaticClass(), nullptr, *Path)
    );
}
```

```cpp
// 2. AssetManager ë°©ì‹
class UGameAssetManager : public UAssetManager
{
private:
    // í•œë²ˆ ë¡œë“œí•œ ì—ì…‹ì€ ìºì‹œì— ì €ì¥
    TMap<FName, UCharacterDataAsset*> CachedAssets;

public:
    UCharacterDataAsset* GetCharacterData(const FName& CharacterID)
    {
        // ìºì‹œëœ ì—ì…‹ì´ ìˆìœ¼ë©´ ë°”ë¡œ ë°˜í™˜
        if (UCharacterDataAsset** Found = CachedAssets.Find(CharacterID))
        {
            return *Found;
        }

        // ì—†ìœ¼ë©´ ë¡œë“œí•˜ê³  ìºì‹œì— ì €ì¥
        UCharacterDataAsset* NewData = LoadAsset(CharacterID);
        CachedAssets.Add(CharacterID, NewData);
        return NewData;
    }
};
```