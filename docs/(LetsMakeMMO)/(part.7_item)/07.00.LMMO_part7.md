---
layout: default
title: "(07. ì•„ì´í…œ)"
parent: "(MMORPG ë§Œë“¤ì–´ ë³´ê¸° ğŸ¤©)"
has_children: true
nav_order: 1
---

```csharp
public override float OnDamaged(BaseObject attacker, float damage)
{
    if (Room == null)
        return 0;

    if (State == EObjectState.Dead)
        return 0;

    damage = Math.Max(damage - TotalStat.Defence, 0);
    TotalStat.Hp = Math.Max(TotalStat.Hp - damage, 0);

    S_ChangeHp changePacket = new S_ChangeHp();
    changePacket.ObjectId = ObjectId;
    changePacket.Hp = TotalStat.Hp;
    changePacket.Mp = TotalStat.Mp;
    changePacket.Damage = damage;
    changePacket.DamageType = EDamageType.Hit;
    Room.Broadcast(CellPos, changePacket);

    if (TotalStat.Hp <= 0)
    {
        // ë°ë¯¸ì§€ë¥¼ ì…ê³  ì£½ê²Œëœë‹¤ë©´
        OnDead(attacker);
    }

    return damage;
}
```

```csharp
public override void OnDead(BaseObject attacker)
{
    if (attacker.IsValid() == false)
        return;
    
    BaseObject owner = attacker.GetOwner();
    if (owner.ObjectType == EGameObjectType.Hero)
    {
        Hero hero = owner as Hero;
        if (hero.Inven.IsInventoryFull() == false)
        {
            RewardData rewardData = GetRandomReward();
            if (rewardData != null)
                DBManager.RewardHero(hero, rewardData);
        }
        
        if (MonsterData.DropTable != null)
            hero.RewardExpAndGold(MonsterData.DropTable);
    }

    _ai.OnDead(attacker);
    base.OnDead(attacker);
}
```