---
layout: default
title: "04-02. Server Update ì£¼ê¸° ê´€ë¦¬"
parent: "(04. ëª¬ìŠ¤í„° ìŠ¤í°)"
grand_parent: "(MMORPG ë§Œë“¤ì–´ ë³´ê¸° ğŸ¤©)"
nav_order: 1
---

## Table of contents
{: .no_toc .text-delta }

1. TOC
{:toc}

---

* [Get Code ğŸŒŸ](https://github.com/Arthur880708/LetMakeMMO/tree/4)

---

* ë§ˆì¹˜ Clientì²˜ëŸ¼ Frameë‹¨ìœ„ë¡œ í•´ë²„ë¦¬ë©´ ì—…ë°ì´íŠ¸ ì£¼ê¸°ê°€ ë„ˆë¬´ ì§§ë‹¤.

```csharp
public void Update()
{
    if (Owner == null || Owner.Room == null)
        return;

    HashSet<BaseObject> currentObjects = GatherObjects();

    List<BaseObject> added = currentObjects.Except(PreviousObjects).ToList();
    if (added.Count > 0)
    {
        S_Spawn spawnPacket = new S_Spawn();

        foreach (BaseObject obj in added)
        {
            if (obj.ObjectType == EGameObjectType.Hero)
            {
                Hero hero = (Hero)obj;
                HeroInfo info = new HeroInfo(); // TODO CHECK
                info.MergeFrom(hero.HeroInfo);
                spawnPacket.Heroes.Add(info);
            }
            else if (obj.ObjectType == EGameObjectType.Monster)
            { 
                Monster monster = (Monster)obj;
                CreatureInfo info = new CreatureInfo();
                info.MergeFrom(monster.CreatureInfo);
                spawnPacket.Creatures.Add(info);
            }
            else
            {
                ObjectInfo info = new ObjectInfo();
                info.MergeFrom(obj.ObjectInfo);
                spawnPacket.Objects.Add(info);
            }
        }

        Owner.Session?.Send(spawnPacket);
    }

    List<BaseObject> removed = PreviousObjects.Except(currentObjects).ToList();
    if (removed.Count > 0)
    {
        S_Despawn despawnPacket = new S_Despawn();

        foreach (BaseObject obj in removed)
        {
            despawnPacket.ObjectIds.Add(obj.ObjectId);
        }

        Owner.Session?.Send(despawnPacket);
    }

    PreviousObjects = currentObjects;

    // ì´ëŸ°ì‹ìœ¼ë¡œ íŠ¹ì • ì‹œê°„í›„ Updateë¥¼ í˜¸ì¶œí•˜ê²Œ ë³€ê²½.
    UpdateJob = Owner.Room.PushAfter(100, Update);
}
```
