---
layout: default
title: "17. Crawling í›„ Telegram Push ì˜ˆì œ"
parent: (Django)
grand_parent: Python
nav_order: 2
---

## Table of contents
{: .no_toc .text-delta }

1. TOC
{:toc}

---

{% raw %}

* [Get Code ğŸŒ](https://github.com/Arthur880708/python.example.use.mysql/tree/4)

---

* ìˆ˜ì •ì‚¬í•­ì´ ë§ì•„ì„œ ì½”ë“œë¥¼ ë³´ëŠ”ê²Œ í¸í•¨
* ëŒ€ëµ ì‚¬ìš©ì€ ì•„ë˜ì™€ ê°™ì´ í•œë‹¤.

```py
from telegram import ForceReply, Update
from telegram.ext import ContextTypes

from data_operations import add_or_update_property_listings, get_property_listings_by_aptNum
from database import init_db

def start_crawling_data(aptnolist):
    from crawler import Crawler
    c = Crawler()

    for no in aptnolist:
        c.crawling_naver_apart(no)
        return_item = c.start()
        add_or_update_property_listings(return_item)

def show_apart_db_data(aptno):
    # 4. ë°ì´í„° ì½ì–´ì˜¤ê¸°
    property_listings = get_property_listings_by_aptNum(aptno)
    if not property_listings:
        print("No property listings found.")
        return

    returnText = ""
    returnText = "\n".join([
        f"ë™: {property.bildNm} ì¸µìˆ˜: {property.flrInfo.split('/')[0]},"
        f" ë§¤ë¬¼í™•ì¸ì¼: {property.cfmYmd}, ê°€ê²©: {property.prcInfo}, ë°©í–¥: {property.direction}"
        for property in property_listings
    ])

    return returnText


async def telegram_bot_msg_handler(update: Update, context: ContextTypes.DEFAULT_TYPE) -> None:
    sendTest = ""
    if update.message.text == "h":
        sendTest = """
ğŸŒğŸŒğŸŒğŸŒğŸŒğŸŒğŸŒğŸŒ\n
ğŸ‘‰ğŸ‘‰ help destk ğŸ‘ˆğŸ‘ˆ\n
c : start crawling\n
n1 : show "ë¡¯ë°ì„ ê²½ 21c" current price\n
n2 : show "ê´‘êµìì´ë”í´ë˜ìŠ¤ 25c" current price\n
ğŸŒğŸŒğŸŒğŸŒğŸŒğŸŒğŸŒğŸŒ
        """
    elif update.message.text == "c":
        start_crawling_data(['102536', '2591'])
        sendTest = "Crawling Finished !!! ğŸ‘¶"
    elif update.message.text == "n1":
        sendTest = "ë¡¯ë°ì„ ê²½ 21c\n"
        sendTest += show_apart_db_data('2591')
    elif update.message.text == "n2":
        sendTest = "ê´‘êµìì´ë”í´ë˜ìŠ¤ 25c\n"
        sendTest += show_apart_db_data('102536')
    else:
        sendTest = "not supported command ğŸ‘¶"
    await update.message.reply_text(sendTest)


def main():
    # 1. db init
    init_db()

    # 2. bot init
    from telegrambot import TelegramBot
    from configManager import ConfigManager
    t = TelegramBot()
    _configManager = ConfigManager()
    token, chat_id = _configManager.get_telegram_token_and_chat_id()
    t.set_token(token)
    t.add_message_hander(telegram_bot_msg_handler)
    t.start_bot()


if __name__ == "__main__":
    main()

```

{% endraw %}