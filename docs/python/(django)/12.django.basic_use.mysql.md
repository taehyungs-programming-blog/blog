---
layout: default
title: "12. MySQL ì‚¬ìš©"
parent: (Django)
grand_parent: Python
nav_order: 2
---

## Table of contents
{: .no_toc .text-delta }

1. TOC
{:toc}

---

{% raw %}

* [Get Code ğŸŒ](https://github.com/Arthur880708/QuantumTrade.BackEnd)
* [ì°¸ê³  ì‚¬ì´íŠ¸ ğŸŒ](https://github.com/hyunyulhenry/quant_py/tree/main)

---

## pymysql ì„¤ì¹˜

```bash
$ pip install pymysql
```

```py
# DB Connect
import pymysql

# ì—ëŸ¬ì—†ì´ ë„˜ì–´ê°„ë‹¤ë©´ ì •ìƒë™ì‘.
db = pymysql.connect(host='localhost', port=3306, user='root', passwd='root', db='{db_name}', charset='utf8')

db
```

---

## TABLE ìƒì„±

* [Get Code ğŸŒ](https://github.com/kthCodeLog/pymysql-tutorial/tree/2)

```py
import pymysql

db = pymysql.connect(host='localhost', port=3306, user='root', passwd='root', db='dave', charset='utf8')

ecommerce = db.cursor()
sql = """
    CREATE TABLE product (
        PRODUCT_CODE VARCHAR(20) NOT NULL,
        TITLE VARCHAR(200) NOT NULL,
        ORI_PRICE INT,
        DISCOUNT_PRICE INT,
        DISCOUNT_PERCENT INT,
        DELIVERY VARCHAR(2),
        PRIMARY KEY(PRODUCT_CODE)
    );
"""

ecommerce.execute(sql)
db.commit()
db.close()
```

```sql
USE dave;
SELECT * FROM product;
```

<p align="center">
  <img src="https://taehyungs-programming-blog.github.io/blog/assets/images/python/mysql/mysql-3-1.png"/>
</p>

---

## ë°ì´í„° ë„£ê¸°

* [Get Code ğŸŒ](https://github.com/kthCodeLog/pymysql-tutorial/tree/3)

```py
import pymysql

db = pymysql.connect(host='localhost', port=3306, user='root', passwd='root', db='dave', charset='utf8')

cursor = db.cursor()

for index in range(10):
    product_code = 215673140 + index + 1
    sql = """INSERT INTO product VALUES(
    '""" + str(product_code) + """', 'ìŠ¤ìœ„íŠ¸ë°”ë‹ˆ ì—¬ë¦„ì‹ ìƒ5900ì›~ë¡±ì›í”¼ìŠ¤í‹°ì…”ì¸ /ê¸´íŒ”/ë°˜íŒ”', 23000, 6900, 70, 'F'); """
    print (sql)
    cursor.execute(sql)

db.commit()
db.close()
```

```sql
USE dave;
SELECT * FROM product;
```

<p align="center">
  <img src="https://taehyungs-programming-blog.github.io/blog/assets/images/python/mysql/mysql-3-2.png"/>
</p>

---

## ë°ì´í„° ì¡°íšŒ

* [Get Code ğŸŒ](https://github.com/kthCodeLog/pymysql-tutorial/tree/4)

```py
import pymysql
db = pymysql.connect(host='localhost', port=3306, user='root', passwd='root', db='dave', charset='utf8')

cursor = db.cursor()
sql = "SELECT * FROM product"
cursor.execute(sql)
result = cursor.fetchone()
print(result)
db.close()
```

---

## UPDATE

```py
# 3. ì»¤ì„œ ê°€ì ¸ì˜¤ê¸°
cursor = db.cursor()

# 4. SQL êµ¬ë¬¸ ë§Œë“¤ê¸°
SQL = """
UPDATE product SET 
    TITLE='ë‹¬ë¦¬ìƒµë¦°ë„¨ì›í”¼ìŠ¤ ë·”ìŠ¤í‹°ì— ì¸ë¨¸ ê°€ë””ê±´ ì½”ë””ì „', 
    ORI_PRICE=33000, 
    DISCOUNT_PRICE=9900, 
    DISCOUNT_PERCENT=70 
    WHERE PRODUCT_CODE='215673141'
"""

# 5. SQL êµ¬ë¬¸ ì‹¤í–‰í•˜ê¸°
cursor.execute(SQL)

# 6. commit í•˜ê¸°
db.commit()

# 7. close í•˜ê¸°
db.close()
```

---

## DELETE

```py
cursor = db.cursor()

SQL = """DELETE FROM product WHERE PRODUCT_CODE='215673142'"""

cursor.execute(SQL)

db.commit()

db.close()
```

---

## Example

* ìš°ì„  sqlë¬¸ì„ í•˜ë‚˜ë§Œë“¤ì–´ë³´ì.

```sql
-- student.sql

DROP DATABASE IF EXISTS student_mgmt;
CREATE DATABASE student_mgmt DEFAULT CHARSET=utf8 COLLATE=utf8_bin;

USE student_mgmt;
DROP TABLE IF EXISTS students;
CREATE TABLE students (
  id TINYINT NOT NULL AUTO_INCREMENT,
  name VARCHAR(10) NOT NULL,
  gender ENUM('man','woman') NOT NULL,  
  -- ENUMì€ man or womanë§Œ ì„ íƒê°€ëŠ¥
  birth DATE NOT NULL,
  english TINYINT NOT NULL,
  math TINYINT NOT NULL,
  korean TINYINT NOT NULL,
  PRIMARY KEY (id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8;
-- ENGINEì€ SQLì—”ì§„ì„ ì„ íƒí•˜ëŠ” ê²ƒì´ë¼ ìƒê°
-- InnoDBëŠ” MySQL Default Engineì •ë„ë¼ ìƒê°í•˜ì(ëª…ì‹œì  ì„ ì–¸)

INSERT INTO students (name, gender, birth, english, math, korean) VALUES ('dave', 'man', '1983-07-16', 90, 80, 71);
INSERT INTO students (name, gender, birth, english, math, korean) VALUES ('minsun', 'woman', '1982-10-16', 30, 88, 60);
INSERT INTO students (name, gender, birth, english, math, korean) VALUES ('david', 'man', '1982-12-10', 78, 77, 30);
INSERT INTO students (name, gender, birth, english, math, korean) VALUES ('jade', 'man', '1979-11-1', 45, 66, 20);
INSERT INTO students (name, gender, birth, english, math, korean) VALUES ('jane', 'man', '1990-11-12', 65, 32, 90);
INSERT INTO students (name, gender, birth, english, math, korean) VALUES ('wage', 'woman', '1982-1-13', 76, 30, 80);
INSERT INTO students (name, gender, birth, english, math, korean) VALUES ('tina', 'woman', '1982-12-3', 87, 62, 71);
```

* ì´ê±¸ pythonìœ¼ë¡œ loadí•´ë³´ì

```py
import pymysql
import pandas as pd

host_name = 'localhost'
host_port = 3306
username = 'root'
password = 'funcoding'
database_name = 'student_mgmt'

db = pymysql.connect(
    host=host_name,     # MySQL Server Address
    port=host_port,          # MySQL Server Port
    user=username,      # MySQL username
    passwd=password,    # password for MySQL username
    db=database_name,   # Database name
    charset='utf8'
)

# Show TABLE
SQL = "SHOW TABLES"
df = pd.read_sql(SQL, db)

# Show DATA
SQL = "SELECT * FROM students"
df = pd.read_sql(SQL, db)
df.to_csv('students.csv', sep=',', index=False, encoding='utf-8')
df
```

{% endraw %}