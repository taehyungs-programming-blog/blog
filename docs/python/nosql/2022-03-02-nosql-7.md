---
layout: default
title: "7. crawlling - 2"
parent: (NoSQL)
grand_parent: Python
nav_order: 1
---

## Table of contents
{: .no_toc .text-delta }

1. TOC
{:toc}

---

* [Get Code ğŸŒ](https://github.com/EasyCoding-7/pymongo_examples/blob/main/pymongo_1/pymongo_1/pymongo_2.py)

---

ğŸš— ìš°ì„  ì§€ë‚œ ì½”ë“œëŠ” ë‹¤ìŒê³¼ ê°™ê³ 

```py
import pymongo
import requests
from bs4 import BeautifulSoup
import re                       # regular expression

# connection db, collection
conn = pymongo.MongoClient(str(ini_parser['aws']['ip']), int(ini_parser['aws']['port']))
actor_db = conn.cine21_actor
actor_collection = actor_db.actor_collection

# crawlling
url = "http://www.cine21.com/rank/person/content"
post_data = dict()
post_data['section'] = 'actor'
post_data['period_start'] = '2020-03'
post_data['gender'] = 'all'
post_data['page'] = 1

res = requests.post(url, data=post_data)

# parsing
soup = BeautifulSoup(res.content, 'html.parser')
actors = soup.select('li.people_li div.name')

print("... before parsing ...")

for actor in actors:
    print(actor.text)

print("... after parsing ...")

# ì •ê·œ í‘œí˜„ì‹ìœ¼ë¡œ ì´ë¦„ë§Œ ë½‘ê¸°
for actor in actors:
    newname = re.sub("\(\w*\)", "", str(actor.text))  # '\(\w*\)' : ê´„í˜¸ì•ˆì˜( \(\) ) ì–´ë–¤ë¬¸ì( w* ) ë“  '' ì‚­ì œí•´ ë‹¬ë¼
    print(newname)
```

ğŸš— ì‹¤í–‰í•´ ë³´ë©´ ...

<p align="center">
  <img src="https://taehyungs-programming-blog.github.io/blog/assets/images/python/nosql/nosql-7-1.png"/>
</p>

ğŸš— í•´ë³´ê³  ì‹¶ì€ê²ƒì€ ë°°ìš°ì˜ ìƒì„¸í˜ì´ì§€ì— ì •ë³´ë¥¼ Crawllingí•˜ëŠ” ê²ƒì´ë‹¤.

<p align="center">
  <img src="https://taehyungs-programming-blog.github.io/blog/assets/images/python/nosql/nosql-7-2.png"/>
</p>

<p align="center">
  <img src="https://taehyungs-programming-blog.github.io/blog/assets/images/python/nosql/nosql-7-3.png"/>
</p>

ğŸš— ì¢€ ë‹¤ë¥¸ ë°©ë²•ìœ¼ë¡œ crawllingì„ í•´ì•¼í•˜ëŠ”ë°

```py
# ê·¸ëƒ¥ ì¶œë ¥í•´ë³´ë©´
for actor in actors:
    print(actor)
```

<p align="center">
  <img src="https://taehyungs-programming-blog.github.io/blog/assets/images/python/nosql/nosql-7-4.png"/>
</p>

* `<div class="name"><a href="/db/person/info/?person_id=57423">ê¹€ìœ¤ì„(7í¸)</a></div>`
    * a íƒœê·¸ ì•„ë˜ href ì†ì„±ì˜ ë°ì´í„°ê°€ í•„ìš”í•˜ë‹¤

```py
for actor in actors:
    print(actor.select_one('a').attrs['href'])
```

<p align="center">
  <img src="https://taehyungs-programming-blog.github.io/blog/assets/images/python/nosql/nosql-7-5.png"/>
</p>

```py
for actor in actors:
    # ì´ëŸ°ì‹ìœ¼ë¡œ ë§í¬ë¥¼ ë§Œë“¤ìˆ˜ ìˆë‹¤.
    print('http://www.cine21.com' + actor.select_one('a').attrs['href'])
```

```py
# ë°°ìš° ìƒì„¸ì •ë³´ ì¶”ì¶œ
for actor in actors:
    # print('http://www.cine21.com' + actor.select_one('a').attrs['href'])
    actor_url = 'http://www.cine21.com' + actor.select_one('a').attrs['href']
    response_actor = requests.get(actor_url)
    soup_actor = BeautifulSoup(response_actor.content, 'html.parser')
    actor_info = soup_actor.select_one('ul.default_info')
    actor_details = actor_info.select('li')
    for item in actor_details:
        print(item)
```

<p align="center">
  <img src="https://taehyungs-programming-blog.github.io/blog/assets/images/python/nosql/nosql-7-6.png"/>
</p>

ğŸš— ì—¬ê¸°ê¹Œì§€ íŒŒì‹±í•˜ë©´ ìœ„ì™€ ê°™ì´ ë‚˜ì˜¤ëŠ”ë° ì¢€ ë” íŒŒì‹±ì´ í•„ìš”í•˜ë‹¤

---

## ì •ê·œí‘œí˜„ì‹ ì´ìš©

ğŸš— tit í•„ë“œì•ˆì˜ ê°’ê¹Œì§€ëŠ” ì•„ë˜ì™€ ê°™ì´ ë½‘ì„ ìˆ˜ ìˆìŒ

```py
for actor in actors:
    # print('http://www.cine21.com' + actor.select_one('a').attrs['href'])
    actor_url = 'http://www.cine21.com' + actor.select_one('a').attrs['href']
    response_actor = requests.get(actor_url)
    soup_actor = BeautifulSoup(response_actor.content, 'html.parser')
    actor_info = soup_actor.select_one('ul.default_info')
    actor_details = actor_info.select('li')
    for item in actor_details:
        # print(item)
        print(item.select_one('span.tit').text)
```

<p align="center">
  <img src="https://taehyungs-programming-blog.github.io/blog/assets/images/python/nosql/nosql-7-7.png"/>
</p>

ğŸš— ë¬¸ì œëŠ” í•„ë“œì˜ ê°’ì„ ë½‘ëŠ” ë°©ë²•ì´ ì—†ë‹¤ëŠ” ê²ƒì´ë‹¤. -> ì •ê·œí‘œí˜„ì‹ì„ ì´ìš©

* Greedy : `.*`
    * `.`ì€ ì •ê·œí‘œí˜„ì‹ì—ì„œ \në¥¼ ì œì™¸í•œ ëª¨ë“  í•œ ê°œì˜ ë¬¸ìë¥¼ ì˜ë¯¸í•œë‹¤.
    * `*`ëŠ” ì• ë¬¸ìê°€ 0ë²ˆ í˜¹ì€ ê·¸ ì´ìƒ ë°˜ë³µë˜ëŠ” íŒ¨í„´
    * `.*`ëŠ” ë¬¸ìê°€ 0ë²ˆ í˜¹ì€ ê·¸ ì´ìƒ ë°˜ë³µ(ëª¨ë“  ë¬¸ìì˜ë¯¸)
        * ê·¸ëŸ¼ `<.*>` ì´ë ‡ê²Œ í‘œí˜„ì‹œ
        * `<li><span class="tit">ì›ì–´ëª…</span>ì£¼ì§€í›ˆ</li>` ì´ê±¸ ì–´ë–»ê²Œ íŒŒì‹±í• ê¹Œ?? 
        * `<li>` , `<span class="tit">` ì´ë ‡ê²Œ ë”°ë¡œ ë”°ë¡œ íŒŒì‹±?
        * Nope `<li><span class="tit">ì›ì–´ëª…</span>ì£¼ì§€í›ˆ</li>`ë¥¼ í•˜ë‚˜ë¡œ ì¸ì‹í•œë‹¤.
        * ë”°ë¡œ ì¸ì‹ì‹œí‚¤ê³ ì í•œë‹¤ë©´ Non-Greedyì´ìš©
* Non-Greedy : `.*?`
* [ì •ê·œí‘œí˜„ì‹ í…ŒìŠ¤íŠ¸ ì‚¬ì´íŠ¸ ğŸŒ](https://regexr.com)

ğŸš— ì •ê·œí‘œí˜„ì‹ì— ë§¤ì¹­ì´ ë˜ëŠ” ë¶€ë¶„ì´ í‘œì‹œê°€ ëœë‹¤.

<p align="center">
  <img src="https://taehyungs-programming-blog.github.io/blog/assets/images/python/nosql/nosql-7-8.png"/>
</p>

```py
# ë°°ìš° ìƒì„¸ì •ë³´ ì¶”ì¶œ(ì •ê·œí‘œí˜„ì‹ ì´ìš©)
for actor in actors:
    # print('http://www.cine21.com' + actor.select_one('a').attrs['href'])
    actor_url = 'http://www.cine21.com' + actor.select_one('a').attrs['href']
    response_actor = requests.get(actor_url)
    soup_actor = BeautifulSoup(response_actor.content, 'html.parser')
    actor_info = soup_actor.select_one('ul.default_info')
    actor_details = actor_info.select('li')
    for item in actor_details:
        # print(item)
        print(item.select_one('span.tit').text)
        actor_value = re.sub('<span.*?>.*?</span>','',str(item))
        print(re.sub('<.*?>','',str(actor_value)))
```

<p align="center">
  <img src="https://taehyungs-programming-blog.github.io/blog/assets/images/python/nosql/nosql-7-9.png"/>
</p>