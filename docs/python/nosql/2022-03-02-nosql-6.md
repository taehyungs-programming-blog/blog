---
layout: default
title: "6. pymongo - crawlling"
parent: (NoSQL)
grand_parent: Python
nav_order: 1
---

## Table of contents
{: .no_toc .text-delta }

1. TOC
{:toc}

---

* [Get Code ğŸŒ](https://github.com/EasyCoding-7/pymongo_examples/tree/main/pymongo_1)

---

## WEB í˜ì´ì§€ í¬ë¡¤ë§ ê¸°ì´ˆ

* GET, POST ë°©ì‹ì— ë”°ë¼ í¬ë¡¤ë§ ë°©ë²•ì´ ë‹¬ë¼ì§„ë‹¤.
    * **GET** : url ìì²´ê°€ ë‹¬ë¼ì§€ê¸°ì— ë‹¬ë¼ì§„ urlë¡œ requestë¥¼ ë³´ë‚´ê³  ë°›ìœ¼ë©´ë¨.
    * **POST** : urlì€ ë‹¬ë¼ì§€ì§€ ì•Šê¸°ì— ê°œë°œì ë„êµ¬ì—ì„œ í™•ì¸í•´ì•¼í•¨.

ğŸ§¸ ë„¤ì´ë²„ ë‰´ìŠ¤ì˜ ê²½ìš° GETë°©ì‹ìœ¼ë¡œ ë‰´ìŠ¤í˜ì´ì§€ë¥¼ ëˆ„ë¥¼ë•Œë§ˆë‹¤ urlì´ ë‹¬ë¼ì§Šì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.

<p align="center">
  <img src="https://taehyungs-programming-blog.github.io/blog/assets/images/python/nosql/nosql-6-1.png"/>
</p>

ğŸ§¸ Cine21ì˜ ê²½ìš° POSTë°©ì‹ìœ¼ë¡œ urlì€ ë‹¬ë¼ì§€ì§€ ì•Šê³  í˜ì´ì§€ë§Œ ë³€ê²½ëœë‹¤.

<p align="center">
  <img src="https://taehyungs-programming-blog.github.io/blog/assets/images/python/nosql/nosql-6-2.png"/>
</p>

ğŸ§¸ ê°œë°œì ë„êµ¬ -> ë„¤íŠ¸ì›Œí¬ -> content í™•ì¸ì‹œ<br>
ğŸ§¸ POST ë°ì´í„° í™•ì¸ê°€ëŠ¥

<p align="center">
  <img src="https://taehyungs-programming-blog.github.io/blog/assets/images/python/nosql/nosql-6-3.png"/>
</p>

```
ìš”ì²­ URL : http://www.cine21.com/rank/person/content
ìš”ì²­ ë©”ì„œë“œ : POST

section: actor
period_start: 2020-03
gender: all
page: 1
```

ğŸ§¸ ê·¸ëŸ¼ ì´ POSTë¥¼ ë™ì¼í•˜ê²Œ ë§Œë“¤ì–´ì„œ requestë¥¼ ë§Œë“¤ì–´ë³´ì

```py

import configparser
import pymongo
import requests
from bs4 import BeautifulSoup
import re                       # regular expression

# connection db, collection
conn = pymongo.MongoClient(str(ini_parser['aws']['ip']), int(ini_parser['aws']['port']))
actor_db = conn.cine21_actor
actor_collection = actor_db.actor_collection

# crawlling
url = "http://www.cine21.com/rank/person/content"
post_data = dict()
post_data['section'] = 'actor'
post_data['period_start'] = '2020-03'
post_data['gender'] = 'all'
post_data['page'] = 1

res = requests.post(url, data=post_data)

# parsing
soup = BeautifulSoup(res.content, 'html.parser')
actors = soup.select('li.people_li div.name')

print("... before paring ...")

for actor in actors:
    print(actor)

print("... after paring ...")

# ì •ê·œ í‘œí˜„ì‹ìœ¼ë¡œ ì´ë¦„ë§Œ ë½‘ê¸°
for actor in actors:
    newname = re.sub("\(\w*\)", "", str(actor))  # '\(\w*\)' : ê´„í˜¸ì•ˆì˜( \(\) ) ì–´ë–¤ë¬¸ì( w* ) ë“  '' ì‚­ì œí•´ ë‹¬ë¼
    print(newname)
```

<p align="center">
  <img src="https://taehyungs-programming-blog.github.io/blog/assets/images/python/nosql/nosql-6-4.png"/>
</p>
