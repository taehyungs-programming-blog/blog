---
layout: default
title: "8. crawlling - 3"
parent: (NoSQL)
grand_parent: Python
nav_order: 1
---

## Table of contents
{: .no_toc .text-delta }

1. TOC
{:toc}

---

* [Get Code ğŸŒ](https://github.com/EasyCoding-7/pymongo_examples/blob/main/pymongo_1/pymongo_1/pymongo_2.py)

---

ğŸ¥½ ì§€ë‚œì½”ë“œ

```py
import pymongo
import requests
from bs4 import BeautifulSoup
import re                       # regular expression

# connection db, collection
conn = pymongo.MongoClient(str(ini_parser['aws']['ip']), int(ini_parser['aws']['port']))
actor_db = conn.cine21_actor
actor_collection = actor_db.actor_collection

# crawlling
url = "http://www.cine21.com/rank/person/content"
post_data = dict()
post_data['section'] = 'actor'
post_data['period_start'] = '2020-03'
post_data['gender'] = 'all'
post_data['page'] = 1

res = requests.post(url, data=post_data)

# parsing
soup = BeautifulSoup(res.content, 'html.parser')
actors = soup.select('li.people_li div.name')

print("... before parsing ...")

for actor in actors:
    print(actor.text)

print("... after parsing ...")

# ì •ê·œ í‘œí˜„ì‹ìœ¼ë¡œ ì´ë¦„ë§Œ ë½‘ê¸°
for actor in actors:
    newname = re.sub("\(\w*\)", "", str(actor.text))  # '\(\w*\)' : ê´„í˜¸ì•ˆì˜( \(\) ) ì–´ë–¤ë¬¸ì( w* ) ë“  '' ì‚­ì œí•´ ë‹¬ë¼
    print(newname)

print("... actor info print ...")

# ë°°ìš° ìƒì„¸ì •ë³´ ì¶”ì¶œ(ì •ê·œí‘œí˜„ì‹ ì´ìš©)
for actor in actors:
    # print('http://www.cine21.com' + actor.select_one('a').attrs['href'])
    actor_url = 'http://www.cine21.com' + actor.select_one('a').attrs['href']
    response_actor = requests.get(actor_url)
    soup_actor = BeautifulSoup(response_actor.content, 'html.parser')
    actor_info = soup_actor.select_one('ul.default_info')
    actor_details = actor_info.select('li')
    for item in actor_details:
        # print(item)
        print(item.select_one('span.tit').text)
        actor_value = re.sub('<span.*?>.*?</span>','',str(item))
        print(re.sub('<.*?>','',str(actor_value)))
```

<p align="center">
  <img src="https://taehyungs-programming-blog.github.io/blog/assets/images/python/nosql/nosql-8-1.png"/>
</p>

ğŸ¥½ ì´ì œ íŒŒì‹±í•œ ë°ì´í„°ë¥¼ mongodbì— ë„£ì–´ë³´ì.<br>
ğŸ¥½ ìš°ì„  íŒŒì‹±í•œ ë°ì´í„°ë¥¼ list, dictë¡œ ë§Œë“¤ì–´ì„œ ê´€ë¦¬í•´ë³´ì.

```py
# ë°°ìš° ìƒì„¸ì •ë³´ ì¶”ì¶œ list, dict ê´€ë¦¬
actors_detail_info_list = list()

for actor in actors:
    # print('http://www.cine21.com' + actor.select_one('a').attrs['href'])
    actor_url = 'http://www.cine21.com' + actor.select_one('a').attrs['href']
    response_actor = requests.get(actor_url)
    soup_actor = BeautifulSoup(response_actor.content, 'html.parser')
    actor_info = soup_actor.select_one('ul.default_info')
    actor_details = actor_info.select('li')

    actor_info_dict = dict()

    for item in actor_details:
        actor_item_filed = item.select_one('span.tit').text
        actor_value = re.sub('<span.*?>.*?</span>','',str(item))
        actor_item_value = re.sub('<.*?>','',str(actor_value))
        actor_info_dict[actor_item_filed] = actor_item_value

    actors_detail_info_list.append(actor_info_dict)

print(actors_detail_info_list)
```

<p align="center">
  <img src="https://taehyungs-programming-blog.github.io/blog/assets/images/python/nosql/nosql-8-2.png"/>
</p>

ğŸ¥½ ì—¬ê¸°ê¹Œì§€í•˜ë©´ mongodbì— ë„£ì„ ì¤€ë¹„ëŠ” ëê³  ... <br>
ğŸ¥½ ì´ê²ƒë§Œ ë„£ê¸°ëŠ” ì•„ì‰¬ìš°ë‹ˆ ëª‡ ê°€ì§€ ë” ë„£ì–´ë³´ì.

<p align="center">
  <img src="https://taehyungs-programming-blog.github.io/blog/assets/images/python/nosql/nosql-8-3.png"/>
</p>

<p align="center">
  <img src="https://taehyungs-programming-blog.github.io/blog/assets/images/python/nosql/nosql-8-4.png"/>
</p>

ğŸ¥½ `num_info` ì•„ë˜ `<strong>`ì„ ë³´ë©´ ë êº¼ ê°™ë‹¤.

```py
# ë°°ìš° í¥í–‰ì§€ìˆ˜ ë½‘ê¸°
actors = soup.select('li.people_li div.name')
hits = soup.select('ul.num_info > li > strong')

print(actors)
print(hits)
```

<p align="center">
  <img src="https://taehyungs-programming-blog.github.io/blog/assets/images/python/nosql/nosql-8-5.png"/>
</p>

ğŸ¥½ ì•½ê°„ íŒŒì‹±ì´ í•„ìš”í•´ ë³´ì¸ë‹¤.

```py
# ë°°ìš° í¥í–‰ì§€ìˆ˜ ë½‘ê¸°
actors = soup.select('li.people_li div.name')
hits = soup.select('ul.num_info > li > strong')

# print(actors)
# print(hits)

for index, actor in enumerate(actors):
    # print(actor)
    print(re.sub('\(\w*\)','',actor.text))
    # print(hits[index])
    print(int(hits[index].text.replace(',', '')))
```

