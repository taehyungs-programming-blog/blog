---
layout: default
title: "9. crawlling - 4"
parent: (NoSQL)
grand_parent: Python
nav_order: 1
---

## Table of contents
{: .no_toc .text-delta }

1. TOC
{:toc}

---

* [Get Code ğŸŒ](https://github.com/EasyCoding-7/pymongo_examples/blob/main/pymongo_1/pymongo_1/pymongo_2.py)

---

ğŸ‘‘ ë°°ìš°ì˜ ëŒ€í‘œì‘ ì •ë³´ë„ í¬ë¡¤ë§í•´ë³´ì.

<p align="center">
  <img src="https://taehyungs-programming-blog.github.io/blog/assets/images/python/nosql/nosql-9-1.png"/>
</p>

<p align="center">
  <img src="https://taehyungs-programming-blog.github.io/blog/assets/images/python/nosql/nosql-9-2.png"/>
</p>

```py
# ë°°ìš° í¥í–‰ì§€ìˆ˜ ë½‘ê¸°
actors = soup.select('li.people_li div.name')
hits = soup.select('ul.num_info > li > strong')
movies = soup.select('ul.mov_list')

# print(actors)
# print(hits)

for index, actor in enumerate(actors):
    # print(actor)
    print(re.sub('\(\w*\)','',actor.text))
    # print(hits[index])
    print(int(hits[index].text.replace(',', '')))
    movie_titles = movies[index].select('li a span')
    for movie in movie_titles:
        print(movie.text)
```

<p align="center">
  <img src="https://taehyungs-programming-blog.github.io/blog/assets/images/python/nosql/nosql-9-3.png"/>
</p>

ğŸ‘‘ ì¶œì—°ì˜í™”ëŠ” ë°°ìš°ë³„ë¡œ ë¦¬ìŠ¤íŠ¸ ê´€ë¦¬í•´ë³´ì.

```py
# ë°°ìš° í¥í–‰ì§€ìˆ˜ ë½‘ê¸°
actors = soup.select('li.people_li div.name')
hits = soup.select('ul.num_info > li > strong')
movies = soup.select('ul.mov_list')

# print(actors)
# print(hits)

for index, actor in enumerate(actors):
    # print(actor)
    print(re.sub('\(\w*\)','',actor.text))
    # print(hits[index])
    print(int(hits[index].text.replace(',', '')))
    movie_titles = movies[index].select('li a span')
    movie_titles_list = list()
    for movie in movie_titles:
        # print(movie.text)
        movie_titles_list.append(movie.text)
    print(movie_titles_list)
```

ğŸ‘‘ `actors_detail_info_list = list()` ë‚´ì— ë°°ìš°ì˜ ì¶œì—°ì‘ ì •ë³´ë¥¼ ë„£ì–´ë³´ì.

```py
# ë°°ìš° ìƒì„¸ì •ë³´ ì¶”ì¶œ list, dict ê´€ë¦¬
actors_detail_info_list = list()

# ë°°ìš° í¥í–‰ì§€ìˆ˜ ë½‘ê¸°
actors = soup.select('li.people_li div.name')
hits = soup.select('ul.num_info > li > strong')
movies = soup.select('ul.mov_list')

for index, actor in enumerate(actors):
    # ë°°ìš°ì´ë¦„(actor_name), hitì ìˆ˜(actor_hits), ëŒ€í‘œì‘ ë¦¬ìŠ¤íŠ¸(movie_titles_list) íŒŒì‹±
    actor_name = re.sub('\(\w*\)','',actor.text)
    actor_hits = int(hits[index].text.replace(',', ''))
    movie_titles = movies[index].select('li a span')
    movie_titles_list = list()
    for movie in movie_titles:
        movie_titles_list.append(movie.text)

    # ë°°ìš° ìƒì„¸ì •ë³´(actor_url)
    actor_url = 'http://www.cine21.com' + actor.select_one('a').attrs['href']
    response_actor = requests.get(actor_url)
    soup_actor = BeautifulSoup(response_actor.content, 'html.parser')
    actor_info = soup_actor.select_one('ul.default_info')
    actor_details = actor_info.select('li')

    actor_info_dict = dict()
    actor_info_dict['ë°°ìš°ì´ë¦„'] = actor_name
    actor_info_dict['hits'] = actor_hits
    actor_info_dict['ì¶œì—°ì‘'] = movie_titles_list

    for item in actor_details:
        actor_item_filed = item.select_one('span.tit').text
        actor_value = re.sub('<span.*?>.*?</span>','',str(item))
        actor_item_value = re.sub('<.*?>','',str(actor_value))
        actor_info_dict[actor_item_filed] = actor_item_value

    actors_detail_info_list.append(actor_info_dict)

print(actors_detail_info_list)
```

<p align="center">
  <img src="https://taehyungs-programming-blog.github.io/blog/assets/images/python/nosql/nosql-9-4.png"/>
</p>

---

ğŸ‘‘ í˜ì´ì§€ ì •ë³´ ê°±ì‹ í•˜ë©° ë°›ê¸°(í˜„ì¬ëŠ” 1í˜ì´ì§€ë§Œ ë°›ìŒ)

* [Get Code ğŸŒ](https://github.com/EasyCoding-7/pymongo_examples/blob/main/pymongo_1/pymongo_1/pymongo_3.py)

```py
# crawlling
url = "http://www.cine21.com/rank/person/content"
post_data = dict()
post_data['section'] = 'actor'
post_data['period_start'] = '2020-03'
post_data['gender'] = 'all'
post_data['page'] = 1                               # ì—¬ê¸°ë¶€í„° ë‹¬ë¼ì ¸ì•¼ í•œë‹¤.
```

```py
import configparser
import pymongo
import requests
from bs4 import BeautifulSoup
import re                       # regular expression

# ë°°ìš° ìƒì„¸ì •ë³´ ì¶”ì¶œ list, dict ê´€ë¦¬
actors_detail_info_list = list()

# read aws ip and port info
iniFile = 'aws_address.ini'
ini_parser = configparser.ConfigParser()
ini_parser.read(iniFile)

# connection db, collection
conn = pymongo.MongoClient(str(ini_parser['aws']['ip']), int(ini_parser['aws']['port']))
actor_db = conn.cine21_actor
actor_collection = actor_db.actor_collection

# crawlling
url = "http://www.cine21.com/rank/person/content"
post_data = dict()
post_data['section'] = 'actor'
post_data['period_start'] = '2020-03'
post_data['gender'] = 'all'

# 20 í˜ì´ì§€ ê¹Œì§€ ë°›ì•„ì˜¤ê²Œ ë³€ê²½
for pindex in range(1, 21):
    post_data['page'] = pindex

    res = requests.post(url, data=post_data)

    # parsing
    soup = BeautifulSoup(res.content, 'html.parser')
    actors = soup.select('li.people_li div.name')

    # ë°°ìš° í¥í–‰ì§€ìˆ˜ ë½‘ê¸°
    actors = soup.select('li.people_li div.name')
    hits = soup.select('ul.num_info > li > strong')
    movies = soup.select('ul.mov_list')

    for index, actor in enumerate(actors):
        # ë°°ìš°ì´ë¦„(actor_name), hitì ìˆ˜(actor_hits), ëŒ€í‘œì‘ ë¦¬ìŠ¤íŠ¸(movie_titles_list) íŒŒì‹±
        actor_name = re.sub('\(\w*\)','',actor.text)
        actor_hits = int(hits[index].text.replace(',', ''))
        movie_titles = movies[index].select('li a span')
        movie_titles_list = list()
        for movie in movie_titles:
            movie_titles_list.append(movie.text)

        # ë°°ìš° ìƒì„¸ì •ë³´(actor_url)
        actor_url = 'http://www.cine21.com' + actor.select_one('a').attrs['href']
        response_actor = requests.get(actor_url)
        soup_actor = BeautifulSoup(response_actor.content, 'html.parser')
        actor_info = soup_actor.select_one('ul.default_info')
        actor_details = actor_info.select('li')

        actor_info_dict = dict()
        actor_info_dict['ë°°ìš°ì´ë¦„'] = actor_name
        actor_info_dict['hits'] = actor_hits
        actor_info_dict['ì¶œì—°ì‘'] = movie_titles_list

        for item in actor_details:
            actor_item_filed = item.select_one('span.tit').text
            actor_value = re.sub('<span.*?>.*?</span>','',str(item))
            actor_item_value = re.sub('<.*?>','',str(actor_value))
            actor_info_dict[actor_item_filed] = actor_item_value

        actors_detail_info_list.append(actor_info_dict)

print(actors_detail_info_list)
```

ğŸ‘‘ í•˜ë‚˜ë§Œ ë” í•´ë³´ì.<br>
ğŸ‘‘ ë­í‚¹ì •ë³´ë¥¼ ë°›ì•„ë³´ì.

<p align="center">
  <img src="https://taehyungs-programming-blog.github.io/blog/assets/images/python/nosql/nosql-9-5.png"/>
</p>

ğŸ‘‘ people_list ì•„ë˜ span gradeì— ìˆìŒ

```py
    # ë°°ìš° í¥í–‰ì§€ìˆ˜ ë½‘ê¸°
    actors = soup.select('li.people_li div.name')
    hits = soup.select('ul.num_info > li > strong')
    movies = soup.select('ul.mov_list')
    rankings = soup.select('li.people_li > span.grade')

    for index, actor in enumerate(actors):
        # ë°°ìš°ì´ë¦„(actor_name), hitì ìˆ˜(actor_hits), ëŒ€í‘œì‘ ë¦¬ìŠ¤íŠ¸(movie_titles_list) íŒŒì‹±
        actor_name = re.sub('\(\w*\)','',actor.text)
        actor_hits = int(hits[index].text.replace(',', ''))
        actor_rank = int(rankings[index].text)
        movie_titles = movies[index].select('li a span')
        movie_titles_list = list()
        for movie in movie_titles:
            movie_titles_list.append(movie.text)

        # ë°°ìš° ìƒì„¸ì •ë³´(actor_url)
        actor_url = 'http://www.cine21.com' + actor.select_one('a').attrs['href']
        response_actor = requests.get(actor_url)
        soup_actor = BeautifulSoup(response_actor.content, 'html.parser')
        actor_info = soup_actor.select_one('ul.default_info')
        actor_details = actor_info.select('li')

        actor_info_dict = dict()
        actor_info_dict['ë°°ìš°ì´ë¦„'] = actor_name
        actor_info_dict['hits'] = actor_hits
        actor_info_dict['rank'] = actor_rank
        actor_info_dict['ì¶œì—°ì‘'] = movie_titles_list
```