---
layout: default
title: "13. mongodb ì¸ë±ìŠ¤"
parent: (NoSQL)
grand_parent: Python
nav_order: 2
---

## Table of contents
{: .no_toc .text-delta }

1. TOC
{:toc}

---

* **INDEX** : ê²€ìƒ‰ì„ ë¹ ë¥´ê²Œ í•´ì£¼ëŠ” íŒŒë¼ë¯¸í„°
    * ê¸°ë³¸ INDEXëŠ” **_id** ì´ë‹¤.
    * Single(ë‹¨ì¼), Compound(ë³µí•©)ìœ¼ë¡œ êµ¬ì„±ë  ìˆ˜ ìˆìŒ.

ğŸ•¶ ê·¸ëŸ¼ í•œ ë²ˆ ì½”ë“œë¡œ í™•ì¸í•´ ë³´ì.<br>
ğŸ•¶ ê¸°ì¡´ì½”ë“œë¥¼ í™œìš©.

* [Get Code ğŸŒ](https://github.com/EasyCoding-7/pymongo_examples/blob/main/pymongo_1/pymongo_1/pymongo_8.py)

```py
import configparser
import pymongo

# read aws ip and port info
iniFile = 'aws_address.ini'
ini_parser = configparser.ConfigParser()
ini_parser.read(iniFile)

# connection db, collection
conn = pymongo.MongoClient(str(ini_parser['aws']['ip']), int(ini_parser['aws']['port']))
actor_db = conn.cine21_actor
actor_collection = actor_db.actor_collection
```

```py
# INDEX ìƒì„±(Single)
actor_collection.create_index('ë°°ìš°ì´ë¦„')
```

```json
{
    '_id_': 
    {
        'v': 2, 
        'key': [('_id', 1)], 
        'ns': 'cine21_actor.actor_collection'
    }, 
    'ë°°ìš°ì´ë¦„_1': 
    {
        'v': 2, 
        'key': [('ë°°ìš°ì´ë¦„', 1)], 
        'ns': 'cine21_actor.actor_collection'
    }
}
```

* key :
    * field name
    * direction (1 : ASCENDING / 2 : DESCENDING)

```py
# ì´ë ‡ê²Œë„ ì„ ì–¸ê°€ëŠ¥
actor_collection.create_index(['ë°°ìš°ì´ë¦„', pymongo.DESCENDING])
```

```py
# indexë¡œ ê²€ìƒ‰ì‹œ ë¬¸ìì—´ ë‹¨ìœ„ë¡œ ê²€ìƒ‰í•˜ê³  ì‹¶ë‹¤ë©´
docs = text_collection.find(
    {
        '$text' :
        {
            '$search' : '\"coffee shop\"'
            # coffee shopì„ í¬í•¨ì‹œ ì¶œë ¥
        }
    }
)
```

```py
# ëŒ€ì†Œë¬¸ì êµ¬ë¶„í•  ê²½ìš°
docs = text_collection.find(
    {
        '$text' :
        {
            '$search' : 'coFFee',
            '$caseSensitive': True
        }
    }
)
```

---

ğŸ•¶ ì´ê²Œ ì •ë§ ì„±ëŠ¥ì— íš¨ê³¼ê°€ ìˆë‚˜???<br>
ğŸ•¶ ì‚¬ì‹¤ ë°ì´í„°ê°€ ì ì„ ê²½ìš° ì„±ëŠ¥ì˜ íš¨ê³¼ëŠ” ë¯¸ë¯¸í•˜ë‹¤.<br>
ğŸ•¶ ê·¸ëŸ¼ ì´ê±¸ ì™œ ì¨ì•¼í•˜ì§€?? ğŸ‘‰ ì•„ë˜ì™€ ê°™ì€ ì¼€ì´ìŠ¤ê°€ ìˆê¸° ë•Œë¬¸ì´ë‹¤.

```py
# textë¡œ indexingì´ ë˜ì–´ìˆì§€ ì•Šê¸°ì— ì•„ë˜ì„œ ì—ëŸ¬ ë¦¬í„´
docs = actor_collection.find( {'$text' : {'$search' : 'ì™•' } } ) # error
for doc in docs:
    print(doc)
```

```py
# text indexë¥¼ ì§€ì •í•´ë³´ì.
actor_collection.create_index( [ ('ì¶œì—°ì‘', 'text') ] )

# ì¬ì‹œë„
docs = actor_collection.find( 
    {
        '$text' : 
        {
            '$search' : 'ì™•' 
        } 
    } 
)
for doc in docs:
    print(doc)
```

---

## Compound(ë³µí•©) Field Indexing

* [Get Code ğŸŒ](https://github.com/EasyCoding-7/pymongo_examples/blob/main/pymongo_1/pymongo_1/pymongo_9.py)

```py
import configparser
import pymongo

# read aws ip and port info
iniFile = 'aws_address.ini'
ini_parser = configparser.ConfigParser()
ini_parser.read(iniFile)

# connection db, collection
conn = pymongo.MongoClient(str(ini_parser['aws']['ip']), int(ini_parser['aws']['port']))
actor_db = conn.cine21_actor
actor_collection = actor_db.actor_collection

# í…ŒìŠ¤íŠ¸ë¥¼ ìœ„í•´ ì²˜ìŒì€ INDEX ì‚­ì œí•´ ì¤€ë‹¤.
actor_collection.drop_indexes()

# compound indexing
actor_collection.create_index(
    [
        ('ì¶œì—°ì‘', pymongo.TEXT),
        ('ì§ì—…', pymongo.TEXT),
        ('hits', pymongo.TEXT)
    ]
)

# ê²€ìƒ‰í•´ ë³´ìë©´
docs = actor_collection.find(
    {
        '$text' : 
        {
            '$search' : 'ê°€ìˆ˜'
        }
    }
)
for doc in docs:
    print(doc)
```
