---
layout: default
title: "10. Rest APIë¥¼ ì´ìš©í•œ LogIn System êµ¬í˜„"
parent: (Django)
grand_parent: Python
nav_order: 2
---

## Table of contents
{: .no_toc .text-delta }

1. TOC
{:toc}

---

* [Get Code ğŸŒ](https://github.com/Arthur880708/QuantumTrade.BackEnd)

---

## Super-User ë“±ë¡

* User ê´€ë¦¬ë¥¼ ìœ„í•´ì„œ Super-User(admin)ì´ í•„ìš”í•˜ë‹¤

```bash
$ python manage.py createsuperuser
```

* ë¥¼ í†µí•´ Super-Userë¥¼ ë§Œë“¤ê³  `http://{ip}/admin` ì—ì„œ Userë¥¼ ë“±ë¡í•˜ì

---

## Log-in System êµ¬í˜„

```py
from django.contrib.auth.models import User

# ì—¬ê¸°ì„œëŠ” Djangoì˜ ê¸°ë³¸ User ëª¨ë¸ì„ ì‚¬ìš©í•©ë‹ˆë‹¤.
# í•„ìš”í•œ ê²½ìš° ì»¤ìŠ¤í…€ User ëª¨ë¸ì„ ìƒì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```

```py
# ê°€ë ¹ Custom í•œë‹¤ë©´ ...

from django.db import models
from django.contrib.auth.models import User

class UserProfile(models.Model):
    user = models.OneToOneField(User, on_delete=models.CASCADE)
    bio = models.TextField(max_length=500, blank=True)
    birth_date = models.DateField(null=True, blank=True)
    location = models.CharField(max_length=30, blank=True)

    def __str__(self):
        return self.user.username

```

* ë‹¨, Customí•œë‹¤ë©´ Migrationì´ í•„ìˆ˜ì„

```bash
python manage.py makemigrations
python manage.py migrate
```

```py
# serializers.py

from django.contrib.auth.models import User
from rest_framework import serializers

class UserSerializer(serializers.ModelSerializer):
    class Meta:
        model = User
        fields = ['username', 'password']
        extra_kwargs = {'password': {'write_only': True}}

    def create(self, validated_data):
        user = User.objects.create_user(**validated_data)
        return user

```

```py
# views.py

from django.contrib.auth.models import User
from rest_framework import views, status
from rest_framework.response import Response
from .serializers import UserSerializer
from django.contrib.auth import authenticate

class LoginView(views.APIView):
    def post(self, request):
        username = request.data.get('username')
        password = request.data.get('password')
        user = authenticate(username=username, password=password)
        if user:
            return Response({"message": "ë¡œê·¸ì¸ ì„±ê³µ"}, status=status.HTTP_200_OK)
        return Response({"message": "ë¡œê·¸ì¸ ì‹¤íŒ¨"}, status=status.HTTP_401_UNAUTHORIZED)

```

```py
# urls.py

from django.urls import path
from .views import LoginView

urlpatterns = [
    path('login/', LoginView.as_view(), name='login'),
]

```

```bash
# curl í…ŒìŠ¤íŠ¸ í•˜ê¸°

curl -X POST http://example.com/api/login/ \
     -H "Content-Type: application/json" \
     -d '{"username": "your_username", "password": "your_password"}'

```

---

## JWTë¥¼ ë°˜ì˜í•´ ë³´ì

* JWTë¥¼ ì™œ ì“°ëƒ?
    * ë§¤ë²ˆ ë¡œê·¸ì¸ í•  ìˆ˜ëŠ” ì—†ì–ìŠ´.

```bash
pip install djangorestframework
pip install djangorestframework-simplejwt
```

```py
# settings.py

INSTALLED_APPS = [
    ...
    'rest_framework',
    ...
]

from datetime import timedelta

REST_FRAMEWORK = {
    'DEFAULT_AUTHENTICATION_CLASSES': (
        'rest_framework_simplejwt.authentication.JWTAuthentication',
    ),
}

SIMPLE_JWT = {
    'ACCESS_TOKEN_LIFETIME': timedelta(minutes=5),
    'REFRESH_TOKEN_LIFETIME': timedelta(days=1),
    'ROTATE_REFRESH_TOKENS': False,
    'BLACKLIST_AFTER_ROTATION': True,

    'ALGORITHM': 'HS256',
    'SIGNING_KEY': SECRET_KEY,
    'VERIFYING_KEY': None,
    'AUTH_HEADER_TYPES': ('Bearer',),
    'USER_ID_FIELD': 'id',
    'USER_ID_CLAIM': 'user_id',
}
```

```py
# urls.py

from django.urls import path
from rest_framework_simplejwt.views import TokenObtainPairView, TokenRefreshView

urlpatterns = [
    ...
    path('api/token/', TokenObtainPairView.as_view(), name='token_obtain_pair'),
    path('api/token/refresh/', TokenRefreshView.as_view(), name='token_refresh'),
    ...
]
```

```py
# views.py

class ItemViewSet(viewsets.ModelViewSet):
    # viewì—ì„œ Authê°€ ìˆì–´ì•¼ ëœë‹¤ê³  ëª…ì‹œí•´ ì¤˜ì•¼í•¨.
    permission_classes = (IsAuthenticated,)

    queryset = Item.objects.all()
    serializer_class = ItemSerializer
```

```bash
# jwt ìš”ì²­
curl -X POST http://localhost:8000/api/token/ \
     -H "Content-Type: application/json" \
     -d '{"username": "your_username", "password": "your_password"}'
```

```bash
# jwt ê°±ì‹ 
curl -X POST http://localhost:8000/api/token/refresh/ \
     -H "Content-Type: application/json" \
     -d '{"refresh": "your_refresh_token"}'
```

```bash
# ì¡°íšŒ
curl -H "Authorization: Bearer your_access_token" http://localhost:8000/your/api/url/
```