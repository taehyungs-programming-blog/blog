---
layout: default
title: "9. Protobuf"
parent: Unity-ì‹¬í™”
grand_parent: "Unity ğŸ¡"
nav_order: 1
---

## Table of contents
{: .no_toc .text-delta }

1. TOC
{:toc}

---

* [Get Code ğŸŒ](https://github.com/EasyCoding-7/UnityPortfolio/tree/9.Protobuf)

---

* [ProtoBuf C# Tutorial ğŸŒ](https://developers.google.com/protocol-buffers/docs/csharptutorial)
* [ProtoBuf v3.12.3 Down ğŸŒ](https://github.com/protocolbuffers/protobuf/releases/tag/v3.12.3)

ğŸ¦ Protobufìì²´ë¥¼ ë¹Œë“œí• ê²Œ ì•„ë‹ˆë¼ë©´ **protoc-3.12.3-win64.zip**ì„ ë‹¤ìš´ë°›ìœ¼ë©´ ëœë‹¤.

<p align="center">
  <img src="https://taehyungs-programming-blog.github.io/blog/assets/images/csharp/unity-adv/unity-adv-9-1.png"/>
</p>

ğŸ¦ Commonì•„ë˜ Protocë¥¼ ë„£ì

<p align="center">
  <img src="https://taehyungs-programming-blog.github.io/blog/assets/images/csharp/unity-adv/unity-adv-9-2.png"/>
</p>

ğŸ¦ ProtoBufì˜ ì‚¬ìš©ì„ ìœ„í•´ì„  NuGetì˜ ì„¤ì¹˜ê°€ í•„ìš”í•˜ë‹¤.

<p align="center">
  <img src="https://taehyungs-programming-blog.github.io/blog/assets/images/csharp/unity-adv/unity-adv-9-3.png"/>
</p>

```bat
:: GenProto.bat

protoc.exe -I=./ --csharp_out=./ ./Protocol.proto 
IF ERRORLEVEL 1 PAUSE

START ../../../Server/PacketGenerator/bin/PacketGenerator.exe ./Protocol.proto
XCOPY /Y Protocol.cs "../../../Client/Assets/Scripts/Packet"
XCOPY /Y Protocol.cs "../../../Server/Server/Packet"
XCOPY /Y ClientPacketManager.cs "../../../Client/Assets/Scripts/Packet"
XCOPY /Y ServerPacketManager.cs "../../../Server/Server/Packet"
```

```csharp
namespace Server
{
	class ClientSession : PacketSession
	{
		public int SessionId { get; set; }

		public override void OnConnected(EndPoint endPoint)
		{
			Console.WriteLine($"OnConnected : {endPoint}");

			// PROTO Test
			S_Chat chat = new S_Chat()
			{
				Context = "ì•ˆë…•í•˜ì„¸ìš”"
			};

			ushort size = (ushort)chat.CalculateSize();
			byte[] sendBuffer = new byte[size + 4];
			Array.Copy(BitConverter.GetBytes(size + 4), 0, sendBuffer, 0, sizeof(ushort));
			ushort protocolId = (ushort)MsgId.SChat;
			Array.Copy(BitConverter.GetBytes(protocolId), 0, sendBuffer, 2, sizeof(ushort));
			Array.Copy(chat.ToByteArray(), 0, sendBuffer, 4, size);

			Send(new ArraySegment<byte>(sendBuffer));

            // ...
```

