---
layout: default
title: "5. Collision"
parent: Unity-ê¸°ì´ˆ
grand_parent: "Unity ğŸ¡"
nav_order: 1
---

## Table of contents
{: .no_toc .text-delta }

1. TOC
{:toc}

---

## Collision ê¸°ë³¸ë™ì‘ í™•ì¸

* Collisionì„ í™•ì¸í•˜ê¸° ìœ„í•´ì„œ Planeì„ í•˜ë‚˜ ì¶”ê°€í•˜ì
* Planeì— ìƒ‰ìƒì´ ì—†ì–´ êµ¬ë¶„ì´ ì–´ë ¤ìš°ë‹ˆ Materialì„ í•˜ë‚˜ ì¶”ê°€í•´ ìƒ‰ìƒê¹Œì§€ ë„£ëŠ”ë‹¤.
    * Create -> Material
    * Albedoì—ì„œ ìƒ‰ì„ ì„ íƒí•˜ë©´ ëœë‹¤.
* Planeì— ìƒì„±í•œ Materialì„ ë“œë˜ê·¸ ì•¤ ë“œë¡­í•´ ë„£ëŠ”ë‹¤.

<p align="center">
  <img src="https://taehyungs-programming-blog.github.io/blog/assets/images/csharp/unity/unity-5-1.png"/>
</p>

* Unity Chanì„ ì¶”ê°€í•˜ê³ , Rigidbodyì™€ Capsule Collider Componentë¥¼ ì¶”ê°€í•œë‹¤.
    * Rigidbody - ë¬¼ë¦¬ì—”ì§€ì„ ì ìš©í•´ ë‹¬ë¼
    * Collider Component - ì¶©ëŒì„ ê°ì§€í•˜ê²Œ í•´ë‹¬ë¼

<p align="center">
  <img src="https://taehyungs-programming-blog.github.io/blog/assets/images/csharp/unity/unity-5-2.png"/>
</p>

* ì°¸ê³ ë¡œ Edit Colliderë¥¼ í´ë¦­í•´ Collsion ë²”ìœ„ë¥¼ ì„¤ì •í• ìˆ˜ ìˆë‹¤.
* ì´ì œ Playë¥¼ ëˆŒëŸ¬ ì–´ë–»ê²Œ ë™ì‘í•˜ëŠ”ì§€ í™•ì¸í•œë‹¤.
    * ì°¸ê³ ë¡œ ë§í•˜ìë©´ Planeì— Mesh Colliderê°€ ì—†ë‹¤ë©´ ê·¸ëƒ¥ Planeì„ ëš«ê³  ì§€ë‚˜ê°€ ë²„ë¦°ë‹¤.

<p align="center">
  <img src="https://taehyungs-programming-blog.github.io/blog/assets/images/csharp/unity/unity-5-3.png"/>
</p>

---

## ë¬¼ì²´ì™€ ì¶©ëŒì´ ì¼ì–´ë‚˜ë©´ ì–´ë–»ê²Œ ë˜ë‚˜ í™•ì¸í•´ ë³´ì.

* Cubeë¥¼ í•˜ë‚˜ ë†“ê³  Unity Chanê³¼ ì¶©ëŒ ì‹œì¼œë³¸ë‹¤.
    * (TIPS) ë©”ì¸ì¹´ë©”ë¼ ëˆ„ë¥¸ìƒíƒœì—ì„œ Control + Shift + f - ë©”ì¸ì¹´ë©”ë¼ ìœ„ì¹˜ë³€ê²½

<p align="center">
  <img src="https://taehyungs-programming-blog.github.io/blog/assets/images/csharp/unity/unity-5-4.png"/>
</p>

* ì—„ì²­ ê³¼ë„í•˜ê²Œ ë°˜ì‘í•¨ì„ ë³¼ ìˆ˜ ìˆëŠ”ë°, Unityì˜ ë¬¼ë¦¬ì—”ì§„ì˜ ì˜í–¥ì´ë‹¤.(is Kinematic)
* ì˜í–¥ì„ ì ê²Œí•˜ë ¤ë©´ Unity-Chanì˜ Rigidbody -> Constrains -> Freeze Rotation X, Y, Zë¥¼ ëª¨ë‘ í‚¤ë©´ ë˜ëŠ”ë° ë°˜ì‘ì´ ì´ìƒí•˜ê¸´ ë§¤í•œê°€ì§€ì´ë‹¤.
* ì´í›„ì— ì •í™•íˆ ì–´ë–»ê²Œ ì²˜ë¦¬í•˜ëŠ”ì§€ ì•Œë ¤ì¤€ë‹¤. ì¼ë‹¨ ì´ëŸ° ì¶©ëŒì´ ê°€ëŠ¥í•˜ë‹¤ê³ ë§Œ ì•Œê³  ìˆì.

---

## ì¶©ëŒì—¬ë¶€ë¥¼ ì½”ë“œì—ì„œ í™•ì¸í•˜ëŠ” ë°©ë²•?

```csharp
public class TestCollision : MonoBehaviour
{
    /*
        OnCollisionEnter ì¡°ê±´
            * ë‚˜í•œí…Œ RigidBody ìˆìŒ (ë‹¨, IsKinematic Off)
            * ë‚˜í•œí…Œ Collider ìˆìŒ (ë‹¨, IsTrigger Off)
            * ìƒëŒ€ì—ê²Œ Collider ìˆìŒ (ë‹¨, IsTrigger Off)
    */
    private void OnCollisionEnter(Collision collision)  // collision : ë‚˜ë‘ Collsionëœ objectì˜ ì •ë³´ê°€ ë“¤ì–´ê°„ë‹¤.
    {
        Debug.Log($"Collision @ {collision.gameObject.name}");
    }

    /*
        OnTriggerEnter ì¡°ê±´
            * ë‘˜ ë‹¤ Collider ìˆìŒ
            * ë‘˜ ì¤‘ í•˜ë‚˜ IsTrigger On
            * ë‘˜ ì¤‘ í•˜ë‚˜ RigidBody ìˆìŒ
    */
    private void OnTriggerEnter(Collider other)
    {
        Debug.Log("Trigger");
    }
```

---

## Raycasting

* ì¸ê²Œì„ í™”ë©´ì—ì„œ ë§ˆìš°ìŠ¤ í´ë¦­ì´ë²¤íŠ¸ë¥¼ ì–´ë–»ê²Œ ì²˜ë¦¬í•´ì•¼í• ê¹Œ?

```csharp
public class TestCollision : MonoBehaviour
{
    // ...

    void Update()
    {
        Debug.DrawRay(transform.position, Vector3.forward * 100, Color.red);
        
        if (Physics.Raycast(transform.position, Vector3.forward, 10/* ê±°ë¦¬ *//))
        {
            Debug.Log("Ray Casted")
        }
    }

    // ...
```

<p align="center">
  <img src="https://taehyungs-programming-blog.github.io/blog/assets/images/csharp/unity/unity-5-5.png"/>
</p>

* ì•„ì§ ë­”ì§€ëŠ” ì˜ ëª¨ë¥´ê² ìœ¼ë‚˜ ë¹¨ê°„ ì„ ì´ ìƒê²¼ìŒì„ ì•Œ ìˆ˜ ìˆë‹¤.

```csharp
public class TestCollision : MonoBehaviour
{
    // ...

    void Update()
    {
        // playerê°€ ë°”ë¼ë³´ëŠ” ì¢Œí‘œë¥¼ worldì¢Œí‘œê³„ë¡œ ì „í™˜
        Vector3 look = transform.TransformDirection(Vector3.forward);
        Debug.DrawRay(transform.position, look, Color.red);
        
        RaycastHit hit;
        if (Physics.Raycast(transform.position, Vector3.forward, out hit ,10))
        {
            Debug.Log($"RayCast {hit.collider.gameObject.name}")
        }

        // Raycastì— ë§ëŠ” ì˜¤ë¸Œì íŠ¸ê°€ ì—¬ëŸ¬ê°œ ì¼ì‹œ
        RaycastHit[] hit;
        hit = Physics.RaycastAll(transform.position, Vector3.forward, out hit ,10)
        foreach(RaycastHit h in hit)
        {
            Debug.Log($"RayCast {h.collider.gameObject.name}")
        }
    }

    // ...
```

---

### Screen, Viewport?

* ì¸ê²Œì„í™”ë©´ì˜ ë§ˆìš°ìŠ¤ì¢Œí‘œë¥¼ ë°›ì•„ì™€ ë³´ì.

```csharp
public class TestCollision : MonoBehaviour
{
    // ...

    void Update()
    {
        // Screen ì¢Œí‘œ(í•´ìƒë„)
        Debug.Log(Input.mousePosition);

        // Viewport ì¢Œí‘œ(-1 ~ 1)
        Debug.Log(Camera.main.ScreenToViewportPoint(Input.mousePosition));
    }

    // ...
```

---

### ë‹¤ì‹œ RayCast

* ì¸ê²Œì„í™”ë©´ì—ì„œ í´ë¦­ì‹œ ì²˜ë¦¬ë¥¼ ì–´ë–»ê²Œ í•˜ëŠ”ì§€ ë‹¤ì‹œ ì–˜ê¸°í•´ ë³´ì.

```csharp
public class TestCollision : MonoBehaviour
{
    // ...

    void Update()
    {
        if(InputGetMouseButtonDown(0))  // ë§ˆìš°ìŠ¤ í´ë¦­ì‹œì—
        {
            Vector3 mouseWorldPos = Camera.main.ScreenToWorldPoint(new Vector3(Input.mousePosition.x, Input.mousePosition.y, Camera.main.nearClipPlane));

            Vector3 dir = mouseWorldPos - Camera.main.transform.position;
            dir = dir.normalized;

            // 1ì´ˆë™ì•ˆ Rayë¥¼ ê·¸ë ¤ì¤€ë‹¤
            Debug.DrawRay(Camera.main.transform.position, dir * 100, Color.red, 1.0f);

            RaycastHit hit;
            if (Physics.Raycast(Camera.main.transform.position, dir, out hit, 100.0f))
            {
                Debug.Log($"RayCast {hit.collider.gameObject.name}")
            }
        }

    // ...
```

* ??? ê·¸ëŸ°ë° ì¸ê²Œì„ì—ì„œ í´ë¦­ ì´ë²¤íŠ¸ ì²˜ë¦¬ëŠ” ë§ì´ ì‚¬ìš©ë êº¼ ê°™ì€ë° ì € ì½”ë“œë¥¼ ë§¤ë²ˆ ì¹œë‹¤ê³ ??<br>
* ì‚¬ì‹¤ Unityì— ì¤€ë¹„ê°€ ë˜ì–´ìˆë‹¤.

```csharp
public class TestCollision : MonoBehaviour
{
    // ...

    void Update()
    {
        if(InputGetMouseButtonDown(0))
        {
            Ray ray = Camera.main.ScreenPointToRay(Input.mousePosition);

            Debug.DrawRay(Camera.main.transform.position, ray.direction * 100.0f, Color.red, 1.0f);

            RaycastHit hit;
            if (Physics.Raycast(ray, out hit, 100.0f))
            {
                Debug.Log($"RayCast {hit.collider.gameObject.name}")
            }

            // ...
```

---

## LayerMast

* Raycast ì‘ì—…ì€ ì—°ì‚°ëŸ‰ì´ ë§ê¸°ì— ëª¨ë“  objectì— Raycastë¥¼ ì ìš©ì‹œ ì„±ëŠ¥ì´ ë‚˜ë¹ ì§„ë‹¤.<br>
* ë”± í•„ìš”í•œ objectì— í•œí•´ì„œ Raycastë¥¼ í•˜ê³ ì í•˜ëŠ”ë° **Layer**ë¥¼ í†µí•´ ì„¤ì •í•˜ê²Œ ëœë‹¤.

<p align="center">
  <img src="https://taehyungs-programming-blog.github.io/blog/assets/images/csharp/unity/unity-5-6.png"/>
</p>

* Layer -> Add Layer ... ì„ íƒ

<p align="center">
  <img src="https://taehyungs-programming-blog.github.io/blog/assets/images/csharp/unity/unity-5-7.png"/>
</p>

* 0 ~ 7ì€ Unityê°€ ì‚¬ìš©ì¤‘ì´ê³  8ë¶€í„° ê°œë°œìê°€ ì„ ì–¸í•  ìˆ˜ ìˆë‹¤.

```csharp
public class TestCollision : MonoBehaviour
{
    // ...

    void Update()
    {
        if(InputGetMouseButtonDown(0))
        {
            Ray ray = Camera.main.ScreenPointToRay(Input.mousePosition);

            Debug.DrawRay(Camera.main.transform.position, ray.direction * 100.0f, Color.red, 1.0f);

            // Layer ìˆœë²ˆì€ bit flagë¡œ ì„ íƒì´ ê°€ëŠ¥(ì•„ë˜ëŠ” 8ë²ˆ layerë¥¼ ì„ íƒ)
            int mask = (1 << 8);
            // int mask = (1 << 8) | (1 << 9);

            // í˜¹ì€ maskì •ë³´ë¥¼ ì´ë¦„ìœ¼ë¡œ ë°›ì„ìˆ˜ ìˆë‹¤.
                // ë­˜ ì“°ë“  ìƒê´€ì—†ìŒ.
            LayerMask mask = LayerMask.GetMask("Monster");

            RaycastHit hit;
            if (Physics.Raycast(ray, out hit, 100.0f, mask))
            {
                Debug.Log($"RayCast {hit.collider.gameObject.name}")

                // í…Œê·¸ì •ë³´ë¡œë„ ì¶œë ¥ê°€ëŠ¥
                Debug.Log($"RayCast print Tag {hit.collider.gameObject.tag}")
            }

            // ...
```

