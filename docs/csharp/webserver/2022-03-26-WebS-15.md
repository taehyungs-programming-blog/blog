---
layout: default
title: "15. Blazor - Dependency Injection"
parent: (WebServer)
grand_parent: "(C#)"
nav_order: 2
---

## Table of contents
{: .no_toc .text-delta }

1. TOC
{:toc}

---

{% raw %}

* [Get Code ğŸŒ](https://github.com/EasyCoding-7/AspNetTutorial/tree/15.Dependency)

## Dependency Injectionì„ ì™œ ì“°ë‚˜?

ğŸ¥ Data/FoodService.cs íŒŒì¼ìƒì„±

```cs
namespace BlazorApp.Data
{
    public class Food
    {
        public string Name { get; set; }
        public int Price { get; set; }
    }

    // ì•„ë˜ì™€ ê°™ì´ FoodServiceë¼ëŠ” í´ë˜ìŠ¤ë¥¼ ë§Œë“¤ì–´ ì‚¬ìš©í•˜ê³ ì í•œë‹¤.
    public class FoodService
    {
        public IEnumerable<Food> GetFoods()
        {
            List<Food> foods = new List<Food>()
            {
                new Food() {Name = "Bibimbap", Price=7000},
                new Food() {Name = "Bibimbap2", Price=3000},
                new Food() {Name = "Bibimbap3", Price=9000}
            };

            return foods;
        }
    }

    // ...
```

ğŸ¥ ì•„ë˜ì™€ ê°™ì´ ì‚¬ìš©í•˜ëŠ”ê²Œ ê³¼ì—° ì¢‹ì€ ë°©ë²•ì¼ê¹Œ?

```xml
@page "/"

@using BlazorApp.Data

<div>
    @foreach (var food in _foodService.GetFoods())
    {
        <div>@food.Name</div>
        <div>@food.Price</div>
    }
</div>

@code {
    // ë§Œì•½ FoodServiceë¥¼ FastFoodServiceë¡œ ë°”ê¾¸ê³ ì í•œë‹¤ë©´?
    // ë§¤ë²ˆ ì½”ë“œë¡œê°€ì„œ FoodServiceë¡œ ì½”ë“œë¥¼ í•˜ë‚˜í•˜ë‚˜ ìˆ˜ì •í•´ì•¼í• ê¹Œ?
    // ì´ëŸ°ì½”ë“œê°€ 1000ê°œë¼ë©´? 1000ê°œë¥¼ ëª¨ë‘??
    FoodService IFoodService _foodService = new FoodService();
}
```

ğŸ¥ ê·¸ë˜ì„œ ë“±ì¥í–ˆë‹¤. Dependency Injection

---

## Dependency Injection ì‚¬ìš©ë²•

```cs
namespace BlazorApp.Data
{
    public class Food
    {
        public string Name { get; set; }
        public int Price { get; set; }
    }

    public interface IFoodService
    {
        IEnumerable<Food> GetFoods();
    }

    // ë§Œì•½ ë°”ë€” ì—¬ì§€ê°€ ìˆì„ê²½ìš° Interfaceë¡œ êµ¬í˜„í•´ ë‘ê³ 
    public class FoodService : IFoodService
    {
        public IEnumerable<Food> GetFoods()
        {
            List<Food> foods = new List<Food>()
            {
                new Food() {Name = "Bibimbap", Price=7000},
                new Food() {Name = "Bibimbap2", Price=3000},
                new Food() {Name = "Bibimbap3", Price=9000}
            };

            return foods;
        }
    }

    public class FastFoodService : IFoodService
    {
        public IEnumerable<Food> GetFoods()
        {
            List<Food> foods = new List<Food>()
            {
                new Food() {Name = "Fast - Bibimbap", Price=7000},
                new Food() {Name = "Fast - Bibimbap2", Price=3000},
                new Food() {Name = "Fast - Bibimbap3", Price=9000}
            };

            return foods;
        }
    }
}
```

```cs
    public class Startup
    {
        // ...

        public void ConfigureServices(IServiceCollection services)
        {
            services.AddRazorPages();
            services.AddServerSideBlazor();
            services.AddSingleton<WeatherForecastService>();

            // Startupì—ì„œ FastFoodServiceë¡œ ì“°ê² ë‹¤ê³  ì•Œë¦°ë‹¤.
            services.AddSingleton<IFoodService, FastFoodService>();
        }

        // ...
```

```xml
@page "/"

@using BlazorApp.Data
<!-- IFoodServiceë¥¼ ì“°ê² ë‹¤ê³  í˜¸ì¶œ  -->
@inject IFoodService foodService;

<div>
    @foreach (var food in foodService.GetFoods())
    {
        <div>@food.Name</div>
        <div>@food.Price</div>
    }
</div>

@code {
    // ì´ì   codeì—ì„œ ë°›ì§€ ì•Šì•„ë„ ëœë‹¤.
}
```

---

##  Dependency Injection ì¥ì 

```cs
// ë‹¤ë¥¸ í´ë˜ìŠ¤ì—ì„œ í˜„ì¬ ì‚¬ìš©ì¤‘ì¸ IFoodServiceë¥¼ ì•Œì•„ì•¼ í•œë‹¤ê³  ê°€ì •í•´ ë³´ì.
public class PaymentService
{
    IFoodService _service;

    public PaymentService(IFoodService service /* IDEì—ì„œ ì•Œì•„ì„œ serviceì— í˜„ì¬ ì‚¬ìš©ì¤‘ì¸ IFoodServiceë¥¼ ë„£ì–´ì¤€ë‹¤. */)
    {
        _service = service;
    }
}
```

```cs
public class Startup
{
    // ...

    public void ConfigureServices(IServiceCollection services)
    {
        services.AddRazorPages();
        services.AddServerSideBlazor();
        services.AddSingleton<WeatherForecastService>();

        services.AddSingleton<IFoodService, FastFoodService>();
        services.AddSingleton<PaymentService>();    // ë“±ë¡ì€ í•´ì¤˜ì•¼ ì“¸ìˆ˜ìˆìŒ.
    }
```

---

## `.AddSingleton()`ë§Œ ìˆì„ê¹Œ?

* [ì°¸ê³  ì‚¬ì´íŠ¸ ğŸŒ](https://aspdotnet.tistory.com/2108)
* ì„¸ ê°€ì§€ê°€ ì¡´ì¬
    * `.AddSingleton()` -  ë”± í•œë²ˆ ì²˜ìŒìœ¼ë¡œ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ìƒì„±í•˜ê³ , ëª¨ë“  í˜¸ì¶œì—ì„œ ë™ì¼í•œ ì˜¤ë¸Œì íŠ¸ë¥¼ ì¬ì‚¬ìš©í•©ë‹ˆë‹¤.
    * `.AddTransient()` - ë§¤ë²ˆ ì¸í„°í˜ì´ìŠ¤ê°€ ìš”ì²­ë  ë•Œë§ˆë‹¤ ìƒˆë¡œìš´ ê°ì²´ë¥¼ ìƒì„±í•©ë‹ˆë‹¤.
    * `.AddScoped()` - ê° HTTP ìš”ì²­ ë‹¹ í•˜ë‚˜ì˜ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ìƒì„±í•˜ë©°, ë™ì¼í•œ ì£¼ì†Œì˜ ì›¹í™”ë©´ë‚´ì„œ ì—¬ëŸ¬ë²ˆ ì´ë¥¼ ì‚¬ìš©í•  ê²½ìš° ë™ì¼í•œ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ì¬ì‚¬ìš©í•©ë‹ˆë‹¤.

{% endraw %}