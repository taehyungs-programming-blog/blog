---
layout: default
title: "21. Example - RankingApp (READ)"
parent: (WebServer)
grand_parent: C#
nav_order: 3
---

## Table of contents
{: .no_toc .text-delta }

1. TOC
{:toc}

---

{% raw %}

* [Get Code ğŸŒ](https://github.com/EasyCoding-7/AspNetTutorial/tree/21.Example)

âš“ Data/Models/GameResult.cs íŒŒì¼ì„ ìƒì„±í•˜ì

```csharp
namespace RankingApp.Data.Models
{
    public class GameResult
    {
        public int Id { get; set; }
        public int UserId { get; set; }
        public string UserName { get; set; }
        public DateTime Date { get; set; }
    }
}
```

âš“ GameResultë¥¼ DBì—ì„œ ì‚¬ìš©í•˜ê¸° ìœ„í•´ì„œ Data/ApplicationDbContext.csì— ì¶”ê°€í•´ ì£¼ì.

```csharp
namespace RankingApp.Data
{
    public class ApplicationDbContext : IdentityDbContext
    {
        public DbSet<GameResult> GameResults { get; set; }

        public ApplicationDbContext(DbContextOptions<ApplicationDbContext> options)
            : base(options)
        {
        }
    }
}
```

âš“ **ë„êµ¬ -> NuGet íŒ¨í‚¤ì§€ ê´€ë¦¬ì -> íŒ¨í‚¤ì§€ ê´€ë¦¬ì ì½˜ì†”**ì— ë“¤ì–´ê°€ DB Migrationì„ í•´ì¤˜ì•¼ í•œë‹¤.

```bash
$ PM> add-migration RankingService
```

<p align="center">
  <img src="https://taehyungs-programming-blog.github.io/blog/assets/images/csharp/webserver/web-21-1.png"/>
</p>

<p align="center">
  <img src="https://taehyungs-programming-blog.github.io/blog/assets/images/csharp/webserver/web-21-2.png"/>
</p>

âš“ DB Migrationì´ ëìŒì„ ì•Œ ìˆ˜ ìˆë‹¤.

```bash
$ PM> update-database
```

âš“ Migrationëœ íŒŒì¼ì„ ë³´ê³  DBë¥¼ Updateì‹œí‚¨ë‹¤.

<p align="center">
  <img src="https://taehyungs-programming-blog.github.io/blog/assets/images/csharp/webserver/web-21-3.png"/>
</p>

âš“ ì„ì˜ë¡œ ë°ì´í„°ë¥¼ ëª‡ê°œ ë„£ì–´ë³´ì.

<p align="center">
  <img src="https://taehyungs-programming-blog.github.io/blog/assets/images/csharp/webserver/web-21-4.png"/>
</p>

âš“ Data/Services/RankingService.cs ë¥¼ ë§Œë“¤ì–´ì£¼ì

```csharp
namespace RankingApp.Data.Services
{
    public class RankingService
    {
        ApplicationDbContext _context;

        // ApplicationDbContextëŠ” IDEì—ì„œ ìƒì„±ì‹œ ë„£ì–´ì¤€ë‹¤.
        public RankingService(ApplicationDbContext context)
        {
            _context = context;
        }

        // contextì— ì´ë¯¸ GameResultê°€ ìˆê³  ì¡°ê±´ì— ë”°ë¼ í˜¸ì¶œí•˜ë©´ ëœë‹¤.

        /*
            public class ApplicationDbContext : IdentityDbContext
            {
                public DbSet<GameResult> GameResults { get; set; }
        */
        public Task<List<GameResult>> GetGameResultAsync()
        {
            List<GameResult> results = _context.GameResults
                                        .OrderByDescending(item => item.UserId)                        
                                        .ToList();

            return Task.FromResult(results);
        }
    }
}
```

```csharp
public class Startup
{
    // ...

    public void ConfigureServices(IServiceCollection services)
    {
        services.AddDbContext<ApplicationDbContext>(options =>
            options.UseSqlServer(
                Configuration.GetConnectionString("DefaultConnection")));
        services.AddDefaultIdentity<IdentityUser>(options => options.SignIn.RequireConfirmedAccount = true)
            .AddEntityFrameworkStores<ApplicationDbContext>();
        services.AddRazorPages();
        services.AddServerSideBlazor();
        services.AddScoped<AuthenticationStateProvider, RevalidatingIdentityAuthenticationStateProvider<IdentityUser>>();
        services.AddSingleton<WeatherForecastService>();

        // Serviceë“±ë¡ì´ í•„ìš”í•˜ë‹¤.
        services.AddScoped<RankingService>();
    }
```

âš“ ë°ì´í„° í™•ì¸ìš© í˜ì´ì§€ Pages/Ranking.razor ìƒì„±

```xml
@page "/ranking"

@using RankingApp.Data.Models
@using RankingApp.Data.Services

@inject RankingService RankingService

<h3>Ranking</h3>

@if (_gameResults == null)
{
    <p><em>Loading...</em></p>
}
else
{
    <table class="table">
        <thead>
            <tr>
                <th>UserName</th>
                <th>Score</th>
                <th>Date</th>
            </tr>
        </thead>
        <tbody>
            @foreach (var gameResult in _gameResults)
            {
                <tr>
                    <td>@gameResult.UserName</td>
                    <td>@gameResult.UserId</td>
                    <td>@gameResult.Date.ToShortDateString()</td>
                </tr>
            }
        </tbody>
    </table>
}

@code {
    List<GameResult> _gameResults;

    protected override async Task OnInitializedAsync()
    {
        _gameResults = await RankingService.GetGameResultAsync();
    }
}
```

<p align="center">
  <img src="https://taehyungs-programming-blog.github.io/blog/assets/images/csharp/webserver/web-21-5.png"/>
</p>

---

## ë„ˆë¬´ í›…í›… ì§€ë‚˜ê°„ ëŠë‚Œì´ ì—†ì§€ ì•Šì•„ì„œ ì¬ ì •ë¦¬.

### DBë¡œ ì‚¬ìš©í•  í´ë˜ìŠ¤ë¥¼ ìƒì„±

âš“ Data/Models/GameResult.cs íŒŒì¼ì„ ìƒì„±

```csharp
namespace RankingApp.Data.Models
{
    public class GameResult
    {
        public int Id { get; set; }
        public int UserId { get; set; }
        public string UserName { get; set; }
        public DateTime Date { get; set; }
    }
}
```

âš“ GameResult.csë¥¼ ì‚¬ìš©í•˜ê¸° ìœ„í•´ì„œ Data/ApplicationDbContext.csì— ì•„ë˜ ì½”ë“œë¥¼ ì¶”ê°€í•´ ì£¼ì.

```csharp
namespace RankingApp.Data
{
    public class ApplicationDbContext : IdentityDbContext
    {
        // GameResultsë¥¼ ì“¸ ì˜ˆì •
        public DbSet<GameResult> GameResults { get; set; }

        // ...
```

âš“ ì´ì œ DB Migration

```bash
$ PM> add-migration RankingService
$ PM> update-database
```

âš“ DBë¥¼ ì½ì–´ì˜¬ Serviceìƒì„±

```csharp
namespace RankingApp.Data.Services
{
    public class RankingService
    {
        ApplicationDbContext _context;

        public RankingService(ApplicationDbContext context)
        {
            _context = context;
        }

        public Task<List<GameResult>> GetGameResultAsync()
        {
            List<GameResult> results = _context.GameResults
                                        .OrderByDescending(item => item.UserId)                        
                                        .ToList();

            return Task.FromResult(results);
        }
    }
}
```

```csharp
public class Startup
{
    // ...

    public void ConfigureServices(IServiceCollection services)
    {
        // ...

        // ì‚¬ìš©í•˜ë ¤ë©´ Serviceë“±ë¡ì´ í•„ìš”í•˜ë‹¤.
        services.AddScoped<RankingService>();
    }
```

âš“ ë°ì´í„° í™•ì¸ìš© í˜ì´ì§€ Pages/Ranking.razor ìƒì„±

```xml
@page "/ranking"

@using RankingApp.Data.Models
@using RankingApp.Data.Services

@inject RankingService RankingService

<h3>Ranking</h3>

@if (_gameResults == null)
{
    <p><em>Loading...</em></p>
}
else
{
    <table class="table">
        <thead>
            <tr>
                <th>UserName</th>
                <th>Score</th>
                <th>Date</th>
            </tr>
        </thead>
        <tbody>
            @foreach (var gameResult in _gameResults)
            {
                <tr>
                    <td>@gameResult.UserName</td>
                    <td>@gameResult.UserId</td>
                    <td>@gameResult.Date.ToShortDateString()</td>
                </tr>
            }
        </tbody>
    </table>
}

@code {
    List<GameResult> _gameResults;

    protected override async Task OnInitializedAsync()
    {
        _gameResults = await RankingService.GetGameResultAsync();
    }
}
```

{% endraw %}