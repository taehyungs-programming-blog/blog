---
layout: default
title: "18. Blazor - State"
parent: (WebServer)
grand_parent: "(C#)"
nav_order: 2
---

## Table of contents
{: .no_toc .text-delta }

1. TOC
{:toc}

---

{% raw %}

* [Get Code ğŸŒ](https://github.com/EasyCoding-7/AspNetTutorial/tree/18.State)

ğŸš— Counterì—ì„œ Countë¥¼ ì €ì¥í•˜ê²Œ í•˜ê³ ìí•œë‹¤.

<p align="center">
  <img src="https://taehyungs-programming-blog.github.io/blog/assets/images/csharp/webserver/web-18-1.png"/>
</p>

ğŸš— Data/CounterState.csë¥¼ ë§Œë“¤ì

```cs
// Data/CounterState.cs

namespace BlazorApp.Data
{
    public class CounterState
    {
        public int Count { get; set; }
    }
}
```

```cs
// Startup.cs

public class Startup
{
    // ...

    public void ConfigureServices(IServiceCollection services)
    {
        services.AddRazorPages();
        services.AddServerSideBlazor();
        services.AddSingleton<WeatherForecastService>();

        // CounterStateë¥¼ ë“±ë¡í•˜ì.
        services.AddScoped<CounterState>();
    }
```

```xml
<!-- Pages/Counter.razor -->
@page "/counter"

@inject BlazorApp.Data.CounterState CounterState

<h1>Counter</h1>

<p>Current count: @CounterState.Count</p>

<button class="btn btn-primary" @onclick="IncrementCount">Click me</button>

@code {
    private void IncrementCount()
    {
        CounterState.Count++;
    }
}
```

ğŸš— ì˜ ì €ì¥ì´ ëœë‹¤. ì´ì œ ë? <br>
ğŸš— ì•„ë˜ í•˜ë‚˜ë§Œ ë” í…ŒìŠ¤íŠ¸ í•´ë³´ì.

```xml
<!-- Pages/NavMenu.razor -->

@inject BlazorApp.Data.CounterState CounterState

<div class="top-row pl-4 navbar navbar-dark">
    <a class="navbar-brand" href="">BlazorApp</a>
    <button class="navbar-toggler" @onclick="ToggleNavMenu">
        <span class="navbar-toggler-icon"></span>
    </button>
</div>

<div class="@NavMenuCssClass" @onclick="ToggleNavMenu">
    <ul class="nav flex-column">
        <li class="nav-item px-3">
            <NavLink class="nav-link" href="" Match="NavLinkMatch.All">
                <span class="oi oi-home" aria-hidden="true"></span> Home
            </NavLink>
        </li>
        <li class="nav-item px-3">
            <NavLink class="nav-link" href="counter">
                <span class="oi oi-plus" aria-hidden="true"></span> Counter
            </NavLink>
        </li>
        <li class="nav-item px-3">
            <NavLink class="nav-link" href="fetchdata">
                <span class="oi oi-list-rich" aria-hidden="true"></span> Fetch data
            </NavLink>
        </li>
    </ul>
</div>

<div>
    <p style="color:white">Counter: @CounterState.Count</p>
</div>

@code {
    private bool collapseNavMenu = true;

    private string NavMenuCssClass => collapseNavMenu ? "collapse" : null;

    private void ToggleNavMenu()
    {
        collapseNavMenu = !collapseNavMenu;
    }
}
```

<p align="center">
  <img src="https://taehyungs-programming-blog.github.io/blog/assets/images/csharp/webserver/web-18-2.png"/>
</p>

ğŸš— ë ìš©? ì—…ë°ì´íŠ¸ê°€ ì•ˆë˜ë„¤?

```cs
public class CounterState
{
    int _count = 0;

    public Action OnStateChanged;

    public int Count
    {
        get
        {
            return _count;
        }

        set
        {
            _count = value;
            Refresh();
        }
    }

    void Refresh()
    {
        OnStateChanged.Invoke();
    }
}
```

```xml
@inject BlazorApp.Data.CounterState CounterState
@implements IDisposable

<div class="top-row pl-4 navbar navbar-dark">
    <a class="navbar-brand" href="">BlazorApp</a>
    <button class="navbar-toggler" @onclick="ToggleNavMenu">
        <span class="navbar-toggler-icon"></span>
    </button>
</div>

<div class="@NavMenuCssClass" @onclick="ToggleNavMenu">
    <ul class="nav flex-column">
        <li class="nav-item px-3">
            <NavLink class="nav-link" href="" Match="NavLinkMatch.All">
                <span class="oi oi-home" aria-hidden="true"></span> Home
            </NavLink>
        </li>
        <li class="nav-item px-3">
            <NavLink class="nav-link" href="counter">
                <span class="oi oi-plus" aria-hidden="true"></span> Counter
            </NavLink>
        </li>
        <li class="nav-item px-3">
            <NavLink class="nav-link" href="fetchdata">
                <span class="oi oi-list-rich" aria-hidden="true"></span> Fetch data
            </NavLink>
        </li>
    </ul>
</div>

<div>
    <p style="color:white">Counter: @CounterState.Count</p>
</div>

@code {
    private bool collapseNavMenu = true;

    private string NavMenuCssClass => collapseNavMenu ? "collapse" : null;

    private void ToggleNavMenu()
    {
        collapseNavMenu = !collapseNavMenu;
    }

    protected override void OnInitialized()
    {
        CounterState.OnStateChanged += onStateChanged;
    }

    void onStateChanged()
    {
        this.StateHasChanged();
    }

    // í•´ì œë ë•Œ Actionì—ì„œ ì œì™¸
    void IDisposable.Dispose()
    {
        CounterState.OnStateChanged -= onStateChanged;
    }
}
```

{% endraw %}

